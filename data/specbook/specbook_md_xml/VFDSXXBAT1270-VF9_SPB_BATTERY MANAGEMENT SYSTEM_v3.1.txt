
<filename>VFDSXXBAT1270-VF9_SPB_BATTERY MANAGEMENT SYSTEM_v3.1</filename>
<pages>

<page number="1">
Specification Book.  

Third Edition (08.2022).  

**BMS_BATTERY_MANAGEMENT_SYSTEM Specification Book (SPB).**  

Responsibly contact - BPI Team – (PIC - Rajendra Rajavelu (v.rajendrar@vines.net.vn)).  

Copyright: "The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization is prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. Nothing in this standard supersedes applicable laws and regulations."
</page>

<page number="2">
Contents.

1. General Document Guidelines.  
1.1. Purpose.  
1.2. Language.  
1.3. Obligation of Requirement Wording.  
1.4. Abbreviations.  

2. General Project Guidelines.  
2.1. Development Scope Abstract.  
2.2. VF9 Variant.  

3. BMS SW components sequence diagram.  
3.1. BMS Startup.  
3.2. BMS Wake up Run Sequence.  
3.3. BMS Shutdown sequence diagram.  

4. Process Flow Charts.  
4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram.  
4.2. Turn off HV (Power down) sequence diagram.  
4.3. Thermal control HVBP sequence diagram.  
4.4. AC/DC Charging sequence diagram.  
4.5. Pre-conditioning Wakeup flow chart.  

5. BMS - Non Functional Architecture Description.  
5.1. Assumption: BMS Functional Content with following conditions.  
5.2. Pack Power Map parameters.  
5.3. HVBP Threshold calibration parameters.  

6. HVBP - Functional Architecture Description.  
6.1. BMS Function List.  
6.2. BMS State Transition Control (BSTC).  
6.3. BSTC – HVBP Operation System Status.  

7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge).  
7.1. CTC - Function Description.  
7.2. CTC - Contactor Closing.  
7.3. CTC - Contactor Opening.  
7.4. CTC - Pre-charge check.  
7.5. CTC - Overheating of pre-charge resistor.  
7.6. CTC - Emergency contactor open state.  
7.7. CTC - Contactor Error Acknowledge.  
7.8. CTC - Contactor Weld check.  
7.9. CTC - Contactor Aging Observer.  
7.10. CTC - Aging of contactor.  

8. BPIU - Battery Pack current voltage protection limits.  
8.1. BPIU - Cell Voltage Min Max Identification.  
8.2. BPIU - Cell Voltage Protection Limits.
</page>

<page number="3">
Contents.

8. BPIU - Battery Pack Current Voltage Protection Limits.
8.3. BPIU - Voltage Acquisition Plausibility  38
8.4. BPIU - Cell Voltage Deviation  42
8.5. BPIU - Cell Temperature Deviation  43

9. MCC - Module Controller Control.
9.1. MCC - Cell Voltage Sensing  44
9.2. MCC - Module Voltage  44
9.3. MCC - Module Temperature  44
9.4. MCC - Cell Balancing 44
9.5. MCC - Temperature Sensor Fault Monitoring– Number of Sensors  46
9.6. MCC - FUSA  46

10. Battery Thermal Handling Management (BTHM).
10.1. BTHM - Function Description  48
10.2. BTHM - Data Preparation  48
10.3. BTHM - Thermal Control  49
10.4. BTHM - Thermal Loop in Vehicle  50
10.5. BTHM - BDU Temperature Sensor Control  55
10.6. BTHM - BDU Thermal Runaway Detection  56

11. Battery Vehicle Communication.
11.1. BVC - Function Description  57
11.2. BVC - VCU State Request  57
11.3. BVC - Discharge Power 3D Data  58
11.4. BVC - HMI (MHU/IPC) Communication  61

12. BCTE - Battery Charge Time Estimation.
12.1. BCTE - Function Overview  64
12.2. BCTE - Function Description  64

13. BWLD - Battery Warranty Logistic Data.
13.1. BWLD - Function Overview  65
13.2. BWLD - Function Description  65

14. BPP - Battery Protection Pack.
14.1. BPP - Function Description  67
14.2. BPP - Pack Resistance  67
14.3. BPP - Cell Temperature Limit  67
14.4. BPP - Controller Temperature Limit  67
14.5. BPP - SOC Limit  68
14.6. BPP - SOH Limit  68
14.7. BPP - Pack Voltage Limit  68
14.8. BPP - Contactor Release Inhibition  69

15. CDEM - Common Diagnostic Event Manager.
15.1. CDEM - Architecture Overview  70
15.2. CDEM - Function Description  71
15.3. CDEM_ErrDisp  73
15.4. CDEM_ReadStsAryCmd_P  73
15.5. CDEM_Clear Status Array  73
</page>

<page number="4">
Contents.

16. DEH - Diagnostic Event Handling.  
16.1. DEH - Function Overview.  
16.2. DEH - Function Description.  

17. BISC - Battery Current Sensor Communication.  
17.1. BISC - Pack Current Measurements.  
17.2. BISC - Function Description.  

18. BILC - Battery Current Limit Coordinator.  
18.1. BILC - Function Description.  
18.2. BILC - Over Current Function description.  

19. EHPN - Electrical Hazard Protection Network (Insulation detection).  
19.1. EHPN - ISO Function Description.  
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock).  

20. SOX - Cell balance.  
20.1. SOX - Cell Balance Function description.  
20.2. SOX - SOC Function description.  
20.3. SOX - SOH Function description.  
20.4. SOX - SOP Function Description.  

21. HW Crash Signal.  
21.1. HW - crash Function description.  
21.2. Wakeup.  
21.3. SFM - Safety Fault Monitoring.  
21.4. E2E Protection.  

22. BMS Diagnostics.  
22.1. Diagnostics Implementation Architecture.  

23. Mechanical Requirements.  
23.1. Electromagnetic Compatibility.  
23.2. Electrostatic Discharge.  
23.3. Climatic Requirements / Thermal Management.  

24. Testing and Validation.  
24.1. Proof of Compliance.  
24.2. Testing Plan for BMS (DVP Plan).  

25. Vehicle Requirement.
</page>

<page number="5">
List of Figure:
Figure 1: BMS SW Startup sequence diagram.  
Figure 2: BMS Wake-up Run Sequence diagram.  
Figure 3: BMS SHUTDOWN diagram.  
Figure 4: Wake up BMS & Turn on HV (Power up) diagram.  
Figure 5: Turn off HV (Power down) diagram.  
Figure 6: Thermal control sequence diagram.  
Figure 7: AC/DC charging sequence diagram.  
Figure 8: Pre-conditioning Wakeup flow chart.  
Figure 9: BMS State Flow.  
Figure 10: Contactor Control.  
Figure 11: HV_ON Sequence.  
Figure 12: HV_OFF Sequence.  
Figure 13: HV Measurement Points.  
Figure 14: Cell Operation Temperature.  
Figure 15: NTC Position in Module.  
Figure 16: BTHM - Thermal control system.  
Figure 17: Thermal Loop in Vehicle.  
Figure 18: Over Current Configuration.  
Figure 19: CDEM Architecture.  
Figure 20: DCEM Code Blocks.  
Figure 21: DEM Module Function.  
Figure 22: Pack Isolation Detection.  
Figure 23: Vehicle Isolation Detection.  
Figure 24: HVIL Mechanization.  
Figure 25: Crash Signal Receiver HW circuit.  
Figure 26: Diagnostics Architecture.
</page>

<page number="6">
Approval confirmed by:

- Function: BPD Head  
  Name: Stanislav Steve Nikulin  

- Function: Project Manager  
  Name: Trịnh Duy Hiệp  

- Function: Chief Engineer  
  Name: Şimşek Mustafa  

- Function: SW Manager  
  Name: Nguyễn Văn Tiệp  

- Function: Hardware Manager  
  Name: Đào Văn Quỳnh  

- Function: System Manager  
  Name: Rajendra Rajavelu  

- Function: ME Manager  
  Name: Hoàng Anh Tài  

- Function: Functional Safety Manager  
  Name: Rajendra Rajavelu  

- Function: High Voltage Attributes Manager  
  Name: Vũ Đức Phúc  

- Function: BMS integration & Pack level test  
  Name: Nguyễn Văn Tiệp  

- Function: QA leader  
  Name: Tạ Phi Hùng
</page>

<page number="7">
Approval confirmed by:
- BPD Head: Stanislav Steve Nikulin.
- Project Manager: Trịnh Duy Hiệp.
- Chief Engineer: Şimşek Mustafa.
- SW Manager: Nguyễn Văn Tiệp.
- Hardware Manager: Đào Văn Quỳnh.
- System Manager: Rajendra Rajavelu.
- ME Manager: Hoàng Anh Tài.
- Functional Safety Manager: Rajendra Rajavelu.
- High Voltage Attributes Manager: Vũ Đức Phúc.
- BMS integration & Pack level test: Nguyễn Văn Tiệp.
- QA leader: Tạ Phi Hùng.

Revisions since previous version:
1. Main Version 1.0: First edition, dated 11/2021.
2. Sub-version 1.1: Updated by Rajendra Rajavelu on 03/2022.

Main Version 2.0:
- Second edition, updated by Rajendra Hùng on 05/2022, included:
  - Changes to the header with VinES logo, ID number, and footer version 2.0.
  - Font corrections (Arial, size 11 for body, size 10 for tables).
  - Corrections to item 1.4 abbreviation, and information for vehicle variant (item 2.2).
  - Addition of item 4.5 (Pre-conditioning Wakeup Flow Chart).
  - Updates to the BMS Function List (Thermal control, BMS Wakeup, Low Voltage Monitoring).
  - Description of power function degradation added to BMS State Algorithms table.
  - Figure 14 corrected (Cell Operation Temperature).
  - Corrections to the Signal I/O table description for item 8.5 (BPIU – Cell Temperature Deviation).
  - Thermal Loop in Vehicle (item 10.4) updated with chiller ON/OFF mode, mass flowrate table, and heating condition mode.
  - Updates for VF9 description in item 11.3.BVC (Discharge power 3D Data).
  - Misspelling corrections.

Main Version 3.0:
- Third edition, dated 06/2022.
- Updates included:
  - BDU temperature limits in item 10.5.BTHM.
  - AC/DC Charging profile for SFC in 11.3.BVC.
  - Misspelling corrections.

Sub-version 3.1:
- Updated by Nguyễn Văn Tiệp on 08/2022.
- Updates included:
  - Diagram updates:
    - Power up process diagram (item 4.1).
    - Power down process diagram (item 4.2).
    - Thermal control HVBP (item 4.3).
    - AC/DC charging sequence diagram (item 4.4, addition of VCU_ACChgGunIn signal).
  - SFC profile updates (item 11.3).
</page>

<page number="8">
1. General Document Guidelines.

1.1. Purpose.  
This version is a production version specification, which provides the information regarding the Battery Management System. This document consists of Battery Management System working concept explanation in detail with respect to the functionality built and signals used to communicate with other ECUs at different conditions. 

Currently, this document is made by considering the scope of requirements, but the detailed working concept will be verified and validated, since this is the working concept, which is looked at the overall concept level.

1.2. Language.  
This document is written in English.  
All official project documentations must be written in English. If documents are bilingual, the English text is binding.

1.3. Obligation of Requirement Wording.  
The following wording rules are used throughout this document:  

No | Terms | Definition  
--- | --- | ---  
1 | "Shall" | The word "shall" is used to state a binding requirement. Such requirements are externally verifiable by manipulation or observation.  
2 | "Should" | The word "should" is used for preferences or desires in implementation that are not strictly binding.  
3 | "May" | The word "may" is used to denote options that are left to the implementer.  
4 | "Must" | To denote legally binding requirements.  
5 | "Shall NOT" | Denotes an absolute prohibition.  
6 | "Cell" | The word "may" is used to denote a brick of cells in the battery pack.
</page>

<page number="9">
## 1. General Document Guidelines.

### 1.1. Purpose.
This version is a production version specification, which provides the information regarding the Battery Management System. This document consists of Battery Management System working concept explanation in detail with respect to the functionality built and signals used to communicate with other ECUs in different conditions.

Currently, this document is made by considering the scope of requirements, but the detailed working concept will be verified and validated, since this is the working concept, which is looked at the overall concept level.

---

### 1.2. Language.
This document is written in English.  
All official project documentations must be written in English. If documents are bilingual, the English text is binding.

---

### 1.3. Obligation of Requirement Wording.
The following wording rules are used throughout this document:

| **No** | **Terms**      | **Definition**                                                                                                                                 |
|--------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 1      | “Shall”        | The word “shall” be used to state a binding requirement. Such requirements are externally verifiable by manipulation or observation.           |
| 2      | “Should”       | The word “should” be used for preferences or desires in implementation that are not strictly binding.                                         |
| 3      | “May”          | The word “may” be used to denote options that are left to the implementer.                                                                     |
| 4      | “Must”         | To denote legally binding requirements.                                                                                                     |
| 5      | “Shall NOT”    | Denotes an absolute prohibition.                                                                                                              |
| 6      | “Cell”         | The word “may” be used to denote a brick of cells in the battery pack.                                                                        |

---

### 1.4. Abbreviations.

#### List of Abbreviations.

| **Abbreviation**  | **Meaning**                                                                                                   |
|--------------------|---------------------------------------------------------------------------------------------------------------|
| ASIC              | Application-Specific Integrated Circuit                                                                       |
| ASIL              | Automotive Safety Integrity Level                                                                             |
| ASW               | Application Software                                                                                          |
| AUTOSAR           | Automotive Software Architecture                                                                              |
| BCU               | Battery Control Unit                                                                                         |
| BDU               | Battery Distribution Unit                                                                                     |
| BMS               | Battery Management System (incl. sensors and actuators)                                                      |
| BOL               | Begin of Life                                                                                                 |
| BSW               | Basic Software                                                                                               |
| CAN               | Controller Area Network                                                                                      |
| CAN NM            | CAN Network Management                                                                                       |
| CEB               | Cell Balancing                                                                                               |
| DCM               | Diagnostic Communication Module                                                                              |
| DEM               | Diagnostic Event Manager                                                                                     |
| DID               | Diagnostic Identifier                                                                                        |
| DTC               | Diagnostic Trouble Code                                                                                      |
| DUT               | Device Under Test                                                                                           |
| ECU               | Electronic Control Unit                                                                                      |
| EEPROM            | Electrically Erasable Programmable Read Only Memory                                                          |
| EOL               | End Of Life                                                                                                  |
| EUT               | Equipment Under Test                                                                                        |
| FFI               | Freedom From Interference                                                                                    |
| FIM               | Fault Inhibition Manager                                                                                     |
| FRM               | Fault Reaction Matrix                                                                                        |
| FSC               | Functional Safety Concept                                                                                    |
| FTTI              | Fault Tolerant Time Interval                                                                                 |
| HVBP              | High Voltage Battery Pack                                                                                    |
| HVIL              | High Voltage Interlock Loop                                                                                  |
| HVSM              | High Voltage System Management                                                                               |
| HW                | Hardware                                                                                                     |
| ID                | Identification                                                                                               |
| IL                | Interface Layer                                                                                              |
| ISO               | Isolation                                                                                                    |
| KL15              | Terminal for ignition (Clamp 15)                                                                             |
| KL30              | Terminal for permanent battery voltage (Clamp 30)                                                           |
| KL30C             | Terminal for switchable battery voltage for relay supply (Clamp 30C)                                         |
</page>

<page number="10">
1. General Document Guidelines.

1.1. Purpose.  
This version is a production version specification, which provides the information regarding the Battery Management System. This document consists of Battery Management System working concept explanation in details with respect to the functionality built and signals used to communicate with other ECU’s at different conditions.  
Currently this document is made by considering the scope of requirements, but the details working concept will be verified and validated, since this is the working concept, which is looked at the overall concept level.  

1.2. Language.  
This document is written in English.  
All official project documentations must be written in English. If documents are bilingual, the English text is binding.  

1.3. Obligation of Requirement Wording.  
The following wording rules are used throughout this document:  

| No | Terms      | Definition                                                                                                   |
|----|------------|-------------------------------------------------------------------------------------------------------------|
| 1  | “Shall”    | The word “shall” be used to state a binding requirement. Such requirements are externally verifiable.        |
| 2  | “Should”   | The word “should” be used for preferences or desires in implementation that are not strictly binding.        |
| 3  | “May”      | The word “may” be used to denote options that are left to the implementer.                                   |
| 4  | “Must”     | To denote legally binding requirements.                                                                      |
| 5  | “Shall NOT”| Denotes an absolute prohibition.                                                                             |
| 6  | “Cell”     | The word “may” be used to denote a brick of cells in the battery pack.                                       |

1.4. Abbreviations.  
The following table lists abbreviations used throughout this document:  

| Abbreviation | Full Form                                                          |
|--------------|--------------------------------------------------------------------|
| ASIC         | Application-Specific Integrated Circuit.                          |
| ASIL         | Automotive Safety Integrity Level.                                |
| ASW          | Application Software.                                             |
| AUTOSAR      | Automotive Software Architecture.                                 |
| BCU          | Battery Control Unit.                                             |
| BDU          | Battery Distribution Unit.                                        |
| BMS          | Battery Management System (incl. sensors and actuators).         |
| BOL          | Begin of Life.                                                   |
| BSW          | Basic Software.                                                  |
| CAN          | Controller Area Network.                                         |
| CAN NM       | CAN Network Management.                                          |
| CEB          | Cell Balancing.                                                  |
| DCM          | Diagnostic Communication Module.                                 |
| DEM          | Diagnostic Event Manager.                                        |
| DID          | Diagnostic Identifier.                                           |
| DTC          | Diagnostic Trouble Code.                                         |
| DUT          | Device Under Test.                                               |
| ECU          | Electronic Control Unit.                                         |
| EEPROM       | Electrically Erasable Programmable Read Only Memory.             |
| EOL          | End Of Life.                                                     |
| EUT          | Equipment Under Test.                                            |
| FFI          | Freedom From Interference.                                       |
| FIM          | Fault Inhibition Manager.                                        |
| FRM          | Fault Reaction Matrix.                                           |
| FSC          | Functional Safety Concept.                                       |
| FTTI         | Fault Tolerant Time Interval.                                    |
| HVBP         | High Voltage Battery Pack.                                       |
| HVIL         | High Voltage Interlock Loop.                                     |
| HVSM         | High Voltage System Management.                                  |
| HW           | Hardware.                                                       |
| ID           | Identification.                                                 |
| IL           | Interface Layer.                                                |
| ISO          | Isolation.                                                      |
| KL15         | Terminal for ignition (Clamp 15).                                |
| KL30         | Terminal for permanent battery voltage (Clamp 30).              |
| KL30C        | Terminal for switchable battery voltage for relay supply (Clamp 30C). |
| KL31         | Terminal for power supply minus (Clamp 31).                      |
| LOI          | Letter of Intent.                                               |
| LON          | Letter of Nomination.                                           |
| LPF          | Latent Point Fault.                                             |
| MCAL         | Microcontroller Abstraction Layer.                               |
| MCU          | Module Control unit.                                            |
| NTC          | Negative Temperature Coefficient.                                |
| OBC          | On Board Charger.                                               |
| OBD          | On Board Diagnostics.                                           |
| OT           | Over temperature.                                               |
| OTS          | Off Tools Samples.                                              |
| OV           | Overvoltage.                                                   |
| PCB          | Printed Circuit Board.                                          |
| PTC          | Positive Temperature Co-efficient Heater.                        |
| PWM          | Pulse Wide Modulation.                                          |
| QM           | Quality Management.                                            |
| RAM          | Random Access Memory.                                          |
| REESS        | Rechargeable Electrical Energy Storage System.                  |
| RF           | Radio Frequency.                                               |
| ROM          | Read-Only Memory.                                              |
| SeooC        | Safety Element Out Of Context.                                  |
| SM           | Safety Mechanism.                                              |
| SMD          | Surface-Mounted Device.                                        |
| SOB          | Supplier on Board.                                             |
| SOC          | State of Charge.                                               |
| SOF          | State of Function.                                             |
| SOH          | State of Health.                                               |
| SOP          | State of Power.                                                |
| SPF          | Single Point Fault.                                            |
| SW           | Software.                                                      |
| TSC          | Technical Safety Concept.                                      |
| UV           | Under voltage.                                                |
</page>

<page number="11">
2. General Project Guidelines

2.1. Development Scope Abstract.
This document details the technical requirements of the High Voltage Battery Pack Battery Management System, which will be used in the VF9 project of VinFast and their other brands. It also explains the functionality of the Battery Management System.
</page>

<page number="12">
2. General Project Guidelines.

2.1. Development Scope Abstract.
This document details the technical requirements of the High Voltage Battery Pack Battery Management System, which will be used in the VF9 project of VinFast and their other brands. It also explains the functionality of the Battery Management System.

2.2. VF9 Variant.
- **Markets:** VN, EU, US, CA.
- **Features:** VF9.
- **Variant ECO EURO NCAP 5* (2022):**
  1. **Battery Type:** (Li-Ion).
  2. **Battery Capacity (Kwh) - Usable:** 92.
  3. **Range per full charge (Km) (WLTP/NEDC):** 438.
  4. **Charging standard - Public station:** Plug & Charge, Auto Charge.
  5. **Portable charger (kW):** Aftersales (VN), YES (CA/US/EU).
  6. **On-board charger (kW):** SOP: 6.6 kW, Post SOP: 11 kW.
  7. **Charging Mode - Fast Charge:** YES.
  8. **Regeneration mode (low/high):** YES (low, high).
  9. **Charging time (h) - Normal Charging:** SOP: <15h (6.6KW OBC), Post SOP: <9 (11KW OBC).
  10. **Charging time (m) - Fast Charging:** 26 minutes (10%-70% SOC @25°C).

- **Variant PLUS EURO NCAP 5* (2022):**
  1. **Battery Type:** (Li-Ion).
  2. **Battery Capacity (Kwh) - Usable:** 92.
  3. **Range per full charge (Km) (WLTP/NEDC):** 423.
  4. **Charging standard - Public station:** Plug & Charge, Auto Charge.
  5. **Portable charger (kW):** Aftersales (VN), YES (CA/US/EU).
  6. **On-board charger (kW):** SOP: 6.6 kW, Post SOP: 11 kW.
  7. **Charging Mode - Fast Charge:** YES.
  8. **Regeneration mode (low/high):** YES (low, high).
  9. **Charging time (h) - Normal Charging:** SOP: <15h (6.6KW OBC), Post SOP: <9 (11KW OBC).
  10. **Charging time (m) - Fast Charging:** 26 minutes (10%-70% SOC @25°C).
</page>

<page number="13">
3. BMS SW components sequence diagram.

3.1. BMS Startup.

Figure 1: BMS SW Startup sequence diagram.  
STARTUP procedure consists of the following phases as per AUTOSAR:  
- Initialization of all BSW and ASW software components.  
- Pre-emptive startup task with 1ms and 10ms cycle time is scheduled on the master core during the startup phase.
</page>

<page number="14">
3.2. BMS Wake-up Run Sequence.

Figure 2: BMS Wake-up Run Sequence diagram.

All tasks will be running cyclically in the master and slave cores.
</page>

<page number="15">
## 3. BMS SW Components Sequence Diagram

### 3.1. BMS Startup

**Figure 1: BMS SW Startup sequence diagram.**  
The STARTUP procedure consists of the following phases as per AUTOSAR:
- Initialization of all BSW and ASW software components.
- A pre-emptive startup task with 1ms and 10ms cycle time is scheduled on the master core during the startup phase.

---

### 3.2. BMS Wake-Up Run Sequence

**Figure 2: BMS Wake-up Run Sequence diagram.**  
All tasks will run cyclically in the master and slave core.

---

### 3.3. BMS Shutdown Sequence Diagram

**Figure 3: BMS Shutdown sequence diagram.**  
The SHUTDOWN procedure consists of the following phases as per AUTOSAR:
- Switch off the CAN transceiver.
- Disable interrupts on the slave core.
- Stop the DEM operation cycle.
- Shut down the DEM.
- Set the date and time in RTC.
- Cancel OS alarms.
- Switch TLF35584 to standby mode.
</page>

<page number="16">
4. Process Flow Charts

4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram.

The Wakeup process begins within the Battery Management System (BMS). This includes the initialization of power-on activities and self-checking procedures. Once the Self-check passes, the high-voltage (HV) system is turned on. The following states are observed:

- **BMS_HVOnOff_STS = 0 (HV off):** Indicates High Voltage is off.
- **BMS_Sys_STS = Self Check passes, can be HV.**
- **VCU_BMS_HVOnOff_Req = 1 (Allow):** Allows High Voltage Precharge.
- **BMS_HVOnOff_STS = 1 (HV Precharge):** Precharge is enabled.
- **KL15 Signal ON / CAN NM.**
- **BMS_HVOnOff_STS = 2 (HV On):** Activates High Voltage.
- **BMS_Sys_STS = Successful High Voltage Power Up:** Confirms a successful process.

The completion of this sequence ensures a successful High Voltage Power Up.

Figure 4: Wake up BMS & Turn on HV (Power up) diagram.
</page>

<page number="17">
4. Process Flow Charts

4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram.
The wakeup process begins with the BMS signal initialization through KL15 Signal ON/CAN NM. The BMS undergoes a self-check process to ensure functionality before high voltage can be turned on. If the self-check passes, the system transitions as follows:
- BMS_Sys_STS, indicating self-check passes, high voltage may be turned on.
- BMS_HVOnOff_STS is set to 0 (HV off).
- VCU_BMS_HVOnOff_Req is set to 1 (Allow).
- BMS_HVOnOff_STS changes to 1 (HV Precharge).
- Successful High Voltage Power Up occurs when BMS_HVOnOff_STS is set to 2 (HV On).

The power-up process completes with BMS_Sys_STS signaling Successful High Voltage Power Up.

Figure 4: Wake up BMS & Turn on HV (Power up) diagram.

4.2. Turn off HV (Power down) sequence diagram.
The power-down process begins after a successful high-voltage power-up. The sequence follows these steps:
- The VCU_BMS_HVOnOff_Req is set to 0 (forbid), indicating the start of the shutdown process.
- BMS_HVOnOff_STS transitions from 2 (HV On) to 0 (HV off).
- BMS_Sys_STS signals Successful High Voltage Power Down to complete the process.

Figure 5: Turn off HV (Power down) diagram.
</page>

<page number="18">
4. Process Flow Charts.

4.3. Thermal control HVBP sequence diagram.

The thermal control sequence begins with the BMS waking up upon receiving the KL15 signal ON/CAN NM. The BMS calculates the flow rate required for thermal management. If a cooling condition is detected (BMS_VCU_ValveOnOff_Req = 1), the valve is activated, leading to chiller ON (VCU_BMS_ValveOnOff_Sts = 1). If heating is required (BMS_VCU_PTCOnoff_Req = 1), the PTC heater is engaged, accompanied by pump activation (VCU_BMS_PumpFB = 1). 

The process includes specific criteria to turn ON/OFF critical components based on measured temperatures. For example:
- The chiller activates under certain conditions like DC charge, AC charge, or when the temperature exceeds predefined limits.
- The PTC heater initializes if the temperature is below the required threshold during DC/AC charging conditions and other modes.

Figure 6 provides a detailed sequence diagram illustrating the interactions and conditions for cooling or heating activation in the HVBP system.
</page>

<page number="19">
4. Process Flow Charts

4.4. AC/DC Charging Sequence Diagram.

Figure 7 depicts the AC/DC charging sequence diagram and outlines the following processes:

- **BCU Wake-Up:** Initiation of power-on and self-checking.
- **Standby:** If self-check passes, the system transitions and prepares for high voltage activation.
- **HV Activation Mode:** The system enables high voltage power up with VCU_BMS_HVOnOff_Req set to 1 (Allow).
- **Precharge:** Precharging begins with BMS_HVOnOff_STS set to 1 (HV Precharge).
- **High Voltage Power-Up:** BMS_HVOnOff_STS changes to 2 (HV On), indicating successful high voltage power activation.
- **Charging Mode:** Charging currents and voltage are requested by BMS_ChgCurrent_REQ and BMS_ChgVoltage_Req respectively. The status parameters such as BMS_SOCActual_Est and BMS_PackCur_MEAS are monitored during the charging process.
- **Max Charge Current Calculation:** Using PLC communication, the maximum charging current is calculated and operational parameters are evaluated.
- **HV Termination Mode:** Charging ends when VCU_ChargeAllow is set to 0 and the system winds down.
- **Powerdown Process:** The system shuts down high voltage with BMS_HVOnOff_STS set to 0 (HV Off) and transitions to standby IG Off mode.
- **Standby IG Off Mode:** Ensures system stability and safety.

The sequence diagram visually maps these steps and their interrelations between the Battery Control Unit (BCU) and Vehicle Control Unit (VCU). Specific signals and statuses are detailed in the diagram for clear understanding.

Figure 7: AC/DC Charging Sequence Diagram.
</page>

<page number="20">
4.5. Pre-conditioning Wakeup Flow Chart.

Vehicle parked and unplugged, BMS asleep. If timer > 30 min, BMS internal wake-up occurs. If BMS minimum cell temperature is < -10°C, then BMS sleeps back. If BMS minimum cell temperature is not < -10°C, then the next step is SOC > 30%.

If SOC > 30%, BMS wakes up the network, requests heating to VCU, and VCU triggers PTC heater. Heating consumes 2 min per °C increase in HVB. If SOC < 30%, then VCU stops heating. If SOC remains ≥ 30% and temperature is ≥ -9°C CALIB, the process concludes with sleeping back.

If the temperature does not meet CALIB ≥ -9°C, then the process concludes with sleeping back.

Figure 8: Pre-conditioning Wakeup flow chart.
</page>

<page number="21">
5. BMS - Non Functional Architecture Description.

5.1. Assumption: BMS Functional Content with following conditions.
- Charging communication to the EVSC shall be managed by VCU with charging parameters provided by the BMS.
- Pyro-fuse is not connected to BMS and will be controlled by ACM.
- HVIL is not detected by any other ECU’s.
- HW Crash PWM signal is detected by the BMS.
- MSD – Power is turned off abruptly, no detection of MSD.
- THR – Thermal Runaway is only detection, no protection.
- Coolant Leakage: No coolant leakage detection supported.
- No Humidity/Gas/Pressure sensor inside the battery pack.
- No condensation detection function inside the BMS.
- No Altitude and pressure detection function inside the BMS.
- No Fire detection and prevention functionality built in BMS.
- Cell is considered as EUCAR Level ≤ L4.
- For Nail penetration & Thermal stability, heating rate @ 5 ℃/min + Stay 30min @ 180℃, all these conditions meet EUCAR Level ≥ L5.
- Module NTC shall measure the temperature from -40℃ to +125℃.
- Thermal Runaway detection is made when the contactor is at closed state or KL15 has to be in ON state.

5.2. Pack Power Map parameters.
Refer to the VF9_HVBP_Power_Map.xlsx.

5.3. HVBP Threshold calibration parameters.
Refer to the VF9_HVBP_Calib_Protect_Threshold_V5.2.xlsx.
</page>

<page number="22">
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.

Table 1: BMS Function list.

Function Group: Contactor Control (HV-plus, HV-minus, Pre-charge).  
Description:  
- Open/close contactors dependent on battery state request.  
- Pre-charge control – monitors the pre-charge procedure (voltage gradients, absolute & relative voltage limits, current, flow, pre-charge resistor temperature).  
- Output current battery state (e.g. Offline, pre-charge, connect, online, shutoff, disconnect…).  
- Contactor diagnosis (stuck open, stuck close).  
- Calculate and track contactor aging individually for each contactor.  
- Switch each contactor separately, service mode.  
- Monitor pack voltage and DC-Link voltage.  

Function Group: Thermal Control.  
Description:  
- Electrical diagnosis and data conversion of battery module temperature measurements.  
- Electrical diagnosis and data conversion of auxiliary temperature measurements.  
- Diagnosis of temperature spread in the battery modules (plausibility check) and temperature spread in the whole battery pack.  
- Calculation of minimum temperature in the pack, maximum temperature in the pack and average pack temperature.  
- Thermal Control function provides requests for actuators in the battery thermal system (shall be based on CAN). Requests are calculated based on current battery state and measured temperatures. The thermal demand is provided to VCU and the VCU controls the thermal system to meet the demand.  

Function Group: Electrical Hazard Protection.  
Description:  
- Calculation of isolation resistance between the battery and vehicle ground. Passive method based on switching of high accurate resistors is used.  
- HV interlock function based on PWM (current) signal.  

Function Group: Battery Protection.  
Description:  
- Includes all generic diagnosis and protection functions, e.g.:  
  - Current limit.  
  - Pack resistance limit.  
  - Current sensor plausibility.  
  - Voltage acquisition plausibility.  
  - Cell voltage limit, etc.  

Function Group: History / Warranty.  
Description:  
- Save of specified battery states throughout the whole battery life cycle.  
- Total energy charged and discharged.  
- Minimum and maximum cell voltage.  
- Minimum and maximum state of charge.  
- Last critical errors leading to a shutdown of the battery.  
- Service-life counter for circuit breakers (see also contactor control function).  

Function Group: Diagnostic Event Handler.  
Description:  
- Determines the global battery error level (severity 0 to 7).  
- Dependent on error entry information and defines related system reaction depending on severity level (e.g. emergency disconnect or warning only).
</page>

<page number="23">
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.

Table 1: BMS Function list.
- **Contactor Control (HV-plus, HV-minus, Pre-charge):**
  - Open/close contactors dependent on battery state request.
  - Pre-charge control monitors voltage gradients, absolute & relative voltage limits, current, flow, and pre-charge resistor temperature.
  - Output current battery state (e.g., Offline, pre-charge, connect, online, shutoff, disconnect).
  - Contactor diagnosis (stuck open, stuck close).
  - Calculation and track contactor aging individually for each contactor.
  - Switch each contactor separately, service mode.
  - Monitor pack voltage and DC-link voltage.

- **Thermal Control:**
  - Electrical diagnosis and data conversion of battery module temperature measurements.
  - Electrical diagnosis and data conversion of auxiliary temperature measurements.
  - Diagnosis of temperature spread in the battery modules (plausibility checks) and the whole battery pack.
  - Calculation of minimum pack temperature, maximum pack temperature, and average pack temperature.
  - Thermal control function provides requests for actuators in the battery thermal system based on CAN, calculated from battery state and temperature measurements. Demand is provided to VCU, which controls the thermal system accordingly.

- **Electrical Hazard Protection:**
  - Calculation of isolation resistance between battery and vehicle ground using high-accuracy resistors.
  - HV interlock function based on PWM (current) signal.

- **Battery Protection:**
  - Includes diagnosis and protection functions such as current limit, pack resistance limit, current sensor plausibility, voltage acquisition plausibility, cell voltage limits, etc.

- **History/Warranty:**
  - Saves specified battery states throughout the battery life cycle:
    - Total energy charged and discharged.
    - Minimum and maximum cell voltage.
    - Minimum and maximum state of charge.
    - Last critical errors leading to shutdown.
    - Service-life counter for circuit breakers.

- **Diagnostic Event Handler:**
  - Determines global battery error level (severity 0 to 7) based on error entry information.
  - Defines related system reactions based on severity level (e.g., emergency disconnect or warning only).

7. CSC (MCU) control module.
- **Functions:**
  - CSC initialization and start-up.
  - Command CSCs to measurement mode.
  - Command balancing of CSCs.
  - Diagnosis of CSC communication.
  
- **BMS Wakeup:**
  - KL15 Wakeup.
  - CAN NM Wakeup.
  - BMS sleep mode wakeup for pre-condition checks.

- **Low Voltage Monitoring:**
  - Continuous monitoring of LV power supply; if the voltage is not within operational limits, the BMS will protect the system.

Table 2: BMS State algorithms.
- **SOC:**
  - Model-based State-Of-Charge estimation.
  - Estimation on module level in [%].
  - Delta SOC estimation per cell in [%].
  - Pack level SOC estimation based on cell SOC.

- **SOF:**
  - Model-based State-Of-Function calculation, including:
    - Battery current limits for short-term pulses (min/max values in [A]).
    - Battery voltage prediction for max charge/discharge (max/min values in [V]).
    - Power limitations calculated using current limits and voltage predictions.
    - Degradation of power according to BDU temperature increases.

- **SOH:**
  - Calculation of State-of-Health:
    - Minimum module capacity (capacity in [Ah]).
    - Maximum module resistance (resistance in [mΩ]).
    - Cell-to-cell differences based on SOC and resistance deviations.

- **Cell wear detection:**
  - Reports error management for outliers in SOC or resistance values relative to module average.

- **Cell Balancing (passive):**
  - Request balancing based on delta SOC, temperature, voltage, and pack current.
  - Balancing is performed within determined boundaries of current, voltage, and temperature.
</page>

<page number="24">
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.

The table below lists the functionalities provided by BMS across different functional groups.

Table 1: BMS Function list.

Function Group: Contactor Control (HV-plus, HV-minus, Pre-charge).
Description: 
- Open/close contactors dependent on battery state request.
- Pre-charge control – monitors the pre-charge procedure (voltage gradients, absolute & relative voltage limits, current, flow, pre-charge resistor temperature).
- Output current battery state (e.g. Offline, pre-charge, connect, online, shutoff, disconnect...).
- Contactor diagnosis (stuck open, stuck close).
- Calculate and track contactor aging individually for each contactor.
- Switch each contactor separately, service mode.
- Monitor pack voltage and DC-Link voltage.

Function Group: Thermal Control.
Description: 
- Electrical diagnosis and data conversion of battery module temperature measurements.
- Electrical diagnosis and data conversion of auxiliary temperature measurements.
- Diagnosis of temperature spread in the battery modules (plausibility check) and temperature spread in the whole battery pack.
- Calculation of minimum temperature in the pack, maximum temperature in the pack and average pack temperature.
- Thermal control function provides requests for actuators in the battery thermal system (shall be based on CAN). Requests are calculated based on current battery state and measured temperatures. The thermal demand is provided to VCU and the VCU controls the thermal system to meet the demand.

Function Group: Electrical Hazard Protection.
Description:
- Calculation of isolation resistance between the battery and vehicle ground. Passive method based on switching of high accurate resistors is used.
- HV interlock function based on PWM (current) signal.

Function Group: Battery Protection.
Description: 
Includes all generic diagnosis and protection functions, e.g.:
- Current limit.
- Pack resistance limit.
- Current sensor plausibility.
- Voltage acquisition plausibility.
- Cell voltage limit.

Function Group: History/Warranty.
Description:
- Save of specified battery states throughout the whole battery lifecycle.
- Total energy charged and discharged.
- Minimum and maximum cell voltage.
- Minimum and maximum state of charge.
- Last critical errors leading to a shutdown of the battery.
- Service-life counter for circuit breakers (see also contactor control function).

Function Group: Diagnostic Event Handler.
Description: 
- Determines the global battery error level (severity 0 to 7).
- Dependent on error entry information and defines related system reaction depending on severity level (e.g. emergency disconnect or warning only).
</page>

<page number="25">
6.2. BMS State Transition Control (BSTC).

Figure 9: BMS State Flow.

This section describes the functionality of battery state transition control. This module handles the state of the battery control unit.

There are five possible states:

**Startup:**
- During the "startup" phase, all initialization procedures are done.
- During the "startup" phase, all main contactors are open.
- When all initialization procedures are finished and the wake signal is on (e.g. ignition key is on and a valid activation command is sent by the vehicle), the BCU state changes to the state "run".

**Run:**
- During the "run" phase, the battery is in normal operation mode. The main contactors connect the battery to the load circuit. This is the main operation mode of the BCU.
- When the wake signal is removed (e.g. ignition key is turned off or the activation command is removed by the vehicle), the main contactors are opened and the BCU state changes to the state "power latch."

**Power Latch:**
- Disable MCs (main contactors).

**Wait:**
- State mode jump.

**Shutdown:**
- Write data in memory.
- Disable power supply.
</page>

<page number="26">
6.2. BMS State Transition Control (BSTC).

During the "power latch" phase, all module controllers will be shut down by the BCU. A counter starts to run. When the counter reaches 0, the BCU will be shut down.

Wait:
During the "wait" phase, the BCU waits for a timer to run out before initiating the power-down sequence.

Shutdown:
During the "shutdown" phase, all NVM variables are saved to the non-volatile memory. After that, the BCU is shut off.

In addition, this module requests the closing and opening of the main contactors. Also, this module controls the BCU power supply. Voltage measurement of the power supply is done and the watchdog function is controlled (if an external watchdog is used).

Further, this module calculates the amount of time the battery was switched on and off.

Contactor Control (HV-Plus, HV-Minus, Pre-Charge).
</page>

<page number="27">
6.3. BSTC – HVBP Operation System Status.

When the BMS starts it sends system status information based on data collected from actuators and sensors. Self-check requirements of the BMS include communication with the BCU, MCU, ROM, RAM, and other components for self-test to ensure no fault. Additionally, all LPF and necessary SPF are checked during the startup phase.

### Signal I/O:
**Name:** BMS_Sys_STS  
**Description:** BMS_Status (Self-test after BMS wake-up).  
**Min:** 0  
**Max:** 15  
**Value Description:**
- 8: Invalid.
- 7: Failure, unable to operate.
- 6: BCU Sleep mode.
- 5: Wait for Successful Power Down.
- 4: Power latch process.
- 3: Successful Power Down of HV.
- 2: Successful High Voltage Power Up.
- 1: Self-check passed, can be HV on.
- 0: Init of power on self-checking.

**Sender:** BMS  
**Receiver:** VCU  

The BMS_Sys_STS signal values are updated as per voltage, temperature, and current monitoring of the battery pack. Based on these inputs, the signal state transitions are performed.

---

### Table 4: BMS System Status Description
| **BMS_Sys_STS** | **Description** |
|------------------|-----------------|
| 0                | Startup state of the system and initialization is in progress. |
| 1                | Initialization is completed successfully and ready to receive commands and process requests from other ECUs. |
| 2                | High voltage power up of the contactor is successful. VCU sends VCU_BMS_HVOnOff_REQ = 1 (allow). |
| 3                | High voltage power down of the contactor is successful. VCU sends VCU_BMS_HVOnOff_REQ = 0 (forbid). |
| 4                | Power latch state or BCU sleep state. After each RUN mode, the BMS system enters power latch state by enabling a shutdown timer. |
| 5                | Shutdown process is initiated. Data needs to be written to non-volatile memory (NVM). |
| 6                | Wait state of the BCU. Refer to BCU_StateControl transitions diagram. |
| 7                | Any sensor is not working or there are issues in initialization. |
| 8                | Invalid state. |

When the BMS system status is **BMS_Sys_STS = 1**, the BMS accepts requests from other ECUs. If the status is not equal to 1, then it continues with system initialization. Any problem during the self-check sets **BMS_Sys_STS = 7**.
</page>

<page number="28">
When BMS wake up, the BMS should be self-checking. The time of self-checking should be limited to approximately 100ms (calibration). During self-checking, the BMS should send BMS_Sys_STS = 0.  

After self-checking is finished, the BMS should send BMS_Sys_STS = 1.  

### Note:
The VCU shall check the BMS_Sys_STS = 1 and then send the command to BMS:  
- **VCU_BMS_HVOnOff_REQ = 1**: Turn HV ON  
- **VCU_BMS_HVOnOff_REQ = 0**: Turn HV OFF  

The BMS shall feedback the status of the high voltage sequence switching and send the HV status over the CAN:  
- **BMS_HVOnOff_STS = 0**: HV OFF  
- **BMS_HVOnOff_STS = 1**: Pre-charge  
- **BMS_HVOnOff_STS = 2**: HV ON
</page>

<page number="29">
7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge).

7.1. CTC - Function Description.
This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

Figure 10: Contactor Control.
The figure illustrates the configuration of the contactor control system, including battery connections, contactors (K1, K2, K3), and load circuit. It showcases the states of operation for achieving the desired battery functions.

The following battery states are implemented according to the states of the contactor:

**Offline (State 1):**
All contactors are open. Load circuit voltage is below target pre-charge voltage.

**Pre-charge (State 2):**
Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

**Connect (State 3):**
Positive contactor (B+) is closed and the pre-charge contactor is opened.

**Online (State 4):**
Positive (B+) and negative (B-) contactors are closed. The battery is ready for normal operation.
</page>

<page number="30">
### 7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge)

#### 7.1. CTC - Function Description
This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

#### Battery State Descriptions

**Offline (State 1)**  
All contactors are open. Load circuit voltage is below the target pre-charge voltage.

**Pre-charge (State 2)**  
Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

**Connect (State 3)**  
Positive contactor (B+) is closed and the pre-charge contactor is opened.

**Online (State 4)**  
Positive (B+) and negative (B-) contactors are closed. The battery is ready for normal operation.

**Shutoff (State 5)**  
To avoid electric arcs upon contactor opening, it is necessary to ensure there is no current flow. The shutoff state allows the high voltage components to smoothly ramp down the current flow (if necessary).

**Disconnect (State 6)**  
All closed contactors are opened.

**DC-charge (State 8)**  
Contactors are controlled as needed for DC charging.

**Charge (State 9)**  
Optional contactor diagnosis marginally alters the contactor switching sequences to check if any contactor is stuck either in an open or closed state.

**Emergency Disconnect (State 10)**  
All contactors are opened immediately despite actual current flow and the previous battery state. This state should only be executed upon critical errors.

**Service Mode (State 20)**  
This state can only be accessed using a service or calibration tool. Each contactor can manually be operated for testing purposes.

#### Unique Battery State Identification
Each battery state is identified by a unique battery state ID.
</page>

<page number="31">
7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge)

7.1. CTC - Function Description.  
This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.  

Figure 10: Contactor Control.  
The following battery states are implemented according to the states of the contactor:  

- **Offline (State 1):**  
  All contactors are open. Load circuit voltage is below the target pre-charge voltage.

- **Pre-charge (State 2):**  
  Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

- **Connect (State 3):**  
  Positive contactor (B+) is closed and pre-charge contactor opened.

- **Online (State 4):**  
  Positive (B+) and negative (B-) contactors are closed. Battery is ready for normal operation.

- **Shutoff (State 5):**  
  To avoid electric arcs upon contactor opening, it is necessary to ensure there is no current flow. The shutoff state allows the HV components to smoothly ramp down the current flow (if necessary).

- **Disconnect (State 6):**  
  All closed contactors are opened.

- **DC-charge (State 8):**  
  Control of contactors needed for DC-charging.

- **Charge (State 9):**  
  The optional contactor diagnosis marginally alters the contactor switching sequences to check if any contactor is stuck either in an open or closed state.

- **Emergency Disconnect (State 10):**  
  All contactors are opened immediately despite actual current flow and previous battery state. This state should only be executed upon critical errors.

- **Service Mode (State 20):**  
  This state can only be accessed by using a service or calibration tool. Each contactor can manually be operated for testing purposes.  

Each battery state shall be identified by a unique battery state ID.

---

7.2. CTC - Contactor Closing.  

Figure 11: HV_ON Sequence.  
When BMS receives `VCU_BMS_HVOnOff_REQ = allow`, then the BMS should close the HV relay. Before closing, it performs diagnostics for the pre-charge relay. The sequence is explained as follows:  

- Diagnostics of the pre-charge relay are performed by closing and opening the relay. The `BMS_HVOnOff_STS = pre-charge`.  
- Afterward, the BMS should close the negative relay first. When negative relay is closed (`BMS_TotalNegRelay_STS = closed`), then the BMS should close the pre-charge relay (`BMS_PreChgRelay_STS = closed`).  

Additional steps:  
- Refer to the section **CTC Pre-charge check**.  
- Timeout for the pre-charge state must finish within 500ms (reference).  
- If three consecutive cycles do not reach the end condition, pre-charging is considered failed (`BMS_HVOnOff_STS = Fail to HV on`).  

When pre-charge is completed, the BMS shall close the positive relay. After the positive relay is closed (`BMS_MainPosRelay_STS = closed`), the BMS shall open the pre-charge relay (`BMS_PreChgRelay_STS = open`).  

Finally, when the pre-charge relay is opened, the process of power-on is complete, and `BMS_HVOnOff_STS = HV ON`.
</page>

<page number="32">
VinES VFDSXXBAT1270  

Version: 3  
Uncontrolled copy when printed  
32 | 101  
Print date  

**7.3. CTC - Contactor Opening**  

**Figure 12: HV_OFF Sequence**  

When BMS receives `VCU_BMS_HVOnOff_REQ=forbid`, the BMS shall open the HV relay. The sequence is shown above and explained:  

- BMS should open the positive relay firstly. When the positive relay is opened (`BMS_MainPosRelay_STS=open`), the `BMS_HVOnOff_STS=HVoff`. Then the BMS should open the negative relay (`BMS_TotalNegRelay_STS=Open`).  
- When the voltage is lower than 90% of the bus total voltage, BMS determines that the high-voltage relay has been completely disconnected.  
- When the relay is in error, BMS should send:  
  - `BMS_MainPosRelay_ERR=Error`  
  - `BMS_TotalNegRelay_ERR=Error`  
  - `BMS_PreCrgRelay_ERR=Error`  

Additional conditions:  
- High side and low side drivers should drive the relay.  
- BMS needs to be able to detect contactor faults such as stuck/open.  
- The BMS shall check for faults in the low side driver during charging/discharging state and monitor the feedback.
</page>

<page number="33">
### 7.3. CTC - Contactor Opening

**Figure 12: HV_OFF Sequence**  
When the BMS receives `VCU_BMS_HVOnOff_REQ=forbid`, the BMS shall open the HV relay. The sequence is detailed as follows:  

- The BMS should first open the positive relay. Once the positive relay is opened (`BMS_MainPosRelay_STS=open`), the BMS updates the status as `BMS_HVOnOff_STS=HVoff`.  
- Following this, the BMS proceeds to open the negative relay (`BMS_TotalNegRelay_STS=Open`).  
- When the voltage drops below 90% of the total bus voltage, the BMS confirms that the high-voltage relay has been completely disconnected.  
- If an error occurs during the process, the BMS should send error signals such as `BMS_MainPosRelay_ERR=Error`, `BMS_TotalNegRelay_ERR=Error`, and `BMS_PreCrgRelay_ERR=Error`.  

Key functionalities during contactor opening:  
- **Relay Drivers**: High-side and low-side drivers are responsible for driving the relay.  
- **Contactor Fault Detection**: The BMS must detect faults, including stuck or open conditions.  
- **Monitoring Feedback**: During charging and discharging states, the BMS continuously checks the low-side driver feedback for errors.  

---

### Signal I/O Table  

#### **VCU_BMS_HVOnOff_REQ**  
- **Description**: High Voltage On/Off command from VCU.  
- **Min Value**: 0 (forbid).  
- **Max Value**: 1 (allow).  
- **Sender**: VCU.  
- **Receiver**: BMS.  

#### **BMS_HV_Sts**  
- **Description**: Status of HV voltage.  
- **Min Value**: 0.  
- **Max Value**: 15.  
- **Value Descriptions**:  
  - 0: HV Off.  
  - 1: Pre-charge.  
  - 2: HV On.  
  - 3: Super Fast Charge.  
  - 4: AC Charge.  
  - 5~9: Undefined.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_MainPosRelay_STS**  
- **Description**: Main Positive Relay Status.  
- **Min Value**: 0.  
- **Max Value**: 7.  
- **Value Descriptions**:  
  - 0: Reserved.  
  - 1: Open.  
  - 2: Closed.  
  - 3: Stuck Closed.  
  - 4: Stuck Open.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_PreChgRelay_STS**  
- **Description**: Pre-Charge Relay Status.  
- **Min Value**: 0.  
- **Max Value**: 7.  
- **Value Descriptions**:  
  - 0: Reserved.  
  - 1: Open.  
  - 2: Closed.  
  - 3: Stuck Closed.  
  - 4: Stuck Open.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_TotalNegRelay_STS**  
- **Description**: Main Negative Relay Status.  
- **Min Value**: 0.  
- **Max Value**: 7.  
- **Value Descriptions**:  
  - 0: Reserved.  
  - 1: Open.  
  - 2: Closed.  
  - 3: Stuck Closed.  
  - 4: Stuck Open.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_MainPosRelay_ERR**  
- **Description**: Main Positive Relay Error.    
- **Min Value**: 0.  
- **Max Value**: 1.  
- **Value Descriptions**:  
  - 0: Error.  
  - 1: Normal.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_TotalNegRelay_ERR**  
- **Description**: Main Negative Relay Error.  
- **Min Value**: 0.  
- **Max Value**: 1.  
- **Value Descriptions**:  
  - 0: Error.  
  - 1: Normal.  
- **Sender**: BMS.  
- **Receiver**: VCU.  

#### **BMS_PreCrgRelay_ERR**  
- **Description**: Pre-Charge Relay Error.  
- **Min Value**: 0.  
- **Max Value**: 1.  
- **Value Descriptions**:  
  - 0: Error.  
  - 1: Normal.  
- **Sender**: BMS.  
- **Receiver**: VCU.
</page>

<page number="34">
### 7.4. CTC - Pre-charge Check
The pre-charge procedure must be precisely monitored to quickly detect errors during this critical stage. The diagnosis involves generating a maximum and minimum voltage curve and verifying that the actual voltage remains within this valid range throughout the pre-charge procedure.

To handle partially pre-charged systems (where the DC-link circuit voltage is not zero), the actual DC-link voltage is converted into a theoretically elapsed pre-charged time during pre-charge initialization. The pre-charge check curves continue from this point forward.

All voltage curves are calculated depending on the total battery voltage. This input is stored during pre-charge initialization and used throughout the procedure since the actual battery voltage can vary due to physical effects of current flow reducing cell voltages, potentially distorting the curves.

Details of faults must be identified in the DTC list.

---

### 7.5. CTC - Overheating of Pre-charge Resistor
This system features a monitoring algorithm to prevent overheating of the pre-charge resistor during a single pre-charge procedure. It also detects errors that might affect this state. The energy absorbed by the pre-charge resistor, calculated based on amperage, resistance, and time, is compared against a predefined maximum allowed limit.

The pre-charge resistor temperature guard prevents overheating caused by excessive pre-charge operations. Since each pre-charge procedure generates heat at the resistor, an algorithm calculates a model-based value to account for thermal load and stops the system from pre-charging in case of temperature issues.

The model-based value incrementally rises with each pre-charge procedure, proportionate to the voltage difference balanced (e.g., charging the load circuit).
</page>

<page number="35">
7.4. CTC - Pre-charge check  
The pre-charge procedure must be precisely monitored to quickly detect errors during this critical stage. Diagnosis is carried out by generating maximum and minimum voltage curves and verifying that the actual voltage remains within the valid range at all times during the pre-charge procedure.  

To accommodate partially pre-charged systems where the DC-link voltage is not zero, the actual DC-link voltage is converted to a theoretically elapsed pre-charge time during initialization. The pre-charge check curves continue at this point.  

Voltage curves are calculated based on the total battery voltage, stored during initialization, and read throughout the pre-charge procedure. Variation in battery voltage due to current flow's physical effects may cause falsified curves.  

Details of faults are identified in the DTC list.  

---

7.5. CTC - Overheating of pre-charge resistor  
The system includes a monitoring algorithm to prevent overheating of the pre-charge resistor during a single procedure and detect other relevant errors. Energy absorbed by the resistor is calculated using amperage, resistance, and time and compared against a maximum allowed limit.  

The pre-charge resistor temperature guard prevents overheating from excessive procedures. A model-based algorithm calculates the thermal load based on the voltage difference balanced during each procedure.  

For example, charging the load circuit from 100V to 360V results in a 260V difference, which is multiplied by a calibration value and added to the guard value. This value decreases during states where the resistor isn't used and is retained non-volatile during ECU sleep. Upon wakeup, the stored value is corrected using the battery off time input.  

The function predicts the expected guard value post-procedure and evaluates if charging can proceed without exceeding the limit. If exceeded, an error flag inhibits charging.  

Detected pre-charge energy errors set the guard value to maximum, preventing charging for several minutes.  
Details of faults are identified in the DTC list.  

---

7.6. CTC - Emergency contactor open state  
The emergency disconnect state opens all closed contactors regardless of battery status and current flow. A calibrated delay period allows HV components to reduce current flow before inevitable disconnection.  

During this delay, a disconnection pending flag is activated, and a countdown begins. Once the counter reaches zero, the contactors open.  

Failure to complete the emergency disconnection within the calibrated period results in a timeout error.

---

7.7. CTC - Contactor Error Acknowledge  
Contactor diagnosis is mandatory if errors occurred in the current or last operation cycle. Diagnosis cannot proceed when the DC-link is partially pre-charged and waits for the DC-link voltage to drop below the activation limit.  

If the limit isn't reached within the calibrated time, an error is activated.

---

7.8. CTC - Contactor Weld check  
While in the offline state, no current flow should occur, and the DC-link voltage must deviate significantly from the battery voltage. Current flow or insufficient deviation indicates potential contactor weld failures.  

For reliability, symptoms of contactor weld errors must persist over a calibrated time before errors are reported.  

The function stays in the offline state for a calibrated minimum duration upon ECU startup to identify errors preventing battery activation.

---
</page>

<page number="36">
7.9. CTC - Contactor Aging Observer. Each high-voltage contactor exhibits individual aging based on the number of operating cycles (make and break) and the amperage during switching events. At each event, the deterioration counter of the contactor increases by an amperage-dependent value. Due to control and mechanical delays, the current flow gradient is monitored for several cycles, and this data is used to calculate the maximum deterioration impact during a calibrated period. The deterioration status is then updated accordingly. Warning and error flags are sent if defined limits are reached. If contactors have been opened within recent cycles (e.g., due to safety interventions), several prior amperage values can also be included in the deterioration calculations. Deterioration counter values, stored as non-volatile variables, must be manually reset using calibration tools when contactors are replaced. The subsystem outputs remaining lifetime information, ranging from 100% (new) to 0% (worn). Errors are categorized into warnings (replace when possible) and failures (replace immediately).

7.10. CTC - Aging of contactor. In addition to state control, the module performs diagnoses to monitor contactor aging, pre-charge resistor energy flow, and temperature. Diagnostics are executed during contactor transitions (on and off states). Contactor health is identified based on their closing and opening conditions, and health data is transmitted via PT-CAN as a single signal covering Positive, Negative, and Pre-Charge contactors. The measured high voltages provide information about the physical status of contactors.

**Signal I/O**
- **Name:** BMS_ContactorAging  
  **Description:** Aging condition of contactor – Pre-charge Relay, Positive Contactor, Negative Contactor.  
  **Min:** 0 | **Max:** 100  
  **Value Description:**  
  - 0: Normal  
  - 1: Warning, counter reaches 90%  
  - 2: Fault, counter reaches 98%  
  **Sender:** BMS | **Receiver:** VCU
</page>

<page number="37">
8. BPIU - Battery Pack current voltage protection limits.

### 8.1. BPIU - Cell Voltage Min Max Identification.
Find the minimum and maximum cell voltage of the complete pack. In addition, the index of the cell with the minimum and maximum cell voltage is also identified.

#### Signal I/O.
- **Name:** BMS_MinCellVol  
  **Description:** Min Cell Voltage  
  **Min:** 0  
  **Max:** 6  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_MaxCellVol  
  **Description:** Max Cell Voltage  
  **Min:** 0  
  **Max:** 6  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_CellNumMinCellVol  
  **Description:** Cell Number of Min Cell Voltage  
  **Min:** 0  
  **Max:** 255  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_CellNumMaxCellVol  
  **Description:** Cell Number of Max Cell Voltage  
  **Min:** 0  
  **Max:** 255  
  **Sender:** BMS  
  **Receiver:** VCU  

### 8.2. BPIU - Cell Voltage Protection Limits.
The cell over voltage protection limits are higher than the safety over-voltage limit. The cell under voltage protection limits are lower than the safety low-voltage limit. Violation of cell voltage protection limits leads to battery lock state.

The battery pack has to be checked by the service engineer and need to confirm that there are no real cell issues, and then the lock state shall be released by using the UDS command.

#### Signal I/O.
- **Name:** CUM_bErrCellUMaxMon  
  **Description:** Error flag indicating cell overvoltage fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error;  
    - 0: No error;  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUMinMon  
  **Description:** Error flag indicating cell under voltage fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error;  
    - 0: No error;  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUProtnMaxNvMon  
  **Description:** Non-volatile error flag indicating cell overvoltage protection limit fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error;  
    - 0: No error;  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUProtnMinNvMon  
  **Description:** Non-volatile error flag indicating cell under voltage protection limit fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error;  
    - 0: No error;  
  **Sender:** BMS  
  **Receiver:** VCU
</page>

<page number="38">
8. BPIU - Battery Pack current voltage protection limits.

8.1. BPIU - Cell Voltage Min Max Identification.
Find the minimum and maximum cell voltage of the complete pack. In addition, the index of the cell with the minimum and maximum cell voltage is also identified.

**Signal I/O:**
- **Name:** BMS_MinCellVol  
  **Description:** Min Cell Voltage.  
  **Min:** 0  
  **Max:** 6  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_MaxCellVol  
  **Description:** Max Cell Voltage.  
  **Min:** 0  
  **Max:** 6  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_CellNumMinCellVol  
  **Description:** Cell Number of Min Cell Voltage.  
  **Min:** 0  
  **Max:** 255  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_CellNumMaxCellVol  
  **Description:** Cell Number of Max Cell Voltage.  
  **Min:** 0  
  **Max:** 255  
  **Sender:** BMS  
  **Receiver:** VCU  

---

8.2. BPIU - Cell Voltage Protection Limits.
The cell over-voltage protection limits are higher than the safety over-voltage limit. The cell under-voltage protection limits are lower than the safety low-voltage limit. Violation of cell voltage protection limits leads to battery lock state. The battery pack has to be checked by the service engineer and confirmed to have no real cell issues before releasing the lock state using the UDS command.

**Signal I/O:**
- **Name:** CUM_bErrCellUMaxMon  
  **Description:** Error flag indicating cell over-voltage fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error.  
    - 0: No error.  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUMinMon  
  **Description:** Error flag indicating cell under-voltage fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error.  
    - 0: No error.  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUProtnMaxNvMon  
  **Description:** Non-volatile error flag indicating cell over-voltage protection limit fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error.  
    - 0: No error.  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** CUM_bErrCellUProtnMinNvMon  
  **Description:** Non-volatile error flag indicating cell under-voltage protection limit fault.  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Error.  
    - 0: No error.  
  **Sender:** BMS  
  **Receiver:** VCU  

---

8.3. BPIU - Voltage Acquisition Plausibility.
The top-level of the voltage acquisition plausibility diagnosis checks whether all high voltage signals, combined module voltages, and combined cell voltages are plausible. This diagnosis consists of a core algorithm, de-bouncing, and the DEM interface. The DEM interface blocks transfer de-bounced error information to the DEM (Diagnostic Event Manager).

**Figure Description (Figure 13 - HV Measurement Points):**
- U1: High Voltage + after battery and before contactor (Pack Voltage) – UAct1.  
- U2: High Voltage + after battery and after contactor (Bus Voltage) – UAct2.  
- U3: High Voltage - after battery and after contactor – UAct3.  
- U5: High Voltage - after fuse inside battery (Fuse Voltage) – UAct5.  
- DC Link: High Voltage after contactor with external reference High Voltage.

The verification of voltage signals is performed by comparing suitable sources during various switching states of contactors. In case of an error, the information is sent to the diagnostic event manager. This checks that the module voltages match the sum of cell voltages for each module, accounting for physical differences induced by current flow and measurement tolerances.
</page>

<page number="39">
An error is detected if the module voltage and the sum of cell voltages of this module differ by more than a calibratable value. The index of the (last) module which triggered an error is also calculated.

Plausibility of battery voltage measurement:
Calculated sums of module and cell voltages as well as measured battery pack voltage (UAct1) are compared against each other. In case of tolerance exceedance in both diagnoses for one of signals, errors are triggered.

Positive contactor voltage acquisition:
The difference between CTC_UAct2 and battery pack voltage is compared with tolerance parameter. Diagnosis is functional only in case of pre-charge or positive contactors closed when negative is open, or in case the load circuit is closed.

Negative contactor voltage acquisition:
In case of only pre-charge or positive contactor closure, UAct3 shall be equal to battery pack voltage measurement, and with negative contactor closed, this voltage shall be equal to 0.

Diagnosis of fuse voltage:
UAct5 shall be equal to the battery pack voltage. Diagnosis is valid when UAct1 diagnosis is enabled, but does not trigger its error.
</page>

<page number="40">
Diagnosis of DC link circuit.

In case load circuit is closed, DC link voltage shall be equal to positive contactor voltage. Error is triggered only if positive contactor acquisition is valid. There are several diagnostics performed using the above voltage values. The detailed DTC in the ODX file shall provide the information.

The Battery Management System should monitor the voltage, current, and temperature of high voltage battery pack and then send all the required information in Power Train CAN (PT-CAN) to all the other ECU’s.

### Signal I/O

| Name                  | Description                                    | Min | Max | Value Description         | Sender | Receiver |
|-----------------------|------------------------------------------------|-----|-----|---------------------------|--------|----------|
| BMS_HVPackVol_MEAS   | Pack Voltage                                   | 0   | 800 | 65535: Invalid            | BMS    | VCU      |
| BMS_HVLinkVol_MEAS   | Link Voltage                                   | 0   | 800 | 65535: Invalid            | BMS    | VCU      |
| BMS_HVFuseVol_MEAS   | Measure voltage after fuse to identify the fuse is blown or not | 0 | 800 | 65535: Invalid            | BMS    | VCU      |
| BMS_HVBusVol_MEAS    | BUS Voltage, it is informative                 | 0   | 800 | 65535: Invalid            | BMS    | VCU      |
</page>

<page number="41">
### 8.3. BPIU - Voltage Acquisition Plausibility
Top level of the voltage acquisition plausibility diagnosis checks if all high voltage signals, combined module voltages, and combined cell voltages are plausible.

The plausibility diagnosis is separated into the core algorithm, de-bouncing, and the DEM interface. DEM interface blocks are responsible for transferring the de-bounced error information to the diagnostic event manager (DEM). 

#### Figure 13: HV Measurement Points
- **U1**: High Voltage + after battery and before contactor (Pack Voltage) – UAct1  
- **U2**: High Voltage + after battery and after contactor (Bus Voltage) – UAct2  
- **U3**: High Voltage - after battery and after contactor – UAct3  
- **U5**: High Voltage - after fuse inside battery (Fuse Voltage) – UAct5  
- **DC Link**: High Voltage after contactor with external reference High Voltage.

The verification of voltage signals is performed by comparing suitable sources under different contactor switching states. Errors are reported to DEM in cases of signal faults.

The module voltages are compared with the sum of cell voltages for each module to ensure alignment, accounting for current flow effects and measurement tolerances.

### Diagnosis Details
- **Module Voltage and Cell Voltage Comparison**: An error is detected when the module voltage and the sum of cell voltages of the module differ by more than a calibratable value. The index of the faulty module is calculated.  
- **Plausibility of Battery Voltage Measurement**: The sums of module/cell voltages and measured battery pack voltage (UAct1) are compared. Errors occur if tolerances are exceeded for any signal.  
- **Positive Contactor Voltage Acquisition**: The difference between CTC_UAct2 and battery pack voltage is compared with a tolerance parameter. Functional under pre-charge or positive contactor closure, with negative contactor open.  
- **Negative Contactor Voltage Acquisition**: UAct3 should equal battery pack voltage during positive/pre-charge contactor closure. With the negative contactor closed, UAct3 should equal 0.  
- **Fuse Voltage Diagnosis**: UAct5 should match battery pack voltage. Valid when UAct1 diagnosis is active but does not trigger UAct1 errors.  
- **DC Link Circuit Diagnosis**: The DC link voltage is validated to equal positive contactor voltage if the load circuit is closed. Errors trigger only when positive contactor acquisition is functional.

The Battery Management System (BMS) monitors voltage, current, and temperature of the high-voltage battery pack, sending required data via Power Train CAN (PT-CAN) to other ECUs.

---

### Signal I/O
| Name                  | Description                                         | Min | Max | Value Description    | Sender | Receiver |
|-----------------------|-----------------------------------------------------|-----|-----|----------------------|--------|----------|
| BMS_HVPackVol_MEAS   | Pack Voltage                                       | 0   | 800 | 65535:Invalid        | BMS    | VCU      |
| BMS_HVLinkVol_MEAS   | Link Voltage                                       | 0   | 800 | 65535:Invalid        | BMS    | VCU      |
| BMS_HVFuseVol_MEAS   | Measure voltage after fuse to identify blown fuse | 0   | 800 | 65535:Invalid        | BMS    | VCU      |
| BMS_HVBusVol_MEAS    | Informative BUS Voltage                           | 0   | 800 | 65535:Invalid        | BMS    | VCU      |

---

### 8.4. BPIU - Cell Temperature Configuration
#### Figure 14: Cell Operation Temperature
The minimum and maximum brick cell temperature of the pack, along with the probe number for the minimum and maximum cell temperature, are identified.

#### During Charging:
- If temperature < 0°C: Charging stops by setting `BMS_ChgCurrent_REQ = 0`.  
- If temperature > 50°C: Charging stops by setting `BMS_ChgCurrent_REQ = 0`.

#### During Charging & Discharging:
- If temperature < -30°C: `BMS_ERR_LEV = 4`, request to open HV contactor within FTTI Time.
</page>

<page number="42">
8.3. BPIU - Voltage Acquisition Plausibility  
Top level of the voltage acquisition plausibility diagnosis checks if all high voltage signals, combined module voltages, and combined cell voltages are plausible. The diagnosis is separated into the core algorithm, the de-bouncing, and the diagnostic event manager (DEM) interface. The de-bounced error information is transferred to the DEM.  

The naming of the high voltage measurement points is illustrated as follows:  

Figure 13: HV Measurement Points  
- **U1:** High Voltage + after battery and before contactor (Pack Voltage) – UAct1  
- **U2:** High Voltage + after battery and after contactor (Bus Voltage) – UAct2  
- **U3:** High Voltage - after battery and after contactor – UAct3  
- **U5:** High Voltage - after fuse inside battery (Fuse Voltage) – UAct5  
- **DC Link:** High Voltage after contactor with external reference High Voltage  

Verification of voltage signals is done by comparing suitable sources during different contactor switching states. Errors are reported to the diagnostic event manager if discrepancies are identified. The module voltages are compared with the sum of cell voltages of each module, which should always match despite current flow and possible measurement tolerances.  

An error is detected if the module voltage and the sum of the module cell voltages differ by more than a calibrated value. The index of the last module that triggered an error is calculated.  

**Diagnosis breakdown:**  
- **Battery voltage measurement plausibility:**  
  - Sums of module and cell voltages, along with the measured battery pack voltage (UAct1), are compared. Errors are triggered when tolerance is exceeded in both diagnoses.  
- **Positive contactor voltage acquisition:**  
  - Difference is calculated between CTC_UAct2 and battery pack voltage within tolerance limits. Diagnosis is functional during pre-charge or when positive contactors are closed (negative open).  
- **Negative contactor voltage acquisition:**  
  - For pre-charge or positive contactor closure, UAct3 must equal battery pack voltage; with negative contactor closed, it must equal 0.  
- **Fuse voltage diagnosis:**  
  - UAct5 should equal battery pack voltage. Active when UAct1 diagnosis is enabled but does not trigger its error.  

8.4. BPIU - Cell Voltage Deviation  
If the voltage difference between the maximum and minimum cell voltage in the pack exceeds a calibrated value within a specific period, an error is triggered.  

The maximum and minimum cell voltage differences are monitored, and deviations causing errors trigger the system to limp home mode during driving. Reduction in charge current occurs during charging.  

Signal I/O  
| Name                   | Description                            | Min | Max | Value Description                           | Sender | Receiver |  
|------------------------|----------------------------------------|-----|-----|---------------------------------------------|--------|----------|  
| BMS_MaxMinDiffCellVol  | Maximum and minimum cell voltage differences | 0   | 2   | 8191: Invalid if diff > 500mV              | BMS    | VCU      |
</page>

<page number="43">
### 8.5. BPIU - Cell Temperature Deviation

The maximum and the minimum cell temperature difference are monitored, and the deviation is checked. Errors are identified when the protection level of cell temperature imbalance is triggered. If the protection level is reached, the battery will be kept at lock state to prevent further damage or unsafe conditions.

#### Signal I/O Table

| Name                     | Description                                 | Min   | Max   | Value Description           | Sender | Receiver |
|--------------------------|---------------------------------------------|-------|-------|-----------------------------|--------|----------|
| BMS_MaxMinDiffCellTemp   | Max and min brick cell temperature differences | -40   | 215   | 255: Invalid Diff Temp;     | BMS    | VCU      |
</page>

<page number="44">
9. MCC - Module Controller Control

9.1. MCC - Cell Voltage Sensing.  
The MCU will measure the brick cell voltages, accuracy of 5mV.

9.2. MCC - Module Voltage.  
Each cell voltage is summed up to get module voltage.

9.3. MCC - Module Temperature.  
Each module is equipped with 4 temperature sensors and each temperature sensor is measured by the MCU.

9.4. MCC - Cell Balancing.  
BCU commands MCU for each brick of cell balancing. External passive balancing is used for cell balancing. The module control unit (MCU) shall communicate with each module using Daisy chain approach. The measurement of temperature is done at an accuracy of ±1°C, and the CAN signal shows the measurement values in 1°C range. The MCU board temperature is also monitored and controlled by the BCU.

**Figure 15: NTC Position in Module.**  
The NTC positions are clearly marked for temperature monitoring within the module.

There are two main functions of the MCC module:  
- A 10ms part for diagnostic function.  
- A 1000ms part for configuration of module information.

The MCC function is divided into a 10ms task and a 1000ms task, which handle the module controller error diagnosis and module configuration respectively. Each task is called individually by the operating system.

The 10ms function contains the diagnosis subsystem. If no errors are reported from the attached MCU’s and MCU’s are sending data, then the signal MCC_StMdulCu will be set to 9 (Run). If an error is reported in any module or the MCU’s are not sending data, the signal status will be updated accordingly.
</page>

<page number="45">
9. MCC - Module Controller Control.

9.1. MCC - Cell Voltage Sensing.  
The MCU will measure the brick cell voltages with an accuracy of 5mV.

9.2. MCC - Module Voltage.  
Each cell voltage is summed up to get the module voltage.

9.3. MCC - Module Temperature.  
Each module is equipped with 4 temperature sensors, and each temperature sensor is measured by the MCU.

9.4. MCC - Cell Balancing.  
The BCU commands the MCU for each brick of cell balancing. External passive balancing is used for cell balancing.  

The module control unit (MCU) communicates with each module using a Daisy chain approach. The measurement of temperature is conducted at an accuracy of ±1℃. Therefore, the CAN signal displays measurement values in a 1℃ range.  

The MCU board temperature is also monitored and controlled by the BCU.

The MCC module performs two main functions:  
- The first part is a **10ms diagnostic function**.
- The second part is a **1000ms configuration function**.

These tasks are called individually by the operating system:  
- **10ms Task**: This contains the diagnostic subsystem. If no errors are reported from the attached MCUs and if the MCUs are sending data, the signal `MCC_StMdulCu` is set to 9 (Run). If an error is reported in any module or if the MCUs are not sending data, the signal is set to 15 (Error). The available errors are defined by the variable containing the Fault Summary array registers for all chips in the Daisy chain.

- **1000ms Task**: This task handles the module configuration.

### Diagnosis System.  
The diagnosis subsystem includes the state flow algorithm, which detects which module controller has raised an error and identifies the error type. The **CDEM module** is responsible for handling fault detection.
</page>

<page number="46">
9.5. MCC - Temperature sensor fault monitoring– number of sensors.
- The over-temperature, under-temperature and temperature deviation monitoring shall continue in case faulty temperature sensors are detected.
- The faulty temperature sensor shall be excluded from calculations; therefore, the faulty sensor will not trigger a temperature limit violation.
- Assuming that thermal runaway detection can run with 3 sensors per module.
- Missing sensor is detected by checking the voltage level on GPIO pin. If the voltage level is below the presence threshold, then it is indicated by the range check as well. No need for separate diagnosis, since range check covers this fault.

9.6. MCC - FUSA.

LPF: Latent Point Fault.
The following SM's are run to detect the latent point fault of the AFE:
- SM19: PEC Diagnostic.
- SM26: Diagnostic tests on digital redundancy.
- SM32: Clear command verification.

SPF: Single Point Fault.
The following SM's are run to detect the latent point fault of the AFE.
</page>

<page number="47">
FMEDA Document:  
Please check the FMEDA document of the AFE - App 6811 FMEDA.

Key Observations from the FMEDA Table:
- Sub-cycles are performed with various SM checks (e.g., Mux Decoder Check, Reference Check, Cell Open-wire Check).
- Diagnostic tests cover voltage level measurements, thermistor range checks, GPIO open-wire validation, and die temperature measurements.
- Each sub-cycle has specific timing associated, typically scheduled at 25.0E-3 ms.
- SM checks such as "Discharge verification algorithm" and "Cells open-wire currents stuck On/Off" are critical, as indicated for certain sub-cycles.
- Redundant GPIO and adjacent short verification are noted with time thresholds.

Specific Tests:
1. SM1: Mux Decoder Check.
2. SM2: Reference Check.
3. SM3: Supply Voltage ADC Check.
4. SM5: Cell Sinc Filter Check.
5. SM10: Aux Register Check.

Scheduled Time: Each sub-cycle contributes to a total duration of 250.0E-3 ms.

For detailed descriptions, refer to the FMEDA documentation, App 6811 FMEDA.
</page>

<page number="48">
10. Battery Thermal Handling Management (BTHM).

10.1. BTHM - Function Description.  
Battery thermal management handling function is responsible for the acquisition and processing of measurements related to the thermal state of the battery pack, BCU, and MCU controllers. This function is also calculating requests required to keep the battery in its optimal thermal boundaries.  

Functionality is split into two main subsystems:  
- Data preparation.  
- Thermal control.  

10.2. BTHM - Data Preparation.  
The data preparation function is used to acquire, electrically check, convert, physically check, and process all necessary data, including:  
- Module controller PCB temperature sensor values transmitted by debug CAN.  
- Cell temperature sensor values transmitted by debug CAN.  
- Coolant inlet temperature sensor from the valve.  
- Coolant outlet temperature sensor from the valve.  
- BCU PCB temperature sensor.  
- Mean pack temperature.  
- Maximum cell temperature (raw and corrected).  
- Minimum cell temperature (raw and corrected).  
- Maximum module controller PCB temperature.  
- Minimum module controller PCB temperature.  
- Average module controller PCB temperature.  

The mean pack temperature is calculated by summing up average module temperatures and dividing them by the number of modules.  

Following checks are executed:  
- Measurement value out of range for coolant temperature sensor at pack inlet.  
- Measurement value out of range for coolant temperature sensor at pack outlet.  
- Measurement value out of range for BCU PCB temperature sensor.  
- Measurement value out of range for module controller PCB temperature sensor.  
- Measurement value out of range for cell temperature sensor.  

In case of cell temperature sensors, alternative values are calculated if a sensor error is detected. In all cases, an error is set if the limits are exceeded. If all temperature sensors of a module are defective, a critical error is set for that module.
</page>

<page number="49">
10. Battery Thermal Handling Management (BTHM)

10.3. BTHM - Thermal Control.

In this subsystem, requests relevant for thermal management are calculated.  

Following signals are calculated:
- Target coolant inlet temperature request.
- Coolant mass flow request.
- Thermal request.

Thermal requests shall be overwritten with calibratable parameters when a service command has been received.  

Coolant mass flow request calculation is based on the following information:
- Difference between minimum and maximum cell temperature.
- Average battery temperature.
- Coolant inlet temperature measurement.
- Current thermal request.

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or 2-D map. Output of the map is saturated on top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.

Homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when the temperatures are close to the switching point. When the homogenization flag is active, and neither heating nor cooling is requested, a different coolant mass flow map will be used for keeping the cell temperatures homogenous.

Additionally, coolant mass flow request calculated from the 2-D map shall be disabled when cooling or heating is not requested.

Following requests are possible:
- Off.
- Cooling.
- Heating.
- Homogenization.
</page>

<page number="50">
### 10. Battery Thermal Handling Management (BTHM)

#### 10.1. BTHM - Function Description
The Battery Thermal Handling Management function is responsible for acquiring and processing measurements related to the thermal state of the battery pack, BCU, and MCU controllers. This function also calculates requests required to keep the battery within optimal thermal boundaries.

Functionality is divided into two subsystems:
- Data preparation.
- Thermal control.

---

#### 10.2. BTHM - Data Preparation
The data preparation function acquires, electrically checks, converts, physically checks, and processes necessary data including:
- Module controller PCB temperature sensor values transmitted by debug CAN.
- Cell temperature sensor values transmitted by debug CAN.
- Coolant inlet temperature sensor from the valve.
- Coolant outlet temperature sensor from the valve.
- BCU PCB temperature sensor.
- Mean pack temperature.
- Maximum cell temperature (raw and corrected).
- Minimum cell temperature (raw and corrected).
- Maximum module controller PCB temperature.
- Minimum module controller PCB temperature.
- Average module controller PCB temperature.

The mean pack temperature is calculated by summing up average module temperatures and dividing by the number of modules.

Checks executed include:
- Measurement values out of range for coolant temperature sensor at pack inlet and outlet.
- Measurement values out of range for the BCU PCB temperature sensor.
- Measurement values out of range for the module controller PCB temperature sensor.
- Measurement values out of range for the cell temperature sensor.

Alternative values are calculated for cell temperature sensors if a sensor error is detected. If all temperature sensors in a module are defective, a critical error is set for that module.

---

#### 10.3. BTHM - Thermal Control
Figure 16: BTHM - Thermal Control System illustrates the subsystem calculating requests related to thermal management.

Signals calculated:
- Target coolant inlet temperature request.
- Coolant mass flow request.
- Thermal request.

Thermal requests can be overwritten with calibratable parameters when a service command is received.

Coolant mass flow request calculations are based on:
- Difference between minimum and maximum cell temperature.
- Average battery temperature.
- Coolant inlet temperature measurement.
- Current thermal request.

Requests depend on the thermal system state and are calculated using calibratable hysteresis or a 2-D map. The output of the map is saturated at calibrated limits, and the maximal calculated value is set as a request.

Homogenization occurs when the temperature difference between the minimum and maximum cell temperature exceeds the upper limit threshold and deactivates when the temperature spread drops below the lower limit threshold. Hysteresis prevents unnecessary switching of requests. When homogenization is active and neither heating nor cooling is requested, a different coolant mass flow map is used to keep cell temperatures homogenous. Coolant mass flow requests from the 2-D map are disabled when cooling or heating is not requested.

Possible thermal requests:
- Off.
- Cooling.
- Heating.
- Homogenization.

---

#### 10.4. BTHM - Thermal Loop in Vehicle
Figure 17: Thermal Loop in Vehicle illustrates the applied thermal loop.

**ON/OFF chiller conditions:**
Table 5: Chiller ON/OFF Operation provides operational conditions for activating the chiller. Thresholds for BMS requests to turn the chiller ON/OFF depend on the operating mode of the battery.

Conditions for turning ON/OFF the chiller:
- **Offline**: 
  - **≥140°C**: ON.
  - **<120°C**: OFF.
- **Online / DC charge / AC charge**:
  - **≥35°C**: ON.
  - **<32°C**: OFF.
- **Other modes**:
  - Always OFF.

Threshold values for BMS request signals ensure operation in specific charge modes, avoiding oscillations, and defaulting to the last set request when offline or in service mode. The "Keep warm" request from VCU is considered by setting different heating thresholds.
</page>

<page number="51">
10. Battery Thermal Handling Management (BTHM)

10.4. BTHM - Thermal Loop in Vehicle

Online: The chiller is turned ON when the maximum cell temperature exceeds 35°C and turned OFF when the maximum cell temperature goes below 32°C.

DC charge: The chiller is turned ON when the maximum cell temperature exceeds 35°C and turned OFF when the maximum cell temperature goes below 32°C.

AC charge: The chiller is turned ON when the maximum cell temperature exceeds 35°C and turned OFF when the maximum cell temperature goes below 32°C.

Another mode: The chiller will be requested to turn OFF.

The BMS sends a request to turn ON/OFF to the VCU through the CAN signal: BMS_VCU_ValveOnOff_Req.

Cooling power calculation: The BMS sends a request to turn ON the chiller to the VCU. If the BMS receives feedback from the VCU, indicating that the chiller was already turned ON (VCU_BMS_ValveOnOff_Sts = 1), the BMS will calculate the cooling power demand and send the value to the VCU through the signal: BMS_CoolPwrDemand.

Cooling power demand is calculated depending on the temperature difference between the target temperature and the inlet temperature. The target temperature of the battery pack is determined based on pack temperature, as shown in the table:

**Table 6: Cooling power calculation**

| Target - Inlet (°C) | Active Cooling/Heating (Power request in kW) | Passive Cooling/Heating (Power request in kW) |
|----------------------|--------------------------------------------|-----------------------------------------------|
| -7                  | -7.5                                       | 0                                             |
| -6                  | -6.5                                       | 0                                             |
| -5                  | -5                                         | 0                                             |
| ≤ 0                 | 0                                          | 0                                             |
| > 0 (Cooling)       | 0                                          | 0                                             |
| 5 (Heating)         | 5                                          | 0                                             |
| 6 (Heating)         | 6                                          | 0                                             |
| 7 (Heating)         | 7                                          | 0                                             |
</page>

<page number="52">
VinES 

VFDSXXBAT1270 

Version: 3 
Uncontrolled copy when printed 
52 | 101 

Print date 
Status 
Functional Responsibility 

3) Mass flowrate calculation:  
BMS sends a request for flowrate to VCU through CAN signal BMS_FlowRate_Req. Flowrate is determined based on the operating mode.

**Table 7: Flowrate based on difference between pack temperature and inlet temperature**
- **Difference Temp (pack - inlet): -150**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): -100**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): -70**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): -15**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): -10**  
  - BMS NOT request Cooling/Heating: 20  
  - BMS request Cooling/Heating: 20  

- **Difference Temp (pack - inlet): -5**  
  - BMS NOT request Cooling/Heating: 15  
  - BMS request Cooling/Heating: 15  

- **Difference Temp (pack - inlet): -4**  
  - BMS NOT request Cooling/Heating: 12  
  - BMS request Cooling/Heating: 12  

- **Difference Temp (pack - inlet): -3**  
  - BMS NOT request Cooling/Heating: 10  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): -2**  
  - BMS NOT request Cooling/Heating: 8  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): -1**  
  - BMS NOT request Cooling/Heating: 5  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): 0**  
  - BMS NOT request Cooling/Heating: 0  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): 1**  
  - BMS NOT request Cooling/Heating: 5  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): 2**  
  - BMS NOT request Cooling/Heating: 8  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): 3**  
  - BMS NOT request Cooling/Heating: 10  
  - BMS request Cooling/Heating: 10  

- **Difference Temp (pack - inlet): 4**  
  - BMS NOT request Cooling/Heating: 12  
  - BMS request Cooling/Heating: 12  

- **Difference Temp (pack - inlet): 5**  
  - BMS NOT request Cooling/Heating: 15  
  - BMS request Cooling/Heating: 15  

- **Difference Temp (pack - inlet): 10**  
  - BMS NOT request Cooling/Heating: 20  
  - BMS request Cooling/Heating: 20  

- **Difference Temp (pack - inlet): 15**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): 70**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): 100**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24  

- **Difference Temp (pack - inlet): 150**  
  - BMS NOT request Cooling/Heating: 24  
  - BMS request Cooling/Heating: 24
</page>

<page number="53">
10. Battery Thermal Handling Management (BTHM)

10.3. BTHM - Thermal Control

In this subsystem, requests relevant for thermal management are calculated.

Following signals are calculated:
- Target coolant inlet temperature request
- Coolant mass flow request  
- Thermal request  

Thermal requests shall be overwritten with calibratable parameters when a service command has been received.

Coolant mass flow request calculation is based on the following information:
- Difference between minimum and maximum cell temperature
- Average battery temperature
- Coolant inlet temperature measurement
- Current thermal request  

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or 2-D map. Output of the map is saturated on top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.

The homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when the temperatures are close to the switching point. When the homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map will be used for keeping the cell temperatures homogenous.  

Additionally, the coolant mass flow request calculated from the 2-D map shall be disabled when cooling or heating is not requested.

Following requests are possible:
- Off
- Cooling
- Heating
- Homogenization  

Calculation of the request is based on minimum and maximum cell temperature values. If certain thresholds are exceeded, the appropriate request is set. Different threshold values shall be set for DC-charge, AC-charge, and Online battery states. Relays are used in order to avoid oscillations of the request signal. If the battery is not in DC-charge, AC-charge, or Online state, the last previously set request will be used. If the battery is offline or in service mode, the request will be set to off.

Additionally, the "Keep warm" request coming from the VCU is considered. When "Keep warm" is requested, different heating thresholds are set.

---

10.4. BTHM - Thermal Loop in vehicle

Figure 17: Thermal Loop in Vehicle  

1) ON/OFF chiller conditions:  
Table 5: Chiller ON/OFF operation  
Thresholds for turning ON/OFF the chiller depend on the operating mode of the battery:

- **Online:** Turn ON the chiller when the maximum cell temperature exceeds 35°C and turn OFF when the maximum cell temperature is below 32°C.  
- **DC charge:** Turn ON the chiller when the maximum cell temperature exceeds 35°C and turn OFF when the maximum cell temperature is below 32°C.  
- **AC charge:** Turn ON the chiller when the maximum cell temperature exceeds 35°C and turn OFF when the maximum cell temperature is below 32°C.  
- **Offline mode:** If the battery is offline or operating under a different mode, the chiller will be requested to be turned OFF.  

---

2) Cooling power calculation:  
BMS sends a request to turn ON the chiller to VCU. If the BMS receives feedback from VCU indicating that the chiller was turned ON (VCU_BMS_ValveOnOff_Sts = 1), the BMS will calculate cooling power demand and send the value to VCU through the signal: `BMS_CoolPwrDemand`.  

Cooling power demand is calculated depending on the temperature difference between the target temperature and inlet temperature. Target temperature of the pack is determined based on pack temperature as shown below:  

Table 6: Cooling Power Calculation
- Target Temperature (-7°C): Active Cooling: -7.5kW / Passive Cooling: 0kW
- Target Temperature (-5°C): Active Cooling: -5kW / Passive Cooling: 0kW
- Target Temperature (0°C or greater): Cooling Disabled  

---

3) Mass flowrate calculation:  
BMS sends a request for flowrate to VCU through the CAN signal: `BMS_FlowRate_Req`. Flowrate is determined depending on the operating mode as indicated below:

Table 7: Flowrate based on temperature difference  
- High negative temperature differences (e.g., -100°C): Flowrate remains constant at 24 regardless of active/passive cooling requests.
- Lower differential levels (e.g., -1°C to +1°C): Active cooling may dynamically increase flow to adjust system performance.

---

4) ON/OFF Heating conditions:  
Threshold for BMS to send requests for turning ON/OFF the PTC Heater depends on the operating mode of the battery:

Table 8: PTC ON/OFF operation
- **Offline:** Turn ON the PTC Heater if the minimum cell temperature falls to ≤ -10°C. Turn OFF if the temperature rises above -9°C.  
- **Online:** Turn ON the PTC Heater when minimum cell temperature falls to ≤ 10°C. Turn OFF if the temperature exceeds 12°C.  
- **DC Charge:** Turn ON the PTC Heater for minimum cell temperatures ≤ 10°C. Turn OFF if temperature exceeds 15°C.  
- **AC Charge:** Turn ON the PTC at ≤ 10°C.  

For ROW markets, the BMS includes a periodic pre-heating condition. When the minimum cell temperature falls below -10°C and battery SOC > 30%, pre-heating is initiated. Heating ceases once minimum temperature rises above -9°C or SOC drops below 30%.
</page>

<page number="54">
10.3. BTHM - Thermal Control.

In this subsystem, requests relevant for thermal management are calculated. Following signals are calculated:
- Target coolant inlet temperature request.
- Coolant mass flow request.  
- Thermal request.  

Thermal requests shall be overwritten with calibratable parameters when a service command has been received. Coolant mass flow request calculation is based on the following information:
- Difference between minimum and maximum cell temperature.
- Average battery temperature.
- Coolant inlet temperature measurement.
- Current thermal request.

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or 2-D map. Output of the map is saturated at the top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.

Homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when the temperatures are close to the switching point. When the homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map will be used to keep the cell temperatures homogenous.

Additionally, coolant mass flow request calculated from the 2-D map shall be disabled when cooling or heating is not requested. Following requests are possible:
- Off.
- Cooling.
- Heating.
- Homogenization.

Calculation of the request is based on minimum and maximum cell temperature values. If certain thresholds are exceeded, an appropriate request is set. Different threshold values shall be set for DC-charge, AC-charge, and Online battery states. Relays are used to avoid oscillations of the request signal. If the battery is not in DC-charge, AC-charge, or Online state, the last previously set request will be used. If the battery is offline or in service mode, the request will be set to off.

Additionally, “Keep warm” request coming from the VCU is considered. When “Keep warm” is requested, different heating thresholds are set.

10.4. BTHM - Thermal Loop in vehicle.

**Figure 17: Thermal Loop in Vehicle.**

1) ON/OFF chiller conditions:  
**Table 5: Chiller ON/OFF operation.**

Chiller ON/OFF requests are sent through the CAN signal `BMS_VCU_ValveOnOff_Req` based on battery operating mode:  
- Offline mode: Request to turn ON when max cell temperature ≥ 140°C, turn OFF when max cell temperature < 120°C.  
- Online mode/DC charge/AC charge: Request to turn ON when max cell temperature ≥ 35°C, turn OFF when max cell temperature < 32°C.  
- Other mode: Chiller will remain OFF.

Thresholds for the BMS send-out request of turning the chiller ON/OFF depend on the battery's operating mode.

2) Cooling power calculation:  
BMS sends a request to turn ON the chiller to VCU. Upon receiving confirmation that the chiller is ON (`VCU_BMS_ValveOnOff_Sts = 1`), BMS calculates cooling power demand and sends it to the VCU through the signal `BMS_CoolPwrDemand`.

Cooling power demand is calculated depending on the temperature difference between target temperature and inlet temperature. Target temperature for the pack is determined based on pack temperature as per Table 6.

**Table 6: Cooling power calculation.**  

| Target - Inlet (°C) | Active Cooling/Heating Power Request (kW) | Passive Cooling/Heating Power Request (kW) |  
| -------------------- | ----------------------------------------- | ------------------------------------------ |  
| -7                  | -7.5                                     | 0                                          |  
| -6                  | -6.5                                     | 0                                          |  
| -5                  | -5                                       | 0                                          |  
| ≤ 0                 | 0                                        | 0                                          |  
| > 0                 | 0                                        | 0                                          |  
| 5                   | 5                                        | 0                                          |  
| 6                   | 6                                        | 0                                          |  
| 7                   | 7                                        | 0                                          |  

3) Mass flow rate calculation:  
BMS sends a request for flow rate to VCU through the CAN signal `BMS_FlowRate_Req`. Flow rate is determined based on the operating mode.  

**Table 7: Flow rate based on difference between pack temperature and inlet temperature.**  

| Difference Temp (pack - inlet) | BMS NOT Request Cooling/Heating | BMS Request Cooling/Heating |  
| ------------------------------ | ------------------------------- | --------------------------- |  
| -150                           | 24                              | 24                          |  
| -100                           | 24                              | 24                          |  
| -70                            | 24                              | 24                          |  
| -15                            | 24                              | 24                          |  
| -10                            | 20                              | 20                          |  
| -5                             | 15                              | 15                          |  
| -4                             | 12                              | 12                          |  
| -3                             | 10                              | 10                          |  
| -2                             | 8                               | 10                          |  
| -1                             | 5                               | 10                          |  
| 0                              | 0                               | 10                          |  
| 1                              | 5                               | 10                          |  
| 2                              | 8                               | 10                          |  
| 3                              | 10                              | 10                          |  
| 4                              | 12                              | 12                          |  
| 5                              | 15                              | 15                          |  
| 15                             | 24                              | 24                          |  
| 70                             | 24                              | 24                          |  
| 100                            | 24                              | 24                          |  
| 150                            | 24                              | 24                          |  

4) ON/OFF heating conditions:  
**Table 8: PTC ON/OFF operation.**

Thresholds for BMS request to turn ON/OFF the PTC heater are based on the battery operating mode:  
- Offline mode: Turn ON when min cell temperature ≤ -10°C, turn OFF when min cell temperature > -9°C.  
- Online mode: Turn ON when min cell temperature ≤ 10°C, turn OFF when min cell temperature > 12°C.  
- DC charge mode: Turn ON when min cell temperature ≤ 10°C, turn OFF when min cell temperature > 15°C.  
- AC charge mode: Turn ON when min cell temperature ≤ 10°C, turn OFF when min cell temperature > 12°C.  
- Other mode: PTC heater remains OFF.

For ROW markets, the BMS provides a pre-heating condition that wakes periodically to check temperature. When min cell temperature ≤ -10°C and SOC > 30%, the BMS requests to turn ON PTC and turns OFF PTC when the minimum cell temperature exceeds -9°C or when SOC < 30%.

Signal I/O descriptions are provided for `CAN` communications. Signals include:
- Temperature signals (`BMS_CoolantOutletTemp`, `BMS_CoolantInletTemp`).
- Flow rate signals (`BMS_FlowRate_Req`).  
- ON/OFF signals (`BMS_VCU_ValveOnOff_Req`, `BMS_VCU_PTCOnOff_Req`).  
- Cooling/heating power signals (`BMS_CoolPwrDemand`, `BMS_HeatPwrDemand`) for effective battery thermal management.
</page>

<page number="55">
10.5. BTHM - BDU Temperature Sensor Control.

The hottest zone point temperature in the Battery Disconnect Unit (BDU) is monitored. The sensor location is chosen with production convenience in mind, and an offset is added for accurate detection. Testing has been conducted by placing the temperature sensor at various locations to identify the hottest zone.

State and conditions for temperature control are as follows:

- **Condition: BDU_Temp_Meas < -35°C.**
  - **BMS_ERR_LEV:** 2 – Limp home mode.

- **Condition: -35°C ≤ BDU_Temp_Meas < -30°C.**
  - **BMS_ERR_LEV:** 0.

- **Condition: -30°C ≤ BDU_Temp_Meas < 93°C.**
  - **BMS_ERR_LEV:** 0.

- **Condition: 93°C ≤ BDU_Temp_Meas < 100°C.**
  - **BMS_ERR_LEV:** 0 – Send warning to MHU to start degrading power due to high temperature of HV components in the battery.

- **Condition: 100°C ≤ BDU_Temp_Meas < 105°C.**
  - **BMS_ERR_LEV:** 2 – Limp home mode.

- **Condition: BDU_Temp_Meas ≥ 105°C.**
  - **BMS_ERR_LEV:** 4 – Open the contactor within the Fault Tolerant Timing Interval (FTTI).

Three target limits are set with degradation modes:
1. **First target limit:** Calibrated temperature limits will trigger power derating; reduction in temperature is monitored.
2. **Second target limit:** If the temperature continues to rise, the system enters limp home mode.
3. **Third and highest target limit:** If the temperature exceeds the hottest calibrated limit, BMS_ERR_LEV = 4 is triggered; this opens the contactor within FTTI time.
</page>

<page number="56">
10.5. BTHM - BDU Temperature Sensor Control.

The Hottest zone point temperature in the BDU is monitored. The location is chosen as per the production convenience into consideration, so an offset shall be added for detection. Testing has been done on the BDU by placing the temperature sensor at different locations to identify the hottest zone. Three target limits are set with degradation modes.

- The first target of calibrated temperature limits will de-rate the power and check if the temperature reduces.
- If the temperature is still further increased, it will lead to limp home mode.
- If the temperature still rises to the hottest limit, then `BMS_ERR_LEV = 4` will trigger, and the contactor will open within FTTI time.

State conditions:

- `BDU_Temp_Meas < -35°C`: `BMS_ERR_LEV = 2` (Limp home mode).
- `-35°C ≤ BDU_Temp_Meas < -30°C`: `BMS_ERR_LEV = 0`.
- `-30°C ≤ BDU_Temp_Meas < 93°C`: `BMS_ERR_LEV = 0`.
- `93°C ≤ BDU_Temp_Meas < 100°C`: `BMS_ERR_LEV = 0` (Send warning to MHU to start degrading power due to high temperature at HV components of the battery).
- `100°C ≤ BDU_Temp_Meas < 105°C`: `BMS_ERR_LEV = 2` (Limp home mode).
- `BDU_Temp_Meas ≥ 105°C`: `BMS_ERR_LEV = 4` (Open the contactor within FTTI time).

---

10.6. BTHM - BDU Thermal Runaway Detection.

Assumption:
The cell fulfills EUCAR L4 or better.

Operational details:
- According to the cell manufacturer, the cell fulfills EUCAR L4 until 125°C. The pack will be allowed to be discharged until 60°C.
- The gradient is calculated continuously but is only taken into account when the temperature exceeds the thermal runaway limit.
- If the temperature rises between calibrated X °C/s, thermal runaway will be detected and triggered.

Signal I/O:
- Name: `BMS_ThermalRunaway`.
  - Description: Thermal runaway.
  - Min: 0.
  - Max: 1.
  - Value Description:
    - `1`: Warning.
    - `0`: No warning.
  - Sender: BMS.
  - Receiver: MHU.

Thermal runaway warning information will be sent to MHU.
</page>

<page number="57">
11. Battery Vehicle Communication.

11.1. BVC - Function Description.
The Battery Vehicle Communication function is responsible for acquisition and processing of signals received from the vehicle or other external devices via CAN. The Battery Vehicle Communication function is divided into initialization tasks and 10ms, 100ms, and 1000ms tasks for received and transmitted signals, respectively. Additionally, there is a separate 10ms task for signals of Battery Data Access Rx messages. Each task is called individually by the operating system.

The function contains:
- Handling of service commands.
- Reset at a 10ms cycle time during the ignition voltage signal being turned on.
- Monitoring of CAN communication.
- Acquisition and forwarding of HV battery mode requests.

11.2. BVC - VCU State Request.
The battery state request is set to the states that are known by the other BMS ASW components.

Table 9: VCU State Request  
| VCU_BMS_HVOnOff_REQ | VCU_ChargeAllow | VCU_DcChgGunIn | VCU_AcChgGunIn | HV State          |  
|---------------------|----------------|----------------|----------------|-------------------|  
| 1                   | 0 or 1         | 1              | 0              | DC_HV_ON (DC charging) |  
| 1                   | 0 or 1         | 0 or 1         | 1              | AC_HV_ON (AC charging) |  
| 1                   | 0 or 1         | 0              | 0              | HV_ON (drive Online) |  
| 0                   | 0 or 1         | 0 or 1         | 0 or 1         | HV_OFF              |  

States include:  
1. Offline.  
2. Online.  
3. AC Charge.  
4. DC Charge.
</page>

<page number="58">
### 11. Battery Vehicle Communication

#### 11.1. BVC - Function Description
The Battery Vehicle Communication function handles the acquisition and processing of signals received from the vehicle or external devices via CAN. It includes initialization tasks alongside 10ms, 100ms, and 1000ms cycles for received and transmitted signals. Additionally, there is a 10ms cycle task for Battery Data Access Rx message signals, each called individually by the operating system.

The function includes:
- Handling of service command.
- Reset at 10ms cycle time during ignition voltage signal activation.
- Monitoring CAN communication.
- Acquiring and forwarding HV battery mode requests.

#### 11.2. BVC - VCU State Request
The battery state request is determined according to known battery states in association with other BMS ASW components.

**Table 9: VCU State Request**
| VCU_BMS_HVOnOff_REQ | VCU_ChargeAllow | VCU_DcChgGunIn | VCU_AcChgGunIn | HV State              |
|----------------------|-----------------|----------------|----------------|----------------------|
| 1                    | 0 or 1         | 1              | 0              | DC_HV_ON             |
| 1                    | 0 or 1         | 0 or 1         | 1              | AC_HV_ON             |
| 1                    | 0 or 1         | 0              | 0              | HV_ON (drive Online) |
| 0                    | 0 or 1         | 0 or 1         | 0 or 1         | HV_OFF               |

Battery states are defined as follows:
1. **Offline:** High Voltage is OFF (No Charging or Discharging, typically a parking condition).
2. **Online:** High Voltage is ON, vehicle is in driving mode.
3. **AC Charge:** High Voltage is ON, vehicle is charging via AC power.
4. **DC Charge:** High Voltage is ON, vehicle is charging via DC power.

#### 11.3. BVC - Discharge Power 3D Data
Cell operating limit data is considered for discharging and charging. 

For DC charging, the following demand parameters are evaluated:
- SOC range of 10% to 70%.
- Achievable within a 26-minute interval at varying temperature ranges.

**DC Charge Profile:** Refer to "SFC_Profile.xlsx" for detailed specifications. 

**AC Charge Conditions:**
- Charge allow flag from VCU must be set.
- Request to close contactors from VCU is activated (disabled via calibration).
- AC charging gun must be connected.

**DC Charge Conditions:** 
- Charge allow flag from VCU must be set.
- Request to close contactors from VCU is activated (disabled via calibration).
- DC charging gun must be connected.

**AC/DC Charging Profile:**
- **Temperature Zone:** 10°C to 45°C.
- **SOC Zone:** 10% to 70%.
- **Maximum Charging Current:** 2.1C (470A).
</page>

<page number="59">
VinES VFDSXXBAT1270

Version: 3  
Uncontrolled copy when printed  
59 | 101  

11.3. BVC - Discharge power 3D Data  
SFC Profile Information at room temperature.  

**BCF_IChLimForDcCh_M**: Charge current limit for DC-Charge (Profile 2.1C).

**Table 10: SFC - DC Charging Profile**

- At SOC = 0 and Temp = 0°C, the charge current limit is 47.7A.
- At SOC = 0 and Temp = 5°C, the charge current limit is 55.65A.
- At SOC = 0 and Temp = 10°C, the charge current limit is 63.6A.
- At SOC = 0.1 and Temp = 10°C, the charge current limit is 156.35A.
- At SOC = 0.1 and Temp = 15°C, the charge current limit is 265A.
- At SOC = 0.25 and Temp = 25°C, the charge current limit is 325A.
- At SOC = 0.5 and Temp = 30°C, the charge current limit is 325A.
- At SOC = 0.7 and Temp = 37.5°C, the charge current limit is 325A.
- At SOC = 1 and Temp = 51°C, the charge current limit is 0A.

**BCF_IChLimForAcCh_M**: Charge current limit for AC-Charge (Profile 0.3C).

**Table 11: SFC - AC Charging Profile**

- At SOC = 0 and Temp = 0°C, the charge current limit is 47.7A.
- At SOC = 0 and Temp = 10°C, the charge current limit is 76.32A.
- At SOC = 0.2 and Temp = 25°C, the charge current limit is 76.32A.
- At SOC = 0.4 and Temp = 32°C, the charge current limit is 76.32A.
- At SOC = 0.6 and Temp = 37.5°C, the charge current limit is 76.32A.
- At SOC = 0.8 and Temp = 44°C, the charge current limit is 76.32A.
- At SOC = 0.95 and Temp = 46°C, the charge current limit is 47.7A.
- At SOC = 1 and Temp = 51°C, the charge current limit is 0A.

**Important Notes on Charging Behavior**  
- To avoid overcharge current protection when heating during OBC or DC charging, the BMS allows short charging times when the temperature is below 0°C.  
- VCU must ensure that the charge current via BMS does not exceed 10 seconds when the temperature is below 0°C.
</page>

<page number="60">
Signal I/O  
**Name:** BMS_ChgVoltage_REQ  
**Description:** Charge Voltage Request  
**Min:** 0  
**Max:** 800  
**Value Description:** 16383 - Invalid  
**Sender:** BMS  
**Receiver:** VCU  

**Name:** BMS_ChgCurrent_REQ  
**Description:** Charge Current Request  
**Min:** 0  
**Max:** 1500  
**Value Description:** 4095 - Invalid  
**Sender:** BMS  
**Receiver:** VCU
</page>

<page number="61">
11.4. BVC - HMI (MHU/IPC) Communication

### Display and Operation concept (HMI/MHU/IPC)

**No. 1: BMS Sends Remaining Charging Time for Display.**   
Remaining charging time is calculated for AC and DC charging, and the time is sent from BMS to display the value to the customer.

*Note:*  
The accuracy of the remaining charging time calculation will be affected by ripple present in the charger. Lower ripple of under 1A will provide accurate remaining time calculation within minutes. If ripple exceeds this threshold, the remaining charging time may jump unpredictably.

---

### DISPLAY Warnings (HMI/MHU/IPC)

| **No.** | **Message**                                    | **Description**                                                                                                                                                                                                   | **Priority** |
|---------|------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|
| 1       | **BMS_ID 0x493_Battery high temperature warning [BIT 12, 13]** | **BMS_PackTempSts = 0x2 "Under Temperature Warning":** The Vehicle EV Battery temperature has fallen below the recommended range. To avoid damage, please stop driving and connect the charger to heat up the battery pack. If the issue persists, contact VinFast Service. Refer to the User Manual.  **BMS_PackTempSts = 0x1 "Over Temperature Warning":** The Vehicle EV Battery temperature has exceeded the recommended range. To avoid damage, please stop driving and allow the battery to cool. If the issue persists, contact VinFast Service. Refer to the User Manual. **BMS_PackTempSts = 0x0 "No warning":** No temperature warnings are detected. | 2            |
| 2       | **BMS_ID 0x493_Thermal Runaway [BIT 14]**        | **BMS_ThermalRunaway = 0x1 "Warning":** Please evacuate your vehicle immediately. **BMS_ThermalRunaway = 0x0 "No Warning":** No thermal runaway warnings are detected.                                            | 1            |
| 3       | **BMS_ID 0x493_Battery Replacement [BIT 15]**   | **BMS_BatteryReplacement = 0x1 "Warning":** Vehicle EV battery needs to be replaced soon. Continuing to use the battery might lead to a shortage in travel distance or other unexpected issues. Please contact VinFast Service to replace your battery. **BMS_BatteryReplacement = 0x0 "No Warning":** No battery replacement warnings are detected. | 9            |
| 4       | **BMS_ID 0x493_Battery Malfunction [BIT 21]**   | **BMS_MalfunctionSts = 0x1 "Malfunction indicator lamp ON":** Battery malfunction detected. EV battery cannot function normally, and system functionality is impacted. Stop the vehicle in a safe place. Please contact VinFast Service to have your vehicle inspected. **BMS_MalfunctionSts = 0x0 "Malfunction indicator lamp OFF":** No battery malfunctions are detected. | 3            |
</page>

<page number="62">
VinES

VFDSXXBAT1270

Version: 3  
Uncontrolled copy when printed  
62 | 101  
Print date  

Status  
Functional Responsibility  

**BMS_ID 0x493_Low Battery Warning [BIT 22, 23]:**  
- **BMS_LowBattery = 0x2 ("Extremely low level").**  
- **BMS_LowBattery = 0x1 ("Low level").**  
- **BMS_LowBattery = 0x0 ("No warning").**  
Description: EV Battery voltage is low. To ensure your vehicle still drives, please make your way to the nearest Charge Station.  
Priority: 4  

**BMS_ID 0x493_Battery delta temperature warning [BIT 20]:**  
- **BMS_PackDeltaTSts = 0x1 ("Level 1 Warning").**  
- **BMS_PackDeltaTSts = 0x0 ("No warning").**  
Description: EV Battery reached Level 1 delta Temperature warning and going into turtle mode (Limp home mode).  
Priority: 3  

**BMS_ID 0x493_Battery delta temperature warning [BIT 19]:**  
- **BMS_PackDeltaTSts = 0x1 ("Level 1 extreme").**  
- **BMS_PackDeltaTSts = 0x0 ("No warning").**  
Description: EV Battery reached Level 2 extreme delta Temperature warning, Car is stopped. For safer operation get out of the car immediately and call VF Service.  
Priority: 2  

**BMS_ID 0x493_Battery Isolation Error [BIT 18]:**  
- **BMS_PackIsoSts = 0x1 ("Level 3 Warning").**  
- **BMS_PackIsoSts = 0x0 ("No warning").**  
Description: EV Battery reached Level 3 isolation warning and going into turtle mode (Limp home mode). Reach nearest VF Service station and get support.  
Priority: 5  

**BMS_ID 0x493_Vehicle HVIL Error [BIT 17]:**  
- **BMS_VehHVILSts = 0x1 ("HVIL Error").**  
- **BMS_VehHVILSts = 0x0 ("No warning").**  
Description: HVIL Error detected in the vehicle. Finish the trip completely or reach nearest VF service station to get the problem rectified.  
Priority: 6  

**BMS_ID 0x493_Battery Delta SOC Warning [BIT 16]:**  
- **BMS_PackDeltaSocSts = 0x1 ("Warning").**  
- **BMS_PackDeltaSocSts = 0x0 ("No warning").**  
Description: EV Battery Delta SOC is high, range reduction in vehicle will be absorbed. Drive and charge for a few times; no warning message will appear. If warning message appeared frequently, reach nearest VF Service station.  
Priority: 8  

**BMS_ID 0x493_Battery BDU temperature warning [BIT 16]:**  
- **BMS_PackDeltaSocSts = 0x1 ("BDU Temperature Warning").**  
- **BMS_PackDeltaSocSts = 0x0 ("No warning").**  
Description: EV Battery temperature is high, power reduction in vehicle will be absorbed. Will be recovered if the temperature becomes normal.  
Priority: 7  

**BMS_ID 0x493_Battery BDU HOT [BIT 31]:**  
- **BMS_PackDeltaSocSts = 0x1 ("BDU Hot").**  
- **BMS_PackDeltaSocSts = 0x0 ("No warning").**  
Description: EV Battery temperature request Limp Home.  
Priority: 7  

**BMS_ID 0x493_Battery BDU Extremely HOT [BIT 31]:**  
- **BMS_PackDeltaSocSts = 0x1 ("BDU Extreme Hot").**  
- **BMS_PackDeltaSocSts = 0x0 ("No warning").**  
Description: Vehicle is stopped due to extreme high temperature of the EV Battery parts. Allow Battery Pack to cool down and start the trip.  
Priority: 7
</page>

<page number="63">
**BVC – CAN Crash Signal Function Description:**

When the crash is detected by the ACM, the ACM sends the crash signal to the Gateway ECU. The Gateway ECU provides the *ACM_Crash_Sts* signal to PT-CAN. This signal is received by the BMS to detect the crash or no-crash status of the vehicle.

When the BMS receives *ACM_Crash_Sts = Crash*, it sends *BMS_ERR_LEV = 7* to the VCU and immediately opens the high-voltage contactor. Once the high voltage is broken, *BMS_HVOnOff_STS = HV Off*.

---

**Signal I/O**

- **Name:** ACM_Crash_Sts  
  **Description:** Crash information from the Airbag Control Module  
  **Min:** 0  
  **Max:** 1  
  **Value Description:**  
    - 1: Crash  
    - 0: No Crash  
  **Sender:** ACM  
  **Receiver:** BMS
</page>

<page number="64">
12. BCTE - Battery Charge Time Estimation.

12.1. BCTE - Function Overview.
This function shall estimate and output the Battery charging remaining time. The output would be the maximum charging time in hours and minutes.

12.2. BCTE - Function Description.
Calibration approach: A 4-D map table based on cell temperature, coolant temperature, SOC, and maximum current available from the charger is used. The map table is built from experimental results. Remaining charge time output from this method is referred to as time_B.

Signal I/O:
- Name: BMS_RemainChargeTime.
- Description: Remain Charge Time sent to other ECU (XGW - IPC).
- Min: 0.
- Max: 16383.
- Value Description: 1023: Invalid.
- Sender: BMS.
- Receiver: XGW.
</page>

<page number="65">
13. BWLD - Battery Warranty Logistic Data.

13.1. BWLD - Function Overview.

This function calculates specified battery states throughout the whole battery life cycle. These states shall be seen as a history of the battery usage e.g., for possible warranty claims, respectively as useful data during development phases. Therefore, these states shall represent the key data of the battery to enable conclusions in case of battery problems. The function also serves as back-end for the PC-based GUI tool, which is used to connect to the BMS and readout specific data as well as request special service modes.

13.2. BWLD - Function Description.

This function is divided into 10ms, 100ms, and 1000ms tasks depending on the input data recurrence.  
Each task is individually called by the operating system.

### Data Log for 1000ms:
Increment the battery-aging counter by one per second if the high voltage connection to the vehicle or charger is established.

### Data Log for 100ms:
The 100ms function calculates the following minimum and maximum values:
- Cell voltage
- Battery SOC
- Cell temperature

It is possible to reset all values by service command 23 or with a calibration parameter. The measured values are only taken into account if the following conditions are valid:
- Error level below or equal to "3" (a higher error level can result in faulty values).
- BCU state is "1" for more than one cycle (necessary since some values like the SOC need an additional cycle to output correct values).

#### Battery SOC.
When BCU conditions are valid, then the Minimum and Maximum SOC of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.

#### Cell Temperature.
When BCU conditions are valid, then the Minimum and Maximum cell temperature of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.

#### Cell Voltage.
When BCU conditions are valid, then the Minimum and Maximum cell voltage of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.

### The 10ms function calculates the following values:
</page>

<page number="66">
13. BWLD - Battery Warranty Logistic Data.

13.1. BWLD - Function Overview.  
This function calculates specified battery states throughout the whole battery life cycle. These states shall be seen as a history of the battery usage e.g., for possible warranty claims or as useful data during development phases. These states shall represent the key data of the battery to enable conclusions in case of battery problems. The function also serves as a back-end for the PC-based GUI tool that connects to the BMS, reads specific data, and requests special service modes.

13.2. BWLD - Function Description.  
The function is divided into 10ms, 100ms, and 1000ms tasks, depending on input data recurrence. Each task is individually called by the operating system.

**Data Log for 1000ms:**  
Increment the battery-aging counter by one per second if the high voltage connection to the vehicle or charger is established.

**Data Log for 100ms:**  
The 100ms function calculates the following minimum and maximum values:  
- Cell voltage.  
- Battery SOC.  
- Cell temperature.  

Measured values are only taken into account if the following conditions are valid:  
- Error level below or equal "3" (higher error levels can result in faulty values).  
- BCU state is "1" for more than one cycle (necessary since some values like SOC require an additional cycle for correct output).  

**Battery SOC:**  
Minimum and maximum SOC of the battery pack are stored in the memory. Values are reset with a service command or calibration parameter.

**Cell Temperature:**  
Minimum and maximum cell temperature of the battery pack are stored in the memory. Values are reset with a service command or calibration parameter.

**Cell Voltage:**  
Minimum and maximum cell voltage of the battery pack are stored in the memory. Values are reset with a service command or calibration parameter.

**10ms Tasks:**  
These tasks calculate:  
- Minimum and maximum battery voltage in closed and open contactor states.  
- Battery energy during charging/discharging over the battery life cycle and current driving cycle.  
- Maximum power during charging and discharging.  
- Maximum current during charging and discharging.  
- Amount of non-volatile MCU write operations.  

**Microcontroller NVM write operations:**  
The system counts valid non-volatile write operations during battery life. The NVM counter resets to 0 using calibration parameters.

**Stored BWLD data:**  
The Battery Management System logs:  
- Total energy stored/supplied during the battery's life cycle.  
- Maximum current/power during charging and discharging within the battery's life cycle.  
- Maximum/minimum state of charge during the battery's life cycle.  
- Time in use with closed contactors.  
- Maximum/minimum temperature during the battery's life cycle.  
- Maximum/minimum voltage while contactors are closed.  
- Maximum/minimum voltage while contactors are open.  
- Maximum/minimum cell voltage during the battery's life cycle.  

UDS services are used to read BWLD data.
</page>

<page number="67">
VinES

VFDSXXBAT1270

Version: 3  
Uncontrolled copy when printed  
67 | 101  
 
14. BPP - Battery Protection Pack.

14.1. BPP - Function Description.  
Normal Mode:  
Besides the diagnosis part, this module also collects all available current flow signals and transmits one valid current. The primary current sensor shall be chosen by calibration parameter as long as there is no exception. An exception would be the failure of a sensor or the detection of a current flow that exceeds the operational range of a sensor.

Diagnoses:  
The battery protection module executes several diagnoses in order to report the status of the battery regarding safety by transmitting error flags (of each single diagnosis) to the diagnostic event modules and current limitations to the vehicle interface and other internal modules. Topmost priority is to protect humans in the area of the battery from harm due to malfunction and, of course, the battery pack hardware itself from damage of any kind.

Each diagnosis shall be disabled/enabled dependent on the current battery state and module controller initialization state. The voltage acquisition diagnosis is also temporarily disabled upon contactor switching event. If the current flow exceeds the valid range of at least one current sensor, the current sensor plausibility diagnosis is disabled. The resistance and voltage plausibility diagnoses are also temporarily disabled, if there is a significant current gradient.

14.2. BPP - Pack Resistance.  
Detect a drastically increase in the pack resistance.  
The software calculates the resistance of the last 5 stored current and voltage values if the current gradient exceeds a specified limit. Pack resistance calculation is more precise when current flow is bigger.  
The diagnosis will be inhibited if:  
- The actual current flow is smaller than a defined minimum current flow as the resistance.  
- Calculation is inaccurate during low current flow.  
- One of the current sensor’s errors is active.  
- A defined timer after diagnosis activation has not passed.  
- The cycler allows execution.  

14.3. BPP - Cell Temperature Limit.  
Detect an exceedance of the cell temperatures.  
This system includes the core algorithm of the cell temperature diagnosis. Each value of the input array gets compared to calibrated minimum/maximum limits and induces corresponding error and warning symptoms.  

14.4. BPP - Controller Temperature Limit.  
Detect an exceedance of the controller temperatures.
</page>

<page number="68">
14. BPP - Battery Protection Pack.

14.1. BPP - Function Description.
Normal Mode: Besides the diagnosis part, this module collects all available current flow signals and transmits one valid current. The primary current sensor is determined via calibration parameter unless there is an exception (e.g., sensor failure or excessive current flow outside operational range).

Diagnoses: The battery protection module executes various diagnoses to report battery status regarding safety. Error flags and current limitations are sent to the vehicle interface and internal modules. Priority is protecting individuals and battery hardware from harm or damage.

Each diagnosis is disabled/enabled based on battery state and initialization. Voltage acquisition diagnosis is disabled during contactor switching. Current sensor plausibility diagnosis is disabled if current exceeds valid range. Resistance and voltage plausibility diagnoses are disabled during significant current gradients.

14.2. BPP - Pack Resistance.
Detects significant increases in pack resistance. Resistance is calculated using the last five current and voltage values. Accuracy improves with a higher current flow.

Inhibition criteria:
- Current flow smaller than defined minimum, as resistance calculation is inaccurate in low flow conditions.
- Active current sensor errors.
- Defined timer after activation not elapsed.
- Cycler execution conditions unmet.

14.3. BPP - Cell Temperature Limit.
Detects instances where cell temperature exceeds limits. Each value in the input array is compared to calibrated thresholds, generating error and warning symptoms.

14.4. BPP - Controller Temperature Limit.
Calculates controller temperature diagnosis and checks measured temperature against limits.

14.5. BPP - SOC Limit.
Detects exceedance of the module SOC limit. State of charge values are compared against calibrated thresholds, inducing error and warning symptoms.

14.6. BPP - SOH Limit.
Detects exceedance of pack SOH limits. SOH values are compared against three calibrated limits to generate errors as needed. 
- Battery Replacement Warning triggered at SOH below 5%.
- Real Battery SOH around 71.5%; replacement warranty sent if SOH drops below 70%.

Max Charge Available Capacity:
- <70%: Insufficient capacity.
- 71.5%-70%: Moderate capacity.
- 100%-71.5%: Full capacity.

SoH (Signal: BMS_SOH):
- <5%: Critical condition.
- 5%-0%: Moderate condition.
- 100%-5%: Full health.

14.7. BPP - Pack Voltage Limit.
Detects exceedance of pack voltage limits (min/max). Pack voltage 'U1' is compared against thresholds based on the minimal raw cell temperature.

Signal I/O.

**Name:** BMS_LowBattery.  
**Description:** Low Battery Warning (Pack Level).  
**Min:** 0.  
**Max:** 15.  
**Value Description:**  
- 2: Extremely low level (less than 275V).  
- 1: Low level (less than 300V).  
- 0: No warning.  
**Sender:** BMS.  
**Receiver:** VCU.
</page>

<page number="69">
14.8. BPP - Contactor Release Inhibition. 

In case there is an extremely high current flow, the contactors must not open instantly to enable the fuse to clear as opening a contactor during extremely high current flow could destroy it. The contactors will disconnect the circuit anyway even if the fuse does not clear but delayed.  

The generated inhibition command is transmitted to the contactor control module, which will delay the opening of the contactors as long as this command is true. The length of the inhibition command shall be configured by calibration value.  

As per the design parameters, the length of time required to make the contactor in inhibition state is around 100ms.

- **Pulsed current (A):** 6000  
- **Pulse duration [ms]:** 100  

Figure 18 shows the Over Current Configuration, illustrating the ranges of current and contactor/fuse behavior:
- Operation occurs between 0A and 250A peak current for the main contactor.
- Damage to the contactor or fuse can occur beyond 1000A discharge current.
- The overlap area indicates ranges where contactors rely on fuse clearing for safety.
</page>

<page number="70">
15. CDEM - Common Diagnostic Event Manager.

15.1. CDEM - Architecture Overview.

The common diagnostic event manager consists of four main parts:

- **10ms recurring task:**  
  Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.

- **SetStatus Call:**  
  Changes the error status of a specific ID.

- **GetStatus Call:**  
  Returns the error status of a specific ID.

- **Init task:**  
  Updates the error information at BCU startup.
</page>

<page number="71">
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.

The common diagnostic event manager consists of four main parts:

- **10ms recurring task:**  
  Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.

- **SetStatus Call:**  
  Changes the error status of a specific ID.

- **GetStatus Call:**  
  Returns the error status of a specific ID.

- **Init task:**  
  Updates the error information at BCU startup.

Figure 19 illustrates the architecture of CDEM.

---

15.2. CDEM - Function Description.

**Normal Mode:**  
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229, with some exceptions, as this module does not provide OBD support. However, the module provides part of the data a full OBD system requires.

**Status byte information pattern:**  
- 0x01: Test failed  
- 0x02: Test failed this cycle  
- 0x04: Test failed last cycle (different from ISO 14229)  
- 0x08: Confirmed diagnostic trouble code (unused)  
- 0x10: Test not completed since clear  
- 0x20: Test failed since clear  
- 0x40: Test not completed this cycle  
- 0x80: Warning indicator requested (unused)

The status ID mapping is based on array position. For example, the error with ID 20 is stored at array position 20.

Figure illustrates how error statuses are stored in a byte array, with ID numbers corresponding to array positions.

One operation cycle is defined as BCU startup to BCU shutdown.

**Error memory operations:**  
- The error memory can be cleared by setting the service command to `$10`. This action is equivalent to a service tool-clear request.  
- The error memory can be reinitialized by setting the service command to `$11`. This resets the error memory to its initial state, which is identical to its state after flashing the BCU.
</page>

<page number="72">
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.
The common diagnostic event manager consists of four main parts:
- **10ms recurring task**: Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.
- **SetStatus Call**: Changes the error status of a specific ID.
- **GetStatus Call**: Returns the error status of a specific ID.
- **Init task**: Updates the error information at BCU startup.

15.2. CDEM - Function Description.

**Normal Mode**  
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229, with exceptions evident as this module does not provide full OBD support. However, the module provides part of the data a full OBD system requires.

**Status byte information pattern**:
- 0x01: Test failed.
- 0x02: Test failed this cycle.
- 0x04: Test failed last cycle (different from ISO 14229).
- 0x08: Confirmed diagnostic trouble code (unused).
- 0x10: Test not completed since clear.
- 0x20: Test failed since clear.
- 0x40: Test not completed this cycle.
- 0x80: Warning indicator requested (unused).

The status ID mapping is based on array position (e.g., error with ID 20 is stored at array position 20).

**Operating Cycle**  
One operation cycle is defined as **BCU startup to BCU shutdown**.

**Error Memory Management**:
- The error memory shall be cleared by setting the service command to $10. This action is equal to the service tool clear request.
- The error memory shall be reinitialized by setting the service command to $11. This resets the error memory to the initial state, identical to the state after flashing the BCU.

**CAN Transmission Preparation**  
To ensure sufficient error information on the CAN, the function prepares data for CAN transmission. Due to limited CAN bandwidth, the status of one error byte per 10ms cycle is transmitted (16-bit ID + 8-bit Status). The function prioritizes specific error IDs in case they are active, ensuring vital errors are not delayed.

**Implementation**  
The common diagnostic event manager is implemented as custom C-Code blocks.

**Functional Components**:
- **Top-level System**:
  - **10ms recurring task**: Transmits error information cycle by cycle.
  - **SetStatus Call**: Modifies error statuses for specific IDs.
  - **GetStatus Call**: Retrieves error statuses for specific IDs.
  - **Init task**: Refreshes error information during BCU initialization.

Active error and old error information shall be cleared by using the service command from the service tool.
</page>

<page number="73">
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.

The common diagnostic event manager consists of four main parts:
- **10ms recurring task:** Updates error information upon clearance command, re-initialize command, and reset command. Prepares error information data for CAN transmission.
- **SetStatus Call:** Changes the error status of a specific ID.
- **GetStatus Call:** Returns the error status of a specific ID.
- **Init task:** Updates error information at BCU startup.

15.2. CDEM - Function Description.

**Normal Mode:**
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229 with some exceptions, as this module does not provide OBD support. It provides partial data required by a full OBD system.

**Status byte information pattern:**
- 0x01: test failed
- 0x02: test failed this cycle
- 0x04: test failed last cycle (different from ISO 14229)
- 0x08: confirmed diagnostic trouble code (unused)
- 0x10: test not completed since clear
- 0x20: test failed since clear
- 0x40: test not completed this cycle
- 0x80: warning indicator requested (unused)

Errors are mapped to an array position, where the error ID corresponds to the array index (e.g., ID 20 stored at position 20).

**Operation Cycle:** 
Defined as BCU startup to BCU shutdown.

- **Service Commands:**
    - `$10`: Clears error memory, equal to a service tool clear request.
    - `$11`: Reinitializes error memory, restoring it to its initial state identically as after BCU flashing.

15.3. CDEM_ErrDisp.

This array lists the recently active errors, with the most recent error at position 0. If a new error occurs when the array is full, the oldest error is removed. Errors already on the list that become active are promoted to position 0. Error IDs are displayed as real text.

15.4. CDEM_ReadStsAryCmd_P.

This parameter configures how error information (CDEM_StsReadInfo) is sent. It allows choosing between sending single information bits or the entire byte:
- `0`: Send bit 0 (test failed)
- `1`: Send bit 1 (test failed this cycle)
- `2`: Send bit 2 (test failed last cycle)
- `3`: Send bit 3 (unused)
- `4`: Send bit 4 (test not completed since clear)
- `5`: Send bit 5 (test failed since clear)
- `6`: Send bit 6 (test not completed this cycle)
- `7`: Send bit 7 (unused)
- `254`: Send the entire byte.
- `255`: Deactivated (always 0).

15.5. CDEM_Clear Status Array.

Clears the entire status array for active error information. Typically executed through a service tool request to remove old errors from memory.

**CDEM_ReInitialization Status Array:** 
Reinitializes the status array to its original state.
</page>

<page number="74">
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.
The common diagnostic event manager consists of four main parts:
- **10ms recurring task:** Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.
- **SetStatus Call:** Changes the error status of a specific ID.
- **GetStatus Call:** Returns the error status of a specific ID.
- **Init task:** Updates the error information at BCU startup.

15.2. CDEM - Function Description.
**Normal Mode:**  
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229 with some exceptions, as this module does not provide OBD support but provides partial data required by a full OBD system.  

**Status byte information pattern:**
- 0x01: test failed
- 0x02: test failed this cycle
- 0x04: test failed last cycle (different to ISO 14229)
- 0x08: confirmed diagnostic trouble code (unused)
- 0x10: test not completed since clear
- 0x20: test failed since clear
- 0x40: test not completed this cycle
- 0x80: warning indicator requested (unused)  

The status ID mapping is based on the array position (e.g., the error with ID 20 is stored at array position 20).  

**Operational Cycle:**  
One operation cycle is defined as BCU startup to BCU shutdown.  

**Service Commands:**  
- The error memory shall be cleared by setting the service command to $10, equivalent to a service tool clear request.  
- The error memory shall be reinitialized by setting the service command to $11, resetting the error memory to its initial state which is identical to post-flashing state.  

15.3. CDEM_ErrDisp.
This array lists the recently active errors (most recent error at position 0). If the array is full and there's a new active error, the oldest error is removed. Errors already in the list are promoted to position 0 if they reoccur. The error IDs in this variable shall be displayed as real text (enumeration).

15.4. CDEM_ReadStsAryCmd_P.
This defines how error information CDEM StsReadInfo is configured. Options include sending individual information bits or the full byte:
- 0: send bit 0 (test failed)
- 1: send bit 1 (test failed this cycle)
- 2: send bit 2 (test failed last cycle)
- 3: unused
- 4: send bit 4 (test not completed since clear)
- 5: send bit 5 (test failed since clear)
- 6: send bit 6 (test not completed this cycle)
- 7: unused
- 254: send whole byte
- 255: output deactivated (always 0)

15.5. CDEM_Clear Status Array.
Clears the entire status array of active error information. This task is normally executed on request by service tools to clear old errors from the error memory.

15.6. CDEM_ReInitialization Status Array.
Reinitializes the entire status array. When executed, all stored error information is overwritten with initial values.

**CDEM_Reset Status Array:**  
Resets all active errors to inactive upon a wake-up signal's rising edge. Diagnoses can reactivate specific errors if they persist.

**CDEM_Read Status Array:**  
Part of the 10ms task, this subsystem reads error information. Due to limited CAN bandwidth, only one byte of information (8-bit status + 16-bit ID) is sent per 10ms cycle. Specific error IDs can be prioritized for faster transmission.

**CDEM_Set Status:**  
Interface designed for activating/deactivating specific error information entries. This system also updates the error display array, which stores recently active errors, aiding during calibration and testing phases.

**CDEM_Get Status:**  
Provides an interface to retrieve specific error information by allowing modules to select error ID and bit position for extraction.

**BCU Initialization:**  
Executed during BCU startup initialization, this task deactivates active errors and updates driving cycle information.
</page>

<page number="75">
16. DEH - Diagnostic Event Handling.

16.1. DEH - Function Overview.

The diagnostic event-handling module consists of three main parts: gathering error information, determining an error level, and assessing an appropriate error reaction. 

16.2. DEH - Function Description.

The module uses error information stored by the diagnostic event manager to alter the battery state request according to the error category. The function operates on a recurring 10ms task. Initial setup occurs during the first execution cycle or each time a reset is triggered. The reset condition is triggered by a rising edge of the wake-up signal.

The diagnostic event-handling module collects all available error information to determine suitable error reactions and assigns an error level. The error level acts as a global indicator, influencing modules that manage battery functions and inhibiting unsafe operations. 

Error level assignment and reactions are based on the analysis of single signals, combinations of multiple signals, or a sequential error activation counter.

The reaction depends on the current error level, battery state request, and the battery's current state. Each state request must be approved, altered, or forward-transmitted by the diagnostic event-handling module.
</page>

<page number="76">
16. DEH - Diagnostic Event Handling.

16.1. DEH - Function Overview.

The diagnostic event-handling module consists of three main parts: The gathering of all necessary error information, the determination of an error level, and the assessment of an appropriate error reaction.

16.2. DEH - Function Description.

This module uses error information stored by the diagnostic event manager to alter the battery state request based on the error category. The function consists of one recurring 10ms task. Initialization occurs during the first execution cycle and each time a reset is triggered. Reset condition occurs from the rising edge of the wake-up signal.

The diagnostic event-handling module collects available error information, deduces appropriate error reactions, and assigns an error level. The error level acts as a global indicator for all other modules, controlling or affecting various battery functions and inhibiting specific processes to maintain safe battery operation.

Error levels and error reactions are generated through single error signal analysis, multiple signal combination, or sequential error activation count. The error reaction depends on the current error level, battery state request, and battery condition. Every battery state request must be approved or altered by the diagnostic event-handling module.

Error severity is divided into 7 levels:

### Table 12: BMS Error Levels.
| Error Severity Level | Error Description         | Possible Failure Reaction                                   |
|-----------------------|---------------------------|------------------------------------------------------------|
| 0                     | No Error                 | -                                                          |
| 1                     | Warning                  | Activate Service Lamp                                      |
| 2                     | Limp Home                | Limp home mode                                             |
| 3                     | Reserved                 | -                                                          |
| 4                     | Critical Error           | Normal battery shutdown with FTTI Time                    |
| 5                     | Hazardous Error          | Immediate battery shutdown                                 |
| 6                     | Battery Disabled         | Inhibit battery operation temporarily (BCU Shutdown required) |
| 7                     | Battery Locked           | Inhibit battery operation solely (Service tool unlock required) |

The failure reaction may include responses from additional error levels; for example, if the error level is 2 (limp home), the service lamp is also activated, and balancing algorithms may be inhibited.

- Error severity level 2 to 5 can be cleared by system restart (ignition).
- Error severity level 6 requires BCU shutdown/wakeup sequence clearance.
- Error severity level 7 must be cleared using a dedicated service or calibration tool command. To clear error level 7, set the service command to 5. To reset level 7 and also clear the error memory, set the service command to 10.

The battery system will not transition to online state with an active error level greater than 3. Independent of the error levels, the battery will also remain offline if the DC link voltage is excessively high (e.g., inverter control failure) or if the pre-charge resistor's temperature exceeds tolerable limits.

Each error's assigned error level needs calibration.
</page>

<page number="77">
17. BISC – Battery Current Sensor Communication

17.1. BISC - Pack Current Measurements.
The pack current is measured by the BCU at the highest ASIL level of ASIL C to detect overcurrent fault and protect the system in a safe state.  
Since it is a critical parameter, redundant sensors are used for the measurements:  
1. IVT Shunt current measurements.  
2. HAL Current measurements.  

Both of these measurements are processed, and the exact pack current measurement is sent over the PT-CAN:  
- Battery Current Sensor Communication.

17.2. BISC - Function Description.
- The Battery Current Sensor Communication function is responsible for acquisition and processing of current values measured from sensors. This function also collects and stores error information supported by current sensors.
- The Battery Current Sensor Communication function is divided into a 10ms task and an init task, which handle the acquisition and processing of current values and current sensor diagnosis and the variable initialization, respectively. Each task is called individually by the operating system.
  - Init Task: Initialization of all current sensors is performed during the initialization task.
  - 10ms Task: This task reads the values from the available current sensor.  

**Current Sensor Diagnosis:**  
Following errors of the current sensor are checked:  
- Short-circuit error.  
- Measurement error.  
- System error.  
- Channel error.

Additionally, an error is detected if the CAN message of the current measurement has a timeout, checksum, or an alive-counter error. All errors, except the short-circuit error, are de-bounced.
</page>

<page number="78">
### 17. BISC – Battery Current Sensor Communication

#### 17.1. BISC - Pack Current Measurements
The pack current is measured by the BCU at the highest ASIL level of ASIL C. This measurement is critical for detecting overcurrent faults and protecting the system in a safe state. To ensure accuracy and reliability, redundant sensors are utilized:
1. IVT Shunt current measurements.
2. HAL Current measurements.

Both measurements are processed, and the exact pack current measurement is sent over the PT-CAN.

---

#### 17.2. BISC - Function Description
The Battery Current Sensor Communication function is responsible for acquisition and processing of current values measured by sensors. It collects and stores error information for all supported current sensors.

The function consists of:
- **Init Task**: Initialization of all current sensors is performed during this task.
- **10ms Task**: This task reads values from available current sensors.
- **Current Sensor Diagnosis**:
  - Following errors for current sensors are checked:
    - Short-circuit error.
    - Measurement error.
    - System error.
    - Channel error.
  - Errors detected include timeout, checksum, or alive-counter errors in CAN messages of current measurements, aside from short-circuit errors, which are not de-bounced.

---

### Signal I/O

| Name                  | Description                                                                                         | Min    | Max    | Value Description                                                          | Sender | Receiver |
|-----------------------|-----------------------------------------------------------------------------------------------------|--------|--------|-----------------------------------------------------------------------------|--------|----------|
| **BMS_MalfunctionSts**  | Malfunction status of battery for MHU display                                                       | 0      | 1      | 1: Malfunction indicator lamp ON; 0: Malfunction indicator lamp OFF         | BMS    | MHU      |
| **BMS_PackOverCurr_ERR**| When overcurrent is detected during charging and discharging for the given period, then this status is set | 0      | 3      | 3: Safety error; 2: Error; 1: Warning; 0: Normal                            | BMS    | VCU      |
| **BMS_PackCur_MEAS**     | Pack Current                                                                                     | -3276.8 | 3276.7 |                                                                             | BMS    | VCU      |
</page>

<page number="79">
18. BILC - Battery Current Limit Coordinator.

18.1. BILC - Function Description.

Normal Mode:
The battery protection module executes several diagnoses to report the status of the battery regarding safety by transmitting error flags for each diagnosis to the diagnostic event modules. The top priority is to protect humans near the battery from harm due to malfunctions and to safeguard the battery pack hardware from damage.

Diagnoses:
- Current Voltage Diagnoses: Functions are categorized into execution task groups based on cycle times (10ms and 100ms). Each diagnosis function's enablement or disablement depends on the battery state (e.g., online or offline) and error signals. This prevents false positive errors from invalid input data. Necessary error signals are de-bounced, and resets reinitialize dynamic variables, diagnoses, and error flags.

Key Functions:
1. **Current Limit:** Detects exceedances in valid current limits. The tolerable delay for inverter control reactions is calibrated (up to 500ms). Short-term overdrive in charge and discharge operations is permitted.
2. **Current Sensor Plausibility:** Compares current sensor values against calculated current values based on pack voltage drop and estimated pack resistance. Significant differences trigger plausibility error detection.
3. **Plausibility Error Reset Counter Block:** Triggers a reset whenever the reset counter changes (e.g., by ignition key events or manual calibration).

State of Function (SOF):
- **Battery Current Limit Calculation:** Determines short-term pulse limits (min/max values in amperes) for the charging process.
- **Battery Voltage Prediction:** Calculates maximum charge and discharge voltage thresholds (max/min values in volts).
- **Power Limitations:** Defines limits based on current and voltage predictions.
</page>

<page number="80">
18. BILC - Battery Current Limit Coordinator.

18.1. BILC - Function Description.
This section describes the functionality of battery protection for current and voltage in Normal Mode.

The battery protection module executes several diagnoses to report the status of the battery regarding safety by transmitting error flags (of each single diagnosis) to the diagnostic event modules. Its topmost priority is to protect humans near the battery from harm caused by malfunction and to safeguard the battery pack hardware from damage.

1. **Execution Task Groups**:
   - Diagnoses are subdivided based on task cycle time into 10ms and 100ms task groups.
   - Diagnoses can be enabled or disabled, dependent on the battery state (e.g., online, offline) and on error signals. This basic diagnosis inhibition management helps prevent false positive errors caused by invalid input data.
   - Error signals are de-bounced when necessary. Resetting reinitializes all dynamic variables, diagnoses, and reset error flags.

2. **Functions**:
   - **Current Limit Detection**: Detect exceedance of the valid current limit. Includes tolerable delay calibration (up to 500ms) and allows short-term overdrive during charge and discharge.
   - **Current Sensor Plausibility Detection**: Compare current sensor values with a calculated current derived from the battery voltage drop and pack resistance. Differences indicate plausibility errors.
   - **Plausibility Error Reset Counter Block**: Trigger reset whenever the counter input from another module changes. Reset can be initiated by ignition events or manual calibration.
   - **SOF – State of Function**:
      - Battery current limit calculation for short-term pulses in [A] for charging purposes.
      - Battery voltage prediction for maximum charge and discharge in [V].
      - Power limitations calculated based on current limit and voltage prediction.

18.2. BILC - Over Current Function Description.
Permissible current values for charging and discharging are provided. The VCU allows operation only within these permissible regions.

1. **Maximum Current Calculations**:
   - **Peak Discharge Current**: Real-time calculation using the 3D data table shared via CAN (BMS_AllowDischgCurrPeak). Specifies the maximum peak discharge current for 10s intervals to limit current drawn from the pack.
   - **Continuous Discharge Current**: Real-time calculation using the 3D data table shared via CAN (BMS_AllowDischgCurr). Specifies the maximum allowed continuous discharge current to limit drawn current.
   - **Peak Charge Current**: Real-time calculation using the 3D data table shared via CAN (BMS_AllowChgCurrPeak). Specifies the maximum peak charge current for 10s intervals to limit regenerative current.
   - **Continuous Charge Current**: Real-time calculation using the 3D data table shared via CAN (BMS_AllowChgCurr). Specifies the maximum charge current allowed continuously to limit regenerative current.

### Signal I/O Table.
| Name                  | Description                                         | Min  | Max   | Value Description                    | Sender | Receiver |
|-----------------------|-----------------------------------------------------|------|-------|--------------------------------------|--------|----------|
| BMS_AllowDischgCurr   | Continuous maximum allowable discharge current of battery | 0    | 1500  |                                      | BMS    | VCU      |
| BMS_AllowDischgCurrPeak| Peak maximum allowable discharge current of battery | 0    | 1500  |                                      | BMS    | VCU      |
| BMS_AllowChgCurr      | Continuous maximum allowable charge current of battery | 0    | 1500  |                                      | BMS    | VCU      |
| BMS_AllowChgCurrPeak  | Peak maximum charge current of battery              | 0    | 1500  |                                      | BMS    | VCU      |
</page>

<page number="81">
19. EHPN - Electrical Hazard Protection Network (Isolation Detection).

This module handles the isolation detection as described in the document “SAE J1766 - Revision APR2005.” It executes the measurement procedure and calculates the isolation resistance. Additionally, the module handles the interlock mechanism input to detect an open high voltage connection.

19.1. EHPN - ISO Function Description.

The function electrical hazard protection includes the isolation detection and interlock mechanism.

**Isolation Detection:**  
The isolation detection calculates the isolation resistance based on voltage measurements between the vehicle chassis and the high voltage connection of the battery. This minimizes the risk of electrical shock if the isolation between the vehicle chassis and high voltage battery becomes insufficient.  

**Several voltage measurements are necessary:**  
- Voltage between the high voltage positive of the battery relative to the vehicle chassis.  
- Voltage between the high voltage negative of the battery relative to the vehicle chassis.  
- Depending on the first measurements, one additional predefined resistance is included during measurement between the chassis and high voltage rail. Results from these measurements are used to calculate isolation resistance.  
- The isolation resistance shall be at least 250 kOhm based on nominal voltage.  

**Normal Mode:**  
The electrical hazard protection system comprises two subsystems: isolation detection and the interlock mechanism.  
- Isolation detection runs in 100ms time steps.  
- The interlock mechanism operates in 10ms steps.  

**EHPN - Insulation Detection Types:**  
1. **Battery Pack Insulation Resistance Measurement**:  
   - When the contactors are in open state.  
   - Performed before the shutdown process is initiated.  
   - Insulation resistance is calculated based on the lowest insulation resistance path.  

2. **Vehicle Level Insulation Resistance Measurement**:  
   - When the contactors are in closed state.  

3. **DC Fast Charge Insulation Resistance Measurement**:  
   - Measurement functionality is turned off by the VCU during DC fast charging.
</page>

<page number="82">
19. EHPN - Electrical Hazard Protection Network (Insulation Detection).

This module handles the isolation detection as described in the document “SAE J1766 - Revision APR2005.” It executes the measurement procedure and calculates isolation resistance. Additionally, the module handles the interlock mechanism input to detect an open high voltage connection.

19.1. EHPN - ISO Function Description.

The function electrical hazard protection includes isolation detection and interlock mechanism. Isolation detection calculates the isolation resistance out of voltage measurements between vehicle chassis and the high voltage connection of the battery, minimizing the risk of electrical shock if the isolation between vehicle chassis and high voltage battery is insufficient.

Several voltage measurements are necessary:
- Voltage between high voltage positive of the battery relative to vehicle chassis.
- Voltage between high voltage negative of the battery relative to vehicle chassis.
- Based on the initial measurements, predefined resistance values are introduced between chassis and high voltage rail to calculate isolation resistance. The calculated resistance is compared against thresholds, and an error state is determined.
- The calculated isolation resistance must be at least 250 kOhm based on the nominal voltage.

**Normal Mode:**
The electrical hazard protection system is split into two components:
- **Isolation detection:** Triggered every 100ms.
- **Interlock mechanism:** Triggered every 10ms.

**EHPN - Insulation Detection** is divided into the following types:
1. Battery Pack Insulation Resistance Measurement: Performed when the contactors are open. The insulation resistance of the battery pack is calculated based on the lowest insulation resistance value of the path.
2. Vehicle Level Insulation Resistance Measurement: Conducted when the contactors are closed during driving and AC charging. The insulation resistance of the vehicle powertrain is measured based on the lowest insulation resistance path.
3. DC Fast Charging Insulation Resistance Measurement: Disabled by the VCU during fast charging operations.

1. **Battery Pack Insulation Detection:**
   Positive and negative contactors are open during the test, performed before shutdown initiation. The insulation resistance of the battery pack is measured based on the lowest insulation resistance path.

   During the next drive cycle, the stored value of insulation resistance is checked:
   - If insulation resistance level is 1 → `BMS_ERR_LEV = 1`.
   - If insulation resistance level is 3 → `BMS_ERR_LEV = 7`.
   Initialization issues are sent over PT-CAN.

**Figure 22: Pack Isolation Detection.**

2. **Vehicle Level Insulation Detection:**
   Positive and negative contactors are closed during the test, performed during driving and AC charging. The insulation resistance of the vehicle powertrain is measured based on the lowest insulation resistance path.

   During the next drive cycle, the stored value of insulation resistance is checked:
   - If insulation resistance level is 1 → `BMS_ERR_LEV = 1`.
   - If insulation resistance level is 3 → `BMS_ERR_LEV = 2` (Limp-Home).
   Initialization issues are sent over PT-CAN.

**Figure 23: Vehicle Isolation Detection.**
</page>

<page number="83">
3. DC Fast Charge Insulation detection is turned off:
VCU_BMS_Insulation_Mon_Req = 1 – This disables the insulation resistance measurement functionality.  
BMS_VCU_Insulation_Mon_Sts = 1 – This turns off the insulation resistance measurement functionality, and the measurement is handled by the DC fast charger.  

**EHPN Function Description with Signal List:**  
- BMS should monitor the resistance between HV+ and ground.  
- BMS should monitor the resistance between HV- and ground.  
- BMS needs to send the minimum insulation resistance value (BMS_PackInsuRes) via CAN communication.  
- BMS should divide the levels according to the minimum resistance values.  
- BMS needs to determine whether the insulation resistance value is normal and transmit the result via CAN signals (BMS_ISU_Status).  

**Table 13: Insulation Resistance Level Description**  
| Insulation Resistance (IR) | Condition          | Grade (BMS_ISU_Status) |
|----------------------------|--------------------|-------------------------|
| 250 kOhm < IR              | Normal            | Normal                 |
| 100 kOhm < IR < 250 kOhm   | Drive/AC-Charge   | Level 1                |
| IR < 100 kOhm              |                   | Level 3                |

**Startup / Power-on State:**  
- If the last trip insulation resistance value is less than 100 kOhm (BMS_ISU_Status = Level 3), the battery system sets the error level (BMS_ERR_LEV = 7) and prevents the contactors from closing during power-on conditions. The battery will remain locked, and clearing the state requires a command sent from a service tool.  

**During Driving:**  
- If the insulation resistance value is less than 250 kOhm (BMS_ISU_Status = Level 1), the error level of the BMS becomes BMS_ERR_LEV = 1 (Warning).  
- If the insulation resistance value drops below 100 kOhm (BMS_ISU_Status = Level 3), the error level of the BMS becomes BMS_ERR_LEV = 2 (Limp-Home), yet the contactor will remain closed.  

Additionally, the measurement can be enabled or disabled via CAN signals and initiated through CAN communication (VCU_BMS_Insulation_Mon_Req = 1 or 0). The status of the insulation circuit being on or off is communicated via the CAN Bus signal BMS_VCU_Insulation_Mon_Sts = 1 or 0.
</page>

<page number="84">
## 19. EHPN - Electrical Hazard Protection Network (Insulation detection)

### 19.1. EHPN - ISO Function Description
The electrical hazard protection network module handles isolation detection and monitors interlock mechanisms for high voltage connections. Its primary function is the calculation of isolation resistance and detection of open high-voltage connections based on voltage measurements.

#### Isolation Detection:
1. Isolation resistance is calculated to minimize the risk of electrical shock caused by insufficient isolation between vehicle chassis and high voltage battery. 
2. Measurement requires voltages between:
   - High voltage positive of the battery relative to vehicle chassis.
   - High voltage negative of the battery relative to vehicle chassis.
   - Additional predefined resistance between chassis and high voltage rail for recalculation.
3. Calculated resistance is compared against thresholds:
   - Resistance must be at least 250 kOhm based on nominal voltage.
4. Error state is determined if resistance is below threshold.

#### Normal Mode:
- Isolation detection is triggered in 100ms intervals.
- Interlock mechanisms operate in 10ms intervals.

#### Types of Insulation Detection:
1. **Battery Pack Insulation Resistance Measurement:**
   - Positive and negative contactors must be open.
   - Test occurs before the shutdown process begins.
   - Insulation resistance is measured based on the lowest resistance path.

2. **Vehicle-Level Insulation Resistance Measurement:**
   - Positive and negative contactors must be closed.
   - Test occurs while driving or during AC charging.
   - Insulation resistance is measured based on the lowest resistance value.

3. **DC Fast Charge Insulation Detection:**
   - Functionality is disabled by VCU with signals:
     - `VCU_BMS_Insulation_Mon_Req = 1` - Insulation resistance measurement forbidden.
     - `BMS_VCU_Insulation_Mon_Sts = 1` - Insulation measurement turned off for DC fast charger operation.

---

### Table 13: Insulation Resistance Level Description
| **Insulation Resistance (IR)** | **Condition**            | **Grade (BMS_ISU_Status)** |
| ------------------------------ | ------------------------ | -------------------------- |
| 250 kOhm < IR                  | Drive/AC-Charge         | Normal                    |
| 100 kOhm < IR < 250 kOhm       | Level 1                 | Level 1                   |
| IR < 100 kOhm                  | Level 3                 | Level 3                   |

---

### Startup/Power-On State
- If insulation resistance value from the last trip is less than 100 kOhm (`BMS_ISU_Status = Level 3`), battery error level (`BMS_ERR_LEV = 7`) prevents closing contactors during power-on conditions. Battery enters locked state requiring service tool intervention to clear the state.

### Driving State
- **Insulation Resistance < 250 kOhm (`BMS_ISU_Status = Level 1`)**:
  - BMS error level triggered: `BMS_ERR_LEV = 1 (Warning)`.
- **Insulation Resistance < 100 kOhm (`BMS_ISU_Status = Level 3`)**:
  - BMS error level triggered: `BMS_ERR_LEV = 2 (Limp-Home)`.

---

### Table 14: BMS Status Description
| **Name**              | **Description**                                | **Value Description**                                                |
| ---------------------- | ---------------------------------------------- | -------------------------------------------------------------------- |
| `BMS_ISU_Status`       | Insulation status                             | 3: `Level 3 (IR < 100 kOhm)`, 1: `Level 1 (100 kOhm < IR < 250 kOhm)`, 0: `Normal (IR > 250 kOhm)` |
| `BMS_PackInsu_ERR`     | Problems with insulation check lines          | 0:`Lv0`, Lv1, Lv3 (Always = 0)                                       |

---

### Signal I/O
| **Name**                  | **Description**                            | **Min** | **Max** | **Unit** | **Sender** | **Receiver** |
| ------------------------- | ------------------------------------------ | ------- | ------- | -------- | ---------- | ------------ |
| `BMS_PackInsuRes`         | Minimum value of `BCU_PosInsuRes` and `BCU_NegInsuRes` | 0     | 60000   | kOhm     | BCU        | VCU          |
| `BMS_ISU_Status`          | Insulation status                         | 0       | 3       | -        | BCU        | VCU          |
| `BMS_PackInsu_ERR`        | Insulation check lines issues              | 0       | 3       | -        | BCU        | VCU          |
| `BMS_VCU_Insulation_Mon_Sts` | Feedback for insulation monitoring signal | 0     | 1       | -        | BCU        | VCU          |
| `VCU_BMS_Insulation_Mon_Req` | Signal to toggle insulation resistance measurement | 0     | 1       | -        | VCU        | BCU          |
</page>

<page number="85">
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock)

The BMS detects that all HV connectors are connected in the system without any open HV line connectors.  
The battery management system operates an interlock mechanism using a PWM signal driven and evaluated by a watchdog timer. If the line is interrupted, the watchdog timer indicates an error.  
If the line is integrated such that battery opening or absence of a connecting line causes an interruption of this signal, the error minimizes the risk of electrical shock.

EHPN HVIL Hardware Signal Information:  

HVIL Signal Generation (HVIL-OUT):  
- Signal Type: PWM  
- Duty Cycle: 50%  
- Frequency of Signal: 50Hz  
- Maximum Current: 10mA  
- Principle: Open Drain Output with a pull-up resistor of 5V  

HVIL Signal Generation (HVIL-IN):  
The destination of the signal receives and verifies the status of the HVIL line.  

Figure 24: HVIL Mechanization  
The diagram illustrates the high voltage interlock circuit connections, including BMS, EAC, and PDU systems, ensuring safe operation and preventing electrical shock.  

EHPN – HVIL Function Description:  
The function outlines the prevention mechanism triggered through signal verification and watchdog error detection in case of a high voltage connection disruption.
</page>

<page number="86">
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock).

EHPN - HVIL Function Diagram:

The Battery Management System (BMS) detects all high voltage (HV) connectors in the system to ensure there are no open HV line connections. The BMS operates an interlock mechanism using a signal line driven by a Pulse Width Modulation (PWM) signal, which is evaluated by a watchdog timer. If the line is interrupted, the watchdog indicates an error. This setup minimizes the risk of electrical shock due to open or absent HV connections.

**EHPN HVIL Hardware Signal Information:**
- **HVIL Signal Generation (HVIL-OUT):**
  - Signal Type: PWM
  - Duty Cycle: 50%
  - Frequency of Signal: 50 Hz
  - Max. Current: 10mA
  - Principle: Open Drain Output with pull-up resistor of 5V.
  
- **HVIL Signal Generation (HVIL-IN):**
  - The destination of the signal verifies the status of the HVIL line.

**EHPN - HVIL Function Description:**

The BMS monitors the HVIL state using the following process:
1. A PWM signal with 50% duty cycle and 50 Hz frequency is generated by the BMS (calibratable).
2. The signal is passed through HVIL-OUT and routed via various HV connector lines.
3. The signal is received as HVIL-IN at the BMS.
4. If the received signal matches the sent signal, the HVIL line is deemed closed. 
5. If the received signal measures approximately 5 V, the HVIL line is diagnosed as open or short-circuited to the battery.
6. If the signal measures less than 0.5 V, the HVIL line is diagnosed as short-circuited to ground.

**State Conditions and CAN Signal Mapping:**
| State            | CAN Signal       | BMS_HVIL_STS | BMS_Sys_STS | BMS_ERR_LEV |
|------------------|------------------|--------------|-------------|--------------|
| **Startup**      | 0 - Closed       | 1            | 0           | 2            |
|                  | 2 - Open         | 7            | 4           |              |
| **Run - Driving**| 0 - Closed       | 2            | 0           | 2            |
|                  | 2 - Open         | 2            | 1           |              |
| **Run - Charging**| 0 - Closed       | 2            | 0           | 2            |
|                  | 2 - Open         | 7            | 4           |              |

**Interlock Mechanism Tasks:**
The interlock mechanism operates in a 10 ms cycle:
1. PWM output signal is sent by the Battery Control Unit (BCU) and received by a watchdog in the BCU.
2. The time period and duty cycle are set via a Basic Software (BSW) interface and can be calibrated with specific parameters.
3. A debouncer is enabled after a calibratable delay once the BCU is switched on, ensuring the watchdog collects correct PWM signals for valid condition outputs. 
4. A counter increments by 0.01 in 10 ms cycles while the BCU operates.
5. Errors are saved through the Custom Diagnostic Event Manager (CDEM) interface.

This configuration ensures effective monitoring and error handling, reinforces system safety, and minimizes risks associated with HV interlock failures.
</page>

<page number="87">
20. SOX - Cell Balance.

20.1. SOX - Cell Balance Function Description.
SOC and SOH estimation assumes that the cells within a module fit together. This applies as long as no cell inhomogeneous deterioration occurs. It is assumed that single cells will fail; otherwise, the cells within the module fit together, and this shall be covered by the SOH.

The cell wear detection monitors the cell SOC deviations and the cell resistance deviations compared to the average module estimates. This information is then used for:
- Adaptation of the current limits predicted by SOF, to avoid any violation of cell limits in advance.
- Cell SOC values are used for the balancing decision, which is not relying on cell voltage. This allows balancing under all operating conditions.

Early detection of cell faults: In case the cell resistance increases or the cell SOC decreases significantly compared to the average.

The cell balancing functionality is supposed to balance the state of charge of the individual cells in order to maximize the usable battery capacity. The balancing method should be self-powered by the battery cells (not dependent on external voltage supply). Where passive balancing is used, the dissipating resistors shall not require any external cooling measures.

When the difference of maximum SOC of cell and the minimum SOC of cell is larger than the SOC difference exceeds 5% (calibratable), then BMS should enable the balance function and send the BMS_Balance_STS = 1.
- BMS at most, should be able to enable 10-channel equalization control.
- Balance current cannot exceed 300mA/cell.
- When the balancing function is turned on, it is found that the BMS is faulty, and the balancing needs to be stopped.
- BMS needs to monitor PCB temperature.
- When the PCB temperature exceeds 70℃, the equalization needs to be stopped.

When the MCU detects the cell balancing switch short or open, then set the BMS_BatBalance_ERR=error.

The cell balancing strategy is using capacity-based balancing schemes.

### Signal I/O.
**Name:** BMS_Balance_STS.  
**Description:** BMS Balance Status.  
**Min:** 0.  
**Max:** 1.  
**Value Description:** 1: active; 0: Inactive.  
**Sender:** BMS.  
**Receiver:** VCU.  

**Name:** BMS_BatBalance_ERR.  
**Description:** Battery Balance Error indicates Balancing switch is short or open.  
**Min:** 0.  
**Max:** 1.  
**Value Description:** 1: normal; 0: Error.  
**Sender:** BMS.  
**Receiver:** VCU.  

SOF – Function Description.
The BMS calculates current limitations and voltage prediction to assure that the battery is always operated in a safe operating mode and the performance and lifetime targets are met. The calculation is performed based on a model-based approach. It restricts the current (in charge and discharge direction) to not violate the cell voltage limits and to restrict the thermal.
</page>

<page number="88">
20. SOX - Cell Balance:

20.1. SOX - Cell Balance Function Description.

SOC and SOH estimation assumes that the cells within a module fit together. This applies as long as no cell inhomogeneous deterioration occurs. It is assumed that single cells will fail; otherwise, the cells within the module fit together and this shall be covered by the SOH.

The cell wear detection monitors the cell SOC deviations and the cell resistance deviations compared to the average module estimates. This information is then used for:
- Adaptation of the current limits predicted by SOF, to avoid any violation of cell limits in advance.
- Cell SOC values are used for the balancing decision, which is not relying on cell voltage. This allows balancing under all operating conditions.
  
Early detection of cell faults: In case the cell resistance increases or the cell SOC decreases significantly compared to the average.

The cell balancing functionality is supposed to balance the state of charge of the individual cells in order to maximize the usable battery capacity. The balancing method should be self-powered by the battery cells (not dependent on external voltage supply). Where passive balancing is used, the dissipating resistors shall not require any external cooling measures.

When the difference of maximum SOC of a cell and the minimum SOC of a cell is larger than the SOC difference exceeds 5% (calibratable), then BMS should enable the balance function and send the BMS_Balance_STS = 1.
- BMS at most, should be able to enable 10-channel equalization control.
- Balance current cannot exceed 300mA/cell.
- When the balancing function is turned on and it is found that the BMS is faulty, the balancing needs to be stopped.
- BMS needs to monitor PCB temperature.
- When the PCB temperature exceeds 70°C, the equalization needs to be stopped.
  
When the MCU detects the cell balancing switch is short or open, then set the BMS_BatBalance_ERR = error.

The cell balancing strategy is using capacity-based balancing schemes.

### Signal I/O
| Name               | Description                              | Min | Max | Value Description       | Sender | Receiver |
|--------------------|------------------------------------------|-----|-----|--------------------------|--------|----------|
| BMS_Balance_STS   | BMS Balance Status                       | 0   | 1   | 1: active; 0: inactive   | BMS    | VCU      |
| BMS_BatBalance_ERR| Battery Balance Error; Balancing switch is short or open | 0 | 1 | 1: normal; 0: error | BMS | VCU |

---

20.2. SOX - SOC Function Description.

SOC cannot be measured directly, at least for today's Lithium-Ion systems, but an accurate SOC is mandatory for the energy management control system. The State-of-Charge is calculated as a percentage at pack and cell level.

The battery core function for SOC-estimation is based on AVL’s proprietary model-based algorithms:
- A battery model and an observer are used to continuously monitor the state of the battery.
- Due to computational power demand, estimation is done on module level rather than on cell-level.
- The internal states (including SOC) of the battery model are adapted if a difference between measured module voltage and predicted module voltage (output of battery model) is present.
- A simplified linear algorithm calculates the cell-to-cell deviation within the module to also have information about cell SOC as well as cell resistance.

This results in an accurate, stable, and convergence of the SOC estimate throughout the battery lifetime.

BMS should calculate the SOC and send it via CAN (BMS_SocActual_EST = XXX). The error between BMS_SocActual_EST and the real SOC should be limited to xx%.

In order to improve the accuracy of BMS_SocActual_EST, BMS can correct the SOC when necessary:
- Need to meet the conditions of -40°C to 85°C; accuracy should meet the design requirements.
- SOC estimation period needs to meet 100ms.

Note: The real SOC of the cell shall not be used for display purposes.

### Signal I/O
| Name               | Description      | Min | Max | Value Description | Sender | Receiver |
|--------------------|------------------|-----|-----|-------------------|--------|----------|
| BMS_SocActual_EST | Actual SOC       | 0   | 100 |                   | BMS    | VCU      |
</page>

<page number="89">
20.3. SOX - SOH Function description.

The nominal capacity of the pack is the base information to identify the battery capacity. The main idea is to identify the limiting value of various criteria from module and cell-based health parameters and report that as the pack SOH value. The parameters included are maximum cell SOC and resistance deviations, as well as module resistance and capacity deviation. The highest module/cell deviation value is mapped to a respective SOH value based on maps; this allows a relation to SOH.

BMS should calculate the SOH and send it to CAN (BMS_SOH=XXX). SOHPack has a range of [0%, 100%] and it is calculated considering previous trip information and remains constant during a trip. The error between BMS_SOH and the real SOH should be limited to 5%. 

- **Conditions:** Meet the temperature range of -40℃ ~ 85℃ to ensure the acquisition accuracy meets design requirements.
  
BMS needs to have the ability to estimate the battery internal resistance aging SOH state. When BMS_SOH < 5%, a Battery Replacement warning will be sent to MHU. The real SOH of the battery is approximately 71.5%. When SOH <0%, a Battery Replacement warranty will still be sent. The real battery SOH drops below 70%.

#### Signal I/O
| Name                  | Description                                            | Min   | Max   | Value Description         | Sender | Receiver |
|-----------------------|--------------------------------------------------------|-------|-------|---------------------------|--------|----------|
| BMS_SOH              | BMS State Of Health                                   | 0     | 100   |                           | BMS    | VCU      |
| BMS_BatteryReplacement | Separate signal indicating battery replacement information (Battery replacement MHU) |       |       | 1: Warning; 0: No warning | BMS    | MHU      |
</page>

<page number="90">
20.4. SOX - SOP Function Description.

Permissible power allowed during charging and discharging with instantaneous and continuous values are provided. The VCU shall allow the permissible power region of operation only.

BMS should calculate the maximum allowable discharge power of the pack in 30/15/10/2s seconds in real-time using the 3D data table, and send it to CAN (BMS_MaxDischgPwr_Peak =XXX). The maximum discharge power allowed for 30/15/10/2s interval is shared to other ECUs to limit the power drawn from the high voltage battery pack.

BMS should calculate the maximum allowable discharge power of the pack continuously in real-time using the 3D data table, and send it to CAN (BMS_MaxDischgPwr_ALW =XXX). The maximum discharge power allowed continuously is shared to other ECUs to limit the power drawn from the high voltage battery pack.

BMS should calculate the maximum allowable charge power of the pack in 30/15/10/2s in real-time using the 3D data table, and send it to CAN (BMS_MaxChgPwr_Peak =XXX). The maximum charge power allowed for 30/15/10/2s interval is shared to other ECUs to limit the regen power provided to the high voltage battery pack.

BMS should calculate the maximum allowable charge power of the pack continuously in real-time using the 3D data table, and send it to CAN (BMS_MaxChgPwr_ALW =XXX). The maximum charge power allowed continuously is shared to other ECUs to limit the regen power provided to the high voltage battery pack.

### Signal I/O

- **Name:** BMS_MaxDischgPwr_Peak  
  - **Description:** Allow Peak Discharge Power  
  - **Min:** 0  
  - **Max:** 800  
  - **Unit:** kW  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_MaxDischgPwr_ALW  
  - **Description:** Allow Max Discharge Power  
  - **Min:** 0  
  - **Max:** 800  
  - **Unit:** kW  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_MaxChgPwr_Peak  
  - **Description:** Allow Peak Regenerative Power  
  - **Min:** 0  
  - **Max:** 800  
  - **Unit:** kW  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_MaxChgPwr_ALW  
  - **Description:** Allow Max Regenerative Power  
  - **Min:** 0  
  - **Max:** 800  
  - **Unit:** kW  
  - **Sender:** BMS  
  - **Receiver:** VCU
</page>

<page number="91">
21. HW Crash Signal.

21.1. HW - crash Function description.

To detect the crash fault using redundant signals, the ACM gives a hardwire signal. The crash hardware circuit detection is outlined below:

**Crash hardware circuit detection:**
- **PWM signal during no crash:** This represents the normal operational state where periodic PWM signals of 200ms intervals are continuous without interruption.
- **PWM signal during crash:** Upon crash detection, the normal PWM signals are interrupted by ‘Crash Event Notification’ signals lasting for 20 pulses.

When the BMS detects the hardwire crash PWM signal:
- **BMS_HWCrash_Sts = Crash.**
- **Error level:** BMS_ERR_LEV = 5 is sent to the VCU.
- The high voltage contactor is immediately opened.
- After the high voltage is broken, **BMS_HVOnOff_STS = HV Off** is set.

If the VCU sends **VCU_BMS_HVOnOff_REQ = forbid**, the secondary path for the BMS also opens the high voltage contactor.

This fault is non-recoverable. Once the fault line is detected, it is logged into memory and cleared after service.

**Signal I/O:**
- Signal illustrations and their operating conditions are shown with PWM waveforms during normal operation and crash scenarios.
</page>

<page number="92">
21. HW Crash Signal.

21.1. HW - crash Function description.
To detect the crash fault using redundant signals, the ACM gives a hardwire signal for crash detection. 

The crash hardware circuit detection is illustrated in the diagram:
- During normal operation, PWM signals are generated at specific intervals.
- During a crash, a distinctive PWM signal is produced and detected.

When the Battery Management System (BMS) detects the hardwired crash PWM signal, the following occurs:
- The BMS sends `BMS_HWCrash_Sts = Crash` with the error level `BMS_ERR_LEV = 5` to the VCU.
- High voltage contactors are immediately opened, and when the high voltage is broken, the BMS status updates to `BMS_HVOnOff_STS = HV Off`.
- If the VCU sends `VCU_BMS_HVOnOff_REQ = forbid`, the secondary path for the BMS also opens the high voltage contactor.

This fault is non-recoverable and is logged into memory, only cleared after servicing.

### Signal I/O.
| Name              | Description                | Min | Max | Value Description | Sender | Receiver |
|-------------------|---------------------------|-----|-----|-------------------|--------|----------|
| BMS_HWCrash_Sts  | HW crash signal status    | 0   | 1   | 1: crash; 0: no crash; | BMS    | -        |

---

21.2. Wakeup.

### Function description.
The BMS shall wake up via Network CAN or the Ignition signal (KL15). 
- The Ignition & CAN signal connects to the System Basis Chip (SBC). Signal changes detected by the SBC during sleep or standby modes trigger the BMS wakeup.
- A trip is counted when the signal changes between completely ON and OFF states.

### Signal I/O.
| Name           | Description                   | Min | Max | Value Description | Sender | Receiver |
|----------------|------------------------------|-----|-----|-------------------|--------|----------|
| BMS_IGN_Sts   | The ignition signal status    | 0   | 1   | 1: ON; 0: OFF;    | BMS    | VCU      |

---

21.3. SFM - Safety Fault Monitoring.

The safety fault monitoring is an ASIL C signal designed to evaluate overall safety fault existence within the high voltage battery pack, providing this information to the VCU.

---

21.4. E2E Protection.

All ASIL Level signals must be protected with End-To-End (E2E) methods.

References to ensure signal and safety message protection:
- Document: VFDSAAEEP0047_CAN_Specification, Chapter: 3.11.9 (Protection of Safety Messages Across Network).
- Fault Reaction Matrix: ARE9452_Safety_Fault_Reactions.xlsx.
</page>

<page number="93">
22. BMS Diagnostics. 
The BMS platform diagnostic concept for BEV applications. According to the current Vietnamese legislation, there is Euro 5 emission standard required but no OBD system mandatory for BEV. According to the current US legislation, there is no OBD system mandatory for BEV. Legal OBD requirements are not considered. In case of HEV application considered in the future, legal OBD features shall be developed.

22.1. Diagnostics Implementation Architecture. 
Diagnostic Coordination:
- Coordination of diagnostic development topics to integrate the platform diagnostic SW component.  
- Assessment of the system in order to identify the required SW adaptation.  
- Document the updates in the Diagnostic Concept (DTC list, interface signals, implementation status, reaction groups, etc.).  

Diagnostics will be implemented and configured according to AUTOSAR (DEM, FIM).  

The fault management according to AUTOSAR (DCM, DEM and FIM) will be configured, integrated, and tested:
- Fault storage.  
- Freeze Frame Groups.  
- FIM configuration (fault reactions).  
- UDS Communication (Service Tool).  

The DTC list (with P-Code, error name, priority, and freeze frame data), FIDs and function inhibition matrix will be implemented. Based on the hardware capability the electrical errors (e.g., open circuit, short circuit to ground, and short circuit to battery) are qualified, and the error symptom is triggered.
</page>

<page number="94">
## 22. BMS Diagnostics

The BMS platform diagnostic concept is tailored for Battery Electric Vehicle (BEV) applications. Current legislation in Vietnam and the US does not mandate an On-Board Diagnostic (OBD) system for BEVs. While legal OBD requirements are not considered for BEVs, the diagnostic system can be developed to meet future HEV applications.

### 22.1 Diagnostics Implementation Architecture

Figure 26 illustrates the Diagnostics Architecture, showing diagnostic coordination and integration components.

**Diagnostic Coordination:**
- Coordination of diagnostic development topics ensures the integration of platform diagnostic software.
- System assessment identifies necessary software adaptations.
- Updates to the Diagnostic Concept are documented, including DTC lists, interface signals, implementation statuses, and reaction groups.

**Implementation Details:**
- Diagnostics will adhere to AUTOSAR standards, leveraging DEM and FIM components.
- Fault management implementation covers areas such as:
  - Fault storage
  - Freeze Frame Groups
  - FIM configuration for fault reactions
  - UDS communication for service tools

**Key Features:**
- The DTC list contains error names, P-Codes, priorities, and freeze frame data.
- Electrical errors such as open circuits, short circuits to ground, and short circuits to the battery are qualified based on hardware capabilities.

---

### CAN Diagnostics

CAN diagnostic features are implemented in the Basic Software (BSW). Typically, debounce counters and replacement values are integrated into the Application Software (ASW). This diagnostic concept additionally addresses checksum, timeout, and Bus-Off errors.

**Functional Errors:** The platform diagnostic concept ensures mandatory protection for the system, taking appropriate fault reaction measures.

**UDS Signals:** Freeze frame reporting, service $22 and $2E, are incorporated into the platform concept. Signal recalculations involving resolution and unit conversions are also supported.

**Diagnostic File Information:** ODX file format details are available upon request.

---

### General Requirements

**Safety Design Measures:** 
As per Functional Safety Goals (FSC), the Technical Safety Concept (TSC) is designed, developed, and tested to ensure safety functionality. 

**Implemented Safety Measures:**

#### Detection, Indication, and Control of Faults in External Devices:
- SM[BCU].100.1 Stable communication check (ASIL C)
- SM[BCU].100.2 End-to-end check of input CAN signals (ASIL C)
- SM[BCU].300.1 End-to-end protection of output CAN signals (ASIL C)

#### Detection, Indication, and Control of Faults in the System:
- **Temperature Conditions:**
  - SRF[BCU].201.1 Determination of HV Battery cell temperatures (ASIL C)
  - SM[BCU].201.2 Cell temperature monitoring (ASIL C)
- **Current Monitoring:**
  - SRF[BCU].202.1 Determination of HV Battery pack current (ASIL C)
  - SM[BCU].202.2 Pack current monitoring (ASIL C)
  - SM[BCU].202.3 Energy flow monitoring (ASIL C)
- **Voltage Monitoring:**
  - SRF[BCU].203.1 Determination of HV Battery cell voltages (ASIL C)
  - SM[BCU].203.2 Cell voltage monitoring (ASIL C)
- **Operational Safety:**
  - SM[BCU].207.1 Power up/down handling (ASIL C)
- **Insulation Resistance:**
  - SRF[BCU].208.1 Determination of Insulation resistance (ASIL A)
  - SM[BCU].208.2 Insulation resistance monitoring (ASIL A)
- **HVIL Signal Check:**
  - SRF[BCU].210.1 Determination of HVIL signal (ASIL B)
  - SM[BCU].210.2 HVIL monitoring (ASIL B)
- **Safety-Relevant Output:**
  - SRF[BCU].300.1 Determination of safety relevant output information (ASIL C)

#### Prevention of Latent Faults:
- **HV Contactor Deterioration:**
  - SRF[BCU].204.1 Determination of HV contactor deterioration (ASIL A)
  - SML[BCU].204.2 HV contactor deterioration monitoring (ASIL A)
- **Voltage Protection:**
  - SRF[BCU].205.1 Determination of high voltages (ASIL A)
  - SML[BCU].205.2 HV contactor weld check (ASIL A)
  - SML[BCU].206.1 HV contactor monitoring (ASIL A)
- **Switch-Off Tests:**
  - SML[BCU].211.1 Switch-off path test (ASIL A)
</page>

<page number="95">
VinES

VFDSXXBAT1270

Version: 3  
Uncontrolled copy when printed  
95 | 101  

### Functional Responsibility  

#### Safety measures that prevent faults from being latent:
- **SML[BCU].212.1 KL30 voltage monitoring (ASIL A)**  

#### Safety measures that enable the system to achieve or maintain a safe state:
- **SS[BMS].01** Disconnect the HV Battery pack (ASIL C).
- **SS[BMS].02** Remain disconnected from HV Power net (ASIL C).
- **SS[BMS].03** Driver warning of thermal event (ASIL C).
- **SS[BMS].04** Remain temporarily disconnected from HV Power net (ASIL C).

#### Safety measures ensuring the integrity of the execution environment:
- Requirements on **Aurix microcontroller** as SEooC.
- Requirements on **System Basis Chip (TLF35584)** as SEooC.
- Requirements on **Multi-cell Battery Stack Monitor (LTC6813)** as SEooC.

---

### Determination of Operating Mode:

| **Condition**                                                            | **Action**                                    |
| ------------------------------------------------------------------------ | --------------------------------------------- |
| The HV_Battery_Pack_Actual_Current falls below the zero offset threshold AND the Charge_Allow_Flag indicates that charging is active. | **Set HV_Battery_Operating_Mode to Charging** |
| The HV_Battery_Pack_Actual_Current falls below the zero offset threshold AND the Charge_Allow_Flag indicates that charging is NOT active. | **Set HV_Battery_Operating_Mode to Recuperation** |
| The HV_Battery_Pack_Actual_Current exceeds the zero offset threshold.    | **Set HV_Battery_Operating_Mode to Discharging** |
| The HV_Battery_Pack_Actual_Current is within range of the zero offset threshold AND the HV contactors are open. | **Set HV_Battery_Operating_Mode to Disconnected** |
| The Charge_Allow_Flag_External_Fault is set.                             | **The last active state is maintained.**     |
</page>

<page number="96">
VinES  
VFDSXXBAT1270  

Version: 3  
Uncontrolled copy when printed  
96 | 101  
Print date  
Status  
Functional Responsibility  

Faults  
Actions  

Temperature sensor fault monitoring:  
- Range Check  
- Open Wire Check  
- Number of Sensor check  

Current Sensor fault monitoring:  
- CAN based shunt sensor fault (ASIL C)  
- ADC based Hall sensor fault ASIL B©  
- Current sensor plausibility fault  
- Both sensor fault  

Energy flow limit monitoring:  
- BDU components overheating  

Temperature based current limitation:  
- Charging: 0 to 50 allow charge current  
- Discharging: 0 to 60 allow discharge current  

Thermal runaway monitoring:  
- Works if the cell fulfills EUCAR L4  

Cell voltage protection limits:  
- Lock the battery pack when protection limit is reached  

Degradation mode:  
- Limp home mode  

HVIL Monitoring:  
- Short to BAT  
- Short to GND  
- Duty cycle or frequency exceeds limit  

Crash monitoring:  
- CAN Signal from ACM  

Insulation resistance monitoring:  
- Limp home mode request  
- Battery lock if limit reached  

CAN communication fault monitoring:  
- Driving: Limp Home mode  
- Charging: Open contactor  

CAN E2E Fault:  
- Open contactor  

KL30 Voltage monitoring (9 – 16V):  
- Out of range fault
</page>

<page number="97">
VinES  
VFDSXXBAT1270  

Version: 3  
Uncontrolled copy when printed  
97 | 101  

Print date  
Status  
Functional Responsibility  

**List of Safety Relevant CAN Signals:**  
| Sender | Receiver | Message             | Signal            | ASIL  | Comment                                              |
|--------|---------|---------------------|------------------|------|------------------------------------------------------|
| VCU    | BCU     | VCU_StSt_0x199     | VCU_BMS_HVOnOff_Req | ASIL C | OK                                                   |
| VCU    | BCU     | VCU_BMS_Information_0x217 | BMS_Insulation_Mon_Req | ASIL A | OK                                                   |
| VCU    | BCU     | VCU_PControl_0x219 | ChargeAllow       | ASIL C | OK                                                   |
| ACM    | BCU     | ACM_Crash_Sts_0x5  | ACM_Crash_Sts     | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_CellTemp_0x245 | BMS_MaxCellTemp   | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_CurrMax_0x174  | BMS_PackCurr_MEAS | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_ERR_LEV        | BMS_ERR_LEV       | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_ISU_StSts      | BMS_ISU_Status    | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_VolMeas1_0x206 | BMS_CellVolt      | ASIL C | OK                                                   |
| BCU    | VCU     | BMS_HItemp_0x133   | BMS_MaxCellVolt   | ASIL C | OK                                                   |
| BCU    | VCU     | HVIL_MEAS          | BMS_HVIL_MEAS     | ASIL C | OK                                                   |

**List of Safety DTC:**  
| DTC Number (hex) | DTC Display Number | Failure Type Byte and Meaning        | DTC Name                                                  |
|-------------------|-------------------|--------------------------------------|----------------------------------------------------------|
| 0x12AC01          | P12AC01          | 0x01 - General Electric Failure      | L2 error: Vehicle-level isolation NVM fault              |
| 0x12B09A          | P12B09A          | 0x9A - Component or System Operating Conditions | L2 error: Cell over temperature fault                    |
| 0x12B117          | P12B117          | 0x17 - Circuit Voltage Above Threshold | L2 error: Cell overvoltage fault                          |
| 0x12B29A          | P12B29A          | 0x9A - Component or System Operating Conditions | L2 error: Cell temperature deviation fault               |
| 0x12B39A          | P12B39A          | 0x9A - Component or System Operating Conditions | L2 error: Cell under temperature fault                   |
| 0x12B416          | P12B416          | 0x16 - Circuit Voltage Below Threshold | L2 error: Cell under voltage fault                       |
| 0x12B562          | P12B562          | 0x62 - Signal Compare Failure        | L2 error: Cell voltage delta fault                       |
| 0x12B601          | P12B601          | 0x01 - General Electric Failure      | L2 error: Current sensor 1 invalidity fault              |
| 0x12B701          | P12B701          | 0x01 - General Electric Failure      | L2 error: Current sensor 2 invalidity fault              |
| 0x12B801          | P12B801          | 0x01 - General Electric Failure      | L2 error: Current sensor plausibility fault              |
| 0x12B901          | P12B901          | 0x01 - General Electric Failure      | L2 error: Energy flow fault                              |
| 0x12BB01          | P12BB01          | 0x01 - General Electric Failure      | L2 error: HVIL open line fault                           |
| 0x12BC01          | P12BC01          | 0x01 - General Electric Failure      | L2 error: HVIL invalidity/short fault                    |
</page>

<page number="98">
VinES  
VFDSXXBAT1270  

Version: 3  
Uncontrolled copy when printed  
98 | 101  
Print date  
Status  
Functional Responsibility  

List of Safety DTC:  
- **DTC Number (hex):** 0x12BD01  
  - **DTC Display Number:** P12BD01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: Pack-level isolation NVM fault  

- **DTC Number (hex):** 0x12C000  
  - **DTC Display Number:** P12C000  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** L2 error: Module/cell/sensor configuration fault  

- **DTC Number (hex):** 0x12C101  
  - **DTC Display Number:** P12C101  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: Overcurrent fault  

- **DTC Number (hex):** 0x12C262  
  - **DTC Display Number:** P12C262  
  - **Failure Type Byte and Meaning:** 0x62 - Signal Compare Failure  
  - **DTC Name:** L2 error: Pack voltage plausibility fault  

- **DTC Number (hex):** 0x12C300  
  - **DTC Display Number:** P12C300  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** L2 error: Safety system deactivation  

- **DTC Number (hex):** 0x12C49A  
  - **DTC Display Number:** P12C49A  
  - **Failure Type Byte and Meaning:** 0x9A - Component or System Operating Conditions  
  - **DTC Name:** L2 error: Thermal runaway fault  

- **DTC Number (hex):** 0x12C500  
  - **DTC Display Number:** P12C500  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** L2 error: Vehicle crash NVM fault  

- **DTC Number (hex):** 0x12C700  
  - **DTC Display Number:** P12C700  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** Disconnect request from L2 Safety  

- **DTC Number (hex):** 0x12C800  
  - **DTC Display Number:** P12C800  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** L2 error: LTC single-point SM fault  

- **DTC Number (hex):** 0x12C900  
  - **DTC Display Number:** P12C900  
  - **Failure Type Byte and Meaning:** 0x00 - No sub type information  
  - **DTC Name:** L2 error: LTC latent-point SM fault  

- **DTC Number (hex):** 0x12CA01  
  - **DTC Display Number:** P12CA01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: Single cell temperature sensor electrical fault in a module  

- **DTC Number (hex):** 0x12CB01  
  - **DTC Display Number:** P12CB01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: More than one cell temperature sensor electrical fault in a module  

- **DTC Number (hex):** 0x12CC16  
  - **DTC Display Number:** P12CC16  
  - **Failure Type Byte and Meaning:** 0x16 - Power supply voltage below threshold  
  - **DTC Name:** L2 error: Cell under voltage protection fault  

- **DTC Number (hex):** 0x12CC17  
  - **DTC Display Number:** P12CC17  
  - **Failure Type Byte and Meaning:** 0x17 - Power supply voltage above threshold  
  - **DTC Name:** L2 error: Cell overvoltage protection fault  

- **DTC Number (hex):** 0x12CD01  
  - **DTC Display Number:** P12CD01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: Switch-off path test fault  

- **DTC Number (hex):** 0x12CE01  
  - **DTC Display Number:** P12CE01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: HSD feedback current fault  

- **DTC Number (hex):** 0x12CF01  
  - **DTC Display Number:** P12CF01  
  - **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
  - **DTC Name:** L2 error: LSD feedback voltage fault  

- **DTC Number (hex):** 0x12D044  
  - **DTC Display Number:** P12D044  
  - **Failure Type Byte and Meaning:** 0x44 – Data memory failure  
  - **DTC Name:** L2 error: Welded negative contactor NVM fault  

- **DTC Number (hex):** 0x12D144  
  - **DTC Display Number:** P12D144  
  - **Failure Type Byte and Meaning:** 0x44 – Data memory failure  
  - **DTC Name:** L2 error: Welded positive contactor NVM fault  

- **DTC Number (hex):** 0x12D244  
  - **DTC Display Number:** P12D244  
  - **Failure Type Byte and Meaning:** 0x44 – Data memory failure  
  - **DTC Name:** L2 error: Welded pre-charge contactor NVM fault  

- **DTC Number (hex):** 0x12D344  
  - **DTC Display Number:** P12D344  
  - **Failure Type Byte and Meaning:** 0x44 – Data memory failure  
  - **DTC Name:** L2 error: NVM value-complement storage fault  

- **DTC Number (hex):** 0xD10508  
  - **DTC Display Number:** U110508  
  - **Failure Type Byte and Meaning:** 0x08 – Bus Signal/Message Failure  
  - **DTC Name:** L2 error: MCU communication fault  

- **DTC Number (hex):** 0xD20400  
  - **DTC Display Number:** U120400  
  - **Failure Type Byte and Meaning:** 0x00 – No sub type information  
  - **DTC Name:** L2 error: Current sensor 1 timeout fault  

- **DTC Number (hex):** 0xD20500  
  - **DTC Display Number:** U120500  
  - **Failure Type Byte and Meaning:** 0x00 – No sub type information  
  - **DTC Name:** L2 error: Current sensor 1 alive counter fault  

- **DTC Number (hex):** 0xC41686  
  - **DTC Display Number:** U041686  
  - **Failure Type Byte and Meaning:** 0x86 – Signal invalid  
  - **DTC Name:** L2 error: HV Battery state request range check fault  

- **DTC Number (hex):** 0xC45286  
  - **DTC Display Number:** U045286  
  - **Failure Type Byte and Meaning:** 0x86 – Signal invalid  
  - **DTC Name:** L2 error: Vehicle crash state range check fault
</page>

<page number="99">
23. Mechanical Requirements.  
Housing of the BMS is considered as a mechanical item.  
Housing is made by aluminum.  

23.1. Electromagnetic Compatibility.  
EMC Requirements – ECE R10.  
FCC-Part 15.  

23.2. Electrostatic Discharge.  
ESD Requirements: Refer to the BMS DVP test plan.  

23.3. Climatic Requirements / Thermal Management.  
**Environmental operating conditions:**  
The ambient temperature, relative humidity, and altitude shall meet the vehicle performance operating environment.  

**Heat protection:**  
The development and validation of the heat protection in the complete vehicle ensure that all relevant component temperatures remain below the maximum allowed limits, which are derived from vehicle operation within the environmental operating temperatures.
</page>

<page number="100">
23. Mechanical Requirements.

Housing of the BMS is considered as a mechanical item. Housing is made by aluminum.

23.1. Electromagnetic Compatibility.
- EMC Requirements – ECE R10.
- FCC-Part 15.

23.2. Electrostatic Discharge.
- ESD Requirements: Refer to BMS DVP test plan.

23.3. Climatic Requirements / Thermal Management.

**Environmental operating conditions.**  
The ambient temperature, relative humidity, and altitude shall meet the vehicle performance operating environment.  

**Heat protection.**  
The development and validation of the heat protection in the complete vehicle ensures that all relevant component temperatures remain below the maximum allowed limits. These limits are derived from vehicle operation within the environmental operating temperatures.

24. Testing and Validation.

24.1. Proof of Compliance.  
Conformity of certified products refers to the degree to which products using the certification mark are consistent with type test samples in terms of design, structure, and key components and materials used. Specifically, the following aspects must ensure consistency:
- The mark of the certified product should be consistent with that indicated on the type test report.
- The structure of the certified product shall be the same as the sample in the type test.
- The parts and materials used in the certification products shall align with those declared in the type test and confirmed by the certification body.

24.2. Testing Plan for BMS (DVP Plan).  
**Electrical Systems & Functions.**  
Several validation cycles for electrical systems and functions are planned to guarantee correct implementation and will be carried out according to mentioned standards.  

Documents shall be provided on request:  
- ARE9452_DVP.pdf.  
- ARE9452_DVPR_final.pdf.
</page>

<page number="101">
25. Vehicle Requirement. 

VFSRXVEEP4030 – 20203103_SOR for battery pack B_C_Purchase.docx.
</page>
</pages>
