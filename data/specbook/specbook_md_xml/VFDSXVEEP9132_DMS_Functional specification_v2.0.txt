
<filename>VFDSXVEEP9132_DMS_Functional specification_v2.0</filename>
<pages>

<page number="1">
FUNCTIONAL SPECIFICATION.  
Driver Monitoring System.  

SCOPE: VF8 / VF9.  

Function owner: Phuong Dinh Le (v.lepd1@vinfast.vn).
</page>

<page number="2">
Table of Contents.

17 / APL31_DMS.  
17.1 / / Document Issued.  4  
17.2 / / Introduction.  7  
17.2.1 / / 1.1 System Overview.  7  
17.2.2 / / 1.2 System Architecture.  7  
17.2.3 / / 1.3 Camera Installation Packaging.  9  
17.2.4 / / 1.3.1 VF35 VF35 Camera Installation Location.  10  
17.2.5 / / 1.3.2 VF36VF36 Camera Installation Location.  10  
17.2.6 / / 1.3.3 Influence of Camera Installation Position.  11  
17.2.7 / / 1.4 Component Parameter.  11  
17.2.8 / / 1.5 References To Documents And Specifications.  13  
17.3 / / System Description.  13  
17.3.1 / / 2.1 System State Machine.  14  
17.3.2 / / 2.2 Interactive Signals.  15  
17.4 / / Function Definition.  23  
17.4.1 / / 3.1 DMS DMS Setting.  24  
17.4.1.1 / / 3.1.1 DMSDMS On and Off.  24  
17.4.2 / / 3.2 Perception Module.  25  
17.4.2.1 / / 3.2.1 Distraction Detection.  25  
17.4.2.2 / / 3.2.2 Drowsiness Detection.  26  
17.4.2.3 / / 3.2.3 Function Priority.  31  
17.4.2.4 / / 3.2.4 The Processing Logic of ADAS_DMS_HAPWARNING.  31  
17.4.2.5 / / 3.2.5 Wearing IR-Blocking Glasses Detection.  32  
17.4.2.6 / / 3.2.6 Wearing Mask Detection.  32  
17.4.2.7 / / 3.2.7 Face Registration.  32  
17.4.2.8 / / 3.2.8 Face Recognition.  33  
17.5 / / Performance Requirements.  33  
17.5.1 / / 4.1 Image Quality Requirements.  33  
17.5.2 / / 4.2 DMS Operational Design Domain for DMS.  34
</page>

<page number="3">
VinFast Management System  
VFDSXVEEP9132  

[This page is intentionally left blank.]
</page>

<page number="4">
17 / APL31_DMS.

**Requirement ID:** FS-225897.  
**Type:** --.  
**Status:** New.  

---

### 17.1 / / Document Issued.

**Requirement ID:** FS-514462.  
**Type:** --.  
**Status:** New.  

### VinFast Version.

| **Version** | **Change by** | **Change description**                        | **Initiator**    | **Approver**        |
|-------------|---------------|-----------------------------------------------|------------------|---------------------|
| 1.0         | ECR60004069   | Initial version released for LS phase         | Duong Hoai An    | Ng Dennis Koon Siu  |
| 2.0         | ECR60005557   | Release for SOP phase                         | Duong Hoai An    | Ng Dennis Koon Siu  |

### Versions.

| **Versions** | **Author**   | **Date**       | **Description**                                           |
|--------------|--------------|----------------|-----------------------------------------------------------|
| V1.0         | --           | 2021/08/04    | 1. Compile.                                                |
| V1.1         | --           | 2021/09/18    | 1. Modify System Overview.                                |
|              |              |                | 2. Modify System Architecture.                            |
|              |              |                | 3. Update Signal Interaction List.                        |
|              |              |                | 4. Update Function Definition.                            |
| V1.2         | --           | 2021/10/14    | 1. Update Function Definition.                            |
</page>

<page number="5">
17 / APL31_DMS

Requirement ID:
FS-225897  
Type: --  
Status: New  

---

17.1 // Document Issued

Requirement ID:
FS-514462  
Type: --  
Status: New  

VinFast version:

1.0  
Change by: ECR60004069  
Change description: Initial version released for LS phase  
Initiator: Duong Hoai An  
Approver: Ng Dennis Koon Siu  

2.0  
Change by: ECR60005557  
Change description: Release for SOP phase  
Initiator: Duong Hoai An  
Approver: Ng Dennis Koon Siu  

---

Versions:  

V1.0  
Author: --  
Date: 2021/08/04  
Description: 1. Compile  

V1.1  
Author: --  
Date: 2021/09/18  
Description:  
1. Modify System Overview  
2. Modify System Architecture  
3. Update Signal Interaction List  
4. Update Function Definition  

V1.2  
Author: --  
Date: 2021/10/14  
Description: 1. Update Function Definition  

V1.3  
Author: --  
Date: 2021/10/28  
Description:  
1. Set ATWS Function Definition as TBD  
2. Update System State Machine  
3. Update Face Registration and Face Recognition Function Definition  

V1.4  
Author: --  
Date: 2021/11/05  
Description:  
1. Add HOD Control Signal in Section 2.2  
2. Add Driver Anomaly Signal in Section 2.2  

V1.5  
Author: --  
Date: 2021/11/15  
Description:  
1. Update Signal Interaction List  
2. Delete the Driver Anomaly Signal in Section 2.2  
3. Update Section 3.1.1  

V1.6  
Author: --  
Date: 2022/03/11  
Description:  
1. Update interactive signals in Section 2.2 according to dbc9.2.0.  
2. DMS Updated Section 3.1.1 DMS on and off content.  
3. Updated logic for distraction, drowsiness, and driver behavior in Sections 3.2.1, 3.2.2, 3.2.3.  
4. ADAS_DMS_Driver_registration coding - Update the content corresponding to the coding value of the signal ADAS_DMS_Driver_registration.  
5. Delete ATWS module logic in Section 3.3.  
6. Delete the content in Section 3.1.2.  
7. Added Section 1.3.1 Influence of camera installation position.  

V1.7  
Author: --  
Date: 2022/04/19  
Description:  
1. Updated System State Machine in Section 2.1.  
2. Add the processing logic of ADAS_DMS_HAPWARNING in Section 3.2.4.  
3. Deleted unused signals in Section 2.2 Interactive Signals.  
4. Updated Section 3.2.1, including distraction based on smoking and distraction based on calling. When the DMS receives the signal DMS_DriverConfirmDMSWarning sent by the MHU and the coding value is 1 "Okay Pressed", DMS will not output the alarm level within 20 seconds (regardless of whether the level changes). After 20 seconds, the alarm level will be output normally.  
5. Updated the logic of head pose and line of sight distraction in Section 3.2.1.
</page>

<page number="6">
Requirement ID: FS-225897. Type: --. Status: New.

17.1 // Document Issued. Requirement ID: FS-514462. Type: --. Status: New.

VinFast versions:

1. Version 1.0:
   - Change by ECR60004069.
   - Change description: Initial version released for LS phase.
   - Initiator: Duong Hoai An.
   - Approver: Ng Dennis Koon Siu.

2. Version 2.0:
   - Change by ECR60005557.
   - Change description: Release for SOP phase.
   - Initiator: Duong Hoai An.
   - Approver: Ng Dennis Koon Siu.

Version history details:

- V1.0 (2021/08/04): Initial compilation.
- V1.1 (2021/09/18): 
  1. Modify System Overview.
  2. Modify System Architecture.
  3. Update Signal Interaction List.
  4. Update Function Definition.
- V1.2 (2021/10/14): 
  1. Update Function Definition.
- V1.3 (2021/10/28): 
  1. Set ATWS Function Definition as TBD.
  2. Update System State Machine.
  3. Update Face Registration and Face Recognition Function Definition.
- V1.4 (2021/11/05): 
  1. Add HOD Control Signal in Section 2.2.
  2. Add Driver Anomaly Signal in Section 2.2.
- V1.5 (2021/11/15): 
  1. Update Signal Interaction List.
  2. Delete the Driver Anomaly Signal in Section 2.2.
  3. Update Section 3.1.1.
- V1.6 (2022/03/11): 
  1. Update interactive signals in section 2.2 according to dbc9.2.0.
  2. DMS updated section 3.1.1 DMS on and off content.
  3. Updated logic for distraction, drowsiness, and driver behavior in sections 3.2.1, 3.2.2, 3.2.3.
  4. ADAS_DMS_Driver_registration coding: Update the content corresponding to the coding value of the signal ADAS_DMS_Driver_registration.
  5. Deleted ATWS module logic in section 3.3.
  6. Deleted content in section 3.1.2.
  7. Added Section 1.3.1 Influence of camera installation position.
- V1.7 (2022/04/19): 
  1. Updated System State Machine in section 2.1.
  2. Add the processing logic of ADAS_DMS_HAPWARNING in section 3.2.4.
  3. Deleted unused signals in Section 2.2 Interactive Signals.
  4. Updated Distraction logic based on smoking and calling in section 3.2.1: When the DMS receives the signal DMS_DriverConfirmDMSWarning sent by MHU (coding value "Okay Pressed"), the alarm level is paused for 20 seconds. Normal output resumes post-20 seconds.
  5. Updated head pose and line-of-sight distraction logic in section 3.2.1.
- V1.8 (2022/06/10): 
  1. Added DMS camera occlusion fault in section 2.1.
  2. Updated DMS logic to turn on by default when powered on in section 3.1.1.
  3. DMS on/off setting and DMS warning sensitivity setting.
  4. Updated section 3.3 ATWS logic.
  5. Updated section 3.2.2 Drowsiness logic.
  6. Removed Hands-Off detection.
- V1.9 (2022/06/22): 
  1. Updated DMS alarm duration logic in section 3.2.2.
  2. In Section 3.1.2, regardless of the MHU Warning Switch status (ON/OFF), the DMS function is always available, and fatigue detection outputs alarms normally.
- V1.10 (2022/08/17): 
  1. Removed ATWS.
  2. Removed Smoking detection.
  3. Removed LDW.
  4. Updated long-time driving logic.
  5. Removed automatic speed-based DMS mode functionality.
  6. Updated signal "ADAS_DMS_Status_feed":
     - Coding=7 indicates the camera is completely occluded or failed connection. 
     - Coding=6 indicates DMS initialization failure or CAN signal acquisition failure.
  7. Updated Section 3.2.4 processing logic for ADAS_DMS_Hapwarning.
</page>

<page number="7">
8. Update Section 3.2.5 wearing IR Blocking Glasses detection.  
9. Update Section 3.2.6 wearing Mask detection.  
10. Add Section 3.2.3 function priority.  

17.2 // Introduction.  

Requirement ID: FS-388753.  
Type: --.  
Status: New.  

17.2.1 // 1.1 System Overview.  

Requirement ID: FS-388754.  
Type: --.  
Status: New.  

The Driver Monitoring System (DMS) is a driver safety assistance system, which mainly consists of three modules:  

1. The Vehicle’s Speed, VSPEED Lane Departure Warning, LDW Time of Day, TOD Signal processing module, which mainly receives and processes signals from other sensors, such as the vehicle’s speed (VSPEED), lane departure warning (LDW), and time of day (TOD).  

2. The Perception module, which uses the data received by the infrared camera and signal processing module to monitor the status of the driver in real-time.  

3. The Interactive module, which is mainly responsible for interacting with the MHU.  

17.2.2 // 1.2 System Architecture.  

Requirement ID: FS-388755.  
Type: --.  
Status: New.  

The DMS system is composed of 1*controller + 1*camera, and its working process requires the cooperation of many modules of the whole vehicle, such as MHU, VSPEED, LDW, TOD, TD, and other modules.
</page>

<page number="8">
17.2.1 / / 1.1 System Overview.

Driver Monitoring System (DMS) is a driver safety assistance system, which mainly consists of three modules:
1. Signal processing module:
   - Receives and processes signals from other sensors, including vehicle’s speed (VSPEED), lane departure warning (LDW), and time of day (TOD).
2. Perception module:
   - Uses data received by the infrared camera and signal processing module to monitor the driver’s status in real-time.
3. Interactive module:
   - Responsible for interacting with the Media Head Unit (MHU).

17.2.2 / / 1.2 System Architecture.

The DMS system is composed of 1*controller and 1*camera. Its functionality requires cooperation between many modules within the vehicle, such as MHU, VSPEED, LDW, TOD, and others.

### Figure 1.1: System Architecture.
A diagram illustrating the connections between modules such as VSPEED, LDW, TOD, and TD, integrated with the DMS, MHU, and 1*camera. CAN and GMSL protocols are employed for communication.

### Table 1.1: Abbreviation Definitions.
Descriptions of abbreviations used within the system:
- **XAVIER**: Undefined.
- **DMS**: Driver Monitoring System.
- **MHU**: Media Head Unit.
- **VSPEED**: Vehicle’s Speed.
- **TOD**: Time of Day.
</page>

<page number="9">
17 / APL31_DMS

Requirement ID: FS-225897. Type: --. Status: New.

---

17.1 / / Document Issued.

Requirement ID: FS-514462. Type: --. Status: New.

### VinFast Version Table:

**Version:**  
- **Change by:** ECR60004069. **Change description:** Initial version released for LS phase. **Initiator:** Duong Hoai An. **Approver:** Ng Dennis Koon Siu.  
- **Change by:** ECR60005557. **Change description:** Release for SOP phase. **Initiator:** Duong Hoai An. **Approver:** Ng Dennis Koon Siu.  

---

### Versions History Table:

**Version:**  
- **V1.0:** Author: --. Date: 2021/08/04. Description: Compile.  
- **V1.1:** Author: --. Date: 2021/09/18. Description: Modify System Overview; Modify System Architecture; Update Signal Interaction List; Update Function Definition.  
- **V1.2:** Author: --. Date: 2021/10/14. Description: Update Function Definition.  

---

**Version V1.3 to V1.10 Updates:**  

- *V1.6:* Author: --. Date: 2022/03/11. Description: Updated interactive signals in section 2.2 according to dbc9.2.0; Deleted Sections like ATWS logic per system requirements like..etc…. 
Other new additions [summarized updates below]*
</page>

<page number="10">
17.2.4 / / 1.3.1 VF35 VF35 Camera Installation Location.

The camera is mounted on the steering column. The red, green, and yellow lines in the image represent the field of view (FOV) of the 5% Manikin, the FOV of the 50% Manikin, and the FOV of the 95% Manikin. The minimum distance between the chin of the 5% Manikin and the lower edge of the camera's FOV is 17.691mm, and the maximum is 39.295mm.

Figure 1.3 Analysis results for VF35.

17.2.5 / / 1.3.2 VF36 VF36 Camera Installation Location.

The camera is mounted on the steering column. The red, green, and yellow lines in the image represent the field of view (FOV) of the 5% Manikin, the FOV of the 50% Manikin, and the FOV of the 95% Manikin. The minimum distance between the chin of the 5% Manikin and the lower edge of the camera's FOV is 18.955mm, and the maximum is 53.565mm.
</page>

<page number="11">
17.2.4 / / 1.3.1 VF35 VF35 Camera Installation Location.

Requirement ID: FS-388757.  
Type: --.  
Status: New.  

The camera is mounted on the steering column. The red, green, and yellow lines in the image represent the field of view (FOV) of the 5% Manikin, the FOV of the 50% Manikin, and the FOV of the 95% Manikin. The minimum distance between the chin of the 5% Manikin and the lower edge of the camera's FOV is 17.691mm and the maximum is 39.295mm.

Figure 1.3 Analysis results for VF35.

---

17.2.5 / / 1.3.2 VF36 Camera Installation Location.

Requirement ID: FS-388758.  
Type: --.  
Status: New.  

The camera is mounted on the steering column. The red, green, and yellow lines in the image represent the field of view (FOV) of the 5% Manikin, the FOV of the 50% Manikin, and the FOV of the 95% Manikin. The minimum distance between the chin of the 5% Manikin and the lower edge of the camera's FOV is 18.955mm and the maximum is 53.565mm.

Figure 1.4 Analysis results for VF36.

---

17.2.6 / / 1.3.3 Influence of Camera Installation Position.

Requirement ID: FS-388759.  
Type: --.  
Status: New.  

The camera installation location may affect the DMS as follows:  
1. If the distance between the FOV of the camera and the chin of the dummy model is less than 45mm, when the driver bows his head, it may cause the face not to be detected and the mouth to be missing in the picture.  
2. If the angle between the center line of the optical axis of the camera and the horizontal line exceeds 25 degrees, this may lead to the degradation of eye-related functions such as line-of-sight estimation and fatigue detection. The final effect needs to be evaluated in combination with real vehicle tests.

---

17.2.7 / / 1.4 Component Parameter.

Requirement ID: FS-388760.  
Type: --.  
Status: New.
</page>

<page number="12">
17.2.7 / / 1.4 Component Parameter.

Requirement ID: FS-388760.  
Type: --.  
Status: New.  

#### Camera Optical Parameter

- **Item**  
  - **Description**  
- **F/No**  
  - 2.0  
- **FOV**  
  - **Diagonal:** 79.7°  
  - **Horizontal:** 68.3°  
  - **Vertical:** 44.8°  
- **Chief ray angle**  
  - 27.6°  
- **IR Filter**  
  - 940nm  

#### Camera Sensor Performance

- **Sensor model**  
  - Onsemi AR0144AT  
- **Optical format**  
  - 1/4-inch  
- **Number of max pixel**  
  - 1280*800  
- **Pixel Size**  
  - 3μm (H)*3μm (V)  

#### Module Performance

- **Number of Output Pixel**  
  - 1280*800
</page>

<page number="13">
Dynamic Range: 63.9 dB  
Signal to Noise Ratio (SNR): MAX 39 dB  
Frame Rate: 30 FPS  
Serializer: MAX9295A  
Output Formats: RAW 12bit  
Transmission Interface: GMSL  

**17.2.8 / / 1.5 References To Documents And Specifications**  
Requirement ID: FS-388761.  
Type: --  
Status: New.  

- UN Regulation No. 157: Uniform provisions concerning the approval of vehicles with regard to Automated Lane Keeping Systems (March 2021).  
- UN Regulation No. 79 Revision 3: Uniform provisions concerning the approval of vehicles with regard to steering equipment (November 2017).  
- UN Regulation No. 79 Revision 3 - Amendment 2: Uniform provisions concerning the approval of vehicles with regard to steering equipment (November 2018).  
- SAE J3198: Driver Drowsiness and Fatigue in the Safe Operation of Vehicles - Definition of Terms and Concepts (October 2020).  
- EURO NCAP - Assisted Driving - Highway Assist Systems v1.0 (October 2020).  
- COMMISSION DELEGATED REGULATION (EU) 2021/1341.  

**17.3 / / System Description**
</page>

<page number="14">
### 17.3 / / System Description

#### Requirement ID: FS-388762  
Type: --  
Status: New  

Failure  
Standby  
Active  
Standby  
Active  
F  

---

### 17.3.1 / / 2.1 System State Machine

#### Requirement ID: FS-514471  
Type: --  
Status: New  

**Figure 2.1 System State Machine**  
The diagram illustrates the DMS system states: OFF, Standby, Active, and Failure, and transitions between these states.  

**Conditions:**  
T1: DMS Standby  
The system is powered on, DMS completes initialization, enters Standby mode. This includes initialization, loading model, configuration parameters, etc.  

**State Descriptions:**  
- **OFF:** The system is in hibernation state.  
- **Standby:** The system is in standby state (DMS处于待机状态).  
- **Active:** The system is active (DMS处于激活状态).  
- **Failure:** DMS system failure (DMS系统故障).
</page>

<page number="15">
T2: The activation condition is triggered, and the DMS function is activated. The activation conditions are as follows:
[1] The DMS camera is available.
[2] When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, DMS is in active mode, normally outputting the driver’s fatigue and distracted state.

T3: The exit condition is triggered when the ADCU power is off.  
T4: System power off.  
T5: System failure, such as a camera module error or DMS perception initialization error.  

The signal output from DMS to MHU is:
"ADAS_DMS_Status_feed" = 7 "Reserved"  
6 "Reserved"  
5 "No face detected"  
4 "Wearing IR-blocking glasses"  
3 "Wearing mask"  
2 "DMS off"  
1 "DMS on"  
0 "Init".

Value coding:
Coding=7: The camera is completely occluded, and camera failure occurs (such as the camera cannot connect), resulting in DMS camera acquisition failure.  
Coding=6: DMS initialization failure, DMS cannot receive the CAN signal, Xavier defect.  

T6: When the failure is recovered, the system enters standby mode.

### 17.3.2 / / 2.2 Interactive Signals  

#### Requirement ID:
FS-388763  
Type: --  
Status: New  

Feature: DMS  
Sub-function: DMS Setting  
Transmitter: MHU  
Receiver: ADAS_Info  
Signal Name: DMS_Status  
Signal Description: MHU requests DMS to change settings.  

Value:
- 2: "DMS off"  
- 1: "DMS on"  
- 0: "Init"

Send Type: OnChange  
Line Number: 1
</page>

<page number="16">
17.3 / / System Description

Requirement ID: FS-388762  
Type: --  
Status: New  

Failure  
Standby  
Active  
Standby  
Active  
F  

17.3.1 / / 2.1 System State Machine  

Requirement ID: FS-514471  
Type: --  
Status: New  

Figure 2.1 System State Machine.  

Conditions:  

T1: DMS Standby. The system is powered on, DMS completes initialization, enters Standby mode. Initialization includes loading the model, configuring parameters, etc.  

T2: DMS activation is triggered, and the DMS function is activated. The activation conditions are as follows:  
[1] The DMS camera is available.  
[2] When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, and DMS is in active mode. DMS normally outputs the driver's fatigue and distracted state.  

T3: ADCU DMS exit condition is triggered when the ADCU powers off.  

T4: System power off.  

T5: System failure such as a camera module error or DMS perception initialization error.  
The signal output from DMS to MHU is as follows:  
- "ADAS_DMS_Status_feed" =  
  - 7: "Reserved".  
  - 6: "Reserved".  
  - 5: "No face detected".  
  - 4: "Wearing IR-blocking glasses".  
  - 3: "Wearing mask".  
  - 2: "DMS off".  
  - 1: "DMS on".  
  - 0: "Init".  

Value = 7. Value = 6. DMS cannot get CAN signal, Xavier defect.  
Coding = 7 means the camera is completely occluded and camera failure (e.g., unable to connect).  
Coding = 6 means DMS initialization failure; DMS cannot get CAN signal due to Xavier defect.  

T6: When the failure is recovered, the system enters Standby mode.  

17.3.2 / / 2.2 Interactive Signals  

Requirement ID: FS-388763  
Type: --  
Status: New  

| Feature | Subfunction | Transmitter | Receiver | Signal name | Signal description | Value | Send type | Line number |  
|---------|-------------|-------------|----------|-------------|-------------------|-------|-----------|-------------|  
| DMS     | DMS Setting | MHU         | ADAS_Info| DMS_Status | MHU DMS request change | 2: "DMS off", 1: "DMS on", 0: "Init" | OnChange | 1 |  
| DMS     | DMS Status  | MHU         | ADAS_Info| ADAS_DMS_Status_feed | DMS confirm status change successfully | 7: "Reserved", 6: "Reserved", 5: "No face detected," 4: "Wearing IR-blocking glasses," 3: "Wearing mask," 2: "DMS off," 1: "DMS on," 0: "Init" | Cyclic | 2 |  
| MHU     | ADAS_Info   | DMS DriverConfirmDMSWarning | MHU pop-up | MHU sends Okay signal to confirm DMS warning prompt pop-up | 1: "Okay pressed", 0: "Okay not pressed" | OnChange | 5 |
</page>

<page number="17">
DMS Driver Registration Interface:

Feature: Face registration.  
Sub Function: DMS_Driver_registration_request.  
Transmitter: MHU.  
Receiver: ADAS_Info.  
Signal Name: DMS_Driver_registration_request.  
Signal Description: MHU requests identification or deletion of a user.  
Values:  
- 2: "Delete"  
- 1: "Identification"  
- 0: "Init"  
Send Type: OnChange.  
Line Number: 9.

Feature: Face registration.  
Sub Function: DMS_Driver_ID_request.  
Transmitter: MHU.  
Receiver: ADAS_Info.  
Signal Name: DMS_Driver_ID_request.  
Signal Description: MHU sends ID that needs to be registered or deleted.  
Values:  
- 0: "Init"  
- 1: "ID 1"  
- 2: "ID 2"  
- 3: "ID 3"  
...  
- 15: "ID 15"  
Send Type: OnChange.  
Line Number: 10.

Feature: Face registration.  
Sub Function: ADAS_DMS_Driver_registration.  
Transmitter: ADAS_Info.  
Receiver: MHU.  
Signal Name: ADAS_DMS_Driver_registration.  
Signal Description: DMS confirms the result of identification.  
Values:  
- 0: "Init"  
- 1: "ID request"  
- 2: "ID already exists / The driver has been registered/save file error"  
- 3: "Identification success"  
- 4: "Delete success/register"  
Send Type: Cyclic.  
Line Number: 11.
</page>

<page number="18">
**Processing Errors and Face Recognition Results**

In cases where errors occur during processing, the possible outcomes include:
- "Error by mask" indicates that the quality of the face is too low due to a mask covering.
- "Error by IR-blocking glasses" denotes detection issues caused by glasses interfering.
- "Error by head pose" occurs when the driver's pose prevents accurate face detection.

**Face Recognition Status**

Feature: ADAS  
Sub-function: Face Recognition  
Transmitter: ADAS  
Receiver: MHU  
Signal Name: ADAS_DMS_DRIVER_DETECTION  

Description: This signal indicates the driver's verification status using facial recognition.  
Possible Values:
- 0: "Driver is not registered".
- 1: "Driver is not detected due to head position".
- 2: "Driver is not detected due to wearing sunglasses".
- 3: "Driver is not detected due to wearing a mask".
- 4: "Identification Success".  

Cycle Type: Cyclic  
Line Number: 12  
Category: BEV
</page>

<page number="19">
Dynamic Range: 
- The dynamic range of the system is 63.9dB.

Signal to Noise Ratio: 
- The maximum SNR is 39dB.

Frame Rate: 
- The frame rate of the camera is 30 FPS.

Serializer: 
- The serializer used is MAX9295A.

Output Formats: 
- The system outputs RAW 12bit data.

Transmission Interface: 
- The transmission interface is GMSL.

---

17.2.8 / / 1.5 References To Documents And Specifications.

Requirement ID: FS-388761. 
Type: --. 
Status: New. 

- UN Regulation No. 157: Uniform provisions concerning the approval of vehicles with regard to Automated Lane Keeping Systems (March 2021). 
- UN Regulation No. 79 Revision 3: Uniform provisions concerning the approval of vehicles with regard to steering equipment (November 2017). 
- UN Regulation No. 79 Revision 3 - Amendment 2: Uniform provisions concerning the approval of vehicles with regard to steering equipment (November 2018). 
- SAE J3198: Driver Drowsiness and Fatigue in the Safe Operation of Vehicles - Definition of Terms and Concepts (October 2020). 
- EURO NCAP - Assisted Driving - Highway Assist Systems v1.0 (October 2020). 
- COMMISSION DELEGATED REGULATION (EU) 2021/1341.

---

17.3 / / System Description.

Requirement ID: FS-388762.
Type: --.
Status: New.

Failure states and transitions:
- Standby, Active, System Off, and Failure states are captured in the system state machine diagram. 
- System transitions include activation (T2), failure recovery (T6), powering off (T4), and active state exit (T3).

---

17.3.1 / / 2.1 System State Machine.

Requirement ID: FS-514471.
Type: --.
Status: New.

Figure 2.1 System State Machine:
- T1: DMS Standby. The system is powered on and initializes; enters Standby mode. Includes model loading and parameter configuration. 
- T2: DMS activation condition is triggered, activating DMS function. 
- T3: ADCU transition. Exit active state when ADCU powers off. 
- T4: System power off transition. 
- T5: System failure triggering signal output indicating various failure codes.
- T6: Upon recovery, system reenters Standby mode.

---

Interactive Signals:

17.3.2 / / 2.2 Interactive Signals.

Requirement ID: FS-388763.
Type: --.
Status: New.

DMS Status:
- Signal name: ADAS_DMS_Status_feed. 
- Describes current operational status including 2 "DMS off," 1 "DMS on," 0 "Init."
- Cyclic transmission type on Line 2.

Driver Confirmation:
- MHU confirmation signal. Name: ADAS_DMS_DriverConfirmDMSWarning.
- Values: 1 "Okay Pressed," 0 "Okay not pressed."
- Signaling is on change. Line 5.

Driver Registration:
- Signal for driver registration request: ADAS_DMS_Driver_registration_request.
- Values include 0 "Init," 1 "Identification," and 2 "Delete."
- On change signal on Line 9.

Driver Identification:
- Driver ID request signal: ADAS_DMS_DRIVER_DETECTION.
- Provides registration status: 0 "Driver is not registered," 1 "Driver is not detected due to head position," 2 "Driver is not detected due to sunglasses," 3 "Driver is not detected due to mask," 4 "Identification success."
- Cyclic transmission type on Line 12.

Driver ID Signal:
- System cyclically transmits driver ID based on request: ADAS_DMS_DRIVER_IDENTIFICATION. 
- Values include IDs 0 to 15. Line 13.

---

DMS Warning Levels:

Signal: ADAS_DMS_DROWS_DISTRACTION_LVL.
- Indicates warning levels including 0 "Init," 1 to 15 varying levels of drowsiness, distraction, or prolonged driving.
- Cyclic transmission on Line 14.
</page>

<page number="20">
16 "long_driving lvl 4" indicates an extended driving session with a warning level of 4.  
17 "smoking lvl 1" identifies a smoking activity at level 1.  
18 "smoking lvl 2" identifies a smoking activity at level 2.  
19 "smoking lvl 3" identifies a smoking activity at level 3.  
20 "smoking lvl 4" identifies a smoking activity at level 4.  
21 "calling lvl 1" indicates a phone call at level 1.  
22 "calling lvl 2" indicates a phone call at level 2.  
23 "calling lvl 3" indicates a phone call at level 3.  
24 "calling lvl 4" indicates a phone call at level 4.  
25 "driving_erractial lvl 1" signals erratic driving behavior at level 1.  
26 "driving_erractial lvl 2" signals erratic driving behavior at level 2.  
27 "driving_erractial lvl 3" signals erratic driving behavior at level 3.  
28 "driving_erractial lvl 4" signals erratic driving behavior at level 4.  
29 "Reserved" indicates a placeholder signal.  
30 "Reserved" indicates a placeholder signal.  
31 "Reserved" indicates a placeholder signal.

### Vehicle Speed
Feature: XGW_Info  
Subsystem: ADAS  
Signal Name: VehicleSpd  
Description: Vehicle speed measurement.  
Value: n.a.  
Transmission Type: Cyclic  
Line Number: 15  
Transmission Interface: BEV.
</page>

<page number="21">
Requirement ID: FS-388762. Type: --. Status: New.

17.3.1 / / 2.1 System State Machine.

Requirement ID: FS-514471. Type: --. Status: New.

Figure 2.1 System State Machine:

**Conditions:**
- T1: DMS Standby — The system is powered on, DMS completes initialization, and enters Standby mode. Includes initialization, loading model, configuration parameter, etc.
- T2: DMS — The activation condition is triggered, and the DMS function is activated. The activation conditions are as follows:
  1. The DMS camera is available.
  2. When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, and DMS is in active mode. The DMS outputs the driver’s fatigue and distracted state normally.
- T3: ADCU DMS — The exit condition is triggered when the ADCU powers off.
- T4: System power off.
- T5: System failure — Such as a camera module error, DMS perception initialization error, etc.
  - The signal output from DMS to MHU is defined as follows:
    - 7: "Reserved."
    - 6: "Reserved."
    - 5: "No face detected."
    - 4: "Wearing IR-blocking glasses."
    - 3: "Wearing a mask."
    - 2: "DMS off."
    - 1: "DMS on."
    - 0: "Init."
  - Coding:
    - 7: The camera is completely occluded, has a failure (e.g., disconnection), or acquisition failure.
    - 6: DMS initialization failure or inability to receive CAN signal.
- T6: When the failure is recovered, the system enters Standby mode.

17.3.2 / / 2.2 Interactive Signals.

Requirement ID: FS-388763. Type: --. Status: New.

**Interactive Signals:**
- Feature: DMS Setting.
  - **Transmitter:** MHU.
  - **Receiver:** ADAS Info.
  - **Signal Name:** DMS_Status.
  - **Signal Description:** MHU requests a change to DMS status.
  - **Value:** 2 "DMS off," 1 "DMS on," 0 "Init."
  - **Send Type:** OnChange.
  - **Line Number:** 1.

- Feature: DMS Status.
  - **Transmitter:** ADAS Info.
  - **Receiver:** MHU.
  - **Signal Name:** ADAS_DMS_Status_feed.
  - **Signal Description:** DMS confirms the change in status successfully.
  - **Value Descriptions:**  
    - 7: "Reserved."  
    - 6: "Reserved."  
    - 5: "No face detected."  
    - 4: "Wearing IR-blocking glasses."  
    - 3: "Wearing a mask."  
    - 2: "DMS off."  
    - 1: "DMS on."  
    - 0: "Init."
  - **Send Type:** Cyclic.
  - **Line Number:** 2.

- Feature: MHU Pop-up Confirmation.
  - **Transmitter:** MHU.
  - **Receiver:** ADAS Info.
  - **Signal Name:** DMS_DriverConfirmDMSWarning.
  - **Signal Description:** MHU sends an Okay signal to confirm DMS warning prompt pop-up.
  - **Value Descriptions:**  
    - 1: "Okay Pressed."  
    - 0: "Okay not pressed."
  - **Send Type:** OnChange.
  - **Line Number:** 5.

**Face Registration:**
- Feature: Driver Registration Request.
  - **Transmitter:** MHU.
  - **Receiver:** ADAS Info.
  - **Signal Name:** DMS_Driver_registration_request.
  - **Signal Description:** MHU requests identification or deletion of a user.
  - **Values:**
    - 2: "Delete."
    - 1: "Identification."
    - 0: "Init."
  - **Send Type:** OnChange.
  - **Line Number:** 9.

- Feature: Driver ID Request.
  - **Transmitter:** MHU.
  - **Receiver:** ADAS Info.
  - **Signal Name:** DMS_Driver_ID_request.
  - **Signal Description:** MHU sends the ID that either needs to be registered or deleted.
  - **Values:**
    - 0: "Init."
    - 1: "ID 1."
    - 2: "ID 2."
    - 3: "ID 3."
    - … 
    - 15: "ID 15."
  - **Send Type:** OnChange.
  - **Line Number:** 10.

- Feature: Driver Registration Confirmation.
  - **Transmitter:** ADAS.
  - **Receiver:** MHU.
  - **Signal Name:** ADAS_DMS_Driver_registration.
  - **Signal Description:** DMS confirms the result of identification.
  - **Values:**
    - 0: "Init."
    - 1: "ID request."
    - 2: "ID already exists," registration failure, or save file error.
    - 3: "ID identification success."
    - 4: "Delete/Registration success."
    - 5: Processing error due to mask or low-quality face.
    - 6: Error due to IR-blocking glasses.
    - 7: Error due to head pose or absence of face.
  - **Send Type:** Cyclic.
  - **Line Number:** 11.

**Face Recognition:**
- Feature: Driver Detection.
  - **Transmitter:** ADAS.
  - **Receiver:** MHU.
  - **Signal Name:** ADAS_DMS_DRIVER_DETECTION.
  - **Signal Description:** Indicates driver verification status.
  - **Values:**
    - 0: "Driver is not registered."
    - 1: "Driver is not detected due to head position."
    - 2: "Driver is not detected due to wearing sunglasses."
    - 3: "Driver is not detected due to wearing a mask."
    - 4: "Identification success."
  - **Send Type:** Cyclic.
  - **Line Number:** 12.
</page>

<page number="22">
Requirement ID: FS-388763  
Type: --  
Status: New  

### Signal Details  

#### DMS Status  
Sender: ADAS_Info  
Receiver: MHU  
Signal Name: ADAS_DMS_Status_feed  
Signal Description: This signal represents DMS status change confirmation.  
Values:  
- 7 "Reserved"  
- 6 "Reserved"  
- 5 "no face detected"  
- 4 "wearing ir-blocking glasses"  
- 3 "wearing mask"  
- 2 "DMS off"  
- 1 "DMS on"  
- 0 "Init"  
Send Type: Cyclic  
Line Number: 2  

#### Haptic Command  
Sender: SCAM  
Receiver: EPS  
Signal Name: ADAS_DMS_HapWarning  
Signal Description: Command for the haptic device operation.  
Values:  
- 0 "Deactivation"  
- 1 "Activation"  
Send Type: Cycle  
Line Number: 23  

#### Vehicle Speed Status  
Sender: XGW_Info  
Receiver: ADAS_Info  
Signal Name: VehicleSpdSts  
Signal Description: Represents vehicle speed validity status.  
Values:  
- 1 "Invalid"  
- 0 "Valid"  
Send Type: Cyclic  
Line Number: 16  

#### Current Hour Signal  
Sender: XGW_Info  
Receiver: ADAS_Info  
Signal Name: DISP_HR  
Signal Description: Indicates the current hour.  
Values: n.a.  
Send Type: Cyclic  
Line Number: 17  

#### Current Minute Signal  
Sender: XGW_Info  
Receiver: ADAS_Info  
Signal Name: DISP_MN  
Signal Description: Indicates the current minute.  
Values: n.a.  
Send Type: Cyclic  
Line Number: 18  

#### Lane Assist Function Popup  
Sender: XGW_Info  
Receiver: MHU  
Signal Name: ADAS_LA_popup  
Signal Description: Represents popup messages for lane assist functionality.  
Values:  
- 7 "Lane assist Unavailable"  
- 6 "reserved"  
- 5 "reserved"  
- 4 "Emergency lane keep assist"  
- 3 "lane keep assist in intervention"  
- 2 "Emergency steering for safety"  
- 1 "Take control. Vehicle departing lane"  
- 0 "No Popup"  
Send Type: Cyclic  
Line Number: 24  

#### Steering Wheel Angle Validity  
Sender: XGW_Info  
Receiver: ADAS_Info  
Signal Name: SAS_SteerWheelAngleValid  
Signal Description: Represents the effective signal for steering angle.  
Values:  
- 0 "Valid"  
- 1 "Invalid"  
Send Type: Cyclic  
Line Number: 25  

#### Steering Wheel Angle  
Sender: XGW_Info  
Receiver: ADAS_Info  
Signal Name: SAS_SteerWheelAngle  
Signal Description: The current angle of the steering wheel (positive angles represent left turns; negative angles represent right turns).  
Values: n.a.  
Send Type: Cyclic  
Line Number: 26  

#### Alive Counter  
Sender: ADAS_Info  
Receiver: MHU  
Signal Name: ALV_ADAS_DMS_STATUS  
Signal Description: Represents the alive counter for ADAS and DMS functionality.  
Values: n.a.  
Send Type: Cyclic  
Line Number: 27  

#### Checksum  
Sender: ADAS_Info  
Receiver: MHU  
Signal Name: CHKSM_ADAS_DMS_STATUS  
Signal Description: Represents the checksum for ADAS and DMS data validation.  
Values: n.a.  
Send Type: Cyclic  
Line Number: 28
</page>

<page number="23">
ADAS_Info MHU ALV_DMS_STATUS. Alive Counter. n.a. Cyclic. Line number: 29.

ADAS_Info MHU CHKSM_DMS_STATUS. Checksum. n.a. Cyclic. Line number: 30.

**17.4 // Function Definition**

Requirement ID: FS-388764. Type: --. Status: New.

DMS3.1. The system mainly consists of three modules, each of which contains several sub-functions. See Table 3.1 below for details.

**Table 3.1 Module Function Introduction**

System: Driver Monitoring System.  
Module: Signal processing and Interaction module.  
Module Description: TBDLDW, MHU. This module mainly receives and processes vehicle speed, time of day, and LDW signal from TBD and interaction signal on MHU.

Module: Visual perception module.  
Module Description: This module mainly includes driver distraction detection, fatigue detection, driving behavior analysis, wearing glasses detection, wearing mask detection, face registration, and face recognition.
</page>

<page number="24">
17.4 / / Function Definition. 

Requirement ID: FS-388764.  
Type: --.  
Status: New.  

DMS3.1. The system mainly consists of three modules, each of which contains several sub-functions.  
See table 3.1 below for details.  

3.1. Table 3.1 Module function introduction.  

System: Driver Monitoring System.  
Module: Signal processing and Interaction module.  
Module Description: This module mainly receives and processes vehicle’s speed, time of day, and LDW signal from TBD and interaction signal on MHU.

System: Driver Monitoring System.  
Module: Visual perception module.  
Module Description: This module mainly includes driver distraction detection, fatigue detection, driving behavior analysis, wearing glasses detection, wearing mask detection, face registration, and face recognition.  

---

17.4.1 / / 3.1 DMS DMS Setting.  

Requirement ID: FS-388765.  
Type: --.  
Status: New.  

---

17.4.1.1 / / 3.1.1 DMSDMS On and Off.  

Requirement ID: FS-388766.  
Type: --.  
Status: New.  

1. When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, and the signal is sent to the MHU.  
The switch signal is input to the DMS, but the DMS Module will not process it.  
DMS is ON by default, and the feedback status is also ON.  
DMS does not feedback OFF state.  

The logic flow chart is shown in the following figure.
</page>

<page number="25">
ADAS_Info  
MHU  
ALV_DMS_STATUS.  
Alive Counter.  
n.a.  
Cyclic.  
29 BEV.  

ADAS_Info  
MHU  
CHKSM_DMS_STATUS.  
Checksum.  
n.a.  
Cyclic.  
30 BEV.  

**17.4 Function Definition.**  

Requirement ID: FS-388764.  
Type: --.  
Status: New.  

**DMS3.1.**  
The system mainly consists of three modules, each of which contains several sub-functions. (See table 3.1 below for details.)  

**Table 3.1 Module function introduction.**

- **Driver Monitoring System.**
  - **Signal processing and Interaction module.**  
    TBDLDW, MHU.  
    This module mainly receives and processes vehicle’s speed, time of day, and LDW signal from TBD and interaction signal on MHU.  
  - **Visual perception module.**  
    This module mainly includes driver distraction detection, fatigue detection, driving behavior analysis, wearing glasses detection, wearing mask detection, face registration, and face recognition.  

**17.4.1 / 3.1 DMS DMS Setting.**  

Requirement ID: FS-388765.  
Type: --.  
Status: New.  

**17.4.1.1 / 3.1.1 DMSDMS On and Off.**  

Requirement ID: FS-388766.  
Type: --.  
Status: New.  

1. When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, and the signal is sent to the MHU.  
The switch signal is input to the DMS, but the DMS Module will not process it.  
DMS is ON by default, and the feedback status is also ON.  
DMS does not feedback OFF state.  

The logic flow chart is shown in the following figure:  
- Signal: “ADAS_DMS_Status_feed.”  

**17.4.2 / 3.2 Perception Module.**  

Requirement ID: FS-388767.  
Type: --.  
Status: New.  

**17.4.2.1 / 3.2.1 Distraction Detection.**  

Requirement ID: FS-388768.  
Type: --.  
Status: New.  

When DMS is turned on, the system will output three kinds of distraction signals:  
- Calling.  
- Driving for a long time.  
- Not looking at the road ahead.  

Each of these contains three levels (level 2/level 3/level 4, remove level 1).  

When driving at night (22:00-06:00), the alarm time will be advanced by K seconds;  
When the vehicle speed exceeds 70 km/h, the alarm time will be advanced by K seconds.  

1. Distraction based on calling.
</page>

<page number="26">
17.4 / / Function Definition.

Requirement ID: FS-388764.  
Type: --  
Status: New.  

DMS3.1.  
The system mainly consists of three modules, each of which contains several sub-functions (See table 3.1 below for details).  

Table 3.1: Module Function Introduction.  

System: Driver Monitoring System.  
Module: Signal Processing and Interaction Module.   
Module Description: This module mainly receives and processes vehicle’s speed, time of day, and LDW signal from TBD and interaction signal on MHU.  

System: Driver Monitoring System.  
Module: Visual Perception Module.  
Module Description: This module mainly includes driver distraction detection, fatigue detection, driving behavior analysis, wearing glasses detection, wearing mask detection, face registration, and face recognition.  

17.4.1 / / 3.1 DMS DMS Setting.  

Requirement ID: FS-388765.  
Type: --  
Status: New.  

--

17.4.1.1 / / 3.1.1 DMSDMS On and Off.  

Requirement ID: FS-388766.  
Type: --  
Status: New.  

When the vehicle is powered on, the ADCU is powered on, the DMS switch is ON by default, and the signal is sent to the MHU.  
The switch signal is input to the DMS, but the DMS Module will not process it.  
DMS is ON by default, and the feedback status is also ON.  
DMS does not feedback OFF state.  

The logic flow chart is shown in the figure provided on the page.  

17.4.2 / / 3.2 Perception Module.  

Requirement ID: FS-388767.  
Type: --  
Status: New.  

--

17.4.2.1 / / 3.2.1 Distraction Detection.  

Requirement ID: FS-388768.  
Type: --  
Status: New.  

When DMS is turned on, the system will output three kinds of distraction signals: calling, driving for a long time, and not looking at the road ahead, each of which contains three levels (level2/level3/level4, remove level 1).  

(When driving at night (22:00-06:00), the alarm time will be advanced by K seconds; when the vehicle speed exceeds 70 km/h, the alarm time will be advanced by K seconds).

1. **Distraction Based on Calling:**  
   - When the driver keeps making a call for more than N seconds, the distraction level is 2.  
   - When the driver keeps making a call for more than N+M seconds, the distraction level is 3.  
   - When the driver keeps making a call for more than N+2*M seconds, the distraction level is 4.  

   Calling has an OK button for level 4. When the DMS receives the signal "DMS_DriverConfirmDMSWarning" sent by the MHU and the coding value is 1 "Okay Pressed", mute alarm for 20 minutes. Reset level is automatically applied when not calling anymore.

2. **Driving for a Long Time:**  
   - When the driver keeps driving for more than 240 minutes, it is determined that the driver is driving for a long time, and the distraction level is 2.  
   - The driver continues to drive for every more than 20 minutes; the level is increased by 1 until level 4.  
   - When driving for a long time at level 2, level 3, or level 4, the level will always be output until downgrade conditions are met.  
   - If the driver takes a 20-minute break or changes the driver, the driving time is recalculated.  

   When the DMS receives the signal "DMS_DriverConfirmDMSWarning" sent by the MHU and the coding value is 1 "Okay Pressed":  
   - The current level is equal to 4.  
   - The interval alarm (level 4) is output after 20 minutes.

3. **Distraction Based on Head Pose and Eye Gaze:**  
   - When the driver’s head pose deviates from the reference pose by G degrees:  
      - Yaw (deviation by 30 degrees).  
      - Head-up or head-down pitch deviation (25 degrees).  
      - Line of sight deviation means the driver is not looking directly at the road ahead.  

   In a continuous period of 30 seconds:  
   - If the driver’s head pose deviation status or eye gaze looks away from the road ahead exceeds 10 seconds, output level 2.  
   - If it exceeds 2.5 seconds, output level 3.  
   - If it exceeds 3.5 seconds, output level 4.  

   When the driver continuously looks straight ahead for more than X seconds:  
   - The level is cleared.  
   - The timer is reset.  

2022/8/15: Perform this logic on the MHU side. VF agrees to MHU handling it.

17.4.2.2 / / 3.2.2 Drowsiness Detection.  

Requirement ID: FS-388769.  
Type: --  
Status: New.  

When the DMS is turned on, the system combines:  
- Driver's yawning state.  
- Eye state.  
- Vehicle speed.  
- Time of day.  

This information is used to analyze fatigue level signals.  
- When driving at night (22:00-06:00), alarm time is advanced by K seconds.  
- When vehicle speed exceeds 70 km/h, alarm time is advanced by K seconds.

The logical summary table is provided within the content.
</page>

<page number="27">
Drowsiness levels.

1. Remove yaw times of 120 seconds, eyes close times of 60 seconds, eyes close duration within 20 seconds, and LDW times of 120 seconds.

Lvl 2:
- Yaw times: 3 times.
- Vehicle speed exceeds 50km/h.
  - Within 1 minute, the number of frames with closed eyes accounts for 10% of the total duration. (Vehicle speed greater than 50km/h for 1 minute).
- Vehicle speed ≤ 50km/h.
  - Within 1 minute, the number of frames with closed eyes accounts for 20% of the total duration. (LDW triggers 1 or more times and yawns 2 times, output level 2).
</page>

<page number="28">
Drowsiness levels.

Lvl 1:  
- Yaw times of 120s: Remove.  
- Eyes close times of 60s: Remove.  
- Eyes close duration within 20 seconds: Remove.  
- LDW times of 120s: Remove.  

Lvl 2:  
- Yaw times of 120s: 3 times.  
- Vehicle speed: 50 km/h — Within 1 minute, the number of frames with closed eyes accounts for 10% of the total duration.  
- Vehicle speed ≤ 50 km/h — Within 1 minute, the number of frames with closed eyes accounts for 20% of the total duration.  
- Eyes close duration within 20 seconds: Remove.  
- LDW times of 120s: If LDW triggers 1 time or more and yawns 2 times, output level 2.

Lvl 3:  
- Yaw times of 120s: 4 times.  
- Vehicle speed: 50 km/h — Within 1 minute, the number of frames with closed eyes accounts for 12.5% of the total duration.  
- Vehicle speed ≤ 50 km/h — Within 1 minute, the number of frames with closed eyes accounts for 25% of the total duration.  
- Eyes close duration within 20 seconds: Eyes closed for 0.75 seconds twice or more within 20 seconds; exceeds 1.5 seconds.  
- LDW times of 120s: If LDW is triggered 1 time or more and eye-closing duration ≥ 0.75 seconds, or if LDW triggers 1 or more times and yawns 3 times, output level 3.

Lvl 4:  
- Yaw times of 120s: Remove.  
- Eyes close times of 60s: Remove.  
- Eyes close duration within 20 seconds: Eyes closed for 1.2 seconds; exceeds 2.4 seconds.  
- LDW times of 120s: If LDW is triggered 1 time or more and eye-closing duration > 1.2 seconds, output level 4.
</page>

<page number="29">
### VinFast Management System

#### 17.4.2 / / 3.2 Perception Module

**Requirement ID:** FS-388767  
**Type:** --  
**Status:** New  

---

#### 17.4.2.1 / / 3.2.1 Distraction Detection

**Requirement ID:** FS-388768  
**Type:** --  
**Status:** New  

When the driver keeps making a call for more than N seconds, the distraction level is 2. When the driver keeps making a call for more than N + M seconds, the distraction level is 3. When the driver keeps making a call for more than N + 2 * M seconds, the distraction level is 4.  

Calling has OK button for level 4. When the DMS receives the signal "DMS_DriverConfirmDMSWarning" sent by the MHU and the coding value is 1 ("Okay Pressed"), alarm mute lasts for 20 minutes. Level reset will automatically apply when not calling anymore.  

Driving for a long time is triggered when the driver keeps driving for more than 240 minutes and distraction level 2 is set. If the driver continues uninterrupted, the level increases every 20 minutes until reaching level 4. Levels persist until downgrade conditions are met, such as a 20-minute break or driver change.  

Distraction based on the driver’s head pose and eye gaze deviation occurs if:
- Yaw angle deviation exceeds 30 degrees,
- Head-up or head-down deviation exceeds a 25-degree pitch reference angle,
- Line of sight deviation is determined.

If deviation lasts for 10+ seconds within 30 seconds, output level 2. For deviations lasting 2.5 seconds or more, output level 3. For deviations lasting more than 3.5 seconds, output level 4. The distraction level resets if the driver looks straight ahead for more than X seconds.

---

#### 17.4.2.2 / / 3.2.2 Drowsiness Detection

**Requirement ID:** FS-388769  
**Type:** --  
**Status:** New  

The DMS system analyzes fatigue based on the driver’s yawning state, eye state, vehicle speed, and time of day. When driving at night (22:00-06:00) or at speeds exceeding 70 km/h, alarm time advances by K seconds.

#### Logical Summary Table  

**Drowsiness Levels:**  
**Level 2**  
- 3 yawns over 120 seconds.  
- At speeds of 50 km/h: within 1 minute, closed eye frames account for 10% of duration.  
- At speeds ≤ 50 km/h: within 1 minute, closed eye frames account for 20% of duration.

**Level 3**  
- 4 yawns over 120 seconds.  
- At speeds of 50 km/h: within 1 minute, closed eye frames account for 12.5% of duration.  
- At speeds ≤ 50 km/h: within 1 minute, closed eye frames account for 25% of duration.  
- Continuous eye closure exceeding 1.5 seconds triggers level 3.  

**Level 4**  
- Continuous eye closure exceeding 2.4 seconds triggers level 4.  
- At speeds ≤ 50 km/h and with triggering from LDW (Lane Departure Warning), 1 or more eye closures exceeding 1.2 seconds may output level 4.  

#### Yawn Logic  
When the mouth opening ratio threshold is reached for 3 seconds, a single yawn is counted. Over 120 seconds:
- Yawn 3 times: output level 2.
- Yawn 4 times: output level 3.

#### Eye Closure Logic  
When the vehicle speed is ≥ 50km/h:
- Within 1 minute, closed eye frames account for 10% (level 2).
- Within 1 minute, closed eye frames account for 12.5% (level 3).

When vehicle speed is ≤ 50km/h:
- Within 1 minute, closed eye frames account for 20% (level 2).
- Within 1 minute, closed eye frames account for 25% (level 3).

#### LDW & Alarm Logic
If LDW triggers 1 or more times:
- Combined with 2 yawns, level 2.
- Combined with eye closure ≥ 0.75 seconds, level 3.
- Combined with 3 yawns, level 3.
- Combined with eye closure ≥ 1.2 seconds, level 4.  

#### Alarm Levels & Duration
**Level 2 Alarm Output:** 3 seconds.  
**Level 3 Alarm Output:** 4 seconds.
</page>

<page number="30">
When the alarm level is lvl4, the duration is all the time (at most 5 minutes) under level 4 or until the driver triggers "OK."

Logic Examples:

Example 1:
If the alarm level has been triggered (e.g., lvl3), within 5 minutes, if there is an upgrade, it will be reported immediately, and the start time of the 5-minute window will be refreshed.
- Time-line: 120s → 140s → ... → 440s
- Warning-level: lvl3 → lvl4 → Reset
- Output to MHU warning time: lvl3 = 4 seconds, lvl4 = all the time (at most 5 minutes) under level 4 or until the driver triggers "OK." NA after reset.

Example 2:
If the alarm level has been triggered (e.g., lvl3 at 120s) and the DMS system does not upgrade the alarm within 5 minutes, this does not indicate that the driver is not drowsy. The level remains consistent with the initial alarm state:
- Time-line: 120s → 180s → 240s → ... → 420s
- Warning-level: lvl3 → lvl3 → ... → lvl3 → Reset
- Output to MHU warning time: lvl3 = 4 seconds repeatedly every minute until the system resets after 5 minutes. NA after reset.

Example 3:
If the alarm level has been triggered (e.g., lvl3), but the DMS system detects that the driver's drowsiness state has degraded within the 5-minute window, the alarm will not be triggered again after downgrade detection. At the end of the 5-minute window, all states will reset.
</page>

<page number="31">
17.4.2.3 Function priority.

Requirement ID: FS-388770.  
Type: --  
Status: New.  

Drowsiness > look_away > long_driving > calling.  
Drowsiness has the highest priority. Even if the fatigue level is the lowest at the same time, the priority output is given to the MHU.  

17.4.2.4 The processing logic of ADAS_DMS_HAPWARNING.

Requirement ID: FS-388771.  
Type: --  
Status: New.  

When Drowsiness Detection occurs, DMS will simultaneously output signal "adas_dms_hapwarning".  
- When the alarm level is 1, Signal "ADAS_DMS_HAPWARNING" = 0 "Deactivation".  
- When the alarm level is 2, Signal "ADAS_DMS_HAPWARNING" = 1 "Activation", continues to send for 2 seconds.  
- When the alarm level is 3, Signal "ADAS_DMS_HAPWARNING" = 1 "Activation", continues to send for 3 seconds.  
- When the alarm level is 4, Signal "ADAS_DMS_HAPWARNING" = 1 "Activation", continues to send for 4 seconds.
</page>

<page number="32">
17.4.2.5 Wearing IR-Blocking Glasses Detection.

Requirement ID: FS-388772  
Type: --  
Status: New  

When DMS is turned on, the system will judge whether the driver is wearing infrared blocking glasses. The characteristic of infrared blocking glasses is that infrared light cannot penetrate the lens, so the state of the eyes cannot be monitored. 

Signal "ADAS_DMS_Status_feed": Coding = 4 "wearing ir-blocking glasses" means wearing infrared blocking glasses or the eye state is unknown due to other reasons.

---

17.4.2.6 Wearing Mask Detection.

Requirement ID: FS-388773  
Type: --  
Status: New  

When the DMS function is turned on, the system provides a signal to indicate whether the driver is wearing a mask. 

Signal "ADAS_DMS_Status_feed": Coding = 3 "wearing mask" means wearing a mask or the mouth is blocked by the hand or the phone is blocking the mouth.

---

17.4.2.7 Face Registration.

Requirement ID: FS-388774  
Type: --  
Status: New  

When DMS is turned on, the face registration process is as follows:

1. First, the MHU sends a registration request to the DMS. When DMS receives the registration request, DMS will request the registration ID from the MHU.  
2. Secondly, the MHU provides the registration ID to DMS.  
3. Finally, when DMS receives the registration ID, DMS enters the face registration process and returns the registration results. These include: ID already exists, driver has been registered, error due to head pose, error due to infrared blocking sunglasses, error due to face mask, identification success, save file error, and no face error.
</page>

<page number="33">
17.4.2.8 / / 3.2.8 Face Recognition.

Requirement ID: FS-388775  
Type: --  
Status: New.  

When the DMS is turned on, the system will output the driver authentication status including: error by head pose, error by ir-blocking sunglasses, error by face mask, driver is not registered, other error, identification success and driver ID.

17.5 / / Performance Requirements.

Requirement ID: FS-388777  
Type: --  
Status: New.  

17.5.1 / / 4.1 Image Quality Requirements.

Requirement ID: FS-388778  
Type: --  
Status: New.  

1. DMS Camera parameter requirements:

- **Camera type**: Near-Infrared (NIR) Camera.  
- **Resolution**: 1280*720.  
- **Optical Size**: 1/4 inch.  
- **Pixel Size**: 3.0 um.  
- **Shutter Type**: Global Shutter.  
- **Signal Noise Ratio (SNR)**: 38dB.
</page>

<page number="34">
### 17.4.2.8 / / 3.2.8 Face Recognition

**Requirement ID:** FS-388775  
**Type:** --  
**Status:** New  

When the DMS is turned on, the system will output the driver authentication status including: error by head pose, error by IR-blocking sunglasses, error by face mask, driver is not registered, other error, identification success, and driver ID.

---

### 17.5 / / Performance Requirements

**Requirement ID:** FS-388777  
**Type:** --  
**Status:** New  

---

### 17.5.1 / / 4.1 Image Quality Requirements

**Requirement ID:** FS-388778  
**Type:** --  
**Status:** New  

#### DMS Camera Parameter Requirements

**Camera Type:** Near-Infrared (NIR) Camera  
**Resolution:** 1280*720  
**Optical Size:** 1/4 inch  
**Pixel Size:** 3.0 um  
**Shutter Type:** Global Shutter  
**Signal Noise Ratio (SNR):** 38dB  

#### LED System Requirements

**LED System:** 940nm LED  
**Frame Rate:** 30FPS  
**FOV:** Horizontal: 50°~70°, Vertical: 40°~60°  
**Output Interface:** LVDS  
**Exposure Control:** Auto Exposure  

#### Additional Requirements for ISP and LED

1. **ISP:** The camera's ISP needs to adapt to conditions such as excessive light and sudden changes in light, for example, when passing through a tunnel or exiting a basement.  
2. **LED Uniformity:** The camera or IR LED should provide even illumination in the head area, ensuring uniform intensity of illumination in the driver's head area in the image.  
3. **LED Intensity:** The camera or IR LED should provide sufficient intensity to produce visible corneal reflection under any light conditions.  
4. **Strong Light Conditions:** Under strong light conditions, it should ensure that the driver’s head will not be overexposed in the image, as this can reduce DMS function performance.  
5. **Camera Placement:** When the camera is installed on the steering column or dashboard, ensure the steering wheel does not block the camera's view for prolonged periods.

---

### 17.5.2 / / 4.2 DMS Operational Design Domain for DMS

**Requirement ID:** FS-388779  
**Type:** --  
**Status:** New  

This chapter integrates the installation position of the camera and the image requirements of the visual perception module. It provides the operational design domain (ODD) of the DMS. To explain this further, the driver's head and surrounding areas are divided into seven areas, as shown in Figure 4.1.
</page>

<page number="35">
### 17.4.2.8 / / 3.2.8 Face Recognition
**Requirement ID:** FS-388775  
**Type:** --  
**Status:** New  

When the DMS is turned on, the system will output the driver authentication status including: error by head pose, error by ir-blocking sunglasses, error by face mask, driver is not registered, other error, identification success, and driver ID.

---

### 17.5 / / Performance Requirements
**Requirement ID:** FS-388777  
**Type:** --  
**Status:** New  

---

### 17.5.1 / / 4.1 Image Quality Requirements
**Requirement ID:** FS-388778  
**Type:** --  
**Status:** New  

#### 1. DMS Camera Parameter Requirements
- **Camera Type:** Near-Infrared (NIR) Camera  
- **Resolution:** 1280 × 720  
- **Optical Size:** 1/4 inch  
- **Pixel Size:** 3.0 µm  
- **Shutter Type:** Global Shutter  
- **Signal Noise Ratio (SNR):** 38 dB  

#### LED System
- **LED Type:** 940 nm LED  
- **Frame Rate:** 30 FPS  
- **Field of View (FOV):** H: 50°–70°, V: 40°–60°  
- **Output Interface:** LVDS  
- **Exposure Control:** Auto Exposure  

---

#### 2. ISP
The camera's ISP needs to adapt to conditions such as excessive light and sudden changes in light, e.g., passing through tunnels or exiting basements.  

#### 3. LED
The camera or IR LED should provide even illumination around the head area, ensuring uniform intensity of illumination in the driver's head area.

#### 4. LED
The camera or IR LED should ensure sufficient intensity to produce visible corneal reflection under any lighting conditions.

#### 5. DMS
Under strong light conditions, the driver’s head should not be overexposed in the image to maintain the performance of DMS functionalities.

#### 6. Installation
When the camera is installed on the steering column or dashboard, ensure the steering wheel does not obstruct the camera’s view for extended periods.

---

### 17.5.2 / / 4.2 DMS Operational Design Domain for DMS
**Requirement ID:** FS-388779  
**Type:** --  
**Status:** New  

This chapter integrates the installation position for the camera and the visual perception module image requirements. It outlines the design operating domain (ODD) for the DMS. The driver's head and surrounding areas have been divided into seven areas, as shown in Figure 4.1.

---

#### 4.1 Figure 4.1 Perception Area Division

##### 1. Overview of Perception Functions by Area:
- **Area 1 and 2:** Calling detection.  
- **Area 3:** Mask detection, yawn detection, fatigue detection based on yawning.  
- **Area 4:** Blink detection, glasses detection, distraction detection based on line-of-sight estimation, fatigue detection based on closed eyes.  
- **Entire Head Area:** Used for distraction estimation based on head pose.

---

##### 2. Restrictions by Function:
**Distraction Detection:**  
- Distraction detection based on head pose: Less than 10% occlusion or truncation of areas 3, 4, and 5 of the face.  
- Distraction detection based on eye gaze: The center point of the iris and pupil in area 4 must be unobstructed and clearly visible.

**Driver Smoking Detection:**  
- Cigarette diameter must be between 5.0 and 8.0 mm.  
- Cigarette must be within the range of area 3. Examples of smoking are illustrated in Figure 4.2.
</page>

<page number="36">
Figure 4.2: Examples of smoking.

Detection of driver smoking: The cigarette must have a diameter between 5.0 mm and 8.0 mm, and it must fall within the range of area 3. Correct examples of smoking are displayed in this figure.

Driver calling detection: The phone must be within the range of areas 1 and 2 for valid detection. Identification will not occur if the phone is outside these areas. Refer to Figure 4.3 for proper examples of calling detection.
</page>

<page number="37">
4.3  
Figure 4.3 Examples of calling.  

2 Fatigue detection.  
3 Fatigue detection based on yawning: mouth (Area 3) is not blocked.  
4 Fatigue detection based on eyes status: eyes (Area 4) are not blocked.  

3 Wearing glasses detection.  

4.4  
The system can detect whether the driver is wearing ordinary myopia glasses and sunglasses (as shown in Figure 4.4). When the glasses worn by the driver cannot be penetrated by infrared rays, the functions related to the eyes cannot be output.
</page>

<page number="38">
4.4  
Figure 4.4 Ordinary myopia glasses and regular sunglasses.  

4 Wearing mask detection.  
The types of masks that can be detected include dust masks and masks similar in shape to dust masks, such as medical-surgical masks and N95 masks. Some types of masks are shown in Figure 4.5.  

The correct way of wearing a mask is shown in Figure 4.6.
</page>

<page number="39">
5 Face Recognition.

The driver’s face (Area 3, 4, 5) is clearly visible and the driver’s face is facing the camera. Only the images captured by the DMS camera of the vehicle are supported for face recognition.
</page>
</pages>
