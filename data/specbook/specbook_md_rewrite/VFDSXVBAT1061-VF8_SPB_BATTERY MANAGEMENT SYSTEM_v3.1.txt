Page 1
VinES VFDSXVBAT1061.

Third Edition (08.2022).  

**Specification Book.**

**BMS_BATTERY_MANAGEMENT_SYSTEM Specification Book (SPB).**

Responsibly contact - BPI Team – (PIC - Rajendra Rajavelu (v.rajendrar@vines.net.vn)).

Copyright: "The reproduction, distribution and utilization of this document as well as the communication of its contents to others without express authorization is prohibited. Offenders will be held liable for the payment of damages. All rights reserved in the event of the grant of a patent, utility model or design. Nothing in this standard supersedes applicable laws and regulations."
Page 2
Contents.

1. General Document Guidelines.
   1.1 Purpose.
   1.2 Language.
   1.3 Obligation of Requirement Wording.
   1.4 Abbreviations. 

2. General Project Guidelines.
   2.1 Development Scope Abstract.
   2.2 VF8 Variant.

3. BMS SW Components Sequence Diagram.
   3.1 BMS Startup.
   3.2 BMS Wake up Run Sequence.
   3.3 BMS Shutdown Sequence Diagram.

4. Process Flow Charts.
   4.1 Wakeup BMS & Turn on HV (Power up) Sequence Diagram.
   4.2 Turn off HV (Power down) Sequence Diagram.
   4.3 Thermal Control HVBP Sequence Diagram.
   4.4 AC/DC Charging Sequence Diagram.
   4.5 Pre-conditioning Wakeup Flow Chart.

5. BMS - Non Functional Architecture Description.
   5.1 Assumption: BMS Functional Content with Following Conditions.
   5.2 Pack Power Map Parameters.
   5.3 HVBP Threshold Calibration Parameters.

6. HVBP - Functional Architecture Description.
   6.1 BMS Function List.
   6.2 BMS State Transition Control (BSTC).
   6.3 BSTC – HVBP Operation System Status.

7. CTC - Contactor Transition Control (HV-plus, HV-minus, Pre-charge).
   7.1 CTC - Function Description.
   7.2 CTC - Contactor Closing.
   7.3 CTC - Contactor Opening.
   7.4 CTC - Pre-charge Check.
   7.5 CTC - Overheating of Pre-charge Resistor.
   7.6 CTC - Emergency Contactor Open State.
   7.7 CTC - Contactor Error Acknowledge.
   7.8 CTC - Contactor Weld Check.
   7.9 CTC - Contactor Aging Observer.
   7.10 CTC - Aging of Contactor.

8. BPIU - Battery Pack Current Voltage Protection Limits.
   8.1 BPIU - Cell Voltage Min Max Identification.
   8.2 BPIU - Cell Voltage Protection Limits.
Page 3
Contents.

8. BPIU - Battery Pack current voltage protection limits.
8.3. BPIU - Voltage Acquisition Plausibility. ........................................................................................ 38.
8.4. BPIU - Cell Voltage Deviation. ..................................................................................................... 42.
8.5. BPIU - Cell Temperature Deviation. ............................................................................................ 43.

9. MCC - Module Controller Control.
9.1. MCC - Cell Voltage Sensing. ....................................................................................................... 44.
9.2. MCC - Module voltage. ................................................................................................................ 44.
9.3. MCC - Module Temperature. ....................................................................................................... 44.
9.4. MCC - Cell Balancing. .................................................................................................................. 44.
9.5. MCC - Temperature sensor fault monitoring – number of sensors. ............................................. 46.
9.6. MCC - FUSA. ............................................................................................................................... 46.

10. Battery Thermal Handling Management (BTHM).
10.1. BTHM - Function Description. .................................................................................................... 48.
10.2. BTHM - Data Preparation. ......................................................................................................... 48.
10.3. BTHM - Thermal Control. ........................................................................................................... 49.
10.4. BTHM - Thermal Loop in vehicle. .............................................................................................. 50.
10.5. BTHM - BDU Temperature sensor control. ............................................................................... 55.
10.6. BTHM - BDU Thermal Runaway Detection. .............................................................................. 56.

11. Battery Vehicle Communication.
11.1. BVC - Function Description. ...................................................................................................... 57.
11.2. BVC - VCU State Request. ........................................................................................................ 57.
11.3. BVC - Discharge power 3D Data. .............................................................................................. 58.
11.4. BVC - HMI (MHU/IPC) Communication. .................................................................................... 61.

12. BCTE - Battery Charge Time Estimation.
12.1. BCTE - Function Overview. ....................................................................................................... 64.
12.2. BCTE - Function Description. .................................................................................................... 64.

13. BWLD - Battery Warranty Logistic Data.
13.1. BWLD - Function Overview. ...................................................................................................... 65.
13.2. BWLD - Function Description. ................................................................................................... 65.

14. BPP - Battery Protection Pack.
14.1. BPP - Function Description. ....................................................................................................... 67.
14.2. BPP - Pack Resistance. ............................................................................................................. 67.
14.3. BPP - Cell Temperature Limit. ................................................................................................... 67.
14.4. BPP - Controller Temperature Limit. .......................................................................................... 67.
14.5. BPP - SOC Limit. ....................................................................................................................... 68.
14.6. BPP - SOH Limit. ....................................................................................................................... 68.
14.7. BPP - Pack Voltage Limit. .......................................................................................................... 68.
14.8. BPP - Contactor Release Inhibition. .......................................................................................... 69.

15. CDEM - Common Diagnostic Event Manager.
15.1. CDEM - Architecture Overview. ................................................................................................. 70.
15.2. CDEM - Function Description. ................................................................................................... 71.
15.3. CDEM_ErrDisp. ......................................................................................................................... 73.
15.4. CDEM_ReadStsAryCmd_P. ...................................................................................................... 73.
15.5. CDEM_Clear Status Array. ........................................................................................................ 73.
Page 4
16. DEH - Diagnostic Event Handling.
16.1. DEH - Function Overview ......................................................................................................... 75
16.2. DEH - Function Description ...................................................................................................... 75

17. BISC – Battery Current Sensor Communication.
17.1. BISC - Pack Current Measurements ........................................................................................ 77
17.2. BISC - Function Description ..................................................................................................... 77

18. BILC - Battery Current Limit Coordinator.
18.1. BILC - Function Description ...................................................................................................... 79
18.2. BILC - Over Current Function description ................................................................................ 80

19. EHPN - Electrical Hazard Protection Network (Insulation detection).
19.1. EHPN - ISO Function Description ............................................................................................. 81
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock) .......................... 85

20. SOX - Cell Balance:
20.1. SOX - Cell Balance Function description ................................................................................. 87
20.2. SOX - SOC Function description .............................................................................................. 88
20.3. SOX - SOH Function description .............................................................................................. 89
20.4. SOX - SOP Function Description .............................................................................................. 90

21. HW Crash Signal.
21.1. HW - crash Function description ............................................................................................... 91
21.2. Wakeup ..................................................................................................................................... 92
21.3. SFM - Safety Fault Monitoring .................................................................................................. 92
21.4. E2E Protection .......................................................................................................................... 92

22. BMS Diagnostics.
22.1. Diagnostics Implementation Architecture ................................................................................. 93

23. Mechanical Requirements.
23.1. Electromagnetic Compatibility .................................................................................................. 99
23.2. Electrostatic Discharge ............................................................................................................. 99
23.3. Climatic Requirements / Thermal Management ....................................................................... 99

24. Testing and Validation.
24.1. Proof of Compliance ............................................................................................................... 100
24.2. Testing Plan for BMS (DVP Plan) ........................................................................................... 100

25. Vehicle Requirement.
Page 5
List of Figures:

- Figure 1: BMS software startup sequence diagram appears on page 13.
- Figure 2: BMS wake-up run sequence diagram appears on page 14.
- Figure 3: BMS shutdown diagram is presented on page 15.
- Figure 4: Wake up BMS and turn on HV (power up) diagram is illustrated on page 16.
- Figure 5: Turn off HV (power down) diagram is displayed on page 17.
- Figure 6: Thermal control sequence diagram is explained on page 18.
- Figure 7: AC/DC charging sequence diagram can be found on page 19.
- Figure 8: Pre-conditioning wakeup flow chart is shown on page 20.
- Figure 9: BMS state flow diagram is discussed on page 25.
- Figure 10: Contactor control illustration is provided on page 29.
- Figure 11: HV_ON sequence diagram is detailed on page 31.
- Figure 12: HV_OFF sequence diagram is presented on page 32.
- Figure 13: HV measurement points are highlighted on page 38.
- Figure 14: Cell operation temperature visualization appears on page 41.
- Figure 15: NTC position in the module is shown on page 44.
- Figure 16: BTHM thermal control system diagram is demonstrated on page 49.
- Figure 17: Thermal loop in the vehicle is described on page 50.
- Figure 18: Over-current configuration is provided on page 69.
- Figure 19: CDEM architecture is outlined on page 70.
- Figure 20: DCEM code blocks are illustrated on page 72.
- Figure 21: DEM module function diagram is shown on page 75.
- Figure 22: Pack isolation detection is explained on page 82.
- Figure 23: Vehicle isolation detection is presented on page 82.
- Figure 24: HVIL mechanization is illustrated on page 85.
- Figure 25: Crash signal receiver hardware circuit is described on page 91.
- Figure 26: Diagnostics architecture is analyzed on page 93.
Page 6
Approval confirmed by:

- **BPC Head:** Stanislav Steve Nikulin  
- **Project Manager:** Trịnh Duy Hiệp  
- **Chief Engineer:** Şimşek Mustafa  
- **SW Manager:** Nguyễn Văn Tiệp  
- **Hardware Manager:** Đào Văn Quỳnh  
- **System Manager:** Rajendra Rajavelu  
- **ME Manager:** Hoàng Anh Tài  
- **Functional Safety Manager:** Rajendra Rajavelu  
- **High Voltage Attributes Manager:** Vũ Đức Phúc  
- **BMS Integration & Pack Level Test:** Nguyễn Văn Tiệp  
- **QA Leader:** Tạ Phi Hùng
Page 7
Approval confirmed by:
- Function: BPC Head | Name: Stanislav Steve Nikulin.
- Function: Project Manager | Name: Trịnh Duy Hiệp.
- Function: Chief Engineer | Name: Şimşek Mustafa.
- Function: SW Manager | Name: Nguyễn Văn Tiệp.
- Function: Hardware Manager | Name: Đào Văn Quỳnh.
- Function: System Manager | Name: Rajendra Rajavelu.
- Function: ME Manager | Name: Hoàng Anh Tài.
- Function: Functional Safety Manager | Name: Rajendra Rajavelu.
- Function: High Voltage Attributes Manager | Name: Vũ Đức Phúc.
- Function: BMS integration & Pack level test | Name: Nguyễn Văn Tiệp.
- Function: QA leader | Name: Tạ Phi Hùng.

Revisions since previous version:
Version 1.0 - First edition (11/2021).
Version 1.1 - Signed by Rajendra Rajavelu (03/2022).

Version 2.0 - Second edition. Changes include:
- Updated header with VinES logo, ID number, and footer to version 2.0.
- Corrected font styling; body set to Arial size 11, table set to size 10.
- Adjusted abbreviations (item 1.4) and vehicle variant (2.2).
- Added "Pre-conditioning Wakeup Flow Chart" as item 4.5.
- Enhanced thermal control, BMS wake-up, and low voltage monitoring functions in section 6.1.
- Updated degradation power function descriptions in section 6.1's BMS State Algorithms table.
- Corrected Figure 14, relating to cell operation temperature.
- Revised the signal I/O table descriptions for section 8.5 (BPIU – Cell Temperature Deviation).
- In section 10.4, added details about chiller ON/OFF mode and mass flowrate tables, as well as heating condition modes.
- Fixed spelling mistakes and restructured document layout.
Signed by Rajendra Hùng (05/2022).

Version 3.0 - Third edition. Modifications include:
- Added new abbreviations to the table.
- Updated BDU temperature limits in section 10.5 (BTHM).
- Enhanced description of VF8's SFC AC/DC charging profile in section 11.3 (BVC – Discharge power 3D data table).
Signed by Hùng (06/2022).

Version 3.1 updates:
- Revised power-up process diagram (section 4.1).
- Revised power-down process diagram (section 4.2).
- Enhanced HVAC thermal control (section 4.3).
- Updated AC/DC charging sequence diagram, including VCU_ACChgGunIn signal (section 4.4).
- Improved SFC Profile table Update (section 11.3).
Signed by Nguyễn Văn Tiệp (08/2022).
Page 8
1. General Document Guidelines.

1.1. Purpose.  
This version is a production version specification, which provides the information regarding the Battery Management System. This document consists of Battery Management System working concept explanation in detail with respect to the functionality built and signals used to communicate with other ECUs at different conditions. Currently, this document is made by considering the scope of requirements, but the details working concept will be verified and validated since this is the working concept, which is looked at the overall concept level.

1.2. Language.  
This document is written in English. All official project documentations must be written in English. If documents are bilingual, the English text is binding.

1.3. Obligation of Requirement Wording.  
The following wording rules are used throughout this document:  

| No | Terms          | Definition                                                                            |
|----|----------------|----------------------------------------------------------------------------------------|
| 1  | “Shall”        | The word “shall” be used to state a binding requirement. Such requirements are externally verifiable by manipulation or observation. |
| 2  | “Should”       | The word “should” be used for preferences or desires in implementation that are not strictly binding.  |
| 3  | “May”          | The word “may” be used to denote options that are left to the implementer.            |
| 4  | “Must”         | To denote legally binding requirements.                                               |
| 5  | “Shall NOT”    | Denotes an absolute prohibition.                                                      |
| 6  | “Cell”         | The word “may” be used to denote brick of cells in the battery pack.                  |
Page 9
1. General Document Guidelines.

1.1. Purpose.  
This version is a production version specification, which provides the information regarding the Battery Management System. This document consists of Battery Management System working concept explanation in details with respect to the functionality built and signals used to communicate with other ECU’s at different conditions. Currently this document is made by considering the scope of requirements, but the detailed working concept will be verified and validated, since this is the working concept, which is looked at the overall concept level.

1.2. Language.  
This document is written in English.  
All official project documentations must be written in English. If documents are bilingual, the English text is binding.

1.3. Obligation of Requirement Wording.  
The following wording rules are used throughout this document.  

| No | Terms          | Definition                                                                                                          |
|----|----------------|---------------------------------------------------------------------------------------------------------------------|
| 1  | “Shall”        | The word “shall” be used to state a binding requirement. Such requirements are externally verifiable by manipulation or observation. |
| 2  | “Should”       | The word “should” be used for preferences or desires in implementation that are not strictly binding.               |
| 3  | “May”          | The word “may” be used to denote options that are left to the implementer.                                         |
| 4  | “Must”         | To denote legally binding requirements.                                                                            |
| 5  | “Shall NOT”    | Denotes an absolute prohibition.                                                                                   |
| 6  | “Cell”         | The word “may” be used to denote brick of cells in the battery pack.                                               |

1.4. Abbreviations.  

List of Abbreviations:  

| Abbreviation | Definition                                                                 |
|--------------|-----------------------------------------------------------------------------|
| ASIC         | Application-Specific Integrated Circuit                                    |
| ASIL         | Automotive Safety Integrity Level                                         |
| ASW          | Application Software                                                      |
| AUTOSAR      | Automotive Software Architecture                                          |
| BCU          | Battery Control Unit                                                      |
| BDU          | Battery Distribution Unit                                                 |
| BMS          | Battery Management System (incl. sensors and actuators)                  |
| BOL          | Begin of Life                                                             |
| BSW          | Basic Software                                                           |
| CAN          | Controller Area Network                                                  |
| CAN NM       | CAN Network Management                                                   |
| CEB          | Cell Balancing                                                           |
| DCM          | Diagnostic Communication Module                                          |
| DEM          | Diagnostic Event Manager                                                 |
| DID          | Diagnostic Identifier                                                    |
| DTC          | Diagnostic Trouble Code                                                 |
| DUT          | Device Under Test                                                       |
| ECU          | Electronic Control Unit                                                 |
| EEPROM       | Electrically Erasable Programmable Read Only Memory                      |
| EOL          | End Of Life                                                              |
| EUT          | Equipment Under Test                                                    |
| FFI          | Freedom From Interference                                                |
| FIM          | Fault Inhibition Manager                                                |
| FRM          | Fault Reaction Matrix                                                   |
| FSC          | Functional Safety Concept                                               |
| FTTI         | Fault Tolerant Time Interval                                            |
| HVBP         | High Voltage Battery Pack                                               |
| HVIL         | High Voltage Interlock Loop                                             |
| HVSM         | High Voltage System Management                                          |
| HW           | Hardware                                                                 |
| ID           | Identification                                                           |
| IL           | Interface Layer                                                         |
| ISO          | Isolation                                                                |
| KL15         | Terminal for ignition (Clamp 15)                                        |
| KL30         | Terminal for permanent battery voltage (Clamp 30)                       |
| KL30C        | Terminal for switchable battery voltage for relay supply (Clamp 30C)    |
Page 10
### 1. General Document Guidelines

#### 1.1 Purpose
This version is a production version specification, which provides information regarding the Battery Management System. It includes a detailed explanation of the Battery Management System's working concept, functionality, and signals used to communicate with other ECUs under different conditions. 

Currently, this document is developed considering the scope of requirements. The detailed working concept will be verified and validated, as it outlines the overall concept level.

#### 1.2 Language
This document is written in English.  
All official project documentation must be written in English. If documents are bilingual, the English text is binding.

#### 1.3 Obligation of Requirement Wording
The following wording rules are used throughout this document:

| No | Terms       | Definition                                                                                                                                       |
|----|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 1  | "Shall"     | The word “shall” is used to state a binding requirement. Such requirements are externally verifiable by manipulation or observation.              |
| 2  | "Should"    | The word “should” is used for preferences or desires in implementation that are not strictly binding.                                             |
| 3  | "May"       | The word “may” is used to denote options left to the implementer.                                                                                |
| 4  | "Must"      | Denotes legally binding requirements.                                                                                                           |
| 5  | "Shall NOT" | Denotes an absolute prohibition.                                                                                                                |
| 6  | "Cell"      | The word “may” is used to denote a brick of cells in the battery pack.                                                                           |

---

### 1.4 Abbreviations

#### List of Abbreviations:

| Abbreviation | Definition                                                                                       |
|--------------|--------------------------------------------------------------------------------------------------|
| ASIC         | Application-Specific Integrated Circuit                                                         |
| ASIL         | Automotive Safety Integrity Level                                                               |
| ASW          | Application Software                                                                            |
| AUTOSAR      | Automotive Software Architecture                                                                |
| BCU          | Battery Control Unit                                                                            |
| BDU          | Battery Distribution Unit                                                                       |
| BMS          | Battery Management System (incl. sensors and actuators)                                         |
| BOL          | Begin of Life                                                                                   |
| BSW          | Basic Software                                                                                  |
| CAN          | Controller Area Network                                                                         |
| CAN NM       | CAN Network Management                                                                          |
| CEB          | Cell Balancing                                                                                  |
| DCM          | Diagnostic Communication Module                                                                 |
| DEM          | Diagnostic Event Manager                                                                        |
| DID          | Diagnostic Identifier                                                                           |
| DTC          | Diagnostic Trouble Code                                                                         |
| DUT          | Device Under Test                                                                               |
| ECU          | Electronic Control Unit                                                                         |
| EEPROM       | Electrically Erasable Programmable Read-Only Memory                                             |
| EOL          | End Of Life                                                                                     |
| EUT          | Equipment Under Test                                                                            |
| FFI          | Freedom From Interference                                                                       |
| FIM          | Fault Inhibition Manager                                                                        |
| FRM          | Fault Reaction Matrix                                                                           |
| FSC          | Functional Safety Concept                                                                       |
| FTTI         | Fault Tolerant Time Interval                                                                    |
| HVBP         | High Voltage Battery Pack                                                                       |
| HVIL         | High Voltage Interlock Loop                                                                     |
| HVSM         | High Voltage System Management                                                                  |
| HW           | Hardware                                                                                        |
| ID           | Identification                                                                                  |
| IL           | Interface Layer                                                                                 |
| ISO          | Isolation                                                                                       |
| KL15         | Terminal for ignition (Clamp 15)                                                                |
| KL30         | Terminal for permanent battery voltage (Clamp 30)                                               |
| KL30C        | Terminal for switchable battery voltage for relay supply (Clamp 30C)                            |
| KL31         | Terminal for power supply minus (Clamp 31)                                                      |
| LOI          | Letter of Intent                                                                                |
| LON          | Letter of Nomination                                                                            |
| LPF          | Latent Point Fault                                                                              |
| MCAL         | Microcontroller Abstraction Layer                                                               |
| MCU          | Module Control Unit                                                                             |
| NTC          | Negative Temperature Coefficient                                                                |
| OBC          | On Board Charger                                                                                |
| OBD          | On Board Diagnostics                                                                            |
| OT           | Over Temperature                                                                                |
| OTS          | Off Tools Samples                                                                               |
| OV           | Overvoltage                                                                                     |
| PCB          | Printed Circuit Board                                                                           |
| PTC          | Positive Temperature Co-efficient Heater                                                        |
| PWM          | Pulse Width Modulation                                                                          |
| QM           | Quality Management                                                                              |
| RAM          | Random Access Memory                                                                            |
| REESS        | Rechargeable Electrical Energy Storage System                                                   |
| RF           | Radio Frequency                                                                                 |
| ROM          | Read-Only Memory                                                                                |
| SeooC        | Safety Element Out Of Context                                                                   |
| SM           | Safety Mechanism                                                                                |
| SMD          | Surface-Mounted Device                                                                          |
| SOB          | Supplier on Board                                                                               |
| SOC          | State of Charge                                                                                 |
| SOF          | State of Function                                                                               |
| SOH          | State of Health                                                                                 |
| SOP          | State of Power                                                                                  |
| SPF          | Single Point Fault                                                                              |
| SW           | Software                                                                                        |
| TSC          | Technical Safety Concept                                                                        |
| UV           | Under Voltage                                                                                   |
Page 11
2. General Project Guidelines

2.1. Development Scope Abstract. 
This document details the technical requirements of the High Voltage Battery Pack Battery Management System, which will be used in the VF8 project of VinFast and its other brands. It also explains the functionality of the Battery Management System.
Page 12
2. General Project Guidelines

2.1. Development Scope Abstract.
This document details the technical requirements of the High Voltage Battery Pack Battery Management System, which will be used in the VF8 project by VinFast and their other brands. It also explains the functionality of the Battery Management System.

2.2. VF8 Variant.

Market Coverage: VN, EU, US, CA.

Features: VF8.

Variant Options: ECO and PLUS.

Both variants meet the EURO NCAP 5* standard for 2022.

**POWERTRAIN SYSTEM - Battery:**

1. **Battery Type:** Li-Ion for both variants.
2. **Battery Capacity (kWh) - Usable:** 82 kWh for both variants.
3. **Range per Full Charge (Km) (WLTP/NEDC):**
   - ECO: 445 km.
   - PLUS: 420 km.
4. **Charging Standard - Public Station:** Plug & Charge, Auto Charge for both variants.
5. **Portable charger (kW):** Available through Aftersales (VN) and YES (CA/US/EU).
6. **On-Board Charger (kW):**
   - SOP: 6.6 kW.
   - Post-SOP: 11 kW.
7. **Charging Mode - Fast Charge:** YES for both variants.
8. **Regeneration Mode (low/high):** YES (low, high) for both variants.
9. **Charging Time (h) - Normal Charging:**
   - SOP: <15 hours (6.6 kW OBC).
   - Post-SOP: <8 hours (11 kW OBC).
10. **Charging Time (m) - Fast Charging:** 24 minutes (10-70% SOC at 25°C) for both variants.
Page 13
3. BMS SW Components Sequence Diagram.

3.1. BMS Startup.

Figure 1: BMS SW Startup sequence diagram.

The STARTUP procedure consists of the following phases as per AUTOSAR. 
1. Initialization of all BSW and ASW software components. 
2. Pre-emptive startup task with 1ms and 10ms cycle time is scheduled on the master core during the startup phase.
Page 14
3. BMS SW components sequence diagram.

3.1. BMS Startup.

Figure 1: BMS SW Startup sequence diagram. The STARTUP procedure consists of the following phases as per AUTOSAR:
- Initialization of all BSW and ASW software components.
- Pre-emptive startup task with 1ms and 10ms cycle time is scheduled on the master core during the startup phase.

3.2. BMS Wake up Run Sequence.

Figure 2: BMS Wake-up Run Sequence diagram. All tasks will be running cyclically in the master and slave core.
Page 15
3. BMS SW components sequence diagram.

3.3. BMS Shutdown Sequence.

Figure 3 illustrates the BMS SHUTDOWN diagram. The SHUTDOWN procedure consists of the following phases as per AUTOSAR:
- CAN transceiver is switched off.
- Interrupts are disabled on the slave core.
- DEM operation cycle is stopped.
- DEM is shut down.
- Date and time are set in RTC.
- NVM_WriteAll() operation completes.
- If no wakeup is requested and NVM_WriteAll() is finished:
  - OS alarms are canceled.
  - TLF35584 is switched to standby mode.
- The ECU_AL_SwitchOff() action is performed, leading to Power Off state.
Page 16
4. Process Flow Charts.

4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram.
The sequence involves the following steps:
- BMS Wake up process begins.
- Initialization of power on and self-checking is performed.
- When the self-check passes, high voltage shall be turned on.
- Status updates during the sequence:
  - `BMS_HVOnOff_STS = 0 (HV off)`
  - `VCU_BMS_HVOnOff_Req = 1 (Allow)`
  - `BMS_HVOnOff_STS = 1 (HV Precharge)`
  - `BMS_HVOnOff_STS = 2 (HV On)`
  - Successful high voltage power up is achieved.
- KL15 Signal ON initiates CAN Network Management (CAN NM).
- Final stage confirms `BMS_Sys_STS` as Successful High Voltage Power Up.

Figure 4 illustrates the sequence diagram of Wake up BMS & Turn on HV (Power up) process, highlighting coordinated tasks between the BMS and VCU.
Page 17
4. Process Flow Charts.

4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram.
The Wakeup BMS and Turn on HV sequence involves the following steps:
- BMS initiates a wake-up process with KL15 Signal ON/CAN NM.
- Initialization of power-on and self-checking begins.
- If the self-check passes, high-voltage is allowed to be turned on.
- BMS_HVOnOff_STS transitions from 0 (indicating HV off) to 1 (indicating HV precharge).
- VCU_BMS_HVOnOff_Req is set to 1 (Allow).
- BMS_HVOnOff_STS transitions again from 1 (HV precharge) to 2 (HV on).
- BMS confirms a successful high-voltage power-up process.

Figure 4: Wake up BMS & Turn on HV (Power up) diagram.

4.2. Turn off HV (Power down) sequence diagram.
The Turn off HV sequence includes the following phases:
- The process begins with BMS in a successful high-voltage power-up state.
- VCU_BMS_HVOnOff_Req is set to 0 (forbid).
- BMS_HVOnOff_STS transitions from 2 (indicating HV on) to 0 (indicating HV off).
- BMS confirms a successful high-voltage power-down process.

Figure 5: Turn off HV (Power down) diagram.
Page 18
4. Process Flow Charts.

4.3. Thermal control HVBP sequence diagram.

Figure 6: Thermal control sequence diagram.
This sequence diagram outlines the thermal control process for the High Voltage Battery Pack (HVBP). It includes various activities such as waking up the Battery Management System (BMS), calculating the flow rate, checking the cooling and heating conditions, and calculating cooling and heating power demand. The diagram uses CAN signals to determine actions such as turning on/off the Chiller and Positive Temperature Coefficient (PTC) heater based on temperature differences and specific modes like Online, DC Charge, AC Charge, and others.

The figure also contains key temperature criteria:
- Chiller ON conditions, with maximum and minimum thresholds.
- PTC ON conditions, showing the limits for activation across different modes.

It visually represents how the BMS coordinates with the Vehicle Control Unit (VCU) for efficient thermal management during operation.
Page 19
### 4. Process Flow Charts

#### 4.1. Wakeup BMS & Turn on HV (Power up) sequence diagram
The process begins with the BMS wake-up and proceeds through initialization of power-on and self-checking. Once the self-check passes, high voltage is turned on. Key steps in the sequence include the following transitions:
- `BMS_HVOnOff_STS = 0` (HV off) before checking.
- `VCU_BMS_HVOnOff_Req = 1` (Allow) signals HV precharge.
- `BMS_HVOnOff_STS = 1` indicates HV Precharge.
- `BMS_HVOnOff_STS = 2` switches HV On.
- The sequence ends with successful high voltage power-up and the system state updated.

Figure 4: Wake up BMS & Turn on HV (Power up) diagram visually represents this process.

---

#### 4.2. Turn off HV (Power down) sequence diagram
The sequence begins with successful high voltage power-up and transitions into the power-down process. Key events include:
- `VCU_BMS_HVOnOff_Req = 0` (Forbid) triggers HV off state.
- `BMS_HVOnOff_STS = 2` signals HV On before turning HV off.
- `BMS_HVOnOff_STS = 0` reflects HV off state.
- The sequence concludes with `BMS_Sys_STS` indicating successful high voltage power-down.

Figure 5: Turn off HV (Power down) diagram provides a visual representation of the process.

---

#### 4.3. Thermal control HVBP sequence diagram
The BMS wake-up initiates thermal control operations. Key actions include:
- Calculating flow rate (`BMS_FlowRate_Req`) and evaluating cooling or heating conditions.
- Engaging cooling mode via `VCU_BMS_ValveOnOff_Req = 1` if conditions are met.
- Engaging heating mode via `VCU_BMS_PTCOnOff_Req = 1` based on requirements.
The sequence dynamically monitors CAN signals and adjusts chiller or PTC status as per temperature.

Figure 6: Thermal control sequence diagram visually represents these operations.

---

#### 4.4. AC/DC Charging sequence diagram
The charging process follows these steps:
1. **Initialization:** BCU and VCU wake up, and the BMS checks self-status (`BMS_Sys_STS = SelfCheck passes, can be HV`).
2. **HV Activation Mode:** Signals (`VCU_BMS_HVOnOff_Req = 1`) initiate HV Precharge (`BMS_HVOnOff_STS = 1`) and HV On (`BMS_HVOnOff_STS = 2`).
3. **Charging Mode:** BMS calculates and requests charge current (`BMS_ChgCurrent_REQ`) and voltage (`BMS_ChgVoltage_REQ`).
4. **Termination:** When completed or forbidden (`VCU_ChargeAllow = 0`), the process transitions into power-down (`BMS_Sys_STS = 4`) via HV off (`BMS_HVOnOff_STS = 0`).
5. **Standby IG Off:** Final steps ensure all processes are terminated and gun disconnected (`VCU_DCChgGunIn = 0`).

Figure 7: AC/DC charging sequence diagram illustrates these detailed operations.
Page 20
### 4.5. Pre-conditioning Wakeup Flow Chart

**Figure 8: Pre-conditioning Wakeup Flow Chart**

The flow chart outlines the sequence for pre-conditioning wakeup when the vehicle is parked and unplugged, initiating the Battery Management System (BMS) internal wakeup process. Specific steps include:

1. The vehicle is parked and unplugged, with the BMS in its asleep state.
2. **Timer check:** If the timer exceeds 30 minutes, the BMS initiates an internal wake-up; otherwise, it remains asleep.
3. **BMS minimum cell temperature check:** If the minimum cell temperature is below -10°C, the system proceeds to wakeup; otherwise, the BMS returns to its asleep state.
4. **State of Charge (SOC) check:** 
   - If SOC is greater than 30%, the BMS wakes up the network and requests heating through the Vehicle Control Unit (VCU).
   - If SOC is less than 30%, the wakeup sequence is halted.
5. **Heating process through VCU:**
   - The VCU triggers the Positive Temperature Coefficient (PTC) heater.
   - Heating consumes High Voltage Batteries (HVB), increasing the temperature by 2 minutes per 1°C increment.
6. **SOC re-evaluation:** 
   - If SOC drops below 30% during heating, the VCU stops heating and the system proceeds to evaluate the temperature to determine if it meets the calibration range (Temp ≥2-9).
   - The BMS may return back to sleep mode after reaching a calibrated temperature.
7. The process ends with an open item for "Sleeping back," ensuring a conditional resting mode for the BMS.

This diagram visually represents the logic and condition-based operations required for pre-conditioning the wakeup state of the system.
Page 21
5. BMS - Non Functional Architecture Description.

5.1. Assumption: BMS Functional Content with following conditions:
- Charging communication to the EVSC shall be managed by VCU with charging parameters provided by the BMS.
- Pyro-fuse is not connected to BMS and will be controlled by ACM.
- HVIL is not detected by any other ECU’s.
- HW Crash PWM signal is detected by the BMS.
- MSD – Power is turned off abruptly no detection of MSD.
- THR – Thermal Runaway is only detection no protection.
- Coolant Leakage: No coolant leakage detection supported.
- No Humidity/Gas/Pressure sensor inside the battery pack.
- No condensation detection function inside the BMS.
- No Altitude and pressure detection function inside the BMS.
- No Fire detection and prevention functionality built in BMS.
- Cell is considered as EUCAR Level ≤ L4.
- Only for Nail penetration & Thermal stability heating rate @ 5℃/min + Stay 30min @ 180℃ all these condition EUCAR Level ≥ L5.
- Module NTC shall measure the temperature from -40℃ to +125℃.
- Thermal Runaway detection is made when the contactor is at closed state or KL15 has to be in ON state.

5.2. Pack Power Map parameters:
Refer to the VF8_HVBP_Power_Map.xlsx.

5.3. HVBP Threshold calibration parameters:
Refer to the VF8_HVBP_Calib_Protect_Threshold_V5.2.xlsx.
Page 22
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.

Table 1: BMS Function list.

1. Contactor Control (HV-plus, HV-minus, Pre-charge):
   - Open/close contactors dependent on battery state request.
   - Pre-charge control monitors the pre-charge procedure (voltage gradients, absolute & relative voltage limits, current, flow, pre-charge resistor temperature).
   - Output current battery state (e.g. offline, pre-charge, connect, online, shutoff, disconnect).
   - Contactor diagnosis (stuck open, stuck close).
   - Calculate and track contactor aging individually for each contactor.
   - Switch each contactor separately, service mode.
   - Monitor pack voltage and DC-Link voltage.

2. Thermal Control:
   - Electrical diagnosis and data conversion of battery module temperature measurements.
   - Electrical diagnosis and data conversion of auxiliary temperature measurements.
   - Diagnosis of temperature spread in the battery modules (plausibility check) and the temperature spread in the whole battery pack.
   - Calculate the minimum temperature in the pack, maximum temperature in the pack, and average pack temperature.
   - Thermal control function provides requests for actuators in the battery thermal system (shall be based on CAN).
   - Requests are calculated based on the current battery state and measured temperatures.
   - The thermal demand is provided to VCU, which controls the thermal system to meet the demand.

3. Electrical Hazard Protection:
   - Calculation of isolation resistance between the battery and vehicle ground.
   - Passive method based on switching of high-accuracy resistors is used.
   - HV interlock function based on PWM (current) signal.

4. Battery Protection:
   - Includes generic diagnosis and protection functions such as:
       - Current limit.
       - Pack resistance limit.
       - Current sensor plausibility.
       - Voltage acquisition plausibility.
       - Cell voltage limit.

5. History/Warranty:
   - Save specified battery states throughout the whole battery lifecycle.
   - Total energy charged and discharged.
   - Minimum and maximum cell voltage.
   - Minimum and maximum state of charge.
   - Last critical errors leading to a shutdown of the battery.
   - Service-life counter for circuit breakers (refer to Contactor Control function).

6. Diagnostic Event Handler:
   - Determines the global battery error level (severity 0 to 7).
   - Based on error entry information, define related system reactions depending on severity level.
   - Responses can range from emergency disconnect to a warning only.
Page 23
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.
Table 1: BMS Function list.

**Function Group: Contactor Control (HV-plus, HV-minus, Pre-charge).**
- Open/close contactors dependent on battery state request.
- Pre-charge control, monitors the pre-charge procedure including voltage gradients, absolute and relative voltage limits, current, flow, and pre-charge resistor temperature.
- Outputs current battery state such as offline, pre-charge, connect, online, shutoff, disconnect, etc.
- Diagnoses contactor conditions (e.g., stuck open, stuck close).
- Calculates and tracks individual contactor aging.
- Separately switches each contactor; service mode included.
- Monitors pack voltage and DC-Link voltage.

**Function Group: Thermal Control.**
- Involves electrical diagnosis and data conversion of battery module temperature measurements.
- Converts auxiliary temperature measurements for electrical diagnosis.
- Diagnoses temperature spread within battery modules (plausibility check) and throughout the entire battery pack.
- Computes minimum, maximum, and average temperature in the battery pack.
- Provides thermal control requests to battery thermal actuators based on CAN communication. Requests are made based on current battery state and measured temperatures, with thermal demand transferred to VCU for control.

**Function Group: Electrical Hazard Protection.**
- Calculates isolation resistance between battery and vehicle ground using passive methods based on high-accuracy resistors.
- Enables HV interlock using a PWM (current) signal.

**Function Group: Battery Protection.**
- Includes generic diagnosis and protection functions such as current limit, pack resistance limit, current sensor plausibility, voltage acquisition plausibility, and cell voltage limit.

**Function Group: History / Warranty.**
- Saves specified battery states throughout battery lifecycle.
- Tracks total energy charged and discharged.
- Records minimum and maximum cell voltage, as well as state of charge values.
- Documents critical errors that led to battery shutdowns.
- Maintains a service-life counter for circuit breakers (related to contactor control).

**Function Group: Diagnostic Event Handler.**
- Determines the global battery error level (severity 0 to 7).
- Defines system reactions based on severity (e.g., emergency disconnect or warning messages).

---

CSC(MCU) control module.
- Handles CSC initialization and start-up.
- Commands CSCs to enter measurement mode.
- Commands balancing actions for CSCs.
- Diagnoses CSC communication.

**BMS Wakeup:**
- KL15 Wakeup management.
- CAN NM Wakeup processing.
- BMS sleep-mode wakeup for pre-condition checks.

**Low Voltage Monitoring:**
- Continuously monitors LV power supply; protective measures are activated if operation voltages exceed limits.

---

Table 2: BMS State algorithms.

**Function Group: SOC.**
- Performs model-based State-Of-Charge estimation.
- Estimates SOC at module level in percentages.
- Computes delta SOC estimation for individual cells in percentages.
- Determines SOC at pack level based on SOC estimates of individual cells.

**Function Group: SOF.**
- Performs model-based State-Of-Function calculations.
- Calculates battery current limits for short-term pulses with minimum and maximum values in amperes, tailored for charging processes.
- Predicts battery voltages for maximum charge and discharge with maximum and minimum values in volts.
- Determines power limitations using calculated current limits and voltage predictions.
- Adjusts power degradation based on BDU temperature increases.

**Function Group: SOH.**
- Computes State-of-Health.
- Determines module capacity as a minimum function (available capacity in Ah provided if necessary).
- Assesses maximum module resistance as a function (available resistance in mΩ output if required).
- Accounts for deviations in SOC and resistance in the modules compared to cell-to-cell estimates.

**Cell wear detection:**
- Reports anomalies to error management.
- Detects SOC or resistance outliers compared to module averages.

**Cell balancing (Passive):**
- Requests balancing based on delta SOC, temperature, voltage, and pack current.
- Operates balancing within defined boundaries of current, voltage, and temperature conditions.
Page 24
6. HVBP - Functional Architecture Description.

6.1. BMS Function List.
Table 1: BMS Function list.

Function Group:
Description:

- **Contactor Control (HV-plus, HV-minus, Pre-charge):**
  - Open/close contactors dependent on battery state request.
  - Pre-charge control – monitors the pre-charge procedure (voltage gradients, absolute & relative voltage limits, current, flow, pre-charge resistor temperature).
  - Output current battery state (e.g. Offline, pre-charge, connect, online, shutoff, disconnect…).
  - Contactor diagnosis (stuck open, stuck close).
  - Calculate and track contactor aging individually for each contactor.
  - Switch each contactor separately, service mode.
  - Monitor pack voltage and DC-Link voltage.

- **Thermal Control:**
  - Electrical diagnosis and data conversion of battery module temperature measurements.
  - Electrical diagnosis and data conversion of auxiliary temperature measurements.
  - Diagnosis of temperature spread in the battery modules (plausibility check) and temperature spread in the whole battery pack.
  - Calculation of minimum temperature in the pack, maximum temperature in the pack and average pack temperature.
  - Thermal control function provides requests for actuators in the battery thermal system (shall be based on CAN). Requests are calculated based on current battery state and measured temperatures. The thermal demand is provided to VCU and the VCU controls the thermal system to meet the demand.

- **Electrical Hazard Protection:**
  - Calculation of isolation resistance between the battery and vehicle ground. Passive method based on switching of high accurate resistors is used.
  - HV interlock function based on PWM (current) signal.

- **Battery Protection:**
  - Includes all generic diagnosis and protection functions, e.g.: current limit, pack resistance limit, current sensor plausibility, voltage acquisition plausibility, cell voltage limit, etc.

- **History / Warranty:**
  - Save specified battery states throughout the whole battery life cycle:
    - Total energy charged and discharged.
    - Minimum and maximum cell voltage.
    - Minimum and maximum state of charge.
    - Last critical errors leading to a shutdown of the battery.
    - Service-life counter for circuit breakers (see also contactor control function).

- **Diagnostic Event Handler:**
  - Determines the global battery error level (severity 0 to 7) dependent on error entry information and defines related system reaction depending on severity level (e.g. emergency disconnect or warning only).

Table 2: BMS State algorithms.

Function Group:
Description:

- **SOC:**
  - Model-based State-Of-Charge estimation:
    - SOC estimation on module level in [%].
    - Delta SOC estimation per cell in [%].
    - SOC estimation on pack level based on estimated SOC of cells in [%].

- **SOF:**
  - Model-based State-Of-Function calculation including:
    - Battery current limit calculation for short-term pulses (min/max values in [A]), which should be used for the charging process.
    - Battery voltage prediction for max. charge and discharge (max/min values in [V]).
    - Power limitations shall be determined by the calculated current limit and voltage prediction.
    - Degradation of power according to the BDU temperature raise.

- **SOH:**
  - Calculation of State-of-Health as:
    - A function of minimum module capacity in [-] (capacity in [Ah] is available as an output if required).
    - A function of maximum module resistance in [-] (resistance in [mΩ] is available as an output if required).
    - A function of cell-to-cell differences (deviation in SOC and resistance compared to module estimates) in the modules.

- **Cell Wear Detection:**
  - Reporting to error management if detecting outlier of SOC or resistance values of a cell compared to the average in a module.

- **Cell Balancing (passive):**
  - Request balancing based on delta SOC, temperature, voltage of the cells, and pack current.
  - Balancing is carried out if the operation is within the determined boundary of current, voltage, and temperature.

Table 3: BMS Safety Function List.

Function Group:
Description:

- **Module Controller Control Monitoring:**
  - Verify correct module and cell configuration in the system.
  - Continuously monitor the safe operation of the module controllers.

- **Cell Temperature Monitoring:**
  - Verify the integrity of cell temperature measurements received from MCUs.
  - Detect cell temperatures out of the safe range.
  - Calculate and provide temperature information to current/cell voltage limitation.
  - Predict thermal event from temperature gradient.

- **Cell Voltage Monitoring:**
  - Verify the integrity of cell voltage measurements received from MCUs.
  - Detect cell voltages out of safe range.
  - Verify the integrity of pack voltage measurement.
  - Determine the safe pack voltage information to external elements.

- **Electrical Hazard Protection Monitoring:**
  - Maintain HVIL and isolation resistance errors.
  - Ensure safe power down in case of vehicle crash.

- **Pack Current Monitoring:**
  - Verify the integrity of pack current measurements received from redundant sensors.
  - Determine the safe pack current information and provide it to external elements.
  - Detect overcurrent during charging and discharging.
  - Calculate the energy flow through the current path and detect if it exceeds the safe limit.
  - Determine contactor release inhibition based on fuse characteristics.
    - Boundary condition: Pack current is measured redundantly by independent current sensors.
    - Main Fuse is inserted to disconnect the circuit in case of high currents, when the contactors could weld.

- **Fault Reaction Monitoring:**
  - Collect and maintain fault information received from safety functions and determine the fault reaction (safe state reaction).
  - Provide fault information to external elements.

- **Contactor Transition Control Monitoring:**
  - Maintain safe state reaction by controlling contactor drivers with control commands.
  - Determine safe contactor control command for HV Battery deactivation considering contactor release inhibition.
  - Determine safe contactor control command for HV Battery activation.
    - Boundary condition: Main Fuse is inserted to disconnect the circuit in case of high currents, when the contactors could weld.

- **CAN Diagnostics Monitoring:**
  - Continuously check the received safety-relevant CAN messages for correct transmission.
  - Check the state of CAN communication.

- **Level 1 Interface Monitoring:**
  - Maintain an interface between Level 1 and Level 2 software and route the signals necessary for safety monitoring to their respective functions.
Page 25
6.2. BMS State Transition Control (BSTC).

Figure 9: BMS State Flow. This section describes the functionality of battery state transition control. This module handles the state of the battery control unit.

There are five possible states:

**Startup:**  
During the "startup" phase, all initialization procedures are done. During the "startup" phase, all main contactors are open. When all initialization procedures are finished and the wake signal is on (e.g., ignition key is on and a valid activation command is sent by the vehicle), the BCU state changes to the state "run."

**Run:**  
During the “run” phase, the battery is in normal operation mode. The main contactors connect the battery to the load circuit. This is the main operation mode of the BCU. When the wake signal is removed (e.g., ignition key is turned off or the activation command is removed by the vehicle), the main contactors are opened, and the BCU state changes to the state “power latch.”

**Power Latch:**  
Power latch involves disabling the module controllers (MCs).

**Wait:**  
The "wait" state allows for mode transitions.

**Shutdown:**  
During the shutdown state, data is written into memory, and the power supply is disabled.
Page 26
During the “power latch” phase, all module controllers are shut down by the BCU. A counter begins to run, and when the counter reaches zero, the BCU shuts down.

**Wait:**  
During the “wait” phase, the BCU waits for a timer to expire before initiating the power-down sequence.

**Shutdown:**  
During the “shutdown” phase, all NVM variables are saved to the non-volatile memory. Following this, the BCU powers off.

Additionally, this module handles the functionality to close and open the main contactors. It controls the BCU’s power supply, performs voltage measurements of the power supply, and oversees the watchdog function (if an external watchdog is utilized).

Furthermore, this module calculates the duration for which the battery remained powered on and off.

**Contactor Control (HV-Plus, HV-minus, Pre-charge):**  
This functionality pertains to the management of contactor controls.
Page 27
6.3. BSTC – HVBP Operation System Status.

When the BMS starts, it sends the system status information according to the data collected from actuators and sensors. During startup, the BMS performs self-check requirements and requires communication with the BCU, MCU, ROM, RAM, and other components for self-test to ensure no fault. All LPF and necessary SPF are checked during the startup phase.

### Signal I/O
**Name:** BMS_Sys_STS  
**Description:** BMS_Status (Self-test after BMS wake-up).  
**Min:** 0  
**Max:** 15  
**Value Description:**  
- 8: Invalid;  
- 7: Failure, unable to operate;  
- 6: BCU Sleep mode;  
- 5: Wait for Successful Power Down;  
- 4: Power latch process;  
- 3: Successful Power Down of HV;  
- 2: Successful High Voltage Power Up;  
- 1: Self-check passed can be HV on;  
- 0: Init of power on self-checking.  
**Sender:** BMS  
**Receiver:** VCU  

The BMS_Sys_STS signal values are changed as per the voltage, temperature, and current monitoring of the pack. According to the input, the signal state transition is performed.

### Table 4: BMS System Status Description
**BMS_Sys_STS** | **Description**
---------------- | ------------------------------------------------------------------------------  
0                | Startup state of the system and initialization is in progress.  
1                | Initialization is completed successfully and ready to receive commands and process the requests from other ECU’s.  
2                | When the high voltage power-up of the contactor is successful. VCU sends VCU_BMS_HVOnOff_REQ = 1 (allow).  
3                | When the high voltage power-down of the contactor is successful. VCU sends VCU_BMS_HVOnOff_REQ = 0 (forbid).  
4                | Power latch state or BCU sleep state. After each RUN mode, the BMS system enters the power latch state by enabling a shutdown timer.  
5                | Shutdown process is initiated. It needs time to write data to NVM.  
6                | Wait state of the BCU. Please refer to the BCU_StateControl transitions diagram.  
7                | If any sensor is not working and the initialization has issues.  
8                | Invalid.  

When the BMS system status is **BMS_Sys_STS = 1**, then only the BMS accepts the requests of other ECU’s. Otherwise, it initializes the system, and if there is a problem during self-check, the BMS_Sys_STS = 7.

The BMS wake-up process should initiate self-checking within ~100ms (calibration). During self-checking, the BMS sends **BMS_Sys_STS = 0**. After the self-checking is finished, the BMS status transitions to **BMS_Sys_STS = 1**.
Page 28
6.2. BMS State Transition Control (BSTC).

During the “power latch” phase, all module controllers will be shut down by the Battery Control Unit (BCU). A counter starts to run, and when it reaches 0, the BCU is shut down. 

Wait.
During the “wait” phase, the BCU waits for a timer to run out before initiating the power-down sequence.

Shutdown.
During the “shutdown” phase, all Non-Volatile Memory (NVM) variables are saved to memory, and the BCU is shut off. Additionally:
- The module requests the closing and opening of main contactors.
- Controls the BCU power supply including voltage measurement and watchdog function control (if an external watchdog is used).
- It calculates the amount of time the battery was switched on and off.

Contactor Control (HV-Plus, HV-minus, Pre-charge).

6.3. BSTC – HVBP Operation System Status.

When the BMS starts, it sends system status information based on collected data from actuators and sensors.  
- Self-check requirements include communication with BCU, MCU, ROM, RAM, and other components to ensure no faults.
- During startup, Low Priority Faults (LPF) and Safety Priority Faults (SPF) are checked.

### Signal I/O
| Name            | Description                               | Min | Max | Value Description                                                                                                                       | Sender | Receiver |
|------------------|------------------------------------------|-----|-----|-----------------------------------------------------------------------------------------------------------------------------------------|--------|----------|
| BMS_Sys_STS     | BMS Status (Self-test after BMS wake-up) | 0   | 15  | 8: Invalid; 7: Failure, unable to operate; 6: BCU Sleep mode; 5: Wait for Successful Power Down; 4: Power latch process; 3: Successful Power Down of HV; 2: Successful High Voltage Power Up; 1: Self-check passed, can be HV ON; 0: Init of power-on self-checking. | BMS    | VCU      |

The BMS_Sys_STS signal values transition based on voltage, temperature, and current monitoring.

### Table 4: BMS System Status Description
| BMS_Sys_STS | Description                                                                                                     |
|--------------|-----------------------------------------------------------------------------------------------------------------|
| 0            | Startup state of the system and initialization is in progress.                                                |
| 1            | Initialization completed successfully. Ready to receive commands and process requests from other ECUs.       |
| 2            | High voltage power-up of the contactor successful; VCU sends VCU_BMS_HVOnOff_REQ = 1 (allow).                 |
| 3            | High voltage power-down of the contactor successful; VCU sends VCU_BMS_HVOnOff_REQ = 0 (forbid).              |
| 4            | Power latch state or BCU sleep state. After each RUN mode, the BMS enters power latch with a shutdown timer.  |
| 5            | Shutdown process initiated; requires time to write data to NVM.                                              |
| 6            | Wait state of the BCU. Refer to BCU_StateControl transition diagrams.                                         |
| 7            | Initialization issue or sensor failure.                                                                      |
| 8            | Invalid.

When the BMS_Sys_STS = 1, the system accepts requests from other ECUs. If the status is not 1 or during a self-check failure, the status becomes BMS_Sys_STS = 7.

Upon wakeup, the BMS performs self-checking within ~100 ms (calibration). It initially sends BMS_Sys_STS = 0 and later transitions to BMS_Sys_STS = 1 once completed.

Note:
- The VCU checks that the BMS_Sys_STS = 1 before sending the following commands:
  - VCU_BMS_HVOnOff_REQ = 1 (Turn HV ON).
  - VCU_BMS_HVOnOff_REQ = 0 (Turn HV OFF).
- The BMS provides feedback on the high voltage sequence status over CAN:
  - BMS_HVOnOff_STS = 0 (HV OFF).
  - BMS_HVOnOff_STS = 1 (Pre-charge).
  - BMS_HVOnOff_STS = 2 (HV ON).
Page 29
7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge)

7.1. CTC - Function Description.

This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

Figure 10: Contactor Control.

The following battery states are implemented according to the states of the contactor:

**Offline (State 1).**  
All contactors are open. Load circuit voltage is below target pre-charge voltage.

**Pre-charge (State 2).**  
Negative(B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

**Connect (State 3).**  
Positive contactor (B+) is closed and pre-charge contactor opened.

**Online (State 4).**  
Positive (B+) and negative (B-) contactors are closed. The battery is ready for normal operation.
Page 30
7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge).

7.1. CTC - Function Description.

This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

Figure 10: Contactor Control.

The following battery states are implemented according to the states of the contactor:

**Offline (State 1).**
All contactors are open. Load circuit voltage is below target pre-charge voltage.

**Pre-charge (State 2).**
Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

**Connect (State 3).**
Positive contactor (B+) is closed and pre-charge contactor opened.

**Online (State 4).**
Positive (B+) and negative (B-) contactors are closed. Battery is ready for normal operation.

**Shutoff (State 5).**
To avoid electric arcs upon contactor opening, it is necessary to ensure there is no current flow. The shutoff state allows the HV components to smoothly ramp down the current flow (if necessary).

**Disconnect (State 6).**
All closed contactors are opened.

**DC-charge (State 8).**
Control of contactors needed for DC-charging.

**Charge (State 9).**
The optional contactor diagnosis marginally alters the contactor switching sequences to check if any contactor is stuck either in open or closed state.

**Emergency Disconnect (State 10).**
All contactors are opened immediately despite actual current flow and previous battery state. This state should only be executed upon critical errors.

**Service Mode (State 20).**
This state can only be accessed by using a service or calibration tool. Each contactor can manually be operated for testing purposes.

Each battery state shall be identified by a unique battery state ID.
Page 31
### 7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge)

#### 7.1. CTC - Function Description
This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

#### Battery States Implemented by Contactor Control:

**Offline (State 1):**  
All contactors are open. Load circuit voltage is below the target pre-charge voltage.

**Pre-charge (State 2):**  
Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.

**Connect (State 3):**  
Positive contactor (B+) is closed and pre-charge contactor opened.

**Online (State 4):**  
Positive (B+) and negative (B-) contactors are closed. Battery is ready for normal operation.

**Shutoff (State 5):**  
To avoid electric arcs upon contactor opening, it is necessary to ensure there is no current flow. The shutoff state allows the HV components to smoothly ramp down the current flow if necessary.

**Disconnect (State 6):**  
All closed contactors are opened.

**DC-charge (State 8):**  
Contactors are controlled for DC-charging processes.

**Charge (State 9):**  
Optional contactor diagnosis marginally alters the contactor switching sequences to check if any contactor is stuck either in open or closed state.

**Emergency Disconnect (State 10):**  
All contactors are opened immediately despite actual current flow and previous battery state. This state should only be executed upon critical errors.

**Service Mode (State 20):**  
This state can only be accessed by using a service or calibration tool. Each contactor can be manually operated for testing purposes.

---

### 7.2. CTC - Contactor Closing

#### Overview of HV_ON Sequence:
When the BMS receives `VCU_BMS_HVOnOff_REQ=allow`, the BMS proceeds to close the HV relay. Before closing, diagnostic checks are applied to the pre-charge relay. The sequence is outlined below:

1. **Pre-charge Relay Diagnostics:**  
   Diagnostics of the pre-charge relay are performed by closing and opening the relay, transitioning `BMS_HVOnOff_STS=pre-charge`.

2. **Negative Relay Closure:**  
   The BMS closes the negative relay first. Once the negative relay is closed (`BMS_TotalNegRelay_STS=closed`), the BMS closes the pre-charge relay (`BMS_PreChgRelay_STS=closed`).

   - **Key Checks:**
     - Refer to Section “CTC Pre-charge check.”
     - Pre-charge timeout is set to 500ms (reference).
     - If pre-charging fails to reach the expected end condition for three consecutive cycles, the state transitions to `BMS_HVOnOff_STS=Fail to HV on`.

3. **Positive Relay Closure:**  
   After completing pre-charge, the BMS closes the positive relay (`BMS_MainPosRelay_STS=closed`), and the pre-charge relay is opened (`BMS_PreChgRelay_STS=open`).

4. **Completion:**  
   With the pre-charge relay opened, the `BMS_HVOnOff_STS=HV ON`, indicating the process of powering on is complete.

#### Figure 11: HV_ON Sequence:
The figure visually demonstrates the sequence of transitions for safely activating the high voltage contactors by the BMS.

---
Page 32
### 7.3. CTC - Contactor Opening

**Figure 12: HV_OFF Sequence**

When BMS receives `VCU_BMS_HVOnOff_REQ=forbid`, the BMS shall open the HV relay. The sequence is shown above and explained below:

- **Step 1:** The BMS should open the positive relay first. When the positive relay is opened (`BMS_MainPosRelay_STS=open`), the status changes to `BMS_HVOnOff_STS=HVoff`.
- **Step 2:** The BMS should then open the negative relay (`BMS_TotalNegRelay_STS=Open`).
- **Step 3:** When the voltage is lower than 90% of the bus total voltage, the BMS determines that the high-voltage relay has been completely disconnected.

**Error Condition:**  
If a relay is faulty, the BMS should send the following error messages:  
- `BMS_MainPosRelay_ERR=Error`  
- `BMS_TotalNegRelay_ERR=Error`  
- `BMS_PreCrgRelay_ERR=Error`

**Additional Monitoring:**  
- High-side and low-side drivers should drive the relay during operation.  
- The BMS needs to detect contactor faults, such as stuck or open states.  
- During charging or discharging states, the BMS shall monitor the feedback and check for faults in the low-side driver.
Page 33
7. CTC - Contactor Transition Control (HV-plus, HV-minus, pre-charge)

### 7.1. CTC - Function Description
This module controls the high voltage contactors based on battery state requests and can execute several diagnoses during the miscellaneous battery states. The main control variable is the battery state request, which induces the contactor control module to switch the contactors in order to attain the requested battery state.

#### The following battery states are implemented according to the states of the contactor:
- **Offline (State 1):** All contactors are open. Load circuit voltage is below target pre-charge voltage.
- **Pre-charge (State 2):** Negative (B-) and pre-charge contactors are closed to pre-charge the load circuit without inducing current flow peaks.
- **Connect (State 3):** Positive contactor (B+) is closed and pre-charge contactor opened.
- **Online (State 4):** Positive (B+) and negative (B-) contactors are closed. Battery is ready for normal operation.
- **Shutoff (State 5):** To avoid electric arcs upon contactor opening, it is necessary to ensure there is no current flow. The shutoff state allows the HV components to smoothly ramp down the current flow (if necessary).
- **Disconnect (State 6):** All closed contactors are opened.
- **DC-charge (State 8):** Control of contactors needed for DC-charging.
- **Charge (State 9):** The optional contactor diagnosis marginally alters the contactor switching sequences to check if any contactor is stuck either in open or closed state.
- **Emergency Disconnect (State 10):** All contactors are opened immediately despite actual current flow and previous battery state. This state should only be executed upon critical errors.
- **Service Mode (State 20):** This state can only be accessed by using a service or calibration tool. Each contactor can manually be operated for testing purposes.

#### Note:
Each battery state shall be identified by a unique battery state ID.

---

### 7.2. CTC - Contactor Closing
When BMS receives `VCU_BMS_HVOnOff_REQ=allow`, then the BMS should close the HV relay. Before closing, it performs diagnostics on the pre-charge relay.

#### Sequence Explanation:
1. **Diagnostics:** Diagnostics of the pre-charge relay is done by closing and opening the relay. The `BMS_HVOnOff_STS=pre-charge`.
2. **Negative Relay Closing:** After diagnostics, BMS should close the negative relay first. When the negative relay is closed (`BMS_TotalNegRelay_STS=closed`), then BMS closes the pre-charge relay (`BMS_PreChgRelay_STS=closed`).
   - Reference the CTC Pre-charge check section.
   - The timeout for the pre-charge state shall finish within 500ms.
   - If 3 consecutive cycles fail to reach end condition, the process is considered failed (`BMS_HVOnOff_STS=Fail to HV On`).
3. **Positive Relay Closing:** Once pre-charge is finished, BMS shall close the positive relay. After closing the positive relay (`BMS_MainPosRelay_STS=closed`), BMS opens the pre-charge relay (`BMS_PreChgRelay_STS=open`).
4. **Completion:** When the pre-charge relay is opened, the process of power-on is finished, and the `BMS_HVOnOff_STS=HV ON`.

---

### 7.3. CTC - Contactor Opening
When BMS receives `VCU_BMS_HVOnOff_REQ=forbid`, then the BMS should open the HV relay:

#### Sequence Explanation:
1. **Positive Relay Opening:** BMS should open the positive relay first. Upon opening, the `BMS_MainPosRelay_STS=open` and `BMS_HVOnOff_STS=HV Off`.
2. **Negative Relay Opening:** Following the positive relay, BMS opens the negative relay (`BMS_TotalNegRelay_STS=Open`).
3. **Voltage Monitoring:** When the voltage drops below 90% of the bus total voltage, BMS determines the high-voltage relay has completely disconnected.
4. **Error Handling:** If there is an error, BMS sends:
   - `BMS_MainPosRelay_ERR=Error`
   - `BMS_TotalNegRelay_ERR=Error`
   - `BMS_PreCrgRelay_ERR=Error`.

   Additional handling includes:
   - High and low side drivers driving the relay.
   - Detection of contactor faults such as stuck/open.
   - Monitoring feedback during charge/discharge states.

---

### Signal I/O

#### **VCU_BMS_HVOnOff_REQ**
- **Description:** High Voltage On-Off command from VCU.
- **Values:** `0` – forbid; `1` – allow
- **Sender:** VCU
- **Receiver:** BMS

#### **BMS_HV_Sts**
- **Description:** Status of HV voltage.
- **Values:** 
   - `9~5`: Undefined.
   - `4`: AC_Charge.
   - `3`: Super_Fast_Charge.
   - `2`: HV On.
   - `1`: Pre-charge.
   - `0`: HV Off.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_MainPosRelay_STS**
- **Description:** Main Positive Relay Status.
- **Values:**
   - `4`: stuck open.
   - `3`: stuck closed.
   - `2`: closed.
   - `1`: open.
   - `0`: reserved.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_PreChgRelay_STS**
- **Description:** Pre-Charge Relay Status.
- **Values:**
   - `4`: stuck open.
   - `3`: stuck closed.
   - `2`: closed.
   - `1`: open.
   - `0`: reserved.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_TotalNegRelay_STS**
- **Description:** Main Negative Relay Status.
- **Values:**
   - `4`: stuck open.
   - `3`: stuck closed.
   - `2`: closed.
   - `1`: open.
   - `0`: reserved.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_MainPosRelay_ERR**
- **Description:** Main Position Relay Error.
- **Values:**
   - `1`: normal.
   - `0`: Error.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_TotalNegRelay_ERR**
- **Description:** Main Negative Relay Error.
- **Values:** 
   - `1`: normal.
   - `0`: Error.
- **Sender:** BMS
- **Receiver:** VCU

#### **BMS_PreCrgRelay_ERR**
- **Description:** Pre-Charge Relay Error.
- **Values:**
   - `1`: normal.
   - `0`: Error.
- **Sender:** BMS
- **Receiver:** VCU
Page 34
### 7.4. CTC - Pre-charge Check
The pre-charge procedure must be precisely monitored to quickly detect errors during this critical stage. The diagnosis is conducted by generating a maximum and minimum voltage curve and verifying that the actual voltage remains within the valid range throughout the pre-charge procedure.  

In cases of partially pre-charged systems where the DC-link circuit voltage is not zero, the actual DC-link voltage is converted to a theoretically elapsed pre-charged time during pre-charge initialization. The pre-charge check curves continue from this theoretical starting point.  

Since voltage curves are calculated based on the total battery voltage, this input is stored during pre-charge initialization and referenced throughout the pre-charge procedure. This approach accounts for expected variations in battery voltage due to physical effects (e.g., current flow-induced cell voltage decreases) preventing falsification of curves.  

Details of faults will be identified in the DTC list.

---

### 7.5. CTC - Overheating of Pre-charge Resistor
This system includes a monitoring algorithm to avoid overheating of the pre-charge resistor during a single pre-charge procedure and detect other errors potentially impacting the process. The energy absorbed by the pre-charge resistor is calculated based on amperage, resistance, and time, and compared to a maximum allowed limit.  

The pre-charge resistor temperature guard is designed to prevent overheating caused by excessive pre-charge operations. Since pre-charge procedures generate heat, an algorithm calculates a model-based value to represent the thermal load. The system prevents further pre-charging when temperature issues are detected.  

The model-based value is incremented during each procedure based on the voltage difference balanced during pre-charging. For example, if the load circuit charge increases from 100V to 360V, the voltage difference is 260V. This difference is multiplied by a calibration value and added to the pre-charge resistor guard value.
Page 35
7.4. CTC - Pre-charge check.  
The pre-charge procedure has to be precisely monitored to quickly detect errors during this critical stage. Diagnosis is conducted by generating a maximum and minimum voltage curve and verifying that the actual voltage is within this valid range at all times during the pre-charge procedure.  

In order to handle partially pre-charged systems (voltage of DC-link circuit not zero), the actual DC-link voltage is converted to a theoretically elapsed pre-charge time during pre-charge initialization. The pre-charge check curves will then continue at this point of time.  

As all voltage curves are dependent on the total battery voltage, this input is stored during pre-charge initialization and read throughout the pre-charge procedure as the actual battery voltage can vary due to physical effects of current flow decreasing the cell voltages, potentially leading to falsified curves.  

Details of faults shall be identified in the DTC list.  

7.5. CTC - Overheating of pre-charge resistor.  
This system contains a monitoring algorithm to avoid overheating of the pre-charge resistor during single pre-charge procedures and detect other errors impacting this state.  

Energy absorbed by the pre-charge resistor is calculated (based on amperage, resistance, and time) and compared to a maximum allowed limit. The pre-charge resistor temperature guard prevents overheating from excessive operations. An algorithm calculates thermal load and blocks further pre-charging in case of temperature issues.  

The calculated model value is incremented during each procedure based on the voltage difference balanced (e.g., charging from 100V to 360V results in a voltage difference of 260V). This voltage difference is multiplied by a calibration value and added to the pre-charge resistor guard value.  

The guard value decreases at a defined rate when the resistor is unused and is stored non-volatile if the ECU enters sleep mode. Upon next wakeup, the guard value is corrected using the battery off time input (reflecting how long the ECU slept).  

The function predicts the value expected after the next procedure and determines its feasibility within the calibrated limit. Exceeding this limit triggers an error flag that inhibits pre-charging. If a pre-charge energy error is detected during operations, the guard value instantly sets to the maximum to prevent pre-charging for several minutes.  

Details of faults shall be identified in the DTC list.  

7.6. CTC - Emergency contactor open state.  
This emergency state opens all closed contactors regardless of battery status and current flow. To reduce current flow in the DC-link circuit, disconnection can be delayed by a calibrated time period. During the delay phase, a "disconnection pending" flag and counter are outputted.  

When the counter reaches zero, the contactors open. If the emergency state is not resolved within the calibrated time, a timeout error is reported.  

7.7. CTC - Contactor Error Acknowledge.  
Contactor diagnosis must be performed if there was an error in this or the last operational cycle and cannot be skipped. Diagnosis cannot occur when the DC-link circuit is partially pre-charged. The function waits for the DC-link voltage to drop below the activation limit.  

Failure to meet this limit within the calibrated time activates an error.  

7.8. CTC - Contactor Weld check.  
While in the offline state, there must be no current flow, and the DC-link HV voltage must significantly deviate from the battery voltage. Current flow or insufficient voltage deviation indicates potential weld failures in contactors.  

To ensure diagnosis reliability, error symptoms must remain active for a calibrated period before reporting errors.  

After ECU startup, the offline state persists for a calibrated time to process possible errors inhibiting the battery's transition to the online state.  

7.9. CTC - Contactor Aging Observer.  
High voltage contactors age based on operating cycle count (make & break) and amperage during switching events. At each event, the contactor's deterioration counter increases based on amperage-dependent values.  

The software determination for switching may vary from the physical execution due to mechanical control factors. The function observes these age-dependent conditions to manage contactor operation adequately.
Page 36
7.6. CTC - Emergency Contactor Open State.  
The emergency disconnect state opens all closed contactors despite previous battery status and current flow. To allow the HV components to reduce the current flow of the DC-link circuit, the disconnection can be delayed by a calibrated period of time. During this delay phase, the function will output a disconnection pending flag and a counter. When the counter reaches zero, the contactors open.  
If the emergency disconnection state is not completed within a calibrated period of time, a timeout error is reported.  

7.7. CTC - Contactor Error Acknowledge.  
The contactor diagnosis must be performed if a contactor error occurred in this or the last operation cycle and cannot be skipped. As the diagnosis cannot proceed when the DC-link circuit is already partially pre-charged, the system waits for the DC-link voltage to drop below the diagnosis activation limit. If the limit is not reached within a calibrated period, an error is activated.  

7.8. CTC - Contactor Weld Check.  
In the offline state, this function ensures there is no current flow and verifies that the DC-link HV voltage measurement deviates clearly from the battery voltage. Current flow or insufficient voltage deviation may indicate contactor weld failures. For increased reliability, error symptoms must persist for a calibrated period before reporting errors.  

The function remains in the offline state for a minimum calibrated duration upon ECU startup to account for potential errors inhibiting the battery from entering the online state.  

7.9. CTC - Contactor Aging Observer.  
Each high-voltage contactor ages with operating cycles and amperage during switching events. The deterioration counter for each contactor incrementally increases based on amperage-dependent deterioration values. To address delays between request determination and actual contactor switching, the current flow gradient is monitored for subsequent cycles. This ensures the calculation of the maximum deterioration impact during calibrated periods.  

Contactor aging warning and error flags trigger if limits are exceeded. Previous amperage values may be considered during safety interventions. The deterioration counter values are stored non-volatile and reset manually upon contactor replacement.  

The contactor condition subsystem outputs remaining lifetime values ranging from 100% (new) to 0% (worn). Warning and failure indicators signalize an upcoming or immediate need for contactor replacement.

7.10. CTC - Aging of Contactor.  
The state control manages diagnoses while monitoring contactor aging, pre-charge resistor energy flow, and temperature. Diagnostics identify contactor health during turn-on and turn-off states.

Contactor health is communicated over PT-CAN as the BMS_ContactorAging signal, which tracks the health conditions of Positive, Negative, and Pre-charge contactors. Status information is measured and shared via PT-CAN.

### Signal I/O:
- **Name**: BMS_ContactorAging.  
  **Description**: Aging condition of contactors – Pre-charge Relay - Positive Contactor - Negative Contactor.  
  **Min**: 0.  
  **Max**: 100.  
  **Value Description**:  
  - 2: Fault: Counter reaches 98%;  
  - 1: Warning: Counter reaches 90%;  
  - 0: Normal.  
  **Sender**: BMS.  
  **Receiver**: VCU.
Page 37
8. BPIU - Battery Pack Current Voltage Protection Limits.

8.1. BPIU - Cell Voltage Min Max Identification.
Find the minimum and maximum cell voltage of the complete pack. In addition, the index of the cell with the minimum and maximum cell voltage is also identified.

Signal I/O:
- **BMS_MinCellVol** - Min Cell Voltage (Min: 0, Max: 6). Sender: BMS, Receiver: VCU.
- **BMS_MaxCellVol** - Max Cell Voltage (Min: 0, Max: 6). Sender: BMS, Receiver: VCU.
- **BMS_CellNumMinCellVol** - Cell Number of Min Cell Voltage (Min: 0, Max: 255). Sender: BMS, Receiver: VCU.
- **BMS_CellNumMaxCellVol** - Cell Number of Max Cell Voltage (Min: 0, Max: 255). Sender: BMS, Receiver: VCU.

8.2. BPIU - Cell Voltage Protection Limits.
The cell over-voltage protection limits are higher than the safety over-voltage limit. The cell under-voltage protection limits are lower than the safety low-voltage limit. Violation of cell voltage protection limits leads to battery lock state. The battery pack has to be checked by the service engineer and confirmed to have no real cell issues. Then the lock state shall be released by using the UDS command.

Signal I/O:
- **CUM_bErrCellUMaxMon** - Error flag indicating cell overvoltage fault (Min: 0, Max: 1; 1: Error, 0: No error). Sender: BMS, Receiver: VCU.
- **CUM_bErrCellUMinMon** - Error flag indicating cell under voltage fault (Min: 0, Max: 1; 1: Error, 0: No error). Sender: BMS, Receiver: VCU.
- **CUM_bErrCellUProtnMaxNvMon** - Non-volatile error flag indicating cell overvoltage protection limit fault (Min: 0, Max: 1; 1: Error, 0: No error). Sender: BMS, Receiver: VCU.
- **CUM_bErrCellUProtnMinNvMon** - Non-volatile error flag indicating cell under voltage protection limit fault (Min: 0, Max: 1; 1: Error, 0: No error). Sender: BMS, Receiver: VCU.
Page 38
8. BPIU - Battery Pack Current Voltage Protection Limits.

8.1. BPIU - Cell Voltage Min Max Identification.
Find the minimum and maximum cell voltage of the complete pack. In addition, the index of the cell with the minimum and maximum cell voltage is identified.

#### Signal I/O:

- **BMS_MinCellVol**: Min Cell Voltage.  
  Min: 0, Max: 6.  
  Sender: BMS, Receiver: VCU.

- **BMS_MaxCellVol**: Max Cell Voltage.  
  Min: 0, Max: 6.  
  Sender: BMS, Receiver: VCU.

- **BMS_CellNumMinCellVol**: Cell Number of Min Cell Voltage.  
  Min: 0, Max: 255.  
  Sender: BMS, Receiver: VCU.

- **BMS_CellNumMaxCellVol**: Cell Number of Max Cell Voltage.  
  Min: 0, Max: 255.  
  Sender: BMS, Receiver: VCU.

---

8.2. BPIU - Cell Voltage Protection Limits.
The cell over-voltage protection limits are higher than the safety over-voltage limit. The cell under-voltage protection limits are lower than the safety low-voltage limit. Violation of cell voltage protection limits leads to a battery lock state. The battery pack has to be checked by the service engineer to confirm there are no real cell issues, and then the lock state shall be released using the UDS command.

#### Signal I/O:

- **CUM_bErrCellUMaxMon**: Error flag indicating cell overvoltage fault.  
  Min: 0, Max: 1.   
  Value: 1: Error; 0: No error.  
  Sender: BMS, Receiver: VCU.

- **CUM_bErrCellUMinMon**: Error flag indicating cell under-voltage fault.  
  Min: 0, Max: 1.   
  Value: 1: Error; 0: No error.  
  Sender: BMS, Receiver: VCU.

- **CUM_bErrCellUProtnMaxNvMon**: Non-volatile error flag indicating cell overvoltage protection limit fault.  
  Min: 0, Max: 1.  
  Value: 1: Error; 0: No error.  
  Sender: BMS, Receiver: VCU.

- **CUM_bErrCellUProtnMinNvMon**: Non-volatile error flag indicating cell under-voltage protection limit fault.  
  Min: 0, Max: 1.  
  Value: 1: Error; 0: No error.  
  Sender: BMS, Receiver: VCU.

---

8.3. BPIU - Voltage Acquisition Plausibility.
The voltage acquisition plausibility diagnosis checks if all high voltage signals, the combined module voltages, and combined cell voltages are plausible. The diagnosis is separated into the core algorithm, the de-bouncing, and the DEM interface. The DEM interface transfers de-bounced error information to the DEM (diagnostic event manager).  

#### Figure 13: HV Measurement Points.
- **U1**: High Voltage + after battery and before contactor (Pack Voltage) - UAct1.  
- **U2**: High Voltage + after battery and after contactor (Bus Voltage) - UAct2.  
- **U3**: High Voltage - after battery and after contactor - UAct3.  
- **U5**: High Voltage - after fuse inside battery (Fuse Voltage) - UAct5.  
- **DC Link**: High Voltage after contactor with external reference High Voltage - reference.  

The verification of voltage signals is performed by comparing suitable sources at different situations of the contactor switching states. In case of an error, the information is sent to the diagnostic event manager. The module voltages are compared with the sum of cell voltages of each module, which should always match despite the physical difference induced by current flow and measurement tolerance.
Page 39
8. BPIU - Battery Pack Current Voltage Protection Limits

8.3. BPIU - Voltage Acquisition Plausibility  
An error is detected if the module voltage and the sum of cell voltages of this module differ by more than a calibratable value. The index of the (last) module which triggered an error is also calculated.

Plausibility of battery voltage measurement:  
Calculated sums of module and cell voltages as well as measured battery pack voltage (UAct1) are compared against each other. In case of tolerance exceedance in both diagnoses for one of the signals, errors are triggered.

**Positive contactor voltage acquisition:**  
The difference between CTC_UAct2 and battery pack voltage is compared with a tolerance parameter. This diagnosis is functional only in case of pre-charge or positive contactors being closed when negative is open, or in case the load circuit is closed.

**Negative contactor voltage acquisition:**  
In case of only pre-charge or positive contactor closure, UAct3 shall be equal to the battery pack voltage measurement. When the negative contactor is closed, this voltage shall be equal to 0.

**Diagnosis of fuse voltage:**  
UAct5 shall be equal to battery pack voltage. This diagnosis is valid when UAct1 diagnosis is enabled but does not trigger its error.
Page 40
## Diagnosis of DC Link Circuit

In case the load circuit is closed, DC link voltage shall be equal to positive contactor voltage. Errors are triggered only if positive contactor acquisition is valid.

Several diagnostic procedures utilize the voltage values above, with detailed DTC information provided in the ODX file. 

The Battery Management System (BMS) should monitor the voltage, current, and temperature of the high voltage battery pack and send all required information over Power Train CAN (PT-CAN) to other ECUs.  

---

### Signal I/O

#### **Name:** BMS_HVPackVol_MEAS  
**Description:** Pack Voltage  
**Min:** 0  
**Max:** 800  
**Value Description:** 65535: Invalid  
**Sender:** BMS  
**Receiver:** VCU  

#### **Name:** BMS_HVLinkVol_MEAS  
**Description:** Link Voltage  
**Min:** 0  
**Max:** 800  
**Value Description:** 65535: Invalid  
**Sender:** BMS  
**Receiver:** VCU  

#### **Name:** BMS_HVFuseVol_MEAS  
**Description:** Measure voltage after fuse to identify if the fuse is blown or not  
**Min:** 0  
**Max:** 800  
**Value Description:** 65535: Invalid  
**Sender:** BMS  
**Receiver:** VCU  

#### **Name:** BMS_HVBusVol_MEAS  
**Description:** BUS Voltage (informative)  
**Min:** 0  
**Max:** 800  
**Value Description:** 65535: Invalid  
**Sender:** BMS  
**Receiver:** VCU
Page 41
**8. BPIU - Battery Pack current voltage protection limits**

**8.1. BPIU - Cell Voltage Min Max Identification.**
Find the minimum and maximum cell voltage of the complete pack.  
In addition, the index of the cell with the minimum and maximum cell voltage is also identified.  

**Signal I/O**  
| Name                     | Description                      | Min | Max  | Value Description | Sender | Receiver |
|--------------------------|----------------------------------|-----|------|-------------------|--------|----------|
| BMS_MinCellVol           | Min Cell Voltage                | 0   | 6    |                   | BMS    | VCU      |
| BMS_MaxCellVol           | Max Cell Voltage                | 0   | 6    |                   | BMS    | VCU      |
| BMS_CellNumMinCellVol    | Cell Number of Min Cell Voltage | 0   | 255  |                   | BMS    | VCU      |
| BMS_CellNumMaxCellVol    | Cell Number of Max Cell Voltage | 0   | 255  |                   | BMS    | VCU      |

---

**8.2. BPIU - Cell Voltage Protection Limits.**
The cell over voltage protection limits are higher than the safety over-voltage limit.  
The cell under voltage protection limits are lower than the safety low-voltage limit.  

Violation of cell voltage protection limits leads to battery lock state.  
The battery pack has to be checked by the service engineer and verified for no real cell issues. The lock state is then released using the UDS command.  

**Signal I/O**  
| Name                          | Description                                     | Min | Max | Value Description        | Sender | Receiver |
|-------------------------------|------------------------------------------------|-----|-----|--------------------------|--------|----------|
| CUM_bErrCellUMaxMon           | Error flag indicating cell overvoltage fault.  | 0   | 1   | 1: Error; 0: No error;   | BMS    | VCU      |
| CUM_bErrCellUMinMon           | Error flag indicating cell under voltage fault.| 0   | 1   | 1: Error; 0: No error;   | BMS    | VCU      |
| CUM_bErrCellUProtnMaxNvMon    | Non-volatile error flag indicating cell overvoltage protection limit fault. | 0 | 1 | 1: Error; 0: No error; | BMS | VCU |
| CUM_bErrCellUProtnMinNvMon    | Non-volatile error flag indicating cell under voltage protection limit fault. | 0 | 1 | 1: Error; 0: No error; | BMS | VCU |

---

**8.3. BPIU - Voltage Acquisition Plausibility.**
Top-level diagnosis checks whether high voltage signals, combined module voltages, and combined cell voltages are plausible.  

Voltage acquisition plausibility diagnosis consists of three parts:  
1. Core algorithm  
2. De-bouncing  
3. DEM interface transferring error information to the diagnostic event manager (DEM).  

**Figure 13: HV Measurement Points**  
- **U1**: High Voltage + after battery and before contactor (Pack Voltage) – UAct1  
- **U2**: High Voltage + after battery and after contactor (Bus Voltage) – UAct2  
- **U3**: High Voltage - after battery and after contactor – UAct3  
- **U5**: High Voltage - after fuse inside battery (Fuse Voltage) – UAct5  
- **DC Link**: High Voltage after contactor with external reference High Voltage  

**Verification Approach**  
- Voltage signals are compared across different contactor switching states.  
- Module voltages are compared with the sum of cell voltages of each module; discrepancies exceeding calibratable tolerances trigger errors.  

---

**Diagnosis of DC link circuit**  
When the load circuit is closed, DC link voltage equals positive contactor voltage.  
Errors are triggered only if positive contactor acquisition is valid.  

- Several diagnostics are performed using the above voltage values.  
- DTC details are provided in the ODX file.  

The Battery Management System monitors voltage, current, and temperature of the HV battery pack and sends this information via PT-CAN (Power Train CAN) to all other ECU’s.

**Signal I/O**  
| Name                 | Description                        | Min | Max | Value Description | Sender | Receiver |
|----------------------|------------------------------------|-----|-----|-------------------|--------|----------|
| BMS_HVPackVol_MEAS   | Pack Voltage                      | 0   | 800 | 65535:Invalid;    | BMS    | VCU      |
| BMS_HVLinkVol_MEAS   | Link Voltage                      | 0   | 800 | 65535:Invalid;    | BMS    | VCU      |
| BMS_HVFuseVol_MEAS   | Voltage after fuse to verify if blown | 0 | 800 | 65535:Invalid; | BMS | VCU |
| BMS_HVBusVol_MEAS    | BUS Voltage, informative          | 0   | 800 | 65535:Invalid;    | BMS    | VCU      |

---

**BPIU Cell Temperature Configured**

**Figure 14: Cell Operation Temperature**  
Find the minimum and maximum brick cell temperature of the complete pack.   
Probe numbers of cells with minimum and maximum temperatures are identified.

**Charging Conditions:**  
- Stop charging if:  
  - Minimum temperature < 0℃ → Request BMS_ChgCurrent_REQ = 0.  
  - Maximum temperature > 50℃ → Request BMS_ChgCurrent_REQ = 0.  

**Charging & Discharging Conditions:**  
- Open HV contactor if:  
  - Minimum temperature < -30℃ → BMS_ERR_LEV = 4.
Page 42
8. BPIU - Battery Pack Current Voltage Protection Limits.

8.3. BPIU - Voltage Acquisition Plausibility.
Top level of the voltage acquisition plausibility diagnosis which checks if all high voltage signals, the combined module voltages and the combined cell voltages are plausible. The voltage acquisition plausibility diagnosis is separated into the core algorithm, the de-bouncing, and the DEM interface. The DEM interface blocks transfer the de-bounced error information to the diagnostic event manager (DEM).

Figure 13: HV Measurement Points.
- U1: High Voltage + after battery and before contactor (Pack Voltage).
- U2: High Voltage + after battery and after contactor (Bus Voltage).
- U3: High Voltage - after battery and after contactor.
- U5: High Voltage - after fuse inside battery (Fuse Voltage).
- DC Link: High Voltage after contactor with external reference High Voltage.

The verification of the voltage signals is done by comparing suitable sources at different situations of contactor switching states. In case of an error, the information is sent to the diagnostic event manager. Module voltages are compared with the sum of cell voltages of each module, which should always match (despite physical differences induced by current flow and measurement tolerance).

Plausibility of battery voltage measurement:
The calculated sums of module and cell voltages, as well as measured battery pack voltage (UAct1), are compared against each other. Errors are triggered in case of tolerance exceedance in both diagnoses.

Positive contactor voltage acquisition:
The difference between CTC_UAct2 and battery pack voltage is compared with a tolerance parameter. Diagnosis is functional only in case of pre-charge or positive contactors closed, when the negative contactor is open, or in case of the load circuit being closed.

Negative contactor voltage acquisition:
In case of only pre-charge or positive contactor closure, UAct3 shall be equal to battery pack voltage measurement. When the negative contactor is closed, this voltage shall be equal to 0.

Diagnosis of fuse voltage:
UAct5 shall be equal to battery pack voltage. Diagnosis is valid when UAct1 diagnosis is enabled but does not trigger its error.

Diagnosis of DC Link Circuit:
In case the load circuit is closed, DC link voltage shall be equal to the positive contactor voltage. An error is triggered only if positive contactor acquisition is valid. Several diagnostics are performed using the above voltage values. Detailed diagnostic trouble codes (DTC) in the ODX file provide information.

The Battery Management System (BMS) monitors the voltage, current, and temperature of the high voltage battery pack and provides the required information via Power Train CAN (PT-CAN) to all other ECUs.

Signal I/O:
- **BMS_HVPackVol_MEAS**: Pack Voltage (Range: 0–800).
  Value Description: 65535:Invalid. Sender: BMS. Receiver: VCU.
- **BMS_HVLinkVol_MEAS**: Link Voltage (Range: 0–800).
  Value Description: 65535:Invalid. Sender: BMS. Receiver: VCU.
- **BMS_HVFuseVol_MEAS**: Measure voltage after fuse to identify blown fuse (Range: 0–800).
  Value Description: 65535:Invalid. Sender: BMS. Receiver: VCU.
- **BMS_HVBusVol_MEAS**: BUS Voltage, informative (Range: 0–800).
  Value Description: 65535:Invalid. Sender: BMS. Receiver: VCU.

8.4. BPIU - Cell Voltage Deviation.
If the voltage difference between the maximum and minimum cell voltage in the pack exceeds a calibrated value within the period of time, an error is triggered. The maximum and minimum cell voltage difference is monitored, and deviations are checked. Errors lead to limp home mode during driving and reduce the charge current during charging.

Signal I/O:
- **BMS_MaxMinDiffCellVol**: Range: 0–2.
  Value Description: 8191:Invalid value if difference > 500mV. Sender: BMS. Receiver: VCU.
Page 43
8.5. BPIU - Cell Temperature Deviation.

The maximum and minimum cell temperature difference are monitored, and deviations are checked to identify errors. When the protection level for cell temperature imbalance is detected, the battery is placed in a lock state.

Signal I/O:
| Name                      | Description                                    | Min  | Max  | Value Description      | Sender | Receiver |
|---------------------------|------------------------------------------------|------|------|------------------------|--------|----------|
| BMS_MaxMinDiffCellTemp    | max and min brick cell temperature differences | -40  | 215  | 255: Invalid Diff Temp | BMS    | VCU      |
Page 44
9. MCC - Module Controller Control.

9.1. MCC - Cell Voltage Sensing.  
The MCU will measure the brick cell voltages with an accuracy of 5mV.  

9.2. MCC - Module Voltage.  
Each cell voltage is summed up to get module voltage.  

9.3. MCC - Module Temperature.  
Each module is equipped with 4 temperature sensors, and each temperature sensor is measured by the MCU.  

9.4. MCC - Cell Balancing.  
BCU commands MCU for each brick during cell balancing. External passive balancing is used for cell balancing.  
The module control unit (MCU) shall communicate with each module using a Daisy chain approach.  
The measurement of temperature is done at an accuracy of ±1°C. The CAN signal shows the measurement values in the 1°C range.  
The MCU board temperature is also monitored and controlled by the BCU.  

**Figure Description:**  
Figure 15 illustrates the NTC positions within the module and specifies temperature sensor locations for monitoring.

The MCC module has two main functions:  
- **10ms Task:** The diagnostic function checks for errors reported by attached MCUs and signals data flow status. If no errors are reported or MCUs are sending data, the signal `MCC_StMdulCu` is set to 9 (Run). If errors are reported by any module or MCUs fail to send data, appropriate diagnostics are performed.  
- **1000ms Task:** Handles module configuration and communicates module information, ensuring smooth operational transitions through subsystem implementations.  
Each task is individually executed based on the operating system schedule.
Page 45
9. MCC - Module Controller Control.

9.1. MCC - Cell Voltage Sensing.  
The MCU will measure the brick cell voltages with an accuracy of 5mV.

9.2. MCC - Module Voltage.  
Each cell voltage is summed up to calculate module voltage.

9.3. MCC - Module Temperature.  
Each module is equipped with 4 temperature sensors, each of which is measured by the MCU.

9.4. MCC - Cell Balancing.  
The BCU commands the MCU for each brick of cell balancing. External passive balancing is used for this purpose.

The module control unit (MCU) communicates with each module using the Daisy chain approach.  
The temperature measurement is conducted with an accuracy of ±1℃, and the CAN signal displays measurement values within a 1℃ range.  
The MCU board temperature is also monitored and controlled by the BCU.

Figure 15: NTC Position in Module.  
The NTC positions within the module are illustrated to show sensor placement for temperature measurement.  

The MCC module has two main functionalities:  
- A 10ms diagnostic task.  
- A 1000ms configuration task.  

The MCC function handles error diagnosis and module configuration. Each task operates individually as initiated by the operating system.  
The 10ms function contains a diagnosis subsystem. If no errors are reported from the attached MCU's and MCU's are sending data, the signal `MCC_StMdulCu` is set to `9` (Run). If an error is reported in any module or the MCU's fail to send data, the signal is set to `15` (Error).  
The errors are defined within the Fault Summary array registers for all chips in the daisy chain.  
The diagnosis subsystem includes a state flow algorithm to identify which module controller raised the error and the type of error detected.  
The `CDEM` module handles fault detection.
Page 46
9.5. MCC - Temperature sensor fault monitoring– number of sensors.
The over-temperature, under-temperature, and temperature deviation monitoring shall continue in case faulty temperature sensors are detected. The faulty temperature sensor shall be excluded from calculations; therefore, the faulty sensor will not trigger a temperature limit violation. Assuming that thermal runaway detection can run with 3 sensors per module. Missing sensor is detected by checking the voltage level on GPIO pin. If the voltage level is below the presence threshold, then it is indicated by the range check as well. No need for separate diagnosis, since range check covers this fault.

9.6. MCC - FUSA.
LPF: - Latent Point Fault.
The following SM’s are run to detect the latent point fault of the AFE:
- SM19 – PEC Diagnostic.
- SM26 – Diagnostic tests on digital redundancy.
- SM32 – Clear command verification.

SPF: Single Point Fault.
The following SM’s are run to detect the single point fault of the AFE:
- Key-on diagnostics.
Page 47
9. MCC - Module Controller Control.

9.5. MCC - Temperature sensor fault monitoring– number of sensors.
- The over-temperature, under-temperature, and temperature deviation monitoring shall continue in case faulty temperature sensors are detected.
- The faulty temperature sensor shall be excluded from calculations; therefore the faulty sensor will not trigger a temperature limit violation.
- Assuming that thermal runaway detection can run with 3 sensors per module.
- Missing sensor is detected by checking the voltage level on GPIO pin. If the voltage level is below the presence threshold, it is indicated by the range check. No need for separate diagnosis since the range check covers this fault.

9.6. MCC - FUSA.
**LPF: Latent Point Fault.**  
The following SM modules are run to detect the latent point fault of the AFE.

**SPF: Single Point Fault.**  
The following SM modules are run to detect the latent point fault of the AFE.

FMEDA Document:  
Please check the FMEDA document of the AFE (App 6811 FMEDA).
Page 48
10. Battery Thermal Handling Management (BTHM)

10.1. BTHM - Function Description.  
Battery thermal management handling function is responsible for acquisition and processing of measurements related to the thermal state of the battery pack, BCU, and MCU controllers. This function also calculates requests required to keep the battery in its optimal thermal boundaries.  

Functionality is split into two main subsystems:  
- Data preparation.  
- Thermal control.  

10.2. BTHM - Data Preparation.  
The data preparation function is used to acquire, electrically check, convert, physically check, and process all necessary data as described below:  
- Module controller PCB temperature sensor values transmitted by debug CAN.  
- Cell temperature sensor values transmitted by debug CAN.  
- Coolant inlet temperature sensor from the valve.  
- Coolant outlet temperature sensor from the valve.  
- BCU PCB temperature sensor.  
- Mean pack temperature.  
- Maximum cell temperature (raw and corrected).  
- Minimum cell temperature (raw and corrected).  
- Maximum module controller PCB temperature.  
- Minimum module controller PCB temperature.  
- Average module controller PCB temperature.  

The mean pack temperature is calculated by summing up average module temperatures and dividing them by the number of modules.  

Following checks are executed:  
- Measurement value out of range for coolant temperature sensor at pack inlet.  
- Measurement value out of range for coolant temperature sensor at pack outlet.  
- Measurement value out of range for BCU PCB temperature sensor.  
- Measurement value out of range for module controller PCB temperature sensor.  
- Measurement value out of range for cell temperature sensor.  

In the case of cell temperature sensors, alternative values are calculated if a sensor error is detected. In all cases, an error is set if the limits are exceeded. If all temperature sensors of a module are defective, a critical error will be set for that module.
Page 49
**10. Battery Thermal Handling Management (BTHM)**

**10.1. BTHM - Function Description.**  
Battery thermal management handling function is responsible for acquisition and processing of measurements related to the thermal state of the battery pack, BCU, and MCU controllers. This function is also calculating requests required to keep the battery in its optimal thermal boundaries.  
Functionality is split into two main subsystems:  
- Data preparation  
- Thermal control  

**10.2. BTHM - Data Preparation.**  
The data preparation function is used to acquire, electrically check, convert, physically check, and process all necessary data, including:  
- Module controller PCB temperature sensor values transmitted by debug CAN  
- Cell temperature sensor values transmitted by debug CAN  
- Coolant inlet temperature sensor from the valve  
- Coolant outlet temperature sensor from the valve  
- BCU PCB temperature sensor  
- Mean pack temperature  
- Maximum cell temperature (raw and corrected)  
- Minimum cell temperature (raw and corrected)  
- Maximum module controller PCB temperature  
- Minimum module controller PCB temperature  
- Average module controller PCB temperature  

The mean pack temperature is calculated by summing up average module temperatures and dividing them by the number of modules.  

Following checks are executed:  
- Measurement value out of range for coolant temperature sensor at pack inlet  
- Measurement value out of range for coolant temperature sensor at pack outlet  
- Measurement value out of range for BCU PCB temperature sensor  
- Measurement value out of range for module controller PCB temperature sensor  
- Measurement value out of range for cell temperature sensor  

In the case of cell temperature sensors, alternative values are calculated if a sensor error is detected. In all cases, an error is set if the limits are exceeded. If all temperature sensors of a module are defective, a critical error is set for that module.

---

**10.3. BTHM - Thermal Control.**  

**Figure 16: BTHM - Thermal control system.**  
In this subsystem, requests relevant for thermal management are calculated.  
Following signals are calculated:  
- Target coolant inlet temperature request  
- Coolant mass flow request  
- Thermal request  

Thermal requests shall be overwritten with calibratable parameters when a service command has been received.  

**Coolant mass flow request calculation is based on the following information:**  
- Difference between minimum and maximum cell temperature  
- Average battery temperature  
- Coolant inlet temperature measurement  
- Current thermal request  

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or a 2-D map. The map output is saturated on top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.  

**Homogenization flag:**  
- Activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold.  
- Deactivated when the temperature spread is lower than the lower limit threshold.  

Hysteresis is used to avoid unnecessary switching of the request when the temperatures are close to the switching point. When the homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map will be used for keeping the cell temperatures homogenous.  

Additionally, coolant mass flow requests calculated from the 2-D map shall be disabled when cooling or heating is not requested.  

**Following requests are possible:**  
- Off  
- Cooling  
- Heating  
- Homogenization
Page 50
## 10. Battery Thermal Handling Management (BTHM)

### 10.3. BTHM - Thermal Control
In this subsystem, requests relevant for thermal management are calculated. Following signals are calculated:
- Target coolant inlet temperature request  
- Coolant mass flow request  
- Thermal request  

Thermal requests shall be overwritten with calibratable parameters when a service command has been received.

Coolant mass flow request calculation is based on the following information:
- Difference between minimum and maximum cell temperature  
- Average battery temperature  
- Coolant inlet temperature measurement  
- Current thermal request  

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or a 2-D map. Output of the map is saturated on top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.

The homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when temperatures are near the switching point. When the homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map will be used to keep cell temperatures homogeneous.

Additionally, the coolant mass flow request calculated from the 2-D map shall be disabled when cooling or heating is not requested.

Requests for the thermal system include:
- Off  
- Cooling  
- Heating  
- Homogenization  

Calculation of the request is based on minimum and maximum cell temperature values. If certain thresholds are exceeded, appropriate requests are set. Different threshold values shall be defined for DC-charge, AC-charge, and Online battery states. Relays are used to avoid oscillations in the request signal. If the battery is not in DC-charge, AC-charge, or Online state, the previously set request will be used. If the battery is offline or in service mode, the request will be set to 'Off'.

Additionally, the "Keep warm" request coming from the VCU is considered. When "Keep warm" is requested, different heating thresholds are set.

---

### 10.4. BTHM - Thermal Loop in Vehicle

#### Figure 17: Thermal Loop in Vehicle

1) **ON/OFF Chiller Conditions**  

Chiller ON/OFF operation depends on the battery's operating mode:

#### Table 5: Chiller ON/OFF Operation  
| **CTC_HvBatSts**                | **Max Cell Temp** | **Request Chiller ON/OFF**         |
|---------------------------------|------------------|-----------------------------------|
| **Offline**                     | ≥140 °C          | ON                                |
| (Condition: RTC wake + KL15 OFF)| <120 °C          | OFF                               |
| **Online**                      | ≥35 °C           | ON                                |
|                                 | <32 °C           | OFF                               |
| **DC Charge**                   | ≥35 °C           | ON                                |
|                                 | <32 °C           | OFF                               |
| **AC Charge**                   | ≥35 °C           | ON                                |
|                                 | <32 °C           | OFF                               |
| **Other Mode**                  | -                | OFF                               |

Thresholds for BMS to send requests for turning ON/OFF the chiller depend on the battery's operating mode.
Page 51
10. Battery Thermal Handling Management (BTHM)

10.3. BTHM - Thermal Control

In this subsystem, requests relevant for thermal management are calculated.

Following signals are calculated:
- Target coolant inlet temperature request.
- Coolant mass flow request.
- Thermal request.

Thermal requests shall be overwritten with calibratable parameters when a service command has been received. Coolant mass flow request calculation is based on the following information:
- Difference between minimum and maximum cell temperature.
- Average battery temperature.
- Coolant inlet temperature measurement.
- Current thermal request.

Depending on the thermal system state, coolant mass flow request shall be calculated either using calibratable hysteresis/backlash or a 2-D map. Output of the map is saturated on top and bottom, and the limits shall be calibrated. Finally, maximal calculated value is set as a request. 

Homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when the temperatures are close to the switching point. 

When homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map will be used for keeping the cell temperatures homogenous. Additionally, coolant mass flow request calculated from the 2-D map shall be disabled when cooling or heating is not requested.

Following requests are possible:
- Off.
- Cooling.
- Heating.
- Homogenization.

Calculation of the request is based on minimum and maximum cell temperature values. If certain thresholds are exceeded, the appropriate request is set. Threshold values shall be set for DC-charge, AC-charge, and Online battery states. Relays are used in order to avoid oscillations of the request signal. 

If the battery is not in DC-charge, AC-charge, or Online state, the last previously set request will be used. If the battery is offline or in service mode, the request will be set to Off. Additionally, "Keep warm" requests coming from the VCU are considered. When "Keep warm" is requested, different heating thresholds are set.

10.4. BTHM - Thermal Loop in Vehicle

**Chiller ON/OFF Conditions**  
Threshold for BMS to send out request to turn ON/OFF chiller depends on the operating mode of the battery:
- **Online:** Turn ON chiller when max cell temperature exceeds 35°C and turn OFF when max cell temperature is below 32°C.
- **DC charge:** Turn ON chiller when max cell temperature exceeds 35°C and turn OFF when max cell temperature is below 32°C.
- **AC charge:** Turn ON chiller when max cell temperature exceeds 35°C and turn OFF when max cell temperature is below 32°C.
- **Other mode:** Chiller will be requested to be turned OFF.

**Communication Signal:**  
BMS sends requests to turn ON/OFF to VCU through CAN signal: `BMS_VCU_ValveOnOff_Req`.

**Cooling Power Calculation**  
BMS sends the request to turn ON the chiller to VCU. If BMS receives feedback from VCU informing that the chiller is turned ON (`VCU_BMS_ValveOnOff_Sts = 1`), BMS calculates cooling power demand and sends the value out to VCU through the signal: `BMS_CoolPwrDemand`.

Cooling power demand is calculated depending on the temperature difference between the target temperature and inlet temperature. Target temperature of the pack is determined based on pack temperature according to the following table:

**Table 6: Cooling Power Calculation**
| Target - Inlet (°C) | Power Request (kW) | CAN Signal: BMS_CoolPwrDemand / BMS_HeatPwrDemand | Active Cooling/Heating | Passive Cooling/Heating |
|----------------------|--------------------|---------------------------------------------------|-------------------------|-------------------------|
| -7                  | -7.5              | 0                                                 | Cooling                 | 0                       |
| -6                  | -6.5              | 0                                                 | Cooling                 | 0                       |
| -5                  | -5                | 0                                                 | Cooling                 | 0                       |
| ≤ 0                 | 0                 | 0                                                 | Cooling                 | 0                       |
| > 0                 | 0                 | 0                                                 | Heating                 | 0                       |
| 5                   | 5                 | 0                                                 | Heating                 | 0                       |
| 6                   | 6                 | 0                                                 | Heating                 | 0                       |
| 7                   | 7                 | 0                                                 | Heating                 | 0                       |
Page 52
10. Battery Thermal Handling Management (BTHM)

10.3. BTHM - Thermal Control  
In this subsystem, requests relevant for thermal management are calculated.  
Following signals are calculated:  
- Target coolant inlet temperature request  
- Coolant mass flow request  
- Thermal request  

Thermal requests shall be overwritten with calibratable parameters when a service command has been received.  

### Coolant mass flow request  
Coolant mass flow request is calculated based on the following information:  
- Difference between minimum and maximum cell temperature  
- Average battery temperature  
- Coolant inlet temperature measurement  
- Current thermal request  

Depending on the thermal system state, coolant mass flow request is calculated either using calibratable hysteresis/backlash or a 2-D map. Output of the map is saturated at the top and bottom, and the limits shall be calibrated. Finally, the maximal calculated value is set as a request.  

Homogenization flag is activated when the difference between minimum and maximum cell temperature exceeds the upper limit threshold and is deactivated when the temperature spread is lower than the lower limit threshold. Hysteresis is used to avoid unnecessary switching of the request when the temperatures are near the switching point. When homogenization flag is active and neither heating nor cooling is requested, a different coolant mass flow map is used for keeping the cell temperatures homogenous.  

Additionally, coolant mass flow request calculated from the 2-D map is disabled when cooling or heating is not requested.  

### Possible requests  
- Off  
- Cooling  
- Heating  
- Homogenization  

Calculation of the request is based on minimum and maximum cell temperature values. If certain thresholds are exceeded, an appropriate request is set. Different threshold values are defined for DC-charge, AC-charge, and Online battery states. Relays are used to avoid oscillations of the request signal. If the battery is offline or in service mode, the request is set to “Off.” Additionally, the "Keep warm" request coming from the VCU is considered. When "Keep warm" is requested, different heating thresholds are set.

---

10.4. BTHM - Thermal Loop in Vehicle  

**Figure 17: Thermal Loop in Vehicle**

### ON/OFF Chiller Conditions  
BMS sends a request to turn ON/OFF the chiller to VCU through the CAN signal: `BMS_VCU_ValveOnOff_Req`.  

### Table 5: Chiller ON/OFF Operation  
Conditions for chiller activation based on the operating modes are as follows:

| CTC_HvBatSts | Max Cell Temp     | Request Chiller ON/OFF |
|--------------|-------------------|-------------------------|
| Offline      | ≥140°C           | ON                     |
|              | <120°C            | OFF                    |
| Online       | ≥35°C            | ON                     |
|              | <32°C             | OFF                    |
| DC Charge    | ≥35°C            | ON                     |
|              | <32°C             | OFF                    |
| AC Charge    | ≥35°C            | ON                     |
|              | <32°C             | OFF                    |
| Other Mode   | -                | OFF                    |

Thresholds for BMS requests to turn the chiller ON/OFF depend on the operating mode of the battery.  

---

### Cooling Power Calculation  
BMS sends a request to turn ON the chiller to VCU, and once feedback is received (`VCU_BMS_ValveOnOff_Sts = 1`), BMS calculates cooling power demand and sends the value to VCU through the signal `BMS_CoolPwrDemand`. Cooling power calculation depends on the difference between target and inlet temperatures.  

#### Table 6: Cooling Power Calculation  
Cooling and heating power requests are calculated based on temperature difference:

| Target-Inlet (°C) | Power Request (kW) |
|--------------------|-------------------|
| Cooling            |                  |
| -7                 | -7.5             |
| -6                 | -6.5             |
| -5                 | -5               |
| ≤0                 | 0                |
| Heating            |                  |
| >0                 | 0                |
| 5                  | 5                |
| 6                  | 6                |
| 7                  | 7                |

---

3) **Mass Flowrate Calculation**  
BMS sends a flowrate request to VCU through the CAN signal `BMS_FlowRate_Req`. Flowrate is determined based on the operating mode.  

### Table 7: Flowrate Based on Difference Between Pack Temp and Inlet Temp  

| Difference Temp (Pack - Inlet) | BMS NOT Request Cooling/Heating | BMS Request Cooling/Heating |
|-------------------------------|----------------------------------|-----------------------------|
| -150                          | 24                               | 24                          |
| -100                          | 24                               | 24                          |
| -70                           | 24                               | 24                          |
| -15                           | 24                               | 24                          |
| -10                           | 20                               | 20                          |
| -5                            | 15                               | 15                          |
| -4                            | 12                               | 12                          |
| -3                            | 10                               | 10                          |
| -2                            | 8                                | 10                          |
| -1                            | 5                                | 10                          |
| 0                             | 0                                | 10                          |
| 1                             | 5                                | 10                          |
| 2                             | 8                                | 10                          |
| 3                             | 10                               | 10                          |
| 4                             | 12                               | 12                          |
| 5                             | 15                               | 15                          |
| 10                            | 20                               | 20                          |
| 15                            | 24                               | 24                          |
| 70                            | 24                               | 24                          |
| 100                           | 24                               | 24                          |
| 150                           | 24                               | 24                          |
Page 53
4) ON/OFF Heating conditions:

Threshold for BMS send-out request turning ON/OFF PTC Heater depends on the operating mode of the battery. 

Table 8: PTC ON/OFF operation.

| PTC ON/OFF                   | CAN signal: BMS_VCU_PTCOnOff_Req           |
| ---------------------------- | ------------------------------------------ |
| **CTC_HvBatSts**             | **Min cell temp**    | **Request PTC ON/OFF** |
| Offline                      | ≤-10 °C              | ON                   |
| **Condition: RTC wake + KL15 OFF** | >-9 °C                | OFF                  |
| Online                       | ≤10 °C               | ON                   |
|                              | >12 °C               | OFF                  |
| DC charge                    | ≤10 °C               | ON                   |
|                              | >15 °C               | OFF                  |
| AC charge                    | ≤10 °C               | ON                   |
|                              | >12 °C               | OFF                  |
| Other mode                   | -                    | OFF                  |

**Conditions:** 
- Online: Turn ON PTC Heater when the minimum cell temperature is below 10°C and turn OFF when the minimum cell temperature exceeds 12°C.
- DC charge: Turn ON PTC Heater when the minimum cell temperature is below 10°C and turn OFF when the minimum cell temperature exceeds 15°C.
- AC charge: Turn ON PTC Heater when the minimum cell temperature is below 10°C and turn OFF when the minimum cell temperature exceeds 12°C.
- Offline mode: In case the BCU wakes up by RTC and KL15 OFF, BMS requests to turn ON the Chiller when the minimum cell temperature is below -10°C and requests to turn OFF when the minimum cell temperature exceeds -9°C.
- Another mode: PTC Heater will be requested to turn OFF.

For ROW markets, BMS has a function for pre-heating conditions with periodic wake-up to check temperature. If the minimum cell temperature is below -10°C and SOC >30%, BMS will request to turn ON the PTC Heater and turn OFF the PTC Heater when the minimum cell temperature is above -9°C or SOC <30%.

BMS sends a request to turn ON/OFF to the VCU through the CAN signal: BMS_VCU_PTCOnOff_Req.
Page 54
### Signal I/O

- **Name:** BMS_CoolantOutletTemp  
  - **Description:** Temperature of Battery Coolant Outlet  
  - **Min:** -40  
  - **Max:** 215  
  - **Value Description:** [No value description provided]  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_CoolantInletTemp  
  - **Description:** Temperature of Battery Coolant Inlet  
  - **Min:** -40  
  - **Max:** 215  
  - **Value Description:** [No value description provided]  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_FlowRate_Req  
  - **Description:** Flow rate required  
  - **Min:** 0  
  - **Max:** 255  
  - **Value Description:** 255: Invalid  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_VCU_ValveOnOff_Req  
  - **Description:** Requesting VCU to turn on and off the valve  
  - **Min:** 0  
  - **Max:** 1  
  - **Value Description:** 1: Open; 0: Close  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_HeatPwrDemand  
  - **Description:** Requesting the heating power required for the battery pack  
  - **Min:** 0  
  - **Max:** 4095  
  - **Value Description:** 4095: Invalid  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_CoolPwrDemand  
  - **Description:** Requesting the cooling power required for the battery pack  
  - **Min:** 0  
  - **Max:** 4095  
  - **Value Description:** 4095: Invalid  
  - **Sender:** BMS  
  - **Receiver:** VCU  

- **Name:** BMS_VCU_PTCOnOff_Req  
  - **Description:** PTC Heater turn on and off request  
  - **Min:** 0  
  - **Max:** 1  
  - **Value Description:** 1: ON; 0: OFF  
  - **Sender:** BMS  
  - **Receiver:** VCU
Page 55
10.5. BTHM - BDU Temperature sensor control.

The hottest zone point temperature in the Battery Disconnect Unit (BDU) is monitored. The location is chosen with consideration for production convenience, and an offset is added for detection. Testing has been done on the BDU by placing the temperature sensor at various locations to identify the hottest zone.

Three target limits are set with degradation modes:
- The first target of calibrated temperature limits will de-rate the power and check if the temperature reduces.
- If the temperature further increases, it will lead to limp home mode.
- If the temperature reaches the hottest limit, the `BMS_ERR_LEV = 4` will trigger and open the contactor within FTTI time.

**State Conditions and Error Levels:**
- **BDU_Temp_Meas < -35°C:** `BMS_ERR_LEV = 2` (Limp home mode).
- **-35°C ≤ BDU_Temp_Meas < -30°C:** `BMS_ERR_LEV = 0` (No action required).
- **-30°C ≤ BDU_Temp_Meas < 85°C:** `BMS_ERR_LEV = 0` (No action required).
- **85°C ≤ BDU_Temp_Meas < 95°C:**
  - `BMS_ERR_LEV = 0` (Send warning to the Main HV Unit (MHU) to start degrading power because of high temperature in HV components).
- **95°C ≤ BDU_Temp_Meas < 105°C:** `BMS_ERR_LEV = 2` (Limp home mode).
- **BDU_Temp_Meas ≥ 105°C:** `BMS_ERR_LEV = 4` (Open the contactor within FTTI time).
Page 56
10.5. BTHM - BDU Temperature Sensor Control.

The hottest zone point temperature in the BDU is monitored. The location is chosen as per production convenience into consideration, requiring an offset added for detection. Testing has been conducted on the BDU by placing the temperature sensor at different locations to identify the hottest zone.

Three target limits are set with degradation modes:
1. The first calibrated temperature limit will initiate power derating and check whether the temperature reduces.
2. If the temperature continues to rise, the system will activate limp home mode.
3. If the temperature reaches the highest limit, BMS_ERR_LEV = 4 is triggered, and the contactor is opened within FTTI time.

Conditions and Associated BMS_ERR_LEV:
- BDU_Temp_Meas < -35°C: BMS_ERR_LEV = 2 – Limp home mode.
- -35°C ≤ BDU_Temp_Meas < -30°C: BMS_ERR_LEV = 0.
- -30°C ≤ BDU_Temp_Meas < 85°C: BMS_ERR_LEV = 0.
- 85°C ≤ BDU_Temp_Meas < 95°C: BMS_ERR_LEV = 0. A warning is sent to MHU to start degrading power due to high battery temperature affecting HV components.
- 95°C ≤ BDU_Temp_Meas < 105°C: BMS_ERR_LEV = 2 – Limp home mode.
- BDU_Temp_Meas ≥ 105°C: BMS_ERR_LEV = 4. The contactor is opened within FTTI time.

---

10.6. BTHM - BDU Thermal Runaway Detection.

Assumption: The cell fulfills EUCAR L4 or better.

Based on cell manufacturer information, cells fulfill EUCAR L4 until 125°C. The pack is permitted to discharge until 60°C. Thermal runaway detection involves continuously calculating the temperature gradient. This gradient is only considered when the temperature exceeds the thermal runaway limit and rises between a calibrated X °C/s threshold.

When thermal runaway occurs:
- A warning is detected and triggered.
- Warning information is sent to MHU.

Signal I/O:
- Name: BMS_ThermalRunaway.
  - Description: Thermal runaway detection.
  - Min: 0, Max: 1.
  - Value Description:
    - 1: Warning.
    - 0: No warning.
  - Sender: BMS.
  - Receiver: MHU.
Page 57
11. Battery Vehicle Communication.

11.1. BVC - Function Description.  
The Battery Vehicle Communication function is responsible for acquisition and processing of signals received from the vehicle or other external devices via CAN. The Battery Vehicle Communication function is divided into initialization tasks and 10ms, 100ms, and 1000ms tasks for received and transmitted signals respectively. Additionally, there is a separate 10ms task for signals of Battery Data Access Rx message. Each task is called individually by the operating system.

The function contains:  
- Handling of service command.  
- Reset at 10ms cycle time during the ignition voltage signal is turned on.  
- Monitoring of CAN communication.  
- Acquisition and forwarding of HV battery mode request.  

11.2. BVC - VCU State Request.  
The battery state request is set to the states that are known for the other BMS ASW components.  

Table 9: VCU State Request.  
| VCU_BMS_HVOnOff_REQ | VCU_ChargeAllow | VCU_DcChgGunIn | VCU_AcChgGunIn | HV state       |
|----------------------|-----------------|----------------|---------------|----------------|
| 1                    | 0 or 1         | 1              | 0             | DC_HV_ON       |
| 1                    | 0 or 1         | 0 or 1         | 1             | AC_HV_ON       |
| 1                    | 0 or 1         | 0              | 0             | HV_ON          |
| 0                    | 0 or 1         | 0 or 1         | 0 or 1        | HV_OFF         |

1. Offline.  
2. Online.  
3. AC Charge.  
4. DC Charge.
Page 58
11. Battery Vehicle Communication.

11.1. BVC - Function Description.

The Battery Vehicle Communication function is responsible for acquisition and processing of signals received from the vehicle or other external devices via CAN. The function is divided into initialization tasks and 10ms, 100ms, and 1000ms tasks for received and transmitted signals respectively. Additionally, a separate 10ms task handles signals of Battery Data Access Rx messages. Each task is individually called by the operating system.

This function contains:
- Handling of service commands.
- Reset at 10ms cycle time during ignition voltage signal activation.
- Monitoring of CAN communication.
- Acquisition and forwarding of HV battery mode request.

11.2. BVC - VCU State Request.

The battery state request is aligned with states recognized by other BMS ASW components.

**Table 9: VCU State Request.**

| VCU_BMS_HVOnOff_REQ | VCU_ChargeAllow | VCU_DcChgGunIn | VCU_AcChgGunIn | HV state             |
|-----------------------|-----------------|-----------------|-----------------|----------------------|
| 1                     | 0 or 1         | 1               | 0               | DC_HV_ON (DC charging) |
| 1                     | 0 or 1         | 0 or 1          | 1               | AC_HV_ON (AC charging) |
| 1                     | 0 or 1         | 0               | 0               | HV_ON (drive Online)   |
| 0                     | 0 or 1         | 0 or 1          | 0 or 1          | HV_OFF                |

Descriptions of states:
1. **Offline:** High Voltage is in OFF state (No Charging and No Discharging, i.e., Parking condition of the vehicle).
2. **Online:** High Voltage is ON and the vehicle is in driving mode.
3. **AC Charge:** High Voltage is ON and the vehicle is charging with AC Power.
4. **DC Charge:** High Voltage is ON and the vehicle is charging with DC Power.

11.3. BVC - Discharge Power 3D Data.

Cell operating limits are considered for discharging and charging. In DC charging mode, the target is to achieve 10% SOC to 70% SOC within a 24-minute interval, evaluated over varying temperature ranges. The DC charging profile complies with the SDI specification (refer to "SFC_Profile.xlsx").

Conditions for AC charge:
- Charge allow flag from VCU is set.
- Request to close contactors from VCU is set (disabling done via calibration).
- AC charging gun is plugged in.

Conditions for DC charge:
- Charge allow flag from VCU is set.
- Request to close contactors from VCU is set (disabling done via calibration).
- DC charging gun is plugged in.

AC and DC charge profiles are shared with VCU during charging modes.

**AC/DC Charging Profile:**
- Temperature zone: 10°C to 45°C.
- SOC zone: 10% to 70%.
- Maximum charging current: 2.1C (470A).
Page 59
VinES VFDSXVBAT1061  
Version: 3  
Uncontrolled copy when printed  
59 | 101  

SFC Profile Information at room temperature:  
**BCF_IChLimForDcCh_M**: Charge current limit for DC-Charge (Profile 2.1C).

**Table 10: SFC - DC Charging Profile**  
The DC charge current limit profile is outlined across various SOC and temperature ranges. Maximum charge current is limited to 470A for temperatures between 15°C and 35°C for SOC ranges 10% to 70%. For temperatures below 0°C, charge current is requested for short intervals of less than 10 seconds. The profile ensures protection against overcharging while considering thermal limitations.

**To avoid protect overcharge current when heating:**                 
In OBC or DC charging stations, BMS allows charging for a short time when temperature is <0°C. VCU must ensure charge current through BMS remains under 10 seconds when temperature is <0°C.

---

**BCF_IChLimForAcCh_M**: Charge current limit for AC-Charge (Profile 0.3C).  

**Table 11: AC Charging Profile**  
The AC charge current limit profile specifies charging rates for temperatures and SOC levels. Similar to DC charging, the maximum AC charge current is capped at 67.68A for temperatures between 15°C and 35°C within SOC ranges of 10% to 70%. For temperatures under 10°C, constraints and safety mechanisms for short-term intervals also apply.

AC charge and DC charge regulation ensure that BMS operates within defined safety thresholds for optimal performance. The profiles, "VF8_HVBP_Power Map.xlsx" and "SFC_Profile.xlsx," provide specific charge current and temperature configurations.
Page 60
Signal I/O

Name: BMS_ChgVoltage_REQ  
Description: Charge Voltage Request  
Min Value: 0  
Max Value: 800  
Value Description: 16383: Invalid  
Sender: BMS  
Receiver: VCU  

Name: BMS_ChgCurrent_REQ  
Description: Charge Current Request  
Min Value: 0  
Max Value: 1500  
Value Description: 4095: Invalid  
Sender: BMS  
Receiver: VCU
Page 61
11.4. BVC - HMI (MHU/IPC) Communication.

Display and Operation concept (HMI/MHU/IPC):
1. **BMS Sends Remaining Charging Time for Display.**  
   Remaining Charging time is calculated for AC and DC Charging and the time is sent from BMS to display the value to the customer.  

   *Note:* The accuracy of the remaining charging time calculation will be affected by ripple present in the charger. Lower ripple of 1A provides accurate remaining time within minutes. If there is more ripple, the remaining charging time jumps.

**DISPLAY Warnings (HMI/MHU/IPC):**

- **Message:**  
  **BMS_ID 0x493_Battery high temperature warning [BIT 12, 13].**  
  **Description:**  
  - BMS_PackTempSts = 0x2 "Under Temperature Warning."  
    UT - The Vehicle EV Battery temperature has fallen below the recommended range. To avoid damage, please stop driving and connect the charger to heat up the battery pack. If the issue persists, contact VinFast Service. Refer to the User Manual.    
  - BMS_PackTempSts = 0x1 "Over Temperature Warning."  
    OT - The Vehicle EV Battery temperature has exceeded the recommended range. To avoid damage, please stop driving and allow the battery to cool. If the issue persists, contact VinFast Service. Refer to the User Manual.    
  - BMS_PackTempSts = 0x0 "No warning."  
  **Priority:** 2.

- **Message:**  
  **BMS_ID 0x493_Thermal Runaway [BIT 14].**  
  **Description:**  
  - BMS_ThermalRunaway = 0x1 "Warning."  
    Please get out of your vehicle immediately.    
  - BMS_ThermalRunaway = 0x0 "No Warning."  
  **Priority:** 1.

- **Message:**  
  **BMS_ID 0x493_Battery Replacement [BIT 15].**  
  **Description:**  
  - BMS_BatteryReplacement = 0x1 "Warning."  
    Vehicle EV battery needs to be replaced soon. Continue to use the battery might lead to a shortage in travel distance or other unexpected issues. Please contact VinFast Service to replace your battery.    
  - BMS_BatteryReplacement = 0x0 "No Warning."  
  **Priority:** 9.

- **Message:**  
  **BMS_ID 0x493_Battery Malfunction [BIT 21].**  
  **Description:**  
  - BMS_MalfunctionSts = 0x1 "Malfunction indicator lamp ON."  
    Battery Malfunction. EV battery cannot function normally. System functionality is impacted. Stop the vehicle in a safe place.    
  - BMS_MalfunctionSts = 0x0 "No Malfunction."  
  **Priority:** 3.
Page 62
11.4. BVC - HMI (MHU/IPC) Communication.

**Display and Operation Concept (HMI/MHU/IPC):**
1. *BMS Sends Remaining Charging Time for Display:* 
   - Remaining charging time is calculated for AC and DC Charging, and the time is sent from BMS to display the value to the customer.
   - *Note:* Higher ripple (above 1A) in the charger affects the accuracy of remaining charging time calculation.

---

**DISPLAY Warnings (HMI/MHU/IPC):**

| Message ID                | Status Key                              | Description                                                                                  | Priority |
|---------------------------|-----------------------------------------|----------------------------------------------------------------------------------------------|---------|
| **BMS_ID 0x493_Battery high temperature warning [BIT 12, 13]** | **BMS_PackTempSts** : <br> - 0x2 "Under Temperature Warning". <br> - 0x1 "Over Temperature Warning". <br> - 0x0 "No warning". | UT: EV Battery temperature below recommended range. Stop driving and connect the charger to heat battery. <br> OT: Battery temperature exceeded recommended range. Stop driving and allow cooling. Refer User Manual for more details. | 2 |
| **BMS_ID 0x493_Thermal Runaway [BIT 14]** | **BMS_ThermalRunaway** : <br> - 0x1 "Warning". <br> - 0x0 "No Warning". | Immediate evacuation is required.                                                            | 1 |
| **BMS_ID 0x493_Battery Replacement [BIT 15]** | **BMS_BatteryReplacement** : <br> - 0x1 "Warning". <br> - 0x0 "No Warning". | Vehicle EV battery needs replacement. Continuing to use the battery may lead to vehicle range reduction or unexpected functionality issues. Contact VinFast service to replace your battery. | 9 |
| **BMS_ID 0x493_Battery Malfunction [BIT 21]** | **BMS_MalfunctionSts** : <br> - 0x1 "Malfunction indicator lamp ON". <br> - 0x0 "Malfunction indicator lamp OFF". | Battery malfunction detected. Stop driving in a safe location and contact VinFast service for inspection.                                                                                                  | 3 |
| **BMS_ID 0x493_Low Battery Warning [BIT 22, 23]** | **BMS_LowBattery** : <br> - 0x2 "Extremely low level". <br> - 0x1 "Low level". <br> - 0x0 "No warning". | EV battery voltage is critically low. Proceed to the nearest charging station promptly.       | 4 |
| **BMS_ID 0x493_Battery delta temperature warning [BIT 20]** | **BMS_PackDeltaTSts** : <br> - 0x1 "Level 1 Warning". <br> - 0x0 "No warning". | Level 1 delta temperature warning detected. Vehicle switching to turtle mode (Limp Home Mode).                                                                               | 3 |
| **BMS_ID 0x493_Battery delta temperature warning [BIT 19]** | **BMS_PackDeltaTSts** : <br> - 0x1 "Extreme Level 2 Warning". <br> - 0x0 "No warning". | Extreme level 2 delta temperature warning. Vehicle stopped; evacuate for safety and contact VinFast service immediately.                                                    | 2 |
| **BMS_ID 0x493_Battery Isolation Error [BIT 18]** | **BMS_PackIsoSts** : <br> - 0x1 "Level 3 Warning". <br> - 0x0 "No warning". | Level 3 isolation warning detected. Vehicle enters turtle mode; contact nearest VF Service center for assistance.                                                         | 5 |
| **BMS_ID 0x493_Vehicle HVIL Error [BIT 17]** | **BMS_VehHVILSts** : <br> - 0x1 "HVIL Error". <br> - 0x0 "No warning". | HVIL error detected in vehicle system. Complete your trip safely or proceed to nearest VF service station for inspection and rectification.                              | 6 |
| **BMS_ID 0x493_Battery Delta SOC Warning [BIT 16]** | **BMS_PackDeltaSocSts** : <br> - 0x1 "Warning". <br> - 0x0 "No warning". | EV battery SOC variance detected, causing reduced range. Use the vehicle as normal for multiple cycles, and frequently contact VF Service if the issue persists.        | 8 |
| **BMS_ID 0x493_Battery BDU temperature warning [BIT 16]** | **BMS_PackDeltaSocSts** : <br> - 0x1 "BDU Temperature Warning". <br> - 0x0 "No warning". | Elevated EV battery temperature. Reduced vehicle power will self-recover as temperatures stabilize.                                                                    | 7 |
| **BMS_ID 0x493_Battery**                          | **BMS_PackDeltaSocSts** : <br> - 0x1 "BDU Hot". | EV battery reaches critical temperature; vehicle requests Limp Home Mode.                                                         | 7 |
Page 63
**BDU HOT Warning Details.**  
- BMS_PackDeltaSocSts = 0x0 "No warning".  

**BDU Extreme HOT Warning Details (BIT 31):**  
- BMS_PackDeltaSocSts = 0x1 “BDU Extreme Hot".  
- BMS_PackDeltaSocSts = 0x0 "No warning".  
Description: Vehicle is stopped due to extreme high temperature of the EV Battery parts. Allow Battery Pack to cool down and start the trip.  
Priority: 7.  

**BVC – CAN Crash Signal Function Description:**  
When the crash is detected by the Airbag Control Module (ACM), the ACM sends the crash signal to the Gateway ECU. The Gateway ECU provides the ACM_Crash_Sts signal to PT-CAN. This signal is received by the BMS to detect crash and no-crash status of the vehicle.  

When BMS receives ACM_Crash_Sts = 1 (Crash), the BMS sends the following instructions:  
1. BMS_ERR_LEV = 7 is sent to VCU.  
2. The high voltage contactor is immediately opened.  
3. BMS_HVOnOff_STS is set to HV Off once the high voltage is broken.  

**Signal I/O Table – Crash Information Signal:**  
1. **Name:** ACM_Crash_Sts.  
   **Description:** Crash information from Airbag Control Module.  
   **Minimum Value:** 0 (No Crash).  
   **Maximum Value:** 1 (Crash).  
   **Sender:** ACM.  
   **Receiver:** BMS.
Page 64
12. BCTE - Battery Charge Time Estimation.

12.1. BCTE - Function Overview.
This function shall estimate and output the battery charging remaining time. The output would be the maximum charging time in hours and minutes.

12.2. BCTE - Function Description.
Calibration approach: This uses a 4-D map table based on cell temperature, coolant temperature, SOC, and maximum current available from the charger. The map table is built from experimental results. Remaining charge time output from this method is time_B.

### Signal I/O:
- **Name**: BMS_RemainChargeTime  
  **Description**: Remain charge time sent to other ECU (XGW - IPC).  
  **Minimum Value**: 0  
  **Maximum Value**: 16383  
  **Value Description**: 1023: Invalid.  
  **Sender**: BMS.  
  **Receiver**: XGW.
Page 65
13. BWLD - Battery Warranty Logistic Data.

13.1. BWLD - Function Overview.
This function calculates specified battery states throughout the whole battery life cycle. These states shall be seen as a history of the battery usage, e.g., for possible warranty claims, respectively as useful data during development phases. Therefore, these states shall represent the key data of the battery to enable conclusions in case of battery problems.

The function also serves as back-end for the PC-based GUI tool, which is used to connect to the BMS and readout specific data as well as request special service modes.

13.2. BWLD - Function Description.
This function is divided into a 10ms, 100ms, and 1000ms task, depending on the input data recurrence. Each task is individually called by the operating system.

**Data Log for 1000ms:**  
Increment the battery-aging counter by one per second if the high voltage connection to the vehicle or charger is established.

**Data Log for 100ms:**  
The 100ms function is calculating the following minimum and maximum values:  
- Cell voltage  
- Battery SOC  
- Cell temperature  

It is possible to reset all values by service command 23 or with a calibration parameter.  

The measured values are only taken into account if the following conditions are valid:  
- Error level below or equal “3” (a higher error level can result in faulty values).  
- BCU state is “1” for more than one cycle (necessary since some values like the SOC need an additional cycle to output correct values).  

**Battery SOC:**  
When BCU conditions are valid, the Minimum and Maximum SOC of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.

**Cell Temperature:**  
When BCU conditions are valid, the Minimum and Maximum cell temperature of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.

**Cell Voltage:**  
When BCU conditions are valid, the Minimum and Maximum cell voltage of the battery pack are stored in the memory. The Service command and the calibration parameter are used to reset these values.
Page 66
12. BCTE - Battery Charge Time Estimation.

12.1. BCTE - Function Overview.  
This function shall estimate and output the Battery charging remaining time. The output would be the maximum charging time in hours and minutes.

12.2. BCTE - Function Description.  
The calibration approach uses a 4-D map table based on cell temperature, coolant temperature, SOC, and maximum current available from the charger. The map table is built from experimental results. Remaining charge time output from this method is referred to as time_B.

Signal I/O:

- **Name**: BMS_RemainChargeTime.  
- **Description**: Remain Charge Time sent to other ECU (XGW - IPC).  
- **Min**: 0.  
- **Max**: 16383.  
- **Value Description**: 1023:Invalid.  
- **Sender**: BMS.  
- **Receiver**: XGW.  

13. BWLD - Battery Warranty Logistic Data.

13.1. BWLD - Function Overview.  
This function calculates specified battery states throughout the whole battery life cycle. These states serve as a history of battery usage for possible warranty claims and as useful data during development phases. Thus, these states represent key data of the battery enabling conclusions in case of battery problems.

Additionally, this function serves as a back-end for the PC-based GUI tool, which enables connection to the BMS for reading specific data and requesting special service modes.

13.2. BWLD - Function Description.  
The function is divided into 10ms, 100ms, and 1000ms tasks depending on the recurrence of input data. Each task is individually called by the operating system.

**Data Log for 1000ms**:  
- Increment the battery-aging counter by one per second if the high voltage connection to the vehicle or charger is established.

**Data Log for 100ms**:  
- The 100ms function calculates the minimum and maximum values:
  - Cell voltage.
  - Battery SOC.
  - Cell temperature.

It is possible to reset all values by service command 23 or with a calibration parameter. The following conditions must be valid for measured values:
- Error level is below or equal to “3” (higher error levels may lead to faulty data).
- BCU state is “1” for more than one cycle (since certain values, like SOC, need additional cycles for accurate output).

- **Battery SOC**: Minimum and maximum SOC of the battery pack are stored in memory when BCU conditions are valid. These values can be reset using service commands or calibration parameters.
- **Cell Temperature**: Minimum and maximum cell temperature during valid BCU conditions are logged in the memory. Values can be reset via service commands or calibration parameters.
- **Cell Voltage**: Minimum and maximum cell voltage in valid BCU conditions are stored in memory. Resetting these values is performed using service commands or calibration parameters.

**The 10ms function calculates the following values**:
- Minimum and maximum battery voltage in closed and open contactor states.
- Battery energy during charging and discharging across the entire battery life cycle and the current driving cycle.
- Maximum power during charging and discharging.
- Maximum current during charging and discharging.
- Amount of non-volatile MCU write operations.

Reset of values is possible using service commands or calibration parameters. Conditions for measured values:
- Error level below or equal to “3” (faulty values may occur with higher error levels).
- BCU state is “1” for more than one cycle (some values like SOC may need multiple cycles for precision).

**Microcontroller NVM Write Operations**:  
- The microcontroller has a limited count of valid non-volatile write operations. The non-volatile write operations counter tracks these during battery life and can be reset to 0 using calibration parameters.

**BWLD Stored in the Pack Life Cycle**:  
The battery pack life cycle logs include:
- Total energy stored in the battery during its life cycle.
- Total energy supplied by the battery during its life cycle.
- Maximum current during charging and discharging during its life cycle.
- Maximum power during battery charging and discharging within its life cycle.
- Maximum and minimum SOC during its life cycle.
- Time spent in use with closed contactors.
- Maximum and minimum temperatures recorded by sensors in battery modules during its life cycle.
- Maximum and minimum voltage with closed and open contactors during its life cycle.
- Maximum and minimum cell voltages during its life cycle.

UDS services allow reading of the BWLD data.
Page 67
14. BPP - Battery Protection Pack.

14.1. BPP - Function Description.  
Normal Mode:  
This module collects all available current flow signals and transmits one valid current. The primary current sensor is selected by a calibration parameter unless an exception occurs, such as a sensor failure or detection of a current flow exceeding the operational range of a sensor.  

Diagnoses:  
The battery protection module executes multiple diagnoses to report battery safety status through transmitted error flags to diagnostic event modules and current limitations to the vehicle interface and other internal modules. Priority is given to protecting humans from harm caused by battery malfunction, as well as safeguarding the battery hardware itself.

Diagnosis enablement or disablement depends upon the current battery state and module initialization state. Voltage acquisition diagnosis is temporarily disabled during contactor switching events. If the current flow exceeds the operational range of at least one sensor, current sensor plausibility diagnosis is disabled. Resistance and voltage plausibility diagnoses are temporarily disabled during significant current gradients.

14.2. BPP - Pack Resistance.  
This function identifies significant increases in pack resistance. The resistance is calculated using the last 5 stored current and voltage values when the current gradient exceeds a specified limit. Accuracy improves with higher current flow.  

The diagnosis is inhibited if:  
- The actual current flow is smaller than a defined minimum.  
- Calculation is imprecise during low current flow.  
- An error is active in one of the current sensors.  
- A defined timer after diagnosis activation has not passed.  
- The cycler allows execution.  

14.3. BPP - Cell Temperature Limit.  
This function monitors cell temperatures to detect exceedances. The input temperature values are compared to calibrated minimum and maximum limits, inducing corresponding error and warning symptoms.  

14.4. BPP - Controller Temperature Limit.  
This function detects exceedances of controller temperatures. It calculates the controller temperature diagnosis and compares the measured temperature against the limit.
Page 68
14. BPP - Battery Protection Pack.

14.5. BPP - SOC Limit.
Detect an exceedance of the module SOC limit. This system includes the core algorithm of the state of charge limit diagnosis. Each value of the input array is compared to calibrated minimum/maximum limits and induces corresponding error and warning symptoms.

14.6. BPP - SOH Limit.
Detect an exceedance of the pack SOH. This system includes the core algorithm of the state of health limit diagnosis. The current state of health value gets compared against three calibratable limits. If necessary, a corresponding error symptom is transmitted to the error manager. 

When SOH < 5%, Battery Replacement warning will be sent. Real Battery SOH is around 71.5%. When SOH < 0%, still Battery Replacement warranty will be sent. Real Battery SOH < 70%.

**Max Charge available capacity:**
- < 70% 
- 71.5% -> 70%
- 100% -> 71.5%

**SOH (Signal: BMS_SOH):**
- 0%
- 5% -> 0%
- 100% -> 5%

14.7. BPP - Pack Voltage Limit.
Detect an exceedance of the pack voltage limit (min/max). This system includes the core algorithm of the pack voltage limit diagnosis. The pack voltage ‘U1’ is compared against minimum/maximum warning and error limits. Limits are chosen according to the input signal containing information on the minimum measured raw cell temperature of the battery pack.

**Signal I/O:**
- **Name:** BMS_LowBattery  
- **Description:** Low Battery Warning (Pack Level).  
- **Min:** 0  
- **Max:** 15  
- **Value Description:**  
  - 2: Extremely low level (less than 275V).  
  - 1: Low level (less than 300V).  
  - 0: No warning.  
- **Sender:** BMS  
- **Receiver:** VCU.
Page 69
14.8. BPP - Contactor Release Inhibition.

In case there is an extremely high current flow, the contactors must not open instantly to enable the fuse to clear. Opening a contactor during extremely high current flow could destroy it.

The contactors will disconnect the circuit anyway, even if the fuse does not clear, but with a delay. The generated inhibition command is transmitted to the contactor control module, which will delay the opening of the contactors as long as this command is true.

The length of the inhibition command shall be configured by a calibration value. As per the design parameters, the length of time required to make the contactor enter inhibition state is approximately 100ms.

### Pulsed Current Configuration:
- Pulsed Current (A): 6000
- Pulse Duration (ms): 100

#### Figure 18: Over Current Configuration
This figure illustrates the current threshold limits for contactor operation and fuse clearance. It highlights the safe operation range, the damage threshold, and the overlapping conditions for switching and fusing scenarios.
Page 70
15. CDEM - Common Diagnostic Event Manager.

15.1. CDEM - Architecture Overview.

The common diagnostic event manager consists of four main parts:

1. **10ms recurring task:** 
   - Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.

2. **SetStatus Call:** 
   - Changes the error status of a specific ID.

3. **GetStatus Call:** 
   - Returns the error status of a specific ID.

4. **Init task:** 
   - Updates the error information at BCU startup.
Page 71
15. CDEM - Common Diagnostic Event Manager.

15.1. CDEM - Architecture Overview.

The common diagnostic event manager consists of four main parts:
- **10ms recurring task:** Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.
- **SetStatus Call:** Changes the error status of a specific ID.
- **GetStatus Call:** Returns the error status of a specific ID.
- **Init task:** Updates the error information at BCU startup.

---

15.2. CDEM - Function Description.

**Normal Mode**

The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data.

### Status byte information pattern:
- `0x01` Test failed.
- `0x02` Test failed this cycle.
- `0x04` Test failed last cycle (different from ISO 14229).
- `0x08` Confirmed diagnostic trouble code (unused).
- `0x10` Test not completed since clear.
- `0x20` Test failed since clear.
- `0x40` Test not completed this cycle.
- `0x80` Warning indicator requested (unused).

The status ID mapping is based on array position (e.g., the error with ID 20 is stored at array position 20).

### Error Memory Operations
- **Operation Cycle Definition:** One operation cycle is defined as BCU startup to BCU shutdown.
- **Error Memory Clearing:** The error memory shall be cleared by setting the service command to `$10`, equivalent to a service tool clear request.
- **Error Memory Reinitialization:** The error memory shall be reinitialized by setting the service command to `$11`, which resets the error memory to its initial state, identical to the post-flashing state of the BCU.
Page 72
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.
The common diagnostic event manager consists of four main parts:
- **10ms recurring task:** Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.
- **SetStatus Call:** Changes the error status of a specific ID.
- **GetStatus Call:** Returns the error status of a specific ID.
- **Init task:** Updates the error information at BCU startup.

15.2. CDEM - Function Description.
**Normal Mode:**  
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229 with some exceptions, as the module does not provide full OBD support; however, it provides some data required by a full OBD system.

**Status byte information pattern:**
- **0x01:** Test failed.
- **0x02:** Test failed this cycle.
- **0x04:** Test failed last cycle (different from ISO 14229).
- **0x08:** Confirmed diagnostic trouble code (unused).
- **0x10:** Test not completed since clear.
- **0x20:** Test failed since clear.
- **0x40:** Test not completed this cycle.
- **0x80:** Warning indicator requested (unused).

The **status ID mapping** is based on array position. For example, the error with ID 20 is stored at array position 20. 

**Operation cycle:**  
One operation cycle is defined as BCU startup to BCU shutdown.

**Clear error memory:**  
The error memory shall be cleared by setting service command to $10, equivalent to a service tool clear request.

**Reinitialize error memory:**  
The error memory shall be reinitialized by setting service command to $11, which resets the error memory to the initial state, identical to the state after flashing the BCU.

To ensure sufficient error information is available on the CAN network:
- The function transmits one error byte per 10ms cycle due to limited CAN bandwidth.
- A prioritization mechanism allows important error IDs to be transmitted faster if actively set.

The diagnostic event manager is implemented using several C-Code parts as custom code blocks.

**Figure 20: DCEM Code Blocks.**  
The diagram outlines the top-level system for the common diagnostic event manager and its four main parts:
1. 10ms recurring task.
2. SetStatus Call.
3. GetStatus Call.
4. Init task.

Errors, both active and old, can be cleared using the service tool via specific service commands.
Page 73
15. CDEM - Common Diagnostic Event Manager

15.1. CDEM - Architecture Overview.
The common diagnostic event manager consists of four main parts:
- **10ms recurring task:** Updates the error information upon clearance command, re-initialize command, reset command, and prepares the error information data for CAN transmission.
- **SetStatus Call:** Changes the error status of a specific ID.
- **GetStatus Call:** Returns the error status of a specific ID.
- **Init task:** Updates the error information at BCU startup.

15.2. CDEM - Function Description.
- **Normal Mode:** The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229, however, with some exceptions as this module does not provide OBD support. Still, the module provides part of the data a full OBD system requires.

**Status byte information pattern:**
- 0x01: test failed.
- 0x02: test failed this cycle.
- 0x04: test failed last cycle (different to ISO 14229).
- 0x08: confirmed diagnostic trouble code (unused).
- 0x10: test not completed since clear.
- 0x20: test failed since clear.
- 0x40: test not completed this cycle.
- 0x80: warning indicator requested (unused).

The status ID mapping is based on array position (e.g., the error with ID 20 is stored at array position 20).

- **Operation Cycle:** One operation cycle is defined as BCU startup to BCU shutdown. 
- The error memory shall be cleared by setting service command to `$10`. This action is equal to a service tool clear request.
- The error memory shall also be reinitialized by setting the service command to `$11`, which resets the error memory to its initial state as after flashing the BCU.

15.3. CDEM_ErrDisp.
This system contains the recently active errors. Active errors are listed in an array (most recent error in position 0). If the array is full and receives a new active error, the oldest error will be removed. If an error already listed becomes active again, it will be promoted to position 0. Error IDs are displayed as real text (enumeration).

15.4. CDEM_ReadStsAryCmd_P.
This parameter defines how the error information `CDEM_StsReadInfo` is configured for CAN transmission. There are multiple configuration options:
- **0:** send bit 0 (test failed).
- **1:** send bit 1 (test failed this cycle).
- **2:** send bit 2 (test failed last cycle).
- **3:** send bit 3 (unused).
- **4:** send bit 4 (test not completed since clear).
- **5:** send bit 5 (test failed since clear).
- **6:** send bit 6 (test not completed this cycle).
- **7:** send bit 7 (unused).
- **254:** send whole byte.
- **255:** output deactivated (always 0).

15.5. CDEM_Clear Status Array.
Clear the entire status array of active error information. This task is executed on request, typically via a service tool.

15.6. CDEM_ReInitialization Status Array.
Reinitialize the entire status array by overwriting it with initial values. This is used to delete stored error information since the beginning of the cycle and is primarily for testing purposes.

10ms Task:
This system operates subsystems like `CDEM_StsReadInfo` and `CDEM_StsReadInfoId`, which prepare and send error information via CAN during each 10ms cycle:
- **CDEM_StsReadInfo:** Contains the error information (8-bit).
- **CDEM_StsReadInfoId:** Contains the corresponding error ID (16-bit).
- How the information is sent is configurable through `CDEM_ReadStsAryCmd_P`. Testing requires recording these variables for error analysis during test runs.

**Figure 20: DCEM Code Blocks.**
The top-level system of the common diagnostic event manager contains:
1. 10ms recurring task.
2. SetStatus Call.
3. GetStatus Call.
4. Init task.

Active error and old error information can be cleared via service commands provided by the testing tool.
Page 74
15. CDEM - Common Diagnostic Event Manager 

15.2. CDEM - Function Description.

Normal Mode.  
The diagnostic event manager module stores all error/status information in an array of configurable length. Each status information consists of 8 bits (one byte) of data. This byte pattern is modeled on OBD ISO 14229, however with some exceptions, as this module does not provide OBD support. Still, the module provides a part of the data a full OBD system requires.  

Status Byte Information Pattern:
- **0x01:** Test failed.
- **0x02:** Test failed this cycle.
- **0x04:** Test failed last cycle (different from ISO 14229).
- **0x08:** Confirmed diagnostic trouble code (unused).
- **0x10:** Test not completed since clear.
- **0x20:** Test failed since clear.
- **0x40:** Test not completed this cycle.
- **0x80:** Warning indicator requested (unused).

The status ID mapping is based on array position. For example, the error with ID 20 is stored at array position 20.  

One operation cycle is defined as BCU startup to BCU shutdown.  
The error memory shall be cleared by setting service command to `$10`. This action is equal to a service tool clear request.  
The error memory shall be reinitialized by setting service command to `$11`. This sets the error memory to its initial state, which is identical to the state the memory has after flashing the BCU.  

---

In order to have sufficient error information on the CAN, the function prepares data for CAN transmission. As it is not possible to send out all status information simultaneously (due to limited CAN bandwidth), the status of one error byte per 10ms cycle is transmitted (16-bit ID + 8-bit Status). To avoid the delay of important error information, the function is able to send out specific error IDs favored (in case the error is set active).  

The common diagnostic event manager is based on several C-Code parts, which are implemented as custom code blocks.  

Figure 20: DCEM Code Blocks.  
The top-level system of the common diagnostic event manager contains four main parts:
1. **10ms recurring task.**  
2. **SetStatus Call.**  
3. **GetStatus Call.**  
4. **Init task.**  

Active error and old error information shall be cleared by using the service command from the service tool.  

---

**10ms Task:**  
This system contains the subsystems of the recurring 10ms task.  

**CDEM_StsReadInfo / CDEM_StsReadInfoId:**  
These variables are also sent via CAN and contain the information of one status byte per 10ms cycle.  
- **CDEM_StsReadInfo** contains the error information (8-bit).  
- **CDEM_StsReadInfoId** contains the corresponding ID (16-bit).  

The way the information is sent shall be set up in different ways (see CDEM_ReadStsAryCmd_P). It is advisable to record these variables during testing to have sufficient error data for analysis of test runs.  

---

### 15.3. CDEM_ErrDisp:
This array lists the recently active errors (most recent error at position 0).  
- If the array is full and there is a new active error, the oldest error is removed.
- If an error, which is already in the list, becomes active again, this error is promoted to position 0.
- The error IDs in this variable shall be displayed as real text (enumeration).  

---

### 15.4. CDEM_ReadStsAryCmd_P:
This parameter defines in which way the error information in **CDEM StsReadInfo** is configured.  
It is possible to choose between sending out single information bits (output is then either false or true) or the whole byte:

- **0:** Send bit 0 (test failed).  
- **1:** Send bit 1 (test failed this cycle).  
- **2:** Send bit 2 (test failed last cycle).  
- **3:** Send bit 3 (unused).  
- **4:** Send bit 4 (test not completed since clear).  
- **5:** Send bit 5 (test failed since clear).  
- **6:** Send bit 6 (test not completed this cycle).  
- **7:** Send bit 7 (unused).  
- **254:** Send the whole byte.  
- **255:** Output deactivated (always 0).  

---

### 15.5. CDEM_Clear Status Array:
Clear the whole status array regarding active error information.  
- This task will most likely be executed on request by some kind of service tool to remove old errors from the error memory.  

---

### CDEM_ReInitialization Status Array:
Reinitialize the whole status array.  
- When executing this task, the whole status array will be overwritten with the initial values.  
- This essentially deletes any error information stored since the beginning and is primarily used for testing.

---

### CDEM_Reset Status Array:
All active errors are reset to inactive upon wake-up signal rising edge.  
Each diagnosis is able to reactivate a specific error if it still persists.

---

### CDEM_Read Status Array:
- This subsystem of the **10ms task** is able to read error information.  
- As this data is sent via CAN, the status of only one byte is processed per 10ms cycle (8-bit Status & 16-bit ID) due to limited CAN bandwidth.  

To avoid any delay of critical error information:
- The function is able to send out specific **favored error IDs** quickly (if the error is active).

---

### CDEM_Set Status:
This is the **CDEM interface** to SET specific error information.  
- Any error information entry is handled by this interface, which can activate or deactivate specific errors.  
- The system also updates the error display array that shows recently active errors, which is useful for calibration and testing.

---

### CDEM_Get Status:
This is the **CDEM interface** to GET specific error information.  
- The corresponding module can choose which error ID and bit position (based on the status byte pattern) to retrieve.

---

### BCU Initialization:
This task will execute once per **BCU startup** during initialization.  
- Active errors will be deactivated.  
- Driving cycle information is updated.
Page 75
16. DEH - Diagnostic Event Handling.

16.1. DEH - Function Overview.

The diagnostic event-handling module consists of three main parts: The gathering of all necessary error information, the determination of an error level, and the assessment of an appropriate error reaction.

Figure 21: DEM Module Function.

16.2. DEH - Function Description.

This module uses error information stored by the diagnostic event manager in order to alter the battery state request according to the error category. The function consists of one recurring 10ms task. Initialization is done during the first execution cycle and each time a reset is triggered. The reset condition is a rising edge of the wake-up signal.

The diagnostic event-handling module collects all available error information and deduces appropriate error reactions as well as the assignment of an error level. The error level is a global indicator for all other modules, which is able to control or affect various battery management functions and inhibit the execution of specific functions to sustain a safe and secure battery operation under any circumstance.

The error level and the error reactions are generated due to the analysis of single error signals, a combination of several error signals, or based on a sequential error activation counter.

The error reaction itself depends on the current error level, the battery state request, and the current battery state. Each battery state request has to be approved and forwarded or altered by the diagnostic event-handling module.
Page 76
16. DEH - Diagnostic Event Handling.

16.1. DEH - Function Overview.  
The diagnostic event-handling module consists of three main parts: the gathering of all necessary error information, the determination of an error level, and the assessment of an appropriate error reaction.

16.2. DEH - Function Description.  
This module uses error information stored by the diagnostic event manager to alter the battery state request according to the error category. The function consists of one recurring 10ms task. Initialization is triggered during the first execution cycle and each time a reset is initiated, corresponding to the rising edge of the wake-up signal.

The diagnostic event-handling module collects all available error information and deduces appropriate error reactions alongside the assignment of an error level. The error level acts as a global indicator for all other modules, controlling or affecting various battery management functions and inhibiting the execution of specific functions to ensure safe and secure battery operation under any circumstance.

The error level and reactions are derived based on analyzing single error signals, a combination of multiple error signals, or a sequential error activation counter. The error reaction depends on the current error level, the request for the battery state, and the current battery state. Each battery state request must be approved and forwarded or altered by the module.

The error severity is divided into 7 levels:

**Table 12: BMS Error Levels.**  
- **Error Severity Level 0:** No Error.  
- **Error Severity Level 1:** Warning; possible failure reaction is activating the service lamp.  
- **Error Severity Level 2:** Limp Home; triggers limp home mode.  
- **Error Severity Level 3:** Reserved.  
- **Error Severity Level 4:** Critical Error; initiates normal battery shutdown with FTTI time.  
- **Error Severity Level 5:** Hazardous Error; triggers immediate battery shutdown.  
- **Error Severity Level 6:** Battery Disabled; inhibits battery operation temporarily, requiring BCU shutdown.  
- **Error Severity Level 7:** Battery Locked; inhibits battery operation completely and needs a service tool unlock for clearance.  

The failure reaction can include subsidiary error level reactions. For example, if the error level is 2 (limp home mode), the service lamp will also be activated and balancing algorithms could be inhibited.

- **Error Severity Level 2 to 5:** These levels can be cleared by restarting the system (ignition).  
- **Error Severity Level 6:** Requires a BCU shutdown/wakeup sequence to be cleared.  
- **Error Severity Level 7:** Can only be cleared by a dedicated clearance command sent by a service or calibration tool.  

Error level 1 is volatile and cleared automatically if no active level 1 errors persist. To clear error level 7, the service command must be set to "5." Additionally, resetting level 7 and clearing the error memory requires setting the service command to "10."

The battery system is restricted from transitioning to the online state if:
1. An active error level above 3 exists.
2. The DC link voltage exceeds safe limits (e.g., inverter control damaged).
3. The pre-charge resistor temperature is above tolerable limits after pre-charging.  

Error levels for each error shall be calibrated accordingly.
Page 77
17. BISC – Battery Current Sensor Communication.

17.1. BISC - Pack Current Measurements.
The pack current is measured by the BCU at the highest ASIL level of ASIL C to detect overcurrent fault and protect the system in a safe state. Since it is a critical parameter, a redundant sensor is used for the measurements:
1. IVT Shunt current measurements.
2. HAL Current measurements.
   
Both of these measurements are processed and the exact pack current measurement is sent over the PT-CAN.

17.2. BISC - Function Description.
The Battery Current Sensor Communication function is responsible for acquiring and processing current values measured from sensors. This function also collects and stores error information of all errors reported by current sensors. 

The Battery Current Sensor Communication function is divided into a 10ms task and an init task, which handle the acquisition and processing of current values and current sensor diagnosis and the variable initialization, respectively. Each task is executed individually by the operating system.

- **Init Task:** Initialization of all current sensors is performed in the initialization task.
- **10ms Task:** The system reads the values from the available current sensor.
   
**Current Sensor Diagnosis:**  
The following errors of current sensors are checked:
- Short-circuit error.
- Measurement error.
- System error.
- Channel error.

Additionally, an error is detected if the CAN message of current measurement has a timeout, checksum, or an alive-counter error. All errors except the short-circuit are de-bounced.
Page 78
17. BISC – Battery Current Sensor Communication

17.1. BISC - Pack Current Measurements.  
The pack current is measured by the BCU at the highest ASIL level of ASIL C to detect overcurrent fault and protect the system in a safe state.  
Since it is a critical parameter, redundant sensors are used for the measurements:  
1. IVT Shunt current measurements.  
2. HAL Current measurements.  

- Both measurements are processed, and the exact pack current measurement is sent over the PT-CAN.  

17.2. BISC - Function Description.  
- The Battery Current Sensor Communication function is responsible for acquisition and processing of current values measured from sensors. This function also collects and stores error information for all supported current sensors.  
- The Battery Current Sensor Communication function is divided into a 10ms task and an initialization task, which handle the acquisition and processing of current values and current sensor diagnostics, as well as variable initialization, respectively. Each task is called individually by the operating system.  
    - **Init Task:** Initialization of all current sensors is performed during the initialization phase.  
    - **10ms Task:** Reads the values from the available current sensors.  

**Current Sensor Diagnosis.**  
The following errors of current sensors are checked:  
- Short-circuit error.  
- Measurement error.  
- System error.  
- Channel error.  

Additionally, an error is detected if the CAN message of current measurement has a timeout, checksum, or an alive-counter error. All errors, except the short-circuit error, are de-bounced.  

### Signal I/O Table  

**Signal Name:** BMS_MalfunctionSts.  
**Description:** Malfunction status of the battery for MHU display.  
- **Min Value:** 0.  
- **Max Value:** 1.  
- **Value Description:**  
  - 1: Malfunction indicator lamp ON.  
  - 0: Malfunction indicator lamp OFF.  
- **Sender:** BMS.  
- **Receiver:** MHU.  

**Signal Name:** BMS_PackOverCurr_ERR.  
**Description:** When overcurrent is detected during charging or discharging for a given period, the BMS_PackOverCurr_ERR is set.  
- **Min Value:** 0.  
- **Max Value:** 3.  
- **Value Description:**  
  - 3: Safety error.  
  - 2: Error.  
  - 1: Warning.  
  - 0: Normal.  
- **Sender:** BMS.  
- **Receiver:** VCU.  

**Signal Name:** BMS_PackCur_MEAS.  
**Description:** Pack Current Measurement.  
- **Min Value:** -3276.8.  
- **Max Value:** 3276.7.  
- **Sender:** BMS.  
- **Receiver:** VCU.
Page 79
18. BILC - Battery Current Limit Coordinator.

18.1. BILC - Function Description.

This section describes the functionality of battery protection for current and voltage.

**Normal Mode:**

The battery protection module executes several diagnoses in order to report the status of the battery regarding safety by transmitting error flags (of each single diagnosis) to the diagnostic event modules. The topmost priority is to protect humans in the area of the battery from harm due to a malfunction and, of course, the battery pack hardware itself from damage of any kind.

The current voltage diagnosis functions are subdivided into execution task groups based on the task cycle time. These task groups include a 10ms and a 100ms task group. Each diagnosis function shall be enabled or disabled depending on the actual battery state (e.g., online, offline) and partially on error signals (basic diagnosis inhibition management). This is to prevent specific diagnoses from reporting false positive errors caused by invalid input data.

The error signals are de-bounced if necessary. Executing a reset will reinitialize all dynamic variables and diagnoses and also reset all error flags.

1. **Current Limit Detection:** Detect an exceedance of the valid current limit. As the inverter control needs some time to react to the received current limits, the tolerable delay shall be calibrated (up to 500ms). Additionally, the algorithm allows a short-term overdrive in both charge and discharge operations.

2. **Current Sensor Plausibility Detection:** Detect implausible current sensor values. In this function, the current sensor values from both current sensors are compared to a current value that is calculated from the pack voltage drop and the estimated pack resistance. Differences in these values lead to detection of a current sensor plausibility error.

3. **Plausibility Error Reset Counter Block:**  
   The block triggers a reset whenever the reset counter is changed (input from another module). A reset may, for instance, be triggered by an ignition key on event or manually through calibration.

4. **SOF – State of Function:**  
   Model-based State-Of-Function calculation includes:  
   - **Battery current limit calculation** for short-term pulses (min/max values in amps), which should be used for the charging process.
   - **Battery voltage prediction** for maximum charge and discharge (max/min values in volts).
   - **Power limitation determination** based on calculated current limit and voltage prediction.
Page 80
18. BILC - Battery Current Limit Coordinator.

18.1. BILC - Function Description.

Normal Mode:
The battery protection module executes several diagnoses in order to report the status of the battery regarding safety by transmitting error flags (of each single diagnosis) to the diagnostic event modules. The topmost priority is to protect humans in the vicinity of the battery from harm due to a malfunction and to prevent damage of any kind to the battery pack hardware.

The current voltage diagnosis functions are subdivided into execution task groups based on the task cycle time, which include 10ms and 100ms task groups. Each diagnosis function shall be enabled or disabled depending on the actual battery state (e.g., online, offline) and partially on error signals through basic diagnosis inhibition management. This ensures that specific diagnoses do not report false positive errors caused by invalid input data.

The error signals are de-bounced when necessary. Executing a reset will reinitialize all dynamic variables and diagnoses and reset all error flags.

**Current Limit:** Detect an exceedance of the valid current limit. As the inverter control requires some time to react to received current limits, the tolerable delay is calibrated (up to 500ms). Additionally, the algorithm allows short-term overdrive in both charge and discharge operations.

**Current Sensor Plausibility:** Detect implausible current sensor values. Current sensor values from both current sensors are compared to a calculated current value derived from the pack voltage drop and estimated pack resistance. Differences in these values lead to the detection of a current sensor plausibility error.

**Plausibility Error Reset Counter Block:** This block triggers a reset whenever the reset counter is modified from input of another module. A reset can be triggered by events such as ignition key activation or manual calibration.

**SOF – State of Function:** Model-based State-Of-Function calculation includes:

- Battery current limit calculation for short-term pulses (min/max values in [A]) used for charging processes.
- Battery voltage prediction for maximum charge and discharge operations (max/min values in [V]).
- Power limitations determined by calculated current limits and voltage predictions.

18.2. BILC - Over Current Function Description.

Permissible current values during charging and discharging are provided for instantaneous and continuous operations. The VCU permits operations within the permissible current regions.

- BMS calculates the maximum allowable peak discharge current in real-time using a 3D data table and sends it via CAN (BMS_AllowDischgCurrPeak). This value regulates the peak interval discharge current drawn from the high-voltage battery pack and adheres to 10s configuration for requirements.
- BMS calculates the maximum allowable continuous discharge current in real-time using a 3D data table, transmitting it via CAN (BMS_AllowDischgCurr). This value regulates continuous discharge current drawn from the high-voltage battery pack.
- BMS calculates the maximum allowable peak charge current using a 3D data table and transmits it via CAN (BMS_AllowChgCurrPeak). This configures the 10s interval for regen current delivered to the high-voltage battery pack.
- BMS calculates the maximum allowable continuous charge current using a 3D data table, transmitting it via CAN (BMS_AllowChgCurr). This regulates continuous regen current delivered to the high-voltage battery pack.

**Signal I/O:**

| Name                   | Description                                          | Min | Max | Value Description                            | Sender | Receiver |
|------------------------|------------------------------------------------------|-----|-----|---------------------------------------------|--------|----------|
| BMS_AllowDischgCurr    | Continuous maximum allowable discharge current       | 0   | 1500 | -                                           | BMS    | VCU      |
| BMS_AllowDischgCurrPeak| Peak maximum allowable discharge current             | 0   | 1500 | -                                           | BMS    | VCU      |
| BMS_AllowChgCurr       | Continuous maximum allowable charge current          | 0   | 1500 | -                                           | BMS    | VCU      |
| BMS_AllowChgCurrPeak   | Peak allowable charge current                        | 0   | 1500 | -                                           | BMS    | VCU      |
Page 81
19. EHPN - Electrical Hazard Protection Network (Insulation detection).

This module handles the isolation detection as described in the document “SAE J1766 - Revision APR2005.” It executes the measurement procedure and calculates the isolation resistance. Additionally, the module handles the interlock mechanism input to detect an open high voltage connection.

19.1. EHPN - ISO Function Description.

The function electrical hazard protection includes the isolation detection and interlock mechanism.

Isolation detection:
- The isolation detection calculates the isolation resistance out of voltage measurements between the vehicle chassis and the high voltage connection of the battery, minimizing the risk of electrical shock if the isolation between the vehicle chassis and high voltage battery is insufficient.
- Several voltage measurements are necessary:
  - Voltage between high voltage positive of the battery relative to vehicle chassis.
  - Voltage between high voltage negative of the battery relative to vehicle chassis.
  - Depending on the first measurements, again one of the upper mentioned values with an additional predefined resistance between chassis and high voltage rail. Using the results of these measurements, an isolation resistance is calculated. This resistance is proved against thresholds, and an error state is determined.
  - The calculated isolation resistance shall have at least 250 kOhm based on the nominal voltage.

Normal Mode:
- The electrical hazard protection main system is split into isolation detection and interlock mechanism. 
- The isolation detection is triggered in 100ms time steps, and the other system runs in 10ms steps.

EHPN - Insulation Detection is split into two types:
1. **Battery pack insulation resistance measurement** when the contactors are in open state.
2. **Vehicle level insulation resistance measurement** when the contactors are in closed state.
3. **DC Fast Charge**: The insulation resistance measurement functionality is turned off by the VCU.

1. Battery Pack Insulation Detection:
- Positive Contactor and Negative Contactor are in open condition. The test is performed before the shutdown process is initiated. The insulation resistance of the battery pack is measured according to the lowest insulation resistance value of path.
Page 82
19. EHPN - Electrical Hazard Protection Network (Insulation detection).

This module handles the isolation detection as described in the document “SAE J1766 - Revision APR2005.” It executes the measurement procedure and calculates the isolation resistance. Additionally, the module handles the interlock mechanism input to detect an open high-voltage connection.

19.1. EHPN - ISO Function Description.

The function electrical hazard protection includes the isolation detection and interlock mechanism.

Isolation detection:
- The isolation detection calculates the isolation resistance out of voltage measurements between the vehicle chassis and the high-voltage connection of the battery, to minimize the risk of electrical shock if the isolation between the vehicle chassis and high-voltage battery is not sufficient anymore.
- Several voltage measurements are necessary:
  - Voltage between the high-voltage positive of the battery relative to the vehicle chassis.
  - Voltage between the high-voltage negative of the battery relative to the vehicle chassis.
  - Depending on the first measurements, again one of the upper-mentioned values with an additional predefined resistance between chassis and high-voltage rail. Using the results of these measurements, isolation resistance is calculated. This resistance is proved against thresholds, and an error state is determined.
  - The calculated isolation resistance shall have at least 250 kOhm based on the nominal voltage.

Normal Mode:
The electrical hazard protection main system is split into isolation detection and interlock mechanism. 
- The isolation detection is triggered in 100ms time steps. 
- The interlock system runs in 10ms steps.

EHPN - Insulation Detection is split into two types:
1. **Battery pack insulation resistance measurement** when the contactors are in an open state.
2. **Vehicle level insulation resistance measurement** when the contactors are in a closed state.
3. **DC Fast Charge** insulation resistance measurement functionality is turned off by the VCU.

Battery Pack Insulation Detection:
- Positive Contactor and Negative Contactor are in open condition. 
- The test is performed before the shutdown process is initiated. 
- The insulation resistance of the battery pack is measured according to the lowest insulation resistance value of the path.

During the next driving cycle, the stored value of insulation resistance is checked. If the insulation resistance value level is 1, then BMS_ERR_LEV = 1. If the level is 3, then BMS_ERR_LEV = 7. Initialization issues will be sent over PT-CAN.

**Figure 22**: Pack Isolation Detection.

Vehicle Level Insulation Detection:
- Positive Contactor and Negative Contactor are in closed condition.
- The test is performed during driving and AC charging. 
- The insulation resistance of the power train is measured according to the lowest insulation resistance value of the path.

During the next driving cycle, the stored value of insulation resistance is checked. If the insulation resistance value level is 1, then BMS_ERR_LEV = 1. If the level is 3, then BMS_ERR_LEV = 2 (Limp Home). Initialization issues will be sent over PT-CAN.

**Figure 23**: Vehicle Isolation Detection.
Page 83
19. EHPN - Electrical Hazard Protection Network (Insulation Detection).

This module handles isolation detection as described in the document “SAE J1766 - Revision APR2005.” It executes the measurement procedure and calculates the isolation resistance. Additionally, the module handles the interlock mechanism input to detect an open high-voltage connection.

19.1. EHPN - ISO Function Description.

The function electrical hazard protection includes isolation detection and the interlock mechanism.

**Isolation Detection:**
- The isolation detection calculates the isolation resistance from voltage measurements between the vehicle chassis and the high-voltage connection of the battery to minimize the risk of electrical shock if the isolation between these components is insufficient.
- Several voltage measurements are necessary:
  - Voltage between the high-voltage positive of the battery relative to the vehicle chassis.
  - Voltage between the high-voltage negative of the battery relative to the vehicle chassis.
  - Further measurements, using a predefined resistance between the chassis and high-voltage rail, help produce an isolation resistance calculation used to determine error states.
- The calculated isolation resistance must meet a threshold of at least 250 kOhm based on nominal voltage.

**Normal Mode:**
The electrical hazard protection system is divided into isolation detection (triggered in 100 ms intervals) and the interlock mechanism (running in 10 ms intervals).

**EHPN - Insulation Detection Types:**
1. Battery pack insulation resistance measurement when the contactors are in the open state.
2. Vehicle-level insulation resistance measurement when the contactors are in the closed state.
3. DC fast charge insulation resistance measurement functionality disabled by the VCU.

**Isolation Detection Details:**
1. **Battery Pack Insulation Detection**:
   - Positive and negative contactors are in the open condition.
   - The test is conducted before the shutdown process begins.
   - The lowest insulation resistance value within the battery pack is measured.
   - During the next driving cycle, the stored insulation resistance value is checked:
     - If the value is less than level 1, `BMS_ERR_LEV = 1`.
     - If the value is level 3, `BMS_ERR_LEV = 7`. Initialization issues are communicated via PT-CAN.

   *Figure 22: Pack Isolation Detection.*

2. **Vehicle Level Insulation Detection**:
   - Positive and negative contactors are in the closed condition.
   - The test is performed during driving or AC charging periods.
   - The lowest insulation resistance value within the powertrain is measured.
   - During the next driving cycle, the stored insulation resistance value is checked:
     - If the value is less than level 1, `BMS_ERR_LEV = 1`.
     - If the value is level 3, `BMS_ERR_LEV = 2` (Limp-Home). Initialization issues are communicated via PT-CAN.

   *Figure 23: Vehicle Isolation Detection.*

3. **DC Fast Charge Insulation Detection**:
   - `VCU_BMS_Insulation_Mon_Req = 1`: Forbids insulation resistance measurement functionality.
   - `BMS_VCU_Insulation_Mon_Sts = 1`: Disables insulation resistance measurement and delegates measurement functionality to the DC fast charger.

**Signal List:**
- Monitor resistance between HV+ to ground.
- Monitor resistance between HV- to ground.
- Send minimum insulation resistance value (`BMS_PackInsuRes`) via CAN communication.
- Grade the insulation resistance level based on the minimum measured value.
- Assess if insulation resistance status is normal and transmit this over CAN (`BMS_ISU_Status`).

**Table 13: Insulation Resistance Level Description.**

| Insulation Resistance (IR)    | Condition       | Grade (`BMS_ISU_Status`) |
|-------------------------------|-----------------|--------------------------|
| 250 kOhm < IR                 | Drive/AC-Charge | Normal                   |
| 100 kOhm < IR < 250 kOhm      | -               | Level 1                  |
| IR < 100 kOhm                 | -               | Level 3                  |

**State Transitions Based on Insulation Resistance Value:**

**Startup/Power On State:**
- If the previous trip ends with an insulation resistance value below 100 kOhm (`BMS_ISU_Status = Level 3`), then:
  - `BMS_ERR_LEV = 7`.
  - The contactor fails to close during power-on conditions.
  - The battery is locked. Manual service tool intervention is required to clear the locked state.

**During Driving:**
- If the insulation resistance value drops below 250 kOhm (`BMS_ISU_Status = Level 1`), then:
  - `BMS_ERR_LEV = 1` (Warning).
- If the value falls below 100 kOhm (`BMS_ISU_Status = Level 3`), then:
  - `BMS_ERR_LEV = 2` (Limp-Home).
  - The contactor remains closed.

**Measurement Control via CAN Signal:**
The measurement can be enabled or disabled via CAN (`VCU_BMS_Insulation_Mon_Req = 1/0`). Insulation circuit status (enabled or disabled) is communicated via `BMS_VCU_Insulation_Mon_Sts = 1/0`.
Page 84
### 19. EHPN - Electrical Hazard Protection Network (Insulation Detection)

#### 19.1. EHPN - ISO Function Description
The function electrical hazard protection includes the isolation detection and interlock mechanism.

**Isolation detection:**
- The isolation detection calculates the isolation resistance using voltage measurements between the vehicle chassis and the high voltage connection of the battery. This minimizes the risk of electrical shock in case the isolation is inadequate.
- Several voltage measurements are necessary:
  - Voltage between high voltage positive of the battery relative to the vehicle chassis.
  - Voltage between high voltage negative of the battery relative to the vehicle chassis.
  - Additional measurements are done considering predefined resistances between chassis and high voltage rail to calculate the isolation resistance. Results are compared against thresholds to determine error states.
  - The calculated isolation resistance shall be at least 250 kOhm based on the nominal voltage.

**Normal Mode:**
- The electrical hazard protection system is split into two parts: isolation detection (executed in 100ms intervals) and the interlock mechanism (executed in 10ms intervals).

**EHPN - Insulation Detection is split into two types:**
1. **Battery Pack Insulation Resistance Measurement:**
   - Test performed when contactors are in the open state.
   - Insulation resistance of the battery pack is measured before the shutdown process.
   - Resistance is determined based on the lowest insulation resistance path.

2. **Vehicle Level Insulation Resistance Measurement:**
   - Test performed during driving and AC charging, with the contactors in the closed state.
   - Insulation resistance of the powertrain is measured based on the lowest insulation resistance path.

**DC Fast Charge Insulation Detection:**
- Insulation resistance measurement is turned off when the vehicle is in DC fast charge mode. The measurement is performed by the DC fast charger.

---

### 3. DC Fast Charge Insulation Detection

- **VCU_BMS_Insulation_Mon_Req = 1:** Forbids insulation resistance measurement functionality.
- **BMS_VCU_Insulation_Mon_Sts = 1:** Turns off insulation resistance measurement; this is handled by the DC fast charger.

**Key functionalities:**
- BMS monitors resistance between HV+ and ground.
- BMS monitors resistance between HV- and ground.
- Minimum insulation resistance values are sent via CAN (BMS_PackInsuRes).
- Levels are divided based on resistance thresholds.
- Insulation resistance status is sent to the CAN bus (BMS_ISU_Status).

---

### Table 13: Insulation Resistance Level Description

| Insulation Resistance (IR) | Condition               | Grade (BMS_ISU_Status) |
|-----------------------------|-------------------------|-------------------------|
| 250 kOhm < IR              | Drive/AC-Charge        | Normal                 |
| 100 kOhm < IR < 250 kOhm   | -                       | Level 1                |
| IR < 100 kOhm              | -                       | Level 3                |

---

**Startup / Power on State:**  
- If the last trip insulation resistance is < 100 kOhm, the BMS_ERR_LEV = 7. Contactor closing is refused, and the battery remains locked. Clearing this state requires a service tool command.

**During Driving:**  
- Insulation resistance < 250 kOhm sets BMS_ERR_LEV = 1 (Warning, Level 1).  
- Insulation resistance < 100 kOhm sets BMS_ERR_LEV = 2 (Limp-Home, Level 3).

Measurement status (on/off) and initiation can be activated via CAN signals.

---

### Signal I/O Table

| **Name**                       | **Description**                                                            | **Min** | **Max**   | **Unit**  | **Sender** | **Receiver** |
|--------------------------------|----------------------------------------------------------------------------|---------|-----------|-----------|------------|--------------|
| BMS_PackInsuRes                | Minimum value of BCU_PosInsuRes and BCU_NegInsuRes                         | 0       | 60000     | kOhm      | BCU        | VCU          |
| BMS_ISU_Status                 | Insulation status                                                         | 0       | 3         | -         | BCU        | VCU          |
| BMS_PackInsu_ERR               | Insulation check lines have problems (short to ground or BAT)              | 0       | 3         | -         | BCU        | VCU          |
| BMS_VCU_Insulation_Mon_Sts     | Feedback signal for insulation monitoring status                          | 0       | 1         | -         | BCU        | VCU          |
| VCU_BMS_Insulation_Mon_Req     | CAN message to turn ON/OFF the insulation resistance measurement           | 0       | 1         | -         | VCU        | BCU          |

---

### Table 14: BMS Status Description

| **Name**             | **Description**                                  | **Value Description**                                                                 |
|----------------------|-------------------------------------------------|--------------------------------------------------------------------------------------|
| BMS_ISU_Status       | Insulation status                               | 3: Level 3 (IR < 100 kOhm); 1: Level 1 (150 kOhm < IR < 250 kOhm); 0: Normal (IR > 250 kOhm). |
| BMS_PackInsu_ERR     | Insulation check line issues (e.g., short to BAT or ground) | 0: Lv0, Lv1, Lv3 (Always = 0).                                                      |
Page 85
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock).

The BMS detects that all HV connectors are connected in the system without any open HV line connectors. 

The battery management system operates an interlock mechanism whereby a PWM signal is driven and evaluated by a watchdog timer. If the signal line is interrupted, the watchdog timer indicates an error. If the line is configured such that an opening of the battery or absence of a connecting line triggers a signal interruption, this error minimizes the risk of electrical shock.

### EHPN HVIL Hardware Signal Information:
**HVIL Signal Generation (HVIL-OUT):**
- Signal Type: PWM  
- Duty Cycle: 50%  
- Frequency of Signal: 50Hz  
- Maximum Current: 10mA  
- Principle: Open Drain Output with pull-up resistor of 5V.

**HVIL Signal Generation (HVIL-IN):**
The destination of the signal must receive and verify the status of the HVIL line.

### Figure 24: HVIL Mechanization
The diagram illustrates the HVIL circuit schematic, showcasing connections between the BMS, EAC, and PDU. The mechanism involves HVIL-IN and HVIL-OUT signals for interlock validation and error detection within the high voltage circuit.
Page 86
19.2. EHPN Electrical Hazard Protection Network (HVIL - High Voltage Interlock).

EHPN – HVIL Function Diagram. 

The BMS detects all HV connectors are connected in the system without any open HV line connector. The battery management system operates an interlock mechanism. A signal line with a PWM signal is driven and evaluated by a watchdog timer. If the line is interrupted, the watchdog indicates an error. If the line is fitted such that opening the battery or the absence of a connecting line causes a signal interruption, this error minimizes electrical shock risks.

### EHPN HVIL Hardware Signal Information.
#### HVIL Signal Generation (HVIL-OUT):
- Signal Type: PWM.
- Duty Cycle: 50%.
- Frequency of Signal: 50Hz.
- Max Current: 10mA.
- Principle: Open Drain Output with a pull-up resistor of 5V.

#### HVIL Signal Generation (HVIL-IN):
The destination of the signal receives and verifies the HVIL line status.

### HVIL Source Generation Description.
HVIL source generation is done by BMS. It is a PWM signal with a 50% duty cycle and a frequency of 50Hz (calibratable). This signal is transmitted through HVIL OUT and routed to various HV connector lines. The same signal is received via HVIL IN in the BMS. If the received signal matches the sent signal, BMS determines that the HVIL line is in a closed state. If the signal received is ~5V, BMS concludes the HVIL line is open or shorted to BAT. If less than 0.5V, BMS determines the line is shorted to ground.

### HVIL State Conditions.
| **State**       | **CAN Signal** | **BMS_HVIL_STS** | **BMS_Sys_STS** | **BMS_ERR_LEV** |
|------------------|----------------|------------------|-----------------|-----------------|
| **Startup**      | 0 - Closed     | 1                | 0               | 2               |
|                  | 2              | 7                | 4               |                 |
| **Run - Driving**| 0 - Closed     | 2                | 0               | 2               |
|                  | 2              | 2                | 1               |                 |
| **Run - Charging**| 0 - Closed    | 2                | 0               | 2               |
|                  | 2              | 7                | 4               |                 |

### Additional Details of Interlock Mechanism.
The 10ms task includes the interlock mechanism:
- A PWM output signal is sent by the BCU and received by a watchdog device. Parameters like time period and duty cycle are calibrated through the BSW interface. 
- A debouncer is activated after a calibratable delay following the BCU startup. This delay ensures a sufficient number of correct PWM flags before outputting a valid condition. The task functions every 10ms increment the counter by 0.01.
- Errors are saved using the CDEM interface.
Page 87
20. SOX - Cell Balance:

20.1. SOX - Cell Balance Function Description.
SOC and SOH estimation assumes that the cells within a module fit together. This applies as long as no cell inhomogeneous deterioration occurs. It is assumed that single cells will fail, otherwise the cells within the module fit together, and this shall be covered by the SOH.

The cell wear detection monitors the cell SOC deviations and the cell resistance deviations compared to the average module estimates. This information is then used for:
- Adaptation of the current limits predicted by SOF, to avoid any violation of cell limits in advance.
- Cell SOC values are used for the balancing decision, which is not relying on cell voltage. This allows balancing under all operating conditions.
Early detection of cell faults occurs in case the cell resistance increases or the cell SOC decreases significantly compared to the average.

The cell balancing functionality is supposed to balance the state of charge of the individual cells in order to maximize the usable battery capacity. The balancing method should be self-powered by the battery cells (not dependent on external voltage supply). Where passive balancing is used, the dissipating resistors shall not require any external cooling measures.

When the difference between the maximum SOC of a cell and the minimum SOC of a cell is larger than 5% (calibratable), then the BMS should enable the balance function and send the signal `BMS_Balance_STS = 1`:
- BMS, at most, should be able to enable 10-channel equalization control.
- Balance current cannot exceed 300mA/cell.
- When the balancing function is turned on, it is found that the BMS is faulty, and the balancing needs to be stopped.
- BMS needs to monitor PCB temperature.
- When the PCB temperature exceeds 70 ℃, the equalization needs to be stopped.

If the MCU detects the cell balancing switch is short or open, it will set the `BMS_BatBalance_ERR = error`.

The cell balancing strategy is using capacity-based balancing schemes.

**Signal I/O:**
Name: `BMS_Balance_STS`.  
Description: BMS Balance Status.  
Min value: 0.  
Max value: 1.  
Value Description: 1: active; 0: inactive.  
Sender: BMS.  
Receiver: VCU.

Name: `BMS_BatBalance_ERR`.  
Description: Battery Balance Error indicates balancing switch is short or open.  
Min value: 0.  
Max value: 1.  
Value Description: 1: normal; 0: error.  
Sender: BMS.  
Receiver: VCU.

---

**SOF – Function Description.**
The BMS calculates current limitations and voltage predictions to ensure that the battery is always operated in a safe mode and meets performance and lifetime targets.  
The calculation is based on a model-driven approach that restricts the current (in both charge and discharge directions) to avoid exceeding cell voltage limits and ensures thermal restrictions are met.
Page 88
20. SOX - Cell balance.

20.1. SOX - Cell Balance Function description.

SOC and SOH estimation assumes that the cells within a module fit together. This applies as long as no cell inhomogeneous deterioration occurs. It is assumed that single cells will fail, otherwise the cells within the module fit together and this shall be covered by the SOH.

The cell wear detection monitors the cell SOC deviations and the cell resistance deviations compared to the average module estimates. This information is then used for:
- Adaptation of the current limits predicted by SOF, to avoid any violation of cell limits in advance.
- Cell SOC values are used for the balancing decision, which is not relying on cell voltage. This allows balancing under all operating conditions.

Early detection of cell faults: In case the cell resistance increases or the cell SOC decreases significantly compared to the average.

The cell balancing functionality is supposed to balance the state of charge of the individual cells in order to maximize the usable battery capacity. The balancing method should be self-powered by the battery cells (not dependent on external voltage supply). Where passive balancing is used, the dissipating resistors shall not require any external cooling measures.

When the difference of maximum SOC of cell and the minimum SOC of cell is larger than the SOC difference exceeds 5% (calibratable), then BMS should enable the balance function and send the `BMS_Balance_STS = 1`.
- BMS at most, should be able to enable 10-channel equalization control.
- Balance current cannot exceed 300mA/cell.
- When the balancing function is turned on, it is found that the BMS is faulty, and the balancing needs to be stopped.
- BMS needs to monitor PCB temperature.
- When the PCB temperature exceeds 70 ℃, the equalization needs to be stopped.

When the MCU detects the cell balancing switch short or open then set the `BMS_BatBalance_ERR=error`. The cell balancing strategy is using capacity-based balancing schemes.

Signal I/O:
| Name                      | Description                                      | Min | Max  | Value Description         | Sender | Receiver |
|---------------------------|--------------------------------------------------|-----|------|---------------------------|--------|----------|
| BMS_Balance_STS          | BMS Balance Status                              | 0   | 1    | 1: active; 0: Inactive    | BMS    | VCU      |
| BMS_BatBalance_ERR       | Battery Balance Error indicates Balancing switch is short or open | 0 | 1 | 1: normal; 0: Error       | BMS    | VCU      |

---

20.2. SOX - SOC Function description.

SOC cannot be measured directly, at least for today's Lithium-Ion systems, but an accurate SOC is mandatory for the energy management control system. The State-of-Charge is calculated as a percentage at pack and cell level.

The battery core function for SOC-estimation is based on AVL’s proprietary model-based algorithms:
- A battery model and an observer are used to continuously monitor the state of the battery.
- Due to computational power demand, estimation is done on module level rather than on cell-level.
- The internal states (including SOC) of the battery model are adapted if a difference between measured module voltage and predicted module voltage (output of the battery model) is present.
- A simplified linear algorithm calculates the cell-to-cell deviation within the module to also have information about cell SOC as well as cell resistance.

This result is an accurate, stable convergence of the SOC estimate throughout the battery lifetime.

BMS should calculate the SOC and send it to CAN (`BMS_SocActual_EST=XXX`). The error between `BMS_SocActual_EST` and the real SOC should be limited xx%.

In order to improve the accuracy of `BMS_SocActual_EST`, BMS can correct the SOC when necessary:
- Need to meet the conditions of -40 ℃ ~ 85 ℃; need to ensure that the acquisition accuracy meets the design requirements.
- SOC estimation period needs to meet 100ms.

Note: It is the real SOC of the cell that shall not be used for display purposes.

Signal I/O:
| Name                | Description   | Min | Max | Value Description | Sender | Receiver |
|---------------------|---------------|-----|-----|-------------------|--------|----------|
| BMS_SocActual_EST  | Actual SOC    | 0   | 100 |                   | BMS    | VCU      |
Page 89
20.3. SOX - SOH Function description.  
The nominal capacity of the pack is the base information to identify the battery capacity. The main idea is to identify the limiting value of various criteria from module and cell-based health parameters and report that as the pack SOH value. The parameters included are maximum cell SOC and resistance deviations, as well as module resistance and capacity deviation. The highest module/cell deviation value is mapped to a respective SOH value based on maps; this allows a relation to SOH.  

BMS should calculate the SOH and send it to CAN (BMS_SOH=XXX).  
SOHPack has a range of [0%, 100%] and it is calculated considering previous trip information and stays constant during a trip.  

The error between BMS_SOH and the real SOH should be limited in 5%:  
- Need to meet the conditions of -40°C ~ 85°C, and need to ensure that the acquisition accuracy meets the design requirements.  

BMS needs to have the ability to estimate the battery internal resistance aging SOH state.  

When BMS_SOH < 5%, the Battery Replacement Warning will be sent to MHU. Real Battery SOH is around 71.5%. When SOH < 0% still Battery Replacement Warranty will be sent. Real Battery SOH < 70%.  

---

**Signal I/O**  

- **Name:** BMS_SOH  
  **Description:** BMS State of Health  
  **Min:** 0  
  **Max:** 100  
  **Sender:** BMS  
  **Receiver:** VCU  

- **Name:** BMS_BatteryReplacement  
  **Description:** Separate signal to indicate battery replacement information (Battery replacement MHU)  
  **Value Description:**  
  - 1: Warning  
  - 0: No warning  
  **Sender:** BMS  
  **Receiver:** MHU
Page 90
20.4. SOX - SOP Function Description.

Permissible power allowed during charging and discharging with instantaneous and continuous values are provided. The VCU shall allow the permissible power region of operation only.

BMS should calculate the maximum allowable discharge power of the pack in 30/15/10/2 seconds in real-time using the 3D data table, and send it to CAN (BMS_MaxDischgPwr_Peak =XXX). The maximum discharge power allowed for 30/15/10/2s interval is shared to other ECUs to limit the power drawn from the high voltage battery pack.

BMS should calculate the maximum allowable discharge power of the pack continuously in real-time using the 3D data table, and send it to CAN (BMS_MaxDischgPwr_ALW =XXX). The maximum discharge power allowed continuously is shared to other ECUs to limit the power drawn from the high voltage battery pack.

BMS should calculate the maximum allowable charge power of the pack in 30/15/10/2 seconds in real-time using the 3D data table, and send it to CAN (BMS_MaxChgPwr_Peak =XXX). The maximum charge power allowed for the 30/15/10/2s interval is shared to other ECUs to limit the regen power provided to the high voltage battery pack.

BMS should calculate the maximum allowable charge power of the pack continuously in real-time using the 3D data table, and send it to CAN (BMS_MaxChgPwr_ALW =XXX). The maximum regenerative charge power allowed continuously is shared to other ECUs to limit the regen power provided to the high voltage battery pack.

---

### Signal I/O Table:
| Name                     | Description                                    | Min | Max | Unit | Sender | Receiver |
|--------------------------|------------------------------------------------|-----|-----|------|--------|----------|
| BMS_MaxDischgPwr_Peak    | Allow Peak Discharge Power                    | 0   | 800 | kW   | BMS    | VCU      |
| BMS_MaxDischgPwr_ALW     | Allow Max Discharge Power                     | 0   | 800 | kW   | BMS    | VCU      |
| BMS_MaxChgPwr_Peak       | Allow Peak Regenerative Power                 | 0   | 800 | kW   | BMS    | VCU      |
| BMS_MaxChgPwr_ALW        | Allow Max Regenerative Power                  | 0   | 800 | kW   | BMS    | VCU      |
Page 91
21. HW Crash Signal.

21.1. HW - Crash Function Description.

To detect the crash fault using a redundant signal, the ACM provides a hardwire signal. The crash is detected via the following hardware circuit:

**Figure 25: Crash Signal Receiver Hardware Circuit.**

**PWM Signal During No Crash:** During normal operation, the PWM signal alternates between a defined time interval of 200ms and 40ms, ensuring regular monitoring.

**PWM Signal During Crash:** In the event of a crash, a distinct crash event notification signal is sent, consisting of a 20-pulse sequence, interrupting the normal operation signal pattern.

When the Battery Management System (BMS) detects the hardwire crash PWM signal:
- The BMS sends `BMS_HWCrash_Sts = Crash`, with the error level `BMS_ERR_LEV=5`.
- The BMS immediately opens the high voltage contactor, breaking the high voltage connection. At this point, `BMS_HVOnOff_STS = HV Off` is sent.
- If the Vehicle Control Unit (VCU) sends `VCU_BMS_HVOnOff_REQ = forbid`, the secondary path for the BMS should also open the high voltage contactor.

This is a non-recoverable fault. Once detected, it is logged into memory and cleared only after service intervention.

**Signal I/O**
| Name                | Description                                                     | Min | Max | Sender | Receiver |
|---------------------|-----------------------------------------------------------------|-----|-----|--------|----------|
| BMS_HWCrash_Sts     | Crash status detected by hardware signal                       | 0   | 1   | BMS    | VCU      |
| BMS_ERR_LEV         | Error level corresponding to crash event                       | 0   | 5   | BMS    | VCU      |
| BMS_HVOnOff_STS     | High Voltage On/Off status after crash                         | 0   | 1   | BMS    | VCU      |
| VCU_BMS_HVOnOff_REQ | Request from VCU to disable high voltage connections           | 0   | 1   | VCU    | BMS      |
Page 92
21. HW Crash Signal.

21.1. HW - Crash Function Description.

To detect the crash fault using redundant signal, the ACM gives a hardwire signal for crash hardware circuit detection.

When BMS detects the hardwire crash PWM signal, then the BMS should send:
- `BMS_HWCrash_Sts = Crash`
- The error level is `BMS_ERR_LEV = 5` to VCU. 

Additionally:
- The high voltage contactor is immediately opened, and when the high voltage is broken, then `BMS_HVOnOff_STS = HV Off`.
- If `VCU_BMS_HVOnOff_REQ = forbid` is sent by VCU, the secondary path for the BMS should also open the high voltage contactor.

This is a non-recoverable fault: once the fault is detected, it is logged into memory and cleared after service.

Signal I/O:

| Name              | Description              | Min | Max | Value Description | Sender | Receiver |
|-------------------|--------------------------|-----|-----|-------------------|--------|----------|
| `BMS_HWCrash_Sts` | HW crash signal status   | 0   | 1   | 1: crash; 0: no crash | BMS    |          |

---

21.2. Wakeup Function Description.

The BMS wakes up via Network CAN or Ignition signal (KL15). The Ignition and CAN signals are connected to the SBC (System Basis Chip). When a signal change is identified by SBC during sleep or standby mode, it wakes up the BMS. A trip is counted when this signal transitions from a complete ON to OFF state.

Signal I/O:

| Name            | Description                    | Min | Max | Value Description | Sender | Receiver |
|-----------------|--------------------------------|-----|-----|-------------------|--------|----------|
| `BMS_IGN_Sts`  | The ignition signal status (on/off) | 0   | 1   | 1: ON; 0: OFF     | BMS    | VCU      |

---

21.3. SFM - Safety Fault Monitoring.

SFM - Function Description:

Safety fault monitoring is an ASIL C signal that checks for overall safety faults in the high voltage battery pack and provides this information to the VCU.

---

21.4. E2E Protection.

All ASIL Level signals are protected with E2E mechanisms. 

References:
- Document VFDSAAEEP0047_CAN_Specification, Chapter `3.11.9 Protection of Safety Messages Across Network`.
- Fault Reaction Matrix: `ARE9452_Safety_Fault_Reactions.xlsx`.
Page 93
22. BMS Diagnostics.

The BMS platform diagnostic concept is designed for BEV applications. Currently, Euro 5 emission standards are required for Vietnamese legislation regarding BEVs, but no OBD system is mandatory. Similarly, according to current US legislation, there is no mandatory requirement for OBD systems for BEVs. If HEV applications are considered in the future, legal OBD features shall be developed.

22.1. Diagnostics Implementation Architecture.

Figure 26: Diagnostics Architecture.

The architecture visually depicts the diagnostic implementation for the platform. Key components include FID, sensed values/signals, enable conditions, and diagnostic functions coordinated with associated modules like FIM, DEM, and DCM.

Diagnostic Coordination:
- Diagnostic development topics are coordinated to integrate the platform diagnostic SW component.
- System assessments are conducted to identify required SW adaptations.
- Updates are documented within the Diagnostic Concept, including DTC lists, interface signals, implementation statuses, reaction groups, etc.

Implementation specifics:
- Diagnostics are implemented and configured according to AUTOSAR standards (DEM, FIM).
- Fault management follows AUTOSAR configurations for DCM, DEM, and FIM, which are integrated and tested.

Fault management covers:
- Fault storage.
- Freeze Frame Groups.
- FIM configuration (fault reactions).
- UDS communication (Service Tool).

The platform supports a DTC list containing P-Codes, error names, priority, freeze frame data, FIDs, and function inhibition matrices. Additionally, electrical errors such as open circuits, short circuits to the ground, and short circuits to the battery are qualified, and the corresponding error symptoms are triggered.
Page 94
22. BMS Diagnostics.

The Battery Management System (BMS) platform diagnostic concept is designed for Battery Electric Vehicle (BEV) applications. According to current Vietnamese legislation, Euro 5 emission standards are required, but there is no mandatory On-Board Diagnostics (OBD) system for BEV. Similarly, current US legislation does not mandate an OBD system for BEV. Legal OBD requirements are excluded from this concept for BEV. However, in the case of future Hybrid Electric Vehicle (HEV) applications, legal OBD features will be developed.

22.1. Diagnostics Implementation Architecture.

The diagnostic implementation process involves the coordination and integration of platform diagnostic software (SW) components. A systematic assessment identifies required SW adaptations, documenting updates in the diagnostic concept. Key updates include DTC lists, interface signals, implementation statuses, and reaction groups.

Diagnostics follow AUTOSAR standards, including Diagnostic Event Manager (DEM) and Function Inhibition Matrix (FIM). Fault management is configured, integrated, and tested with the following elements:
- Fault storage.
- Freeze Frame Groups.
- FIM configuration (fault reactions).
- UDS Communication (Service Tool).

The implemented Diagnostic Trouble Code (DTC) list includes P-Codes, error names, priorities, freeze frame data, and Fault Inhibition Matrix (FIM). Electrical errors such as open circuits, short circuits to ground, and short circuits to battery are qualified and trigger corresponding error symptoms.

Figure 26: Diagnostics Architecture.
The architecture diagram illustrates the flow from sensed values, enable conditions, and diagnostic functions to AUTOSAR components such as DEM and FIM.

CAN diagnostics are implemented at the Basic Software (BSW) level, focusing primarily on debounce counters and replacement values. Application Software (ASW) handles checksum, timeout, and Bus Off errors. Functional errors critical to BMS protection and safety reactions are included in this concept.

Unified Diagnostic Services (UDS) signals are part of this platform, and freeze frames, service $22, and service $2E are considered. Additional recalculations for signal resolution are supported. ODX file formats for diagnostics information shall be made available upon request.

General Requirements.
As stated in the Functional Safety Concept (FSC), the Technical Safety Concept (TSC) ensures the system achieves safety goals and maintains safety functionality. The BMS incorporates various safety measures:

Safety measures for detecting, indicating, and controlling faults in external devices:
- SM[BCU].100.1 Stable communication check (ASIL C).
- SM[BCU].100.2 End-to-end check of input CAN signals (ASIL C).
- SM[BCU].300.1 End-to-end protection of output CAN signals (ASIL C).

Safety measures for detecting, indicating, and controlling system faults:
- SRF[BCU].201.1 Determination of HV Battery cell temperatures (ASIL C).
- SM[BCU].201.2 Cell temperature monitoring (ASIL C).
- SRF[BCU].202.1 Determination of HV Battery pack current (ASIL C).
- SM[BCU].202.2 Pack current monitoring (ASIL C).
- SM[BCU].202.3 Energy flow monitoring (ASIL C).
- SRF[BCU].203.1 Determination of HV Battery cell voltages (ASIL C).
- SM[BCU].203.2 Cell voltage monitoring (ASIL C).
- SM[BCU].207.1 Power up/down handling (ASIL C).
- SRF[BCU].208.1 Determination of insulation resistance (ASIL A).
- SM[BCU].208.2 Insulation resistance monitoring (ASIL A).
- SRF[BCU].210.1 Determination of HVIL signal (ASIL B).
- SM[BCU].210.2 HVIL monitoring (ASIL B).
- SRF[BCU].300.1 Determination of safety-relevant output information (ASIL C).

Safety measures preventing latent faults:
- SRF[BCU].204.1 Determination of HV contactor deterioration (ASIL A).
- SML[BCU].204.2 HV contactor deterioration monitoring (ASIL A).
- SRF[BCU].205.1 Determination of high voltages (ASIL A).
Page 95
- **Safety measures which prevent faults from being latent:**
  - SML[BCU].205.2 HV contactor weld check (ASIL A)
  - SML[BCU].206.1 HV contactor monitoring (ASIL A)
  - SML[BCU].211.1 Switch-off path test (ASIL A)
  - SML[BCU].212.1 KL30 voltage monitoring (ASIL A)

- **Safety measures that enable the system to achieve or maintain a safe state:**
  - SS[BMS].01 Disconnect the HV Battery pack (ASIL C).
  - SS[BMS].02 Remain disconnected from HV Power net (ASIL C).
  - SS[BMS].03 Driver warning of thermal event (ASIL C).
  - SS[BMS].04 Remain temporarily disconnected from HV Power net (ASIL C).

- **Safety measures ensuring the integrity of the execution environment:**
  - Requirements on Aurix microcontroller as SEooC.
  - Requirements on System Basis Chip (TLF35584) as SEooC.
  - Requirements on Multi-cell Battery Stack Monitor (LTC6813) as SEooC.

### Determination of Operating Mode:
| Condition                                                                 | Action                                                             |
|---------------------------------------------------------------------------|-------------------------------------------------------------------|
| the HV_Battery_Pack_Actual_Current falls below the zero offset threshold AND the Charge_Allow_Flag indicates that charging is active | set HV_Battery_Operating_Mode to Charging                          |
| the HV_Battery_Pack_Actual_Current falls below the zero offset threshold AND the Charge_Allow_Flag indicates that charging is NOT active | set HV_Battery_Operating_Mode to Recuperation                     |
| the HV_Battery_Pack_Actual_Current exceeds the zero offset threshold      | set HV_Battery_Operating_Mode to Discharging                      |
| the HV_Battery_Pack_Actual_Current is within range of the zero offset threshold AND the HV contactors are open | set HV_Battery_Operating_Mode to Disconnected                     |
| the Charge_Allow_Flag_External_Fault is set                               | The last active state is maintained                                |
Page 96
Faults and Actions:

**Temperature sensor fault monitoring:**
- Actions:
  - Range Check
  - Open Wire Check
  - Number of Sensor Check

**Current Sensor fault monitoring:**
- Actions:
  - CAN-based shunt sensor fault (ASIL C)
  - ADC-based Hall sensor fault (ASIL B©)
  - Current sensor plausibility check
  - Both sensor fault

**Energy flow limit monitoring:**
- Actions:
  - BDU components overheating

**Temperature-based current limitation:**
- Actions:
  - Charging: 0 to 50 allow charge current
  - Discharging: 0 to 60 allow discharge current

**Thermal runaway monitoring:**
- Actions:
  - Works if the cell fulfills EUCAR L4 requirements

**Cell voltage protection limits:**
- Actions:
  - Lock the battery pack when the protection limit is reached

**Degradation mode:**
- Actions:
  - Limp home mode activation

**HVIL Monitoring:**
- Actions:
  - Short to BAT
  - Short to GND
  - Duty cycle or frequency exceeds limit

**Crash monitoring:**
- Actions:
  - CAN signal received from ACM

**Insulation resistance monitoring:**
- Actions:
  - Limp home mode request
  - Battery lock if limit is reached

**CAN communication fault monitoring:**
- Actions:
  - Driving: Limp Home mode activation
  - Charging: Open contactor

**CAN E2E Fault:**
- Actions:
  - Open contactor

**KL30 Voltage monitoring (9–16V):**
- Actions:
  - Detect and respond to out-of-range fault
Page 97
**VinES VFDSXVBAT1061**  
**Version: 3**  
**Uncontrolled copy when printed**  
**Page 97 | 101**  

**List of Safety relevant CAN signals:**

| Sender | Receiver | Message                       | Signal                 | ASIL | Comment                          |
|--------|----------|-------------------------------|------------------------|------|----------------------------------|
| VCU    | BCU      | VCU_BMS_HVOnOff_Req          | VCU_BMS_HVOnOff_Req   | ASIL C | OK                              |
| VCU    | BCU      | VCU_BMS_Information_0x217    | BMS_Insulation_Mon_Req | ASIL C | OK                              |
| VCU    | BCU      | VCU_PreChrgAllow_0x219       | VCU_ChargeAllow        | ASIL C | OK                              |
| ACM    | BCU      | ACM_Crash_Sts_0x25           | ACM_Crash_Sts          | ASIL C | OK                              |
| VCU    | BCU      | BMS_MaxCellTemp_0x245        | BMS_MaxCellTemp        | ASIL C | OK                              |
| VCU    | BCU      | BMS_MinCellTemp_0x245        | BMS_MinCellTemp        | ASIL C | OK                              |
| VCU    | BCU      | BMS_PackCur_MEAS_0x174       | BMS_PackCur_MEAS       | ASIL C | OK                              |
| VCU    | BCU      | BMS_ERR_LEV                  | BMS_ERR_LEV            | ASIL C | OK                              |
| VCU    | BCU      | BMS_HVIL_Sts_0x216           | BMS_HVIL_Sts           | ASIL C | OK                              |

**List of Safety DTC:**

| DTC Number (hex) | DTC Display Number | Failure type Byte and meaning        | DTC Name                                  |
|-------------------|--------------------|---------------------------------------|-------------------------------------------|
| 0x12AC01          | P12AC01           | 0x01 - General Electric Failure       | L2 error: Vehicle-level isolation NVM fault |
| 0x12B09A          | P12B09A           | 0x9A - Component or System Operating Conditions | L2 error: Cell over temperature fault      |
| 0x12B117          | P12B117           | 0x17 - Circuit Voltage Above Threshold | L2 error: Cell overvoltage fault          |
| 0x12B29A          | P12B29A           | 0x9A - Component or System Operating Conditions | L2 error: Cell temperature deviation fault |
| 0x12B39A          | P12B39A           | 0x9A - Component or System Operating Conditions | L2 error: Cell under temperature fault     |
| 0x12B416          | P12B416           | 0x16 - Circuit Voltage Below Threshold | L2 error: Cell under voltage fault        |
| 0x12B562          | P12B562           | 0x62 - Signal Compare Failure         | L2 error: Cell voltage delta fault        |
| 0x12B601          | P12B601           | 0x01 - General Electric Failure       | L2 error: Current sensor 1 invalidity fault |
| 0x12B701          | P12B701           | 0x01 - General Electric Failure       | L2 error: Current sensor 2 invalidity fault |
| 0x12B801          | P12B801           | 0x01 - General Electric Failure       | L2 error: Current sensor plausibility fault |
| 0x12B901          | P12B901           | 0x01 - General Electric Failure       | L2 error: Energy flow fault               |
| 0x12BB01          | P12BB01           | 0x01 - General Electric Failure       | L2 error: HVIL open line fault            |
| 0x12BC01          | P12BC01           | 0x01 - General Electric Failure       | L2 error: HVIL invalidity/short fault     |
Page 98
VinES  
VFDSXVBAT1061  

Version: 3  
Uncontrolled copy when printed  
98 | 101  
Print date  
Status  
Functional Responsibility  

Safety DTC List:

1. **DTC Number:** 0x12BD01  
   **DTC Display Number:** P12BD01  
   **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
   **DTC Name:** L2 error: Pack-level isolation NVM fault  

2. **DTC Number:** 0x12C000  
   **DTC Display Number:** P12C000  
   **Failure Type Byte and Meaning:** 0x00 - No sub type information  
   **DTC Name:** L2 error: Module/cell/sensor configuration fault  

3. **DTC Number:** 0x12C101  
   **DTC Display Number:** P12C101  
   **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
   **DTC Name:** L2 error: Overcurrent fault  

4. **DTC Number:** 0x12C262  
   **DTC Display Number:** P12C262  
   **Failure Type Byte and Meaning:** 0x62 - Signal Compare Failure  
   **DTC Name:** L2 error: Pack voltage plausibility fault  

5. **DTC Number:** 0x12C300  
   **DTC Display Number:** P12C300  
   **Failure Type Byte and Meaning:** 0x00 - No sub type information  
   **DTC Name:** L2 error: Safety system deactivation  

6. **DTC Number:** 0x12C49A  
   **DTC Display Number:** P12C49A  
   **Failure Type Byte and Meaning:** 0x9A - Component or System Operating Conditions  
   **DTC Name:** L2 error: Thermal runaway fault  

7. **DTC Number:** 0x12C500  
   **DTC Display Number:** P12C500  
   **Failure Type Byte and Meaning:** 0x00 - No sub type information  
   **DTC Name:** L2 error: Vehicle crash NVM fault  

8. **DTC Number:** 0x12C700  
   **DTC Display Number:** P12C700  
   **Failure Type Byte and Meaning:** 0x00 - No sub type information  
   **DTC Name:** Disconnect request from L2 Safety  

9. **DTC Number:** 0x12C800  
   **DTC Display Number:** P12C800  
   **Failure Type Byte and Meaning:** 0x00 - No sub type information  
   **DTC Name:** L2 error: LTC single-point SM fault  

10. **DTC Number:** 0x12C900  
    **DTC Display Number:** P12C900  
    **Failure Type Byte and Meaning:** 0x00 - No sub type information  
    **DTC Name:** L2 error: LTC latent-point SM fault  

11. **DTC Number:** 0x12CA01  
    **DTC Display Number:** P12CA01  
    **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
    **DTC Name:** L2 error: Single cell temperature sensor electrical fault in a module  

12. **DTC Number:** 0x12CB01  
    **DTC Display Number:** P12CB01  
    **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
    **DTC Name:** L2 error: More than one cell temperature sensor electrical fault in a module  

13. **DTC Number:** 0x12CC16  
    **DTC Display Number:** P12CC16  
    **Failure Type Byte and Meaning:** 0x16 - Power supply voltage below threshold  
    **DTC Name:** L2 error: Cell under voltage protection fault  

14. **DTC Number:** 0x12CC17  
    **DTC Display Number:** P12CC17  
    **Failure Type Byte and Meaning:** 0x17 - Power supply voltage above threshold  
    **DTC Name:** L2 error: Cell overvoltage protection fault  

15. **DTC Number:** 0x12CD01  
    **DTC Display Number:** P12CD01  
    **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
    **DTC Name:** L2 error: Switch-off path test fault  

16. **DTC Number:** 0x12CE01  
    **DTC Display Number:** P12CE01  
    **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
    **DTC Name:** L2 error: HSD feedback current fault  

17. **DTC Number:** 0x12CF01  
    **DTC Display Number:** P12CF01  
    **Failure Type Byte and Meaning:** 0x01 - General Electric Failure  
    **DTC Name:** L2 error: LSD feedback voltage fault  

18. **DTC Number:** 0x12D044  
    **DTC Display Number:** P12D044  
    **Failure Type Byte and Meaning:** 0x44_data memory failure  
    **DTC Name:** L2 error: Welded negative contactor NVM fault  

19. **DTC Number:** 0x12D144  
    **DTC Display Number:** P12D144  
    **Failure Type Byte and Meaning:** 0x44_data memory failure  
    **DTC Name:** L2 error: Welded positive contactor NVM fault  

20. **DTC Number:** 0x12D244  
    **DTC Display Number:** P12D244  
    **Failure Type Byte and Meaning:** 0x44_data memory failure  
    **DTC Name:** L2 error: Welded pre-charge contactor NVM fault  

21. **DTC Number:** 0x12D344  
    **DTC Display Number:** P12D344  
    **Failure Type Byte and Meaning:** 0x44_data memory failure  
    **DTC Name:** L2 error: NVM value-complement storage fault  

22. **DTC Number:** 0xD10508  
    **DTC Display Number:** U110508  
    **Failure Type Byte and Meaning:** 0x08 - Bus Signal / Message Failure  
    **DTC Name:** L2 error: MCU communication fault  

23. **DTC Number:** 0xD20400  
    **DTC Display Number:** U120400  
    **Failure Type Byte and Meaning:** 0x00 - No sub type information  
    **DTC Name:** L2 error: Current sensor 1 timeout fault  

24. **DTC Number:** 0xD20500  
    **DTC Display Number:** U120500  
    **Failure Type Byte and Meaning:** 0x00 - No sub type information  
    **DTC Name:** L2 error: Current sensor 1 alive counter fault  

25. **DTC Number:** 0xC41686  
    **DTC Display Number:** U041686  
    **Failure Type Byte and Meaning:** 0x86 - Signal invalid  
    **DTC Name:** L2 error: HV Battery state request range check fault  

26. **DTC Number:** 0xC45286  
    **DTC Display Number:** U045286  
    **Failure Type Byte and Meaning:** 0x86 - Signal invalid  
    **DTC Name:** L2 error: Vehicle crash state range check fault
Page 99
23. Mechanical Requirements  
Housing of the BMS is considered as a mechanical item.  
Housing is made by aluminum.  

23.1. Electromagnetic Compatibility  
EMC Requirements: – ECE R10.  
FCC-Part 15.  

23.2. Electrostatic Discharge  
ESD Requirements: Refer to the BMS DVP test plan.  

23.3. Climatic Requirements / Thermal Management  

Environmental operating conditions:  
The ambient temperature, relative humidity, and altitude shall meet the vehicle performance operating environment.  

Heat protection:  
The development and validation of the heat protection in the complete vehicle ensures that all relevant component temperatures remain below the maximum allowed limits, which are derived from vehicle operation within the environmental operating temperatures.
Page 100
24. Testing and Validation

24.1. Proof of Compliance.

Conformity of certified products refers to the degree to which the products using the certification mark are consistent with type test samples in terms of design, structure, and key components and materials used. Specifically, the following three are consistent:  
- The mark of the certified product should be consistent with that indicated on the type test report.  
- The structure of the certified product shall be the same as the sample in the type test.  
- The parts and materials used in the certification products shall be consistent with those declared in the type test and confirmed by the certification body.  

24.2. Testing Plan for BMS (DVP Plan).

**Electrical Systems & Functions**  
Several validation cycles for electrical systems and functions are planned to guarantee correct implementation and will be carried out according to mentioned standards.  

**Documents shall be provided on request:**  
- ARE9452_DVP.pdf  
- ARE9452_DVPR_final.pdf
Page 101
25. Vehicle Requirement.

VFSRXVEEP4030 – 20203103_SOR for battery pack B_C_Purchase.docx.